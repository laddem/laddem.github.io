[{"authors":null,"categories":null,"content":"O Laborat√≥rio de An√°lise de Dados em Demografia √© parte do N√∫cleo de Estudos de Popula√ß√£o Elza Berqu√≥ e dedica-se a promo√ß√£o do conhecimento na √°rea de demografia, ci√™ncias sociais quantitativas e ci√™ncia de dados, oferecendo cursos, eventos e infraestrutura para alunos, pesquisadores e o p√∫blico em geral.\n","date":1554595200,"expirydate":-62135596800,"kind":"term","lang":"en","lastmod":1554595200,"objectID":"2525497d367e79493fd32b198b28f040","permalink":"https://laddem.github.io/author/laddem/","publishdate":"0001-01-01T00:00:00Z","relpermalink":"/author/laddem/","section":"authors","summary":"O Laborat√≥rio de An√°lise de Dados em Demografia √© parte do N√∫cleo de Estudos de Popula√ß√£o Elza Berqu√≥ e dedica-se a promo√ß√£o do conhecimento na √°rea de demografia, ci√™ncias sociais quantitativas e ci√™ncia de dados, oferecendo cursos, eventos e infraestrutura para alunos, pesquisadores e o p√∫blico em geral.","tags":null,"title":"LADDEM","type":"authors"},{"authors":null,"categories":null,"content":"\r\r Table of Contents\r O que voc√™ vai aprender O curso Programa√ß√£o Instrutores Links √∫teis  \r\rO que voc√™ vai aprender  A filosofia de design por tr√°s de um dos pacotes mais populares no R Importa√ß√£o, Manipula√ß√£o e Visualiza√ß√£o de dados na pr√°tica tidyr, dplyr, ggplot2 e v√°rios outros pacotes para simplificar sua rotina de an√°lise de dados  O curso Uma semana, com aulas √† noite, no formato workshop, com muitos exerc√≠cios para praticar e pegar o jeito.\nPrograma√ß√£o \rreadr, tibble e tidyr\rUm modelo de ci√™ncia de dados Uma forma esquem√°tica, mas √∫til de encarar o processo de an√°lise de dados e de produ√ß√£o de conhecimento a partir de informa√ß√µes secund√°rias √© esta figura:\n\r\rstringr, forcats e dplyr\rOpera√ß√µes em vari√°veis e bancos de dados Hoje vamos apresentar dois pacotes com finalidades mais espec√≠ficas para trabalhar com vari√°veis de tipo caractere e fator e um pacote super importante para as opera√ß√µes com bancos de dados.\n\r\rggplot2\rO pacote ggplot2 e a \u0026ldquo;gram√°tica dos gr√°ficos\u0026rdquo; Ainda me lembro da primeira vez que li o terceiro cap√≠tulo de R for Data Science em que o conceito de visualiza√ß√£o de dados √© apresentado junto com a ideia de data.\n\r\rpurrr\rO autor dos pacotes do tidyverse core √© completamente fascinado por gatos, por isso, tantas refer√™ncias ao bixo nos nomes dos pacotes. \u0026ldquo;Purr\u0026rdquo; (em ingl√™s) √© o som que os gatos fazem quando sentem prazer.\n\r\rSolu√ß√µes\rSolu√ß√µes dos exerc√≠cios\n\r\rInstrutores Vin√≠cius de Souza Maia\nNat√°lia Martins Arruda\nLinks √∫teis Ci√™ncia de dados em R\nR for Data Science\n","date":1621728000,"expirydate":-62135596800,"kind":"section","lang":"en","lastmod":1621728000,"objectID":"02eadce3bea228c4a3968729e322add5","permalink":"https://laddem.github.io/courses/tidyverse/","publishdate":"2021-05-23T00:00:00Z","relpermalink":"/courses/tidyverse/","section":"courses","summary":"Aprenda a utilizar o tidyverse nas suas an√°lises de dados.","tags":null,"title":"üìä Aprenda a utilizar o tidyverse","type":"book"},{"authors":null,"categories":null,"content":"Um modelo de ci√™ncia de dados Uma forma esquem√°tica, mas √∫til de encarar o processo de an√°lise de dados e de produ√ß√£o de conhecimento a partir de informa√ß√µes secund√°rias √© esta figura:\nEla acaba sendo um ponto de partida interessante porque contextualiza a maioria dos pacotes que vamos utilizar. O readr √© uma maneira de facilitar e tornar mais r√°pida a importa√ß√£o de dados em formatos comuns, como o texto delimitado por separadores e o formato colunado com larguras-fixas utilizado pelo IBGE.\nA tibble √© uma proposta de moderniza√ß√£o para o data.frame, aproveitando a estrutura flex√≠vel e poderosa, mas mudando certas conven√ß√µes, como a convers√£o de strings para fatores, permitindo a cria√ß√£o de colunas de listas, utiliza√ß√£o de nomes mais complexos para colunas, etc.\nO tidyr √© uma forma de reformatar (reshape) bancos de dados que v√™m em formatos que dificultam seu processamento, permitindo que o analista facilmente reconfigure a informa√ß√£o para o formato mais adequado. Ele √© o primeiro pacote que veremos sobre a parte de \u0026ldquo;cozinha\u0026rdquo; dos dados, no qual √© preciso processar o dado bruto para torn√°-lo pass√≠vel de an√°lise.\nO mesmo pode ser dito para os outros pacotes que veremos nos pr√≥ximos dias. Cada um deles foi pensado para resolver um problema ou facilitar uma rotina de trabalho relacionada com um dos passos descritos acima.\nPrograma√ß√£o liter√°ria V√°rios dos conceitos que guiam o design do tidyverse s√£o orientados por uma certa filosofia. Esta filosofia dita que a principal preocupa√ß√£o por tr√°s de um programa n√£o √© que ele funcione. Eventualmente e com um pouco de persist√™ncia, √© quase sempre poss√≠vel chegar a uma solu√ß√£o t√©cnica adequada. A principal quest√£o √© que o programa √© uma ferramenta de comunica√ß√£o com outras pessoas que o ler√£o, seja seus colegas, colaboradores, alunos ou voc√™ mesmo, daqui a 2 anos, quando lembrar que voc√™ j√° escreveu um programa para aquela tarefa. Trago aqui alguns trechos de Literate Programming, de Donald Knuth (1984), traduzidos livremente por este que vos fala:\n Creio que chegou a hora de melhorar significativamente a documenta√ß√£o dos programas, e que podemos atingir este objetivo tratando programas como obras liter√°rias. Por isso o t√≠tulo: \u0026ldquo;Programa√ß√£o Liter√°ria\u0026rdquo;. Abandonemos os velhos h√°bitos de construir programas: ao inv√©s de imaginar que nossa tarefa principal √© instruir um computador sobre o que deve ser feito, concentremo-nos em explicar aos seres humanos o que queremos que o computador fa√ßa. O praticante da programa√ß√£o liter√°ria pode ser visto como um ensa√≠sta, cuja principal preocupa√ß√£o √© com a clareza da exposi√ß√£o e a excel√™ncia no estilo. Tal autor, com um dicion√°rio na m√£o, escolhe os nomes das vari√°veis com cuidado e explica claramente seu significado. Ele ou ela esmera por um programa que √© compreens√≠vel porque seus conceitos foram introduzidos na melhor ordem poss√≠vel para o entendimento humano, utilizando uma mistura de m√©todos formais e informais que se complementam.\n Assim, v√°rias das escolhas feitas na constru√ß√£o de tidyverse procuram refor√ßar essa caracter√≠stica de interpretabilidade dos programas, como a ordem l√≥gica das opera√ß√µes com o pipe (%\u0026gt;%), fun√ß√µes com nomes mais longos e sem√¢nticos, a utiliza√ß√£o de uma fun√ß√£o espec√≠fica para cada tarefa, ao inv√©s da adapta√ß√£o de fun√ß√µes gen√©ricas para uma grande variedade de tarefas. O prop√≥sito de um c√≥digo escrito como tidyverse √© que, no limite, a pr√≥pria s√≠ntaxe do c√≥digo funcione como parte da documenta√ß√£o do programa.\nO mist√©rio do pipe: %\u0026gt;% Usu√°rios de longa data do R j√° podem ter encontrado no mato esse animal estranho e podem ter ficado confusos com seu significado. O pipe √© de origem humilde e nasceu nos sistemas Unix h√° muitas d√©cadas atr√°s. Seu objetivo √© muito simples: e se voc√™ tiver uma sequ√™ncia de computa√ß√µes em que cada uma recebe o resultado daquela feita anteriormente? Claro que voc√™ poderia fazer:\nx \u0026lt;- 1:10\ry \u0026lt;- diff(x)\rmean(y)\r ## [1] 1\r Mas n√£o seria interessante pular os objetos intermedi√°rios e ir direto ao ponto? O pipe vem do pacote magrittr, mas ele v√™m carregado em quase todos os pacotes do tidyverse. Vamos carregar logo o tibble.\n# Para ter acesso ao pipe, basta carregar um pacote do tidyverse, como tibble, dplyr, tidyr, etc.\r# Vamos carregar o tibble agora\rlibrary(tibble)\rx %\u0026gt;% diff() %\u0026gt;% mean()\r ## [1] 1\r Vejamos um exemplo mais real, quantos artistas existem no dataset billboard? Podemos usar unique e length para descobrir.\nx \u0026lt;- unique(tidyr::billboard$artist)\rlength(x)\r ## [1] 228\r Mas com %\u0026gt;% fica bem melhor:\ntidyr::billboard %\u0026gt;% .$artist %\u0026gt;% unique() %\u0026gt;% length()\r ## [1] 228\r Ok, mas como ele funciona? √â simples, o pipe carrega o objeto a sua esquerda num ponto . invis√≠vel que √© automaticamente passado como o primeiro argumento da fun√ß√£o √† direita.\nx \u0026lt;- 1:10\rmean(x)\r ## [1] 5.5\r x %\u0026gt;% mean()\r ## [1] 5.5\r OK, mas e se meu argumento n√£o for o primeiro, ainda posso usar pipe? Pode! √â s√≥ usar explicitamente um ponto no lugar onde voc√™ quer aproveitar o efeito:\niris %\u0026gt;% boxplot(Sepal.Length ~ Species, data = .)\r O ponto . depois de data indica indica que ali deve ser colocado o iris. O pipe √© uma pe√ßa chave de muitas fun√ß√µes do tidyverse, n√£o porque ele seja obrigat√≥rio, mas sim porque ele permite expressar sequ√™ncias de opera√ß√µes numa ordem mais l√≥gica, do tipo: \u0026ldquo;Primeiro fa√ßa a, ent√£o b, ent√£o c, \u0026hellip; \u0026ldquo;, ao contr√°rio da forma como isto √© geralmente feito usando par√™nteses para preced√™ncia.\n# Compare\rmean(diff(1:10))\r ## [1] 1\r 1:10 %\u0026gt;% diff %\u0026gt;% mean\r ## [1] 1\r E assim fica desmistificado o mist√©rio do pipe! Um √∫ltimo pulo do gato: pelo amor de deus ningu√©m digita Shift + %, \u0026gt;, Shift + %, basta usar o atalho: Ctrl + Shift + M que ele p√µe um pipe separado por espa√ßos %\u0026gt;%.\nreadr Usu√°rios do R provavelmente v√£o estar familiarizados com os nossos leitores de arquivos mais comuns: read.table e read.csv. Talvez muitos de voc√™s j√° at√© memorizaram alguns dos argumentos mais comuns. N√£o √© o caso aqui de revisitar esta fun√ß√£o, mas o readr tem muitos paralelos com elas, porque √© pensado como uma nova vers√£o da mesma coisa.\n# Comecemos carregando o readr\rlibrary(readr)\r Debaixo do cap√¥ O readr, como as fun√ß√µes de leitura do base √© uma cole√ß√£o de parsers, que transformam texto em objetos R com o tipo desejado.\nparse_number(c(\u0026quot;1\u0026quot;, \u0026quot;20\u0026quot;, \u0026quot;38\u0026quot;))\r ## [1] 1 20 38\r parse_character(c(\u0026quot;banana\u0026quot;, \u0026quot;ma√ß√£\u0026quot;, \u0026quot;p√™ra\u0026quot;))\r ## [1] \u0026quot;banana\u0026quot; \u0026quot;ma\u0026lt;e7\u0026gt;\u0026lt;e3\u0026gt;\u0026quot; \u0026quot;p\u0026lt;ea\u0026gt;ra\u0026quot;\r # Note os acentos e caracteres especiais\rparse_character(c(\u0026quot;banana\u0026quot;, \u0026quot;ma√ß√£\u0026quot;, \u0026quot;p√™ra\u0026quot;), locale = locale(encoding = \u0026quot;Windows-1252\u0026quot;))\r ## [1] \u0026quot;banana\u0026quot; \u0026quot;ma√ß√£\u0026quot; \u0026quot;p√™ra\u0026quot;\r parse_logical(c(\u0026quot;true\u0026quot;, \u0026quot;false\u0026quot;, \u0026quot;true\u0026quot;))\r ## [1] TRUE FALSE TRUE\r Em geral, a gente n√£o precisa descer tanto o n√≠vel, a gente vai trabalhar mesmo √© com os leitores de dados \u0026ldquo;retangulares\u0026rdquo;. Como os do base, eles s√£o read_csv, read_table, etc. Vamos trabalhar com bancos de dados que j√° v√™m no pacote, para facilitar o processo.\n# Lista os datasets que vem no pacote\rreadr_example()\r ## [1] \u0026quot;challenge.csv\u0026quot; \u0026quot;epa78.txt\u0026quot; \u0026quot;example.log\u0026quot; ## [4] \u0026quot;fwf-sample.txt\u0026quot; \u0026quot;massey-rating.txt\u0026quot; \u0026quot;mtcars.csv\u0026quot; ## [7] \u0026quot;mtcars.csv.bz2\u0026quot; \u0026quot;mtcars.csv.zip\u0026quot;\r Uma coisa que gosto de fazer √© olhar como o arquivo est√° organizado antes de tentar abr√≠-lo. Muitos de voc√™s podem fazer isso com readLines. Ela ganhou sua vers√£o no pacote com read_lines.\n# Vamos tentar abrir massey-rating.txt\rread_lines(readr_example(\u0026quot;massey-rating.txt\u0026quot;), n_max = 10)\r ## [1] \u0026quot;UCC PAY LAZ KPK RT COF BIH DII ENG ACU Rank Team Conf\u0026quot; ## [2] \u0026quot; 1 1 1 1 1 1 1 1 1 1 1 Ohio St B10 \u0026quot;\r## [3] \u0026quot; 2 2 2 2 2 2 2 2 4 2 2 Oregon P12 \u0026quot;\r## [4] \u0026quot; 3 4 3 4 3 4 3 4 2 3 3 Alabama SEC \u0026quot;\r## [5] \u0026quot; 4 3 4 3 4 3 5 3 3 4 4 TCU B12 \u0026quot;\r## [6] \u0026quot; 6 6 6 5 5 7 6 5 6 11 5 Michigan St B10 \u0026quot;\r## [7] \u0026quot; 7 7 7 6 7 6 11 8 7 8 6 Georgia SEC \u0026quot;\r## [8] \u0026quot; 5 5 5 7 6 8 4 6 5 5 7 Florida St ACC \u0026quot;\r## [9] \u0026quot; 8 8 9 9 10 5 7 7 10 7 8 Baylor B12 \u0026quot;\r## [10] \u0026quot; 9 11 8 13 11 11 12 9 14 9 9 Georgia Tech ACC \u0026quot;\r # Identificando o separador, escolho a fun√ß√£o adequada\rread_table(readr_example(\u0026quot;massey-rating.txt\u0026quot;))\r ## ## -- Column specification --------------------------------------------------------\r## cols(\r## UCC = col_double(),\r## PAY = col_double(),\r## LAZ = col_double(),\r## KPK = col_double(),\r## RT = col_double(),\r## COF = col_double(),\r## BIH = col_double(),\r## DII = col_double(),\r## ENG = col_double(),\r## ACU = col_double(),\r## Rank = col_double(),\r## Team = col_character(),\r## Conf = col_character()\r## )\r ## # A tibble: 10 x 13\r## UCC PAY LAZ KPK RT COF BIH DII ENG ACU Rank Team Conf ## \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt;\r## 1 1 1 1 1 1 1 1 1 1 1 1 Ohio~ B10 ## 2 2 2 2 2 2 2 2 2 4 2 2 Oreg~ P12 ## 3 3 4 3 4 3 4 3 4 2 3 3 Alab~ SEC ## 4 4 3 4 3 4 3 5 3 3 4 4 TCU B12 ## 5 6 6 6 5 5 7 6 5 6 11 5 Mich~ B10 ## 6 7 7 7 6 7 6 11 8 7 8 6 Geor~ SEC ## 7 5 5 5 7 6 8 4 6 5 5 7 Flor~ ACC ## 8 8 8 9 9 10 5 7 7 10 7 8 Bayl~ B12 ## 9 9 11 8 13 11 11 12 9 14 9 9 Geor~ ACC ## 10 13 10 13 11 8 9 10 11 9 10 10 Miss~ SEC\r Como identifiquei que as colunas estavam separadas por espa√ßos, utilizei read_table cujo delimitador √© o espa√ßo \u0026quot; \u0026quot;.\nA segunda feature mais interessante do readr, √© uma interface para selecionar os tipos de colunas que ser√£o importadas. Vejamos o seguinte exemplo.\n# Vamos abrir mtcars.csv\rread_lines(readr_example(\u0026quot;mtcars.csv\u0026quot;), n_max = 10)\r ## [1] \u0026quot;\\\u0026quot;mpg\\\u0026quot;,\\\u0026quot;cyl\\\u0026quot;,\\\u0026quot;disp\\\u0026quot;,\\\u0026quot;hp\\\u0026quot;,\\\u0026quot;drat\\\u0026quot;,\\\u0026quot;wt\\\u0026quot;,\\\u0026quot;qsec\\\u0026quot;,\\\u0026quot;vs\\\u0026quot;,\\\u0026quot;am\\\u0026quot;,\\\u0026quot;gear\\\u0026quot;,\\\u0026quot;carb\\\u0026quot;\u0026quot;\r## [2] \u0026quot;21,6,160,110,3.9,2.62,16.46,0,1,4,4\u0026quot; ## [3] \u0026quot;21,6,160,110,3.9,2.875,17.02,0,1,4,4\u0026quot; ## [4] \u0026quot;22.8,4,108,93,3.85,2.32,18.61,1,1,4,1\u0026quot; ## [5] \u0026quot;21.4,6,258,110,3.08,3.215,19.44,1,0,3,1\u0026quot; ## [6] \u0026quot;18.7,8,360,175,3.15,3.44,17.02,0,0,3,2\u0026quot; ## [7] \u0026quot;18.1,6,225,105,2.76,3.46,20.22,1,0,3,1\u0026quot; ## [8] \u0026quot;14.3,8,360,245,3.21,3.57,15.84,0,0,3,4\u0026quot; ## [9] \u0026quot;24.4,4,146.7,62,3.69,3.19,20,1,0,4,2\u0026quot; ## [10] \u0026quot;22.8,4,140.8,95,3.92,3.15,22.9,1,0,4,2\u0026quot;\r # Identificamos o separador de colunas, selecionamos a fun√ß√£o adequada\rread_csv(readr_example(\u0026quot;mtcars.csv\u0026quot;))\r ## ## -- Column specification --------------------------------------------------------\r## cols(\r## mpg = col_double(),\r## cyl = col_double(),\r## disp = col_double(),\r## hp = col_double(),\r## drat = col_double(),\r## wt = col_double(),\r## qsec = col_double(),\r## vs = col_double(),\r## am = col_double(),\r## gear = col_double(),\r## carb = col_double()\r## )\r ## # A tibble: 32 x 11\r## mpg cyl disp hp drat wt qsec vs am gear carb\r## \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt;\r## 1 21 6 160 110 3.9 2.62 16.5 0 1 4 4\r## 2 21 6 160 110 3.9 2.88 17.0 0 1 4 4\r## 3 22.8 4 108 93 3.85 2.32 18.6 1 1 4 1\r## 4 21.4 6 258 110 3.08 3.22 19.4 1 0 3 1\r## 5 18.7 8 360 175 3.15 3.44 17.0 0 0 3 2\r## 6 18.1 6 225 105 2.76 3.46 20.2 1 0 3 1\r## 7 14.3 8 360 245 3.21 3.57 15.8 0 0 3 4\r## 8 24.4 4 147. 62 3.69 3.19 20 1 0 4 2\r## 9 22.8 4 141. 95 3.92 3.15 22.9 1 0 4 2\r## 10 19.2 6 168. 123 3.92 3.44 18.3 1 0 4 4\r## # ... with 22 more rows\r O console nos mostra que a leitura do banco foi completada, mas tamb√©m mostra Column Specification. Isto indica qual o tipo de dado que foi identificado automaticamente numa an√°lise feita pela fun√ß√£o guess_parser. Em diversos casos, n√≥s podemos querer identificar manualmente as colunas. Vejamos um exemplo:\n# Vamos identificar as colunas com spec\rspec_csv(readr_example(\u0026quot;mtcars.csv\u0026quot;))\r ## ## -- Column specification --------------------------------------------------------\r## cols(\r## mpg = col_double(),\r## cyl = col_double(),\r## disp = col_double(),\r## hp = col_double(),\r## drat = col_double(),\r## wt = col_double(),\r## qsec = col_double(),\r## vs = col_double(),\r## am = col_double(),\r## gear = col_double(),\r## carb = col_double()\r## )\r ## cols(\r## mpg = col_double(),\r## cyl = col_double(),\r## disp = col_double(),\r## hp = col_double(),\r## drat = col_double(),\r## wt = col_double(),\r## qsec = col_double(),\r## vs = col_double(),\r## am = col_double(),\r## gear = col_double(),\r## carb = col_double()\r## )\r # Copia e cola, modifica as colunas que queremos alterar\rspec_cols \u0026lt;- cols(\rmpg = col_double(),\rcyl = col_factor(), # N de cilindros do autom√≥vel\rdisp = col_double(),\rhp = col_double(),\rdrat = col_double(),\rwt = col_double(),\rqsec = col_double(),\rvs = col_double(),\ram = col_factor(c(\u0026quot;0\u0026quot;, \u0026quot;1\u0026quot;)), # Transmiss√£o autom√°tica ou manual\rgear = col_double(),\rcarb = col_double()\r)\rdf \u0026lt;- read_csv(readr_example(\u0026quot;mtcars.csv\u0026quot;), col_types = spec_cols)\rdf\r ## # A tibble: 32 x 11\r## mpg cyl disp hp drat wt qsec vs am gear carb\r## \u0026lt;dbl\u0026gt; \u0026lt;fct\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;fct\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt;\r## 1 21 6 160 110 3.9 2.62 16.5 0 1 4 4\r## 2 21 6 160 110 3.9 2.88 17.0 0 1 4 4\r## 3 22.8 4 108 93 3.85 2.32 18.6 1 1 4 1\r## 4 21.4 6 258 110 3.08 3.22 19.4 1 0 3 1\r## 5 18.7 8 360 175 3.15 3.44 17.0 0 0 3 2\r## 6 18.1 6 225 105 2.76 3.46 20.2 1 0 3 1\r## 7 14.3 8 360 245 3.21 3.57 15.8 0 0 3 4\r## 8 24.4 4 147. 62 3.69 3.19 20 1 0 4 2\r## 9 22.8 4 141. 95 3.92 3.15 22.9 1 0 4 2\r## 10 19.2 6 168. 123 3.92 3.44 18.3 1 0 4 4\r## # ... with 22 more rows\r # Para importar apenas colunas selecionadas, utilize 'cols_only()'\rspec_cols2 \u0026lt;- cols_only(\rmpg = col_double(),\rcyl = col_factor(), # N de cilindros do autom√≥vel\ram = col_factor(c(\u0026quot;0\u0026quot;, \u0026quot;1\u0026quot;)), # Transmiss√£o autom√°tica ou manual\rgear = col_double(),\rcarb = col_double()\r)\rdf2 \u0026lt;- read_csv(readr_example(\u0026quot;mtcars.csv\u0026quot;), col_types = spec_cols2)\rdf2\r ## # A tibble: 32 x 5\r## mpg cyl am gear carb\r## \u0026lt;dbl\u0026gt; \u0026lt;fct\u0026gt; \u0026lt;fct\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt;\r## 1 21 6 1 4 4\r## 2 21 6 1 4 4\r## 3 22.8 4 1 4 1\r## 4 21.4 6 0 3 1\r## 5 18.7 8 0 3 2\r## 6 18.1 6 0 3 1\r## 7 14.3 8 0 3 4\r## 8 24.4 4 0 4 2\r## 9 22.8 4 0 4 2\r## 10 19.2 6 0 4 4\r## # ... with 22 more rows\r # Para indicar os tipos de colunas de um jeito mais sucinto, utilize uma string:\rdf \u0026lt;- read_csv(readr_example(\u0026quot;mtcars.csv\u0026quot;), col_types = \u0026quot;dfddddddfdd\u0026quot;)\r# S√≥ cuidado pra n√£o perder a conta dos ds!\rdf\r ## # A tibble: 32 x 11\r## mpg cyl disp hp drat wt qsec vs am gear carb\r## \u0026lt;dbl\u0026gt; \u0026lt;fct\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;fct\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt;\r## 1 21 6 160 110 3.9 2.62 16.5 0 1 4 4\r## 2 21 6 160 110 3.9 2.88 17.0 0 1 4 4\r## 3 22.8 4 108 93 3.85 2.32 18.6 1 1 4 1\r## 4 21.4 6 258 110 3.08 3.22 19.4 1 0 3 1\r## 5 18.7 8 360 175 3.15 3.44 17.0 0 0 3 2\r## 6 18.1 6 225 105 2.76 3.46 20.2 1 0 3 1\r## 7 14.3 8 360 245 3.21 3.57 15.8 0 0 3 4\r## 8 24.4 4 147. 62 3.69 3.19 20 1 0 4 2\r## 9 22.8 4 141. 95 3.92 3.15 22.9 1 0 4 2\r## 10 19.2 6 168. 123 3.92 3.44 18.3 1 0 4 4\r## # ... with 22 more rows\r Voc√™ tamb√©m pode querer definir caracter√≠sticas de localiza√ß√£o, como a codifica√ß√£o de caracteres, os separadores de decimal e de milhar e etc. A melhor forma de fazer isso √© definir um locale.\nmeu_locale \u0026lt;- locale(encoding = \u0026quot;UTF-8\u0026quot;, decimal_mark = \u0026quot;,\u0026quot;, grouping_mark = \u0026quot;.\u0026quot;)\r A√≠ √© s√≥ passar isso pra uma das fun√ß√µes do pacote sob o argumento locale\nread_csv(readr_example(\u0026quot;mtcars.csv\u0026quot;), locale = meu_locale)\r ## ## -- Column specification --------------------------------------------------------\r## cols(\r## mpg = col_number(),\r## cyl = col_double(),\r## disp = col_number(),\r## hp = col_double(),\r## drat = col_number(),\r## wt = col_number(),\r## qsec = col_number(),\r## vs = col_double(),\r## am = col_double(),\r## gear = col_double(),\r## carb = col_double()\r## )\r ## # A tibble: 32 x 11\r## mpg cyl disp hp drat wt qsec vs am gear carb\r## \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt;\r## 1 21 6 160 110 39 262 1646 0 1 4 4\r## 2 21 6 160 110 39 2875 1702 0 1 4 4\r## 3 228 4 108 93 385 232 1861 1 1 4 1\r## 4 214 6 258 110 308 3215 1944 1 0 3 1\r## 5 187 8 360 175 315 344 1702 0 0 3 2\r## 6 181 6 225 105 276 346 2022 1 0 3 1\r## 7 143 8 360 245 321 357 1584 0 0 3 4\r## 8 244 4 1467 62 369 319 20 1 0 4 2\r## 9 228 4 1408 95 392 315 229 1 0 4 2\r## 10 192 6 1676 123 392 344 183 1 0 4 4\r## # ... with 22 more rows\r Existe ainda a possibilidade de ler dados colunados com largura-fixa. readr implementa quatro fun√ß√µes diferentes para ajudar na constru√ß√£o do dicion√°rio:\n# Nossos dados\rx \u0026lt;- readr_example(\u0026quot;fwf-sample.txt\u0026quot;)\rread_lines(x, n_max = 10)\r ## [1] \u0026quot;John Smith WA 418-Y11-4111\u0026quot;\r## [2] \u0026quot;Mary Hartford CA 319-Z19-4341\u0026quot;\r## [3] \u0026quot;Evan Nolan IL 219-532-c301\u0026quot;\r # separados por espa√ßo\rdic1 \u0026lt;- fwf_empty(x)\rdic1\r ## $begin\r## [1] 0 5 20 30\r## ## $end\r## [1] 4 13 22 NA\r## ## $skip\r## [1] 0\r## ## $col_names\r## [1] \u0026quot;X1\u0026quot; \u0026quot;X2\u0026quot; \u0026quot;X3\u0026quot; \u0026quot;X4\u0026quot;\r df \u0026lt;- read_fwf(file = x, col_positions = dic1)\r ## ## -- Column specification --------------------------------------------------------\r## cols(\r## X1 = col_character(),\r## X2 = col_character(),\r## X3 = col_character(),\r## X4 = col_character()\r## )\r df\r ## # A tibble: 3 x 4\r## X1 X2 X3 X4 ## \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; ## 1 John Smith WA 418-Y11-4111\r## 2 Mary Hartford CA 319-Z19-4341\r## 3 Evan Nolan IL 219-532-c301\r # indicando a largura da coluna\rlarguras \u0026lt;- c(20, 10, 12)\rdic2 \u0026lt;- fwf_widths(larguras)\rdic2\r ## # A tibble: 3 x 3\r## begin end col_names\r## \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;chr\u0026gt; ## 1 0 20 X1 ## 2 20 30 X2 ## 3 30 42 X3\r df \u0026lt;- read_fwf(file = x, col_positions = dic2)\r ## ## -- Column specification --------------------------------------------------------\r## cols(\r## X1 = col_character(),\r## X2 = col_character(),\r## X3 = col_character()\r## )\r df\r ## # A tibble: 3 x 3\r## X1 X2 X3 ## \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; ## 1 John Smith WA 418-Y11-4111\r## 2 Mary Hartford CA 319-Z19-4341\r## 3 Evan Nolan IL 219-532-c301\r # indicando onde cada coluna come√ßa e termina\rcomeca \u0026lt;- c(1, 21, 30)\rtermina \u0026lt;- c(20, 29, 42)\rdic3 \u0026lt;- fwf_positions(comeca, termina)\rdic3\r ## # A tibble: 3 x 3\r## begin end col_names\r## \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;chr\u0026gt; ## 1 0 20 X1 ## 2 20 29 X2 ## 3 29 42 X3\r df \u0026lt;- read_fwf(file = x, col_positions = dic3)\r ## ## -- Column specification --------------------------------------------------------\r## cols(\r## X1 = col_character(),\r## X2 = col_character(),\r## X3 = col_character()\r## )\r df\r ## # A tibble: 3 x 3\r## X1 X2 X3 ## \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; ## 1 John Smith WA 418-Y11-4111\r## 2 Mary Hartford CA 319-Z19-4341\r## 3 Evan Nolan IL 219-532-c301\r # indicando pares nome-valor\rdic4 \u0026lt;- fwf_cols(\rnome = c(1, 20),\ruf = c(21, 29),\rnumero = c(30, 42))\rdic4\r ## # A tibble: 3 x 3\r## begin end col_names\r## \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;chr\u0026gt; ## 1 0 20 nome ## 2 20 29 uf ## 3 29 42 numero\r df \u0026lt;- read_fwf(file = x, col_positions = dic4)\r ## ## -- Column specification --------------------------------------------------------\r## cols(\r## nome = col_character(),\r## uf = col_character(),\r## numero = col_character()\r## )\r df\r ## # A tibble: 3 x 3\r## nome uf numero ## \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; ## 1 John Smith WA 418-Y11-4111\r## 2 Mary Hartford CA 319-Z19-4341\r## 3 Evan Nolan IL 219-532-c301\r Especificar dicion√°rios para arquivos colunados √© um p√©-no-saco, por sorte, existem pacotes que j√° fizeram parte desse trabalho por n√≥s. O readr n√£o melhora muita o servi√ßo manual de constru√ß√£o de dicion√°rios, o que ele oferece √© um ganho de performance tremendo. read_fwf √© centenas de vezes mais r√°pido que o base read.fwf.\nEm termos do que o pacote faz, √© basicamente isso. A √∫nica coisa que falta mencionar √© que ele importa os dados como tibbles ao inv√©s do data.frame padr√£o, mas isso j√° √© um √≥timo gancho pra nossa pr√≥xima parte.\ntibbles Tibbles s√£o basicamente data.frames com um m√©todo mais bonitinho de print. Elas automaticamente se ajustam a largura da sua tela, omitindo as colunas que estouram, e por padr√£o imprimem s√≥ as 10 primeiras observa√ß√µes. Outras caracter√≠sticas que pessoalmente gosto, √© que elas informam o tipo de vari√°vel junto com o nome, arrendondam digitos significativos, destacam n√∫meros grandes, negativos, NAs e etc.\ndf \u0026lt;- read_csv(readr_example(\u0026quot;mtcars.csv\u0026quot;), col_types = cols()) # omitir a especifica√ß√£o\rdf\r ## # A tibble: 32 x 11\r## mpg cyl disp hp drat wt qsec vs am gear carb\r## \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt;\r## 1 21 6 160 110 3.9 2.62 16.5 0 1 4 4\r## 2 21 6 160 110 3.9 2.88 17.0 0 1 4 4\r## 3 22.8 4 108 93 3.85 2.32 18.6 1 1 4 1\r## 4 21.4 6 258 110 3.08 3.22 19.4 1 0 3 1\r## 5 18.7 8 360 175 3.15 3.44 17.0 0 0 3 2\r## 6 18.1 6 225 105 2.76 3.46 20.2 1 0 3 1\r## 7 14.3 8 360 245 3.21 3.57 15.8 0 0 3 4\r## 8 24.4 4 147. 62 3.69 3.19 20 1 0 4 2\r## 9 22.8 4 141. 95 3.92 3.15 22.9 1 0 4 2\r## 10 19.2 6 168. 123 3.92 3.44 18.3 1 0 4 4\r## # ... with 22 more rows\r Do ponto de vista pr√°tico, elas funcionam exatamente igual a data.frames, tudo que voc√™ pode fazer com um data.frame, voc√™ faz com tibbles. O que elas trazem de novidade √©:\n Elas nunca mudam o tipo de dado inputado.  df1 \u0026lt;- data.frame(x = list(1:5, 1:10, 1:20))\rdf1\r ## x.1.5 x.1.10 x.1.20\r## 1 1 1 1\r## 2 2 2 2\r## 3 3 3 3\r## 4 4 4 4\r## 5 5 5 5\r## 6 1 6 6\r## 7 2 7 7\r## 8 3 8 8\r## 9 4 9 9\r## 10 5 10 10\r## 11 1 1 11\r## 12 2 2 12\r## 13 3 3 13\r## 14 4 4 14\r## 15 5 5 15\r## 16 1 6 16\r## 17 2 7 17\r## 18 3 8 18\r## 19 4 9 19\r## 20 5 10 20\r df2 \u0026lt;- tibble(x = list(1:5, 1:10, 1:20))\rdf2\r ## # A tibble: 3 x 1\r## x ## \u0026lt;list\u0026gt; ## 1 \u0026lt;int [5]\u0026gt; ## 2 \u0026lt;int [10]\u0026gt;\r## 3 \u0026lt;int [20]\u0026gt;\r  Elas nunca ajustam os nomes das vari√°veis  names(data.frame(`nome hipster` = 1))\r ## [1] \u0026quot;nome.hipster\u0026quot;\r names(tibble(`nome hipster` = 1))\r ## [1] \u0026quot;nome hipster\u0026quot;\r  Ela avalia cada argumento de forma \u0026ldquo;pregui√ßosa\u0026rdquo; e sequencial  # erro\rdata.frame(x = 1:5, y = x ^ 2)\r ## Error in x^2: argumento n√£o-num√©rico para operador bin√°rio\r # funciona\rtibble(x = 1:5, y = x ^ 2)\r ## # A tibble: 5 x 2\r## x y\r## \u0026lt;int\u0026gt; \u0026lt;dbl\u0026gt;\r## 1 1 1\r## 2 2 4\r## 3 3 9\r## 4 4 16\r## 5 5 25\r  Ela nunca utiliza row.names  head(data.frame(state.x77))\r ## Population Income Illiteracy Life.Exp Murder HS.Grad Frost Area\r## Alabama 3615 3624 2.1 69.05 15.1 41.3 20 50708\r## Alaska 365 6315 1.5 69.31 11.3 66.7 152 566432\r## Arizona 2212 4530 1.8 70.55 7.8 58.1 15 113417\r## Arkansas 2110 3378 1.9 70.66 10.1 39.9 65 51945\r## California 21198 5114 1.1 71.71 10.3 62.6 20 156361\r## Colorado 2541 4884 0.7 72.06 6.8 63.9 166 103766\r as_tibble(state.x77)\r ## # A tibble: 50 x 8\r## Population Income Illiteracy `Life Exp` Murder `HS Grad` Frost Area\r## \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt;\r## 1 3615 3624 2.1 69.0 15.1 41.3 20 50708\r## 2 365 6315 1.5 69.3 11.3 66.7 152 566432\r## 3 2212 4530 1.8 70.6 7.8 58.1 15 113417\r## 4 2110 3378 1.9 70.7 10.1 39.9 65 51945\r## 5 21198 5114 1.1 71.7 10.3 62.6 20 156361\r## 6 2541 4884 0.7 72.1 6.8 63.9 166 103766\r## 7 3100 5348 1.1 72.5 3.1 56 139 4862\r## 8 579 4809 0.9 70.1 6.2 54.6 103 1982\r## 9 8277 4815 1.3 70.7 10.7 52.6 11 54090\r## 10 4931 4091 2 68.5 13.9 40.6 60 58073\r## # ... with 40 more rows\r  Ela muda a \u0026ldquo;regra da reciclagem\u0026rdquo;: apenas s√£o aceitos vetores unit√°rios ou vetores de tamanho igual aos demais  data.frame(x = 1:10, y = 1:5)\r ## x y\r## 1 1 1\r## 2 2 2\r## 3 3 3\r## 4 4 4\r## 5 5 5\r## 6 6 1\r## 7 7 2\r## 8 8 3\r## 9 9 4\r## 10 10 5\r # erro\rtibble(x = 1:10, y = 1:5)\r ## Error: Tibble columns must have compatible sizes.\r## * Size 10: Existing data.\r## * Size 5: Column `y`.\r## i Only values of size one are recycled.\r tibble(x = 1:10, y = 1)\r ## # A tibble: 10 x 2\r## x y\r## \u0026lt;int\u0026gt; \u0026lt;dbl\u0026gt;\r## 1 1 1\r## 2 2 1\r## 3 3 1\r## 4 4 1\r## 5 5 1\r## 6 6 1\r## 7 7 1\r## 8 8 1\r## 9 9 1\r## 10 10 1\r tibble(x = 1:10, y = c(1:5, 1:5))\r ## # A tibble: 10 x 2\r## x y\r## \u0026lt;int\u0026gt; \u0026lt;int\u0026gt;\r## 1 1 1\r## 2 2 2\r## 3 3 3\r## 4 4 4\r## 5 5 5\r## 6 6 1\r## 7 7 2\r## 8 8 3\r## 9 9 4\r## 10 10 5\r  Tibbles s√£o estritas com rela√ß√£o as opera√ß√µes de subsetting com [  df1 \u0026lt;- data.frame(x = 1:3, y = 3:1)\rclass(df1[,1:2])\r ## [1] \u0026quot;data.frame\u0026quot;\r class(df1[,1])\r ## [1] \u0026quot;integer\u0026quot;\r df2 \u0026lt;- tibble(x = 1:3, y = 3:1)\rclass(df2[, 1:2])\r ## [1] \u0026quot;tbl_df\u0026quot; \u0026quot;tbl\u0026quot; \u0026quot;data.frame\u0026quot;\r class(df2[, 1])\r ## [1] \u0026quot;tbl_df\u0026quot; \u0026quot;tbl\u0026quot; \u0026quot;data.frame\u0026quot;\r # Se quiser extrair s√≥ uma coluna, utilize '[[' ou '$'\rclass(df2[[1]])\r ## [1] \u0026quot;integer\u0026quot;\r class(df2$x)\r ## [1] \u0026quot;integer\u0026quot;\r Elas tamb√©m n√£o aceitam \u0026lsquo;partial matching\u0026rsquo; de nomes de vari√°veis.\ndf \u0026lt;- data.frame(nome_de_cavalo = 1)\rdf$nome\r ## [1] 1\r df2 \u0026lt;- tibble(nome_de_cavalo = 1)\rdf2$nome\r ## Warning: Unknown or uninitialised column: `nome`.\r ## NULL\r tidyr Ok, nossos dados est√£o no R, mas, muitas vezes, n√£o est√£o no formato adequado. De maneira geral, analistas de dados v√£o dar prefer√™ncia a um formato parecido com este:\nIsto tem uma raz√£o de ser que deve tornar-se √≥bvia quando tentarmos realizar as opera√ß√µes de transforma√ß√£o de vari√°veis, visualiza√ß√£o, modelos, etc. Por√©m, muitas vezes outras considera√ß√µes s√£o feitas na hora registrar os dados, armazen√°-los, apresent√°-los ao p√∫blico, por isso, frequentemente nossos dados n√£o est√£o no formato tidy e precisam ser reformatados. Essa √© uma das principais tarefas do tidyr e √© nela que vamos nos concentrar.\nAtente que reformata√ß√£o, como muitos outros aspectos da an√°lise de dados, n√£o √© receita de bolo. Muitas vezes o formato desejado n√£o √© √≥bvio, muito menos os passos necess√°rios para chegar l√°. Por√©m, vou apresentar as ferramentas e alguns exemplos simples que cobrem muitos dos nossos casos de uso.\nlibrary(tidyr)\rwho\r ## # A tibble: 7,240 x 60\r## country iso2 iso3 year new_sp_m014 new_sp_m1524 new_sp_m2534 new_sp_m3544\r## \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;int\u0026gt;\r## 1 Afghani~ AF AFG 1980 NA NA NA NA\r## 2 Afghani~ AF AFG 1981 NA NA NA NA\r## 3 Afghani~ AF AFG 1982 NA NA NA NA\r## 4 Afghani~ AF AFG 1983 NA NA NA NA\r## 5 Afghani~ AF AFG 1984 NA NA NA NA\r## 6 Afghani~ AF AFG 1985 NA NA NA NA\r## 7 Afghani~ AF AFG 1986 NA NA NA NA\r## 8 Afghani~ AF AFG 1987 NA NA NA NA\r## 9 Afghani~ AF AFG 1988 NA NA NA NA\r## 10 Afghani~ AF AFG 1989 NA NA NA NA\r## # ... with 7,230 more rows, and 52 more variables: new_sp_m4554 \u0026lt;int\u0026gt;,\r## # new_sp_m5564 \u0026lt;int\u0026gt;, new_sp_m65 \u0026lt;int\u0026gt;, new_sp_f014 \u0026lt;int\u0026gt;,\r## # new_sp_f1524 \u0026lt;int\u0026gt;, new_sp_f2534 \u0026lt;int\u0026gt;, new_sp_f3544 \u0026lt;int\u0026gt;,\r## # new_sp_f4554 \u0026lt;int\u0026gt;, new_sp_f5564 \u0026lt;int\u0026gt;, new_sp_f65 \u0026lt;int\u0026gt;,\r## # new_sn_m014 \u0026lt;int\u0026gt;, new_sn_m1524 \u0026lt;int\u0026gt;, new_sn_m2534 \u0026lt;int\u0026gt;,\r## # new_sn_m3544 \u0026lt;int\u0026gt;, new_sn_m4554 \u0026lt;int\u0026gt;, new_sn_m5564 \u0026lt;int\u0026gt;,\r## # new_sn_m65 \u0026lt;int\u0026gt;, new_sn_f014 \u0026lt;int\u0026gt;, new_sn_f1524 \u0026lt;int\u0026gt;,\r## # new_sn_f2534 \u0026lt;int\u0026gt;, new_sn_f3544 \u0026lt;int\u0026gt;, new_sn_f4554 \u0026lt;int\u0026gt;,\r## # new_sn_f5564 \u0026lt;int\u0026gt;, new_sn_f65 \u0026lt;int\u0026gt;, new_ep_m014 \u0026lt;int\u0026gt;,\r## # new_ep_m1524 \u0026lt;int\u0026gt;, new_ep_m2534 \u0026lt;int\u0026gt;, new_ep_m3544 \u0026lt;int\u0026gt;,\r## # new_ep_m4554 \u0026lt;int\u0026gt;, new_ep_m5564 \u0026lt;int\u0026gt;, new_ep_m65 \u0026lt;int\u0026gt;,\r## # new_ep_f014 \u0026lt;int\u0026gt;, new_ep_f1524 \u0026lt;int\u0026gt;, new_ep_f2534 \u0026lt;int\u0026gt;,\r## # new_ep_f3544 \u0026lt;int\u0026gt;, new_ep_f4554 \u0026lt;int\u0026gt;, new_ep_f5564 \u0026lt;int\u0026gt;,\r## # new_ep_f65 \u0026lt;int\u0026gt;, newrel_m014 \u0026lt;int\u0026gt;, newrel_m1524 \u0026lt;int\u0026gt;,\r## # newrel_m2534 \u0026lt;int\u0026gt;, newrel_m3544 \u0026lt;int\u0026gt;, newrel_m4554 \u0026lt;int\u0026gt;,\r## # newrel_m5564 \u0026lt;int\u0026gt;, newrel_m65 \u0026lt;int\u0026gt;, newrel_f014 \u0026lt;int\u0026gt;,\r## # newrel_f1524 \u0026lt;int\u0026gt;, newrel_f2534 \u0026lt;int\u0026gt;, newrel_f3544 \u0026lt;int\u0026gt;,\r## # newrel_f4554 \u0026lt;int\u0026gt;, newrel_f5564 \u0026lt;int\u0026gt;, newrel_f65 \u0026lt;int\u0026gt;\r Esse √© um banco de dados dif√≠cil de analisar, ele tem 60 colunas, indicando o n√∫mero de casos de tuberculose em diversos est√°gios da doen√ßa, por pa√≠s e ano. O problema √© que ao inv√©s de termos algo como:\ntribble(\r~pais, ~ano, ~tipo, ~idade, ~casos,\r\u0026quot;brasil\u0026quot;, 1980, \u0026quot;extrapulmonar\u0026quot;, \u0026quot;15-24\u0026quot;, 10,\r\u0026quot;brasil\u0026quot;, 1990, \u0026quot;relapso\u0026quot;, \u0026quot;15-24\u0026quot;, 10\r)\r ## # A tibble: 2 x 5\r## pais ano tipo idade casos\r## \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt;\r## 1 brasil 1980 extrapulmonar 15-24 10\r## 2 brasil 1990 relapso 15-24 10\r As informa√ß√µes de tipo de tuberculose e idade dos pacientes est√£o espalhadas pelas colunas. Pra encurtar a hist√≥ria, precisamos \u0026ldquo;tombar\u0026rdquo; esse banco para que essas colunas se tornem um novo conjunto de vari√°veis. Vamos passo a passo.\n# Primeiro, vamos excluir as colunas iso2 e iso3, porque elas s√£o a mesma informa√ß√£o redundante\rwho$iso2 \u0026lt;- NULL\rwho$iso3 \u0026lt;- NULL\rwho1 \u0026lt;- pivot_longer(who,\rcols = c(new_sp_m014:newrel_f65),\rnames_to = \u0026quot;tipo_tb\u0026quot;,\rvalues_to = \u0026quot;casos\u0026quot;,\rvalues_drop_na = TRUE)\rwho1\r ## # A tibble: 76,046 x 4\r## country year tipo_tb casos\r## \u0026lt;chr\u0026gt; \u0026lt;int\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;int\u0026gt;\r## 1 Afghanistan 1997 new_sp_m014 0\r## 2 Afghanistan 1997 new_sp_m1524 10\r## 3 Afghanistan 1997 new_sp_m2534 6\r## 4 Afghanistan 1997 new_sp_m3544 3\r## 5 Afghanistan 1997 new_sp_m4554 5\r## 6 Afghanistan 1997 new_sp_m5564 2\r## 7 Afghanistan 1997 new_sp_m65 0\r## 8 Afghanistan 1997 new_sp_f014 5\r## 9 Afghanistan 1997 new_sp_f1524 38\r## 10 Afghanistan 1997 new_sp_f2534 36\r## # ... with 76,036 more rows\r Nosso primeiro passo √© transformar todas as colunas de novos casos em um par de colunas:\n cols indica quais colunas ser√£o tombadas e quais ser√£o mantidas. Uma coluna names_to recebe as categorias da vari√°vel. Uma coluna values_to recebe os valores das c√©lulas. values_drop_na √© uma op√ß√£o para eliminar c√©lulas vazias.  Essa primeira transforma√ß√£o j√° nos d√° um banco de dados um pouco mais amig√°vel, por√©m, ainda temos vari√°veis \u0026ldquo;presas\u0026rdquo; na coluna tipo_tb. Vamos tentar solt√°-las.\n# primeiro, corrigir uma pequena inconsistencia:\runique(who1$tipo_tb)\r ## [1] \u0026quot;new_sp_m014\u0026quot; \u0026quot;new_sp_m1524\u0026quot; \u0026quot;new_sp_m2534\u0026quot; \u0026quot;new_sp_m3544\u0026quot; \u0026quot;new_sp_m4554\u0026quot;\r## [6] \u0026quot;new_sp_m5564\u0026quot; \u0026quot;new_sp_m65\u0026quot; \u0026quot;new_sp_f014\u0026quot; \u0026quot;new_sp_f1524\u0026quot; \u0026quot;new_sp_f2534\u0026quot;\r## [11] \u0026quot;new_sp_f3544\u0026quot; \u0026quot;new_sp_f4554\u0026quot; \u0026quot;new_sp_f5564\u0026quot; \u0026quot;new_sp_f65\u0026quot; \u0026quot;new_sn_m014\u0026quot; ## [16] \u0026quot;new_sn_m1524\u0026quot; \u0026quot;new_sn_m2534\u0026quot; \u0026quot;new_sn_m3544\u0026quot; \u0026quot;new_sn_m4554\u0026quot; \u0026quot;new_sn_m5564\u0026quot;\r## [21] \u0026quot;new_sn_m65\u0026quot; \u0026quot;new_ep_m014\u0026quot; \u0026quot;new_ep_m1524\u0026quot; \u0026quot;new_ep_m2534\u0026quot; \u0026quot;new_ep_m3544\u0026quot;\r## [26] \u0026quot;new_ep_m4554\u0026quot; \u0026quot;new_ep_m5564\u0026quot; \u0026quot;new_ep_m65\u0026quot; \u0026quot;new_sn_f014\u0026quot; \u0026quot;newrel_m014\u0026quot; ## [31] \u0026quot;newrel_f014\u0026quot; \u0026quot;new_sn_f1524\u0026quot; \u0026quot;new_sn_f2534\u0026quot; \u0026quot;new_sn_f3544\u0026quot; \u0026quot;new_sn_f4554\u0026quot;\r## [36] \u0026quot;new_sn_f5564\u0026quot; \u0026quot;new_sn_f65\u0026quot; \u0026quot;new_ep_f014\u0026quot; \u0026quot;new_ep_f1524\u0026quot; \u0026quot;new_ep_f2534\u0026quot;\r## [41] \u0026quot;new_ep_f3544\u0026quot; \u0026quot;new_ep_f4554\u0026quot; \u0026quot;new_ep_f5564\u0026quot; \u0026quot;new_ep_f65\u0026quot; \u0026quot;newrel_m1524\u0026quot;\r## [46] \u0026quot;newrel_m2534\u0026quot; \u0026quot;newrel_m3544\u0026quot; \u0026quot;newrel_m4554\u0026quot; \u0026quot;newrel_m5564\u0026quot; \u0026quot;newrel_m65\u0026quot; ## [51] \u0026quot;newrel_f1524\u0026quot; \u0026quot;newrel_f2534\u0026quot; \u0026quot;newrel_f3544\u0026quot; \u0026quot;newrel_f4554\u0026quot; \u0026quot;newrel_f5564\u0026quot;\r## [56] \u0026quot;newrel_f65\u0026quot;\r # Notem que newrel deveria ser new_rel\r# Alguns de voc√™s devem conhecer 'gsub'\rwho1$tipo_tb \u0026lt;- gsub(\u0026quot;newrel\u0026quot;, \u0026quot;new_rel\u0026quot;, who1$tipo_tb)\r# Agora, podemos usar outra fun√ß√£o chave do tidyr, 'separate'\rwho2 \u0026lt;- who1 %\u0026gt;% separate(col = tipo_tb,\rinto = c(NA, \u0026quot;tipo_tb\u0026quot;, \u0026quot;sexo_idade\u0026quot;),\rsep = \u0026quot;_\u0026quot;)\rwho2\r ## # A tibble: 76,046 x 5\r## country year tipo_tb sexo_idade casos\r## \u0026lt;chr\u0026gt; \u0026lt;int\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;int\u0026gt;\r## 1 Afghanistan 1997 sp m014 0\r## 2 Afghanistan 1997 sp m1524 10\r## 3 Afghanistan 1997 sp m2534 6\r## 4 Afghanistan 1997 sp m3544 3\r## 5 Afghanistan 1997 sp m4554 5\r## 6 Afghanistan 1997 sp m5564 2\r## 7 Afghanistan 1997 sp m65 0\r## 8 Afghanistan 1997 sp f014 5\r## 9 Afghanistan 1997 sp f1524 38\r## 10 Afghanistan 1997 sp f2534 36\r## # ... with 76,036 more rows\r # E outra passagem de separate para separar a idade do sexo\rwho3 \u0026lt;- who2 %\u0026gt;% separate(col = sexo_idade,\rinto = c(\u0026quot;sexo\u0026quot;, \u0026quot;idade\u0026quot;),\rsep = 1)\rwho3\r ## # A tibble: 76,046 x 6\r## country year tipo_tb sexo idade casos\r## \u0026lt;chr\u0026gt; \u0026lt;int\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;int\u0026gt;\r## 1 Afghanistan 1997 sp m 014 0\r## 2 Afghanistan 1997 sp m 1524 10\r## 3 Afghanistan 1997 sp m 2534 6\r## 4 Afghanistan 1997 sp m 3544 3\r## 5 Afghanistan 1997 sp m 4554 5\r## 6 Afghanistan 1997 sp m 5564 2\r## 7 Afghanistan 1997 sp m 65 0\r## 8 Afghanistan 1997 sp f 014 5\r## 9 Afghanistan 1997 sp f 1524 38\r## 10 Afghanistan 1997 sp f 2534 36\r## # ... with 76,036 more rows\r Bem melhor, n√£o acham? Estamos agora com um banco de dados muito mais adequado para uma an√°lise de dados em R. Cada linha √© uma observa√ß√£o, cada coluna √© uma informa√ß√£o sobre ela.\nAlguns de voc√™s podem ter reparado que fizemos um caminho em que nosso banco de dados passou de ter muitas colunas para muitas linhas (ficou mais \u0026ldquo;longo\u0026rdquo;) e depois precisamos separar algumas das colunas que criamos em outras (o que fizemos com separate). Podemos facilmente imaginar situa√ß√µes em que queremos fazer o caminho inverso: transformar um banco do formato longo para o formato com mais colunas e unir colunas separadas em uma nova. Vamos ver um exemplo.\n# Exemplo adaptado de https://en.wikipedia.org/wiki/List_of_countries_and_dependencies_by_population\rpopulacao \u0026lt;- tribble(\r~Rank, ~Country, ~Population,\t~'% of world', ~Day, ~Month, ~Year, ~Source,\r1L, \u0026quot;China\u0026quot;, 1411778724, \u0026quot;17.9%\u0026quot;, \u0026quot;1\u0026quot;, \u0026quot;Nov\u0026quot;, \u0026quot;2020\u0026quot;, \u0026quot;Seventh Census on 2020\u0026quot;,\r2L, \u0026quot;India\u0026quot;, 1377123716, \u0026quot;17.5%\u0026quot;, \u0026quot;19\u0026quot;, \u0026quot;May\u0026quot;, \u0026quot;2021\u0026quot;, \u0026quot;National population clock[3]\u0026quot;,\r3L, \u0026quot;United States\u0026quot;, 331695937, \u0026quot;4.22%\u0026quot;, \u0026quot;19\u0026quot;, \u0026quot;May\u0026quot;, \u0026quot;2021\u0026quot;, \u0026quot;National population clock[4]\u0026quot;,\r4L, \u0026quot;Indonesia\u0026quot;, 271350000, \u0026quot;3.45%\u0026quot;, \u0026quot;31\u0026quot;, \u0026quot;Dec\u0026quot;, \u0026quot;2020\u0026quot;, \u0026quot;National annual estimate[5]\u0026quot;,\r5L, \u0026quot;Pakistan\u0026quot;, 225200000, \u0026quot;2.86%\u0026quot;, \u0026quot;1\u0026quot;, \u0026quot;Jul\u0026quot;, \u0026quot;2021\u0026quot;, \u0026quot;UN projection[2]\u0026quot;,\r6L, \u0026quot;Brazil\u0026quot;, 213154869, \u0026quot;2.71%\u0026quot;, \u0026quot;19\u0026quot;, \u0026quot;May\u0026quot;, \u0026quot;2021\u0026quot;, \u0026quot;National population clock[6]\u0026quot;,\r7L, \u0026quot;Nigeria\u0026quot;, 211401000, \u0026quot;2.69%\u0026quot;, \u0026quot;1\u0026quot;, \u0026quot;Jul\u0026quot;, \u0026quot;2021\u0026quot;, \u0026quot;UN projection[2]\u0026quot;,\r8L, \u0026quot;Bangladesh\u0026quot;, 170689832, \u0026quot;2.17%\u0026quot;, \u0026quot;19\u0026quot;, \u0026quot;May\u0026quot;, \u0026quot;2021\u0026quot;, \u0026quot;National population clock[7]\u0026quot;,\r9L, \u0026quot;Russia\u0026quot;, 146171015, \u0026quot;1.86%\u0026quot;, \u0026quot;1\u0026quot;, \u0026quot;Jan\u0026quot;, \u0026quot;2021\u0026quot;, \u0026quot;National annual estimate[8]\u0026quot;,\r10L, \u0026quot;Mexico\u0026quot;, 126014024, \u0026quot;1.60%\u0026quot;, \u0026quot;2\u0026quot;, \u0026quot;Mar\u0026quot;, \u0026quot;2020\u0026quot;, \u0026quot;2020 census result[9]\u0026quot;\r)\rpopulacao\r ## # A tibble: 10 x 8\r## Rank Country Population `% of world` Day Month Year Source ## \u0026lt;int\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; ## 1 1 China 1411778724 17.9% 1 Nov 2020 Seventh Census o~\r## 2 2 India 1377123716 17.5% 19 May 2021 National populat~\r## 3 3 United Sta~ 331695937 4.22% 19 May 2021 National populat~\r## 4 4 Indonesia 271350000 3.45% 31 Dec 2020 National annual ~\r## 5 5 Pakistan 225200000 2.86% 1 Jul 2021 UN projection[2] ## 6 6 Brazil 213154869 2.71% 19 May 2021 National populat~\r## 7 7 Nigeria 211401000 2.69% 1 Jul 2021 UN projection[2] ## 8 8 Bangladesh 170689832 2.17% 19 May 2021 National populat~\r## 9 9 Russia 146171015 1.86% 1 Jan 2021 National annual ~\r## 10 10 Mexico 126014024 1.60% 2 Mar 2020 2020 census resu~\r Imagine que, por qualquer motivo, voc√™ prefira trabalhar com uma vari√°vel \u0026ldquo;Data\u0026rdquo; ao inv√©s de dia, m√™s e ano. Podemos usar unite:\npopulacao2 \u0026lt;- populacao %\u0026gt;% unite(col = Data, Day, Month, Year, sep = \u0026quot; \u0026quot;)\rpopulacao2\r ## # A tibble: 10 x 6\r## Rank Country Population `% of world` Data Source ## \u0026lt;int\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; ## 1 1 China 1411778724 17.9% 1 Nov 2020 Seventh Census on 2020 ## 2 2 India 1377123716 17.5% 19 May 20~ National population cl~\r## 3 3 United Stat~ 331695937 4.22% 19 May 20~ National population cl~\r## 4 4 Indonesia 271350000 3.45% 31 Dec 20~ National annual estima~\r## 5 5 Pakistan 225200000 2.86% 1 Jul 2021 UN projection[2] ## 6 6 Brazil 213154869 2.71% 19 May 20~ National population cl~\r## 7 7 Nigeria 211401000 2.69% 1 Jul 2021 UN projection[2] ## 8 8 Bangladesh 170689832 2.17% 19 May 20~ National population cl~\r## 9 9 Russia 146171015 1.86% 1 Jan 2021 National annual estima~\r## 10 10 Mexico 126014024 1.60% 2 Mar 2020 2020 census result[9]\r O outro problema que precisamos resolver frequentemente, √© separar um par de vari√°veis em diversas colunas, fazendo o caminho inverso que fizemos no caso do dataset da OMS.\nus_rent_income\r ## # A tibble: 104 x 5\r## GEOID NAME variable estimate moe\r## \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt;\r## 1 01 Alabama income 24476 136\r## 2 01 Alabama rent 747 3\r## 3 02 Alaska income 32940 508\r## 4 02 Alaska rent 1200 13\r## 5 04 Arizona income 27517 148\r## 6 04 Arizona rent 972 4\r## 7 05 Arkansas income 23789 165\r## 8 05 Arkansas rent 709 5\r## 9 06 California income 29454 109\r## 10 06 California rent 1358 3\r## # ... with 94 more rows\r No exemplo acima, queremos separar em colunas os valores das vari√°veis de renda e valor do aluguel. Esse tipo de opera√ß√£o tem um certo grau de abstra√ß√£o que me deu bastante dor de cabe√ßa para entender inicialmente, ent√£o vamos olhar com carinho para o que queremos ter depois da transforma√ß√£o.\nus_rent_income2 \u0026lt;- tribble(\r~GEOID, ~NAME, ~income_estimate, ~rent_estimate, ~income_moe, ~rent_moe,\r\u0026quot;01\u0026quot;, \u0026quot;Alabama\u0026quot;, 24476, 747, 136, 3,\r\u0026quot;02\u0026quot;, \u0026quot;Alaska\u0026quot;, 32940, 1200, 508, 13\r)\rus_rent_income2\r ## # A tibble: 2 x 6\r## GEOID NAME income_estimate rent_estimate income_moe rent_moe\r## \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt;\r## 1 01 Alabama 24476 747 136 3\r## 2 02 Alaska 32940 1200 508 13\r O banco que queremos tem uma cara assim. Ele tem mais colunas novas e menos linhas, j√° que eu tinha no formato tidy uma vari√°vel chamada \u0026ldquo;variable\u0026rdquo; que guardava os valores renda e aluguel e duas colunas que guardavam os valores da estimativa e do moe. Agora, eu vou ter 4 colunas, duas para as estimativas de renda e aluguel e duas para os moes das mesmas vari√°veis. Como especificar isso para o banco todo? Usando pivot_wider.\nus_rent_income %\u0026gt;% pivot_wider(names_from = variable, values_from = c(estimate, moe))\r ## # A tibble: 52 x 6\r## GEOID NAME estimate_income estimate_rent moe_income moe_rent\r## \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt;\r## 1 01 Alabama 24476 747 136 3\r## 2 02 Alaska 32940 1200 508 13\r## 3 04 Arizona 27517 972 148 4\r## 4 05 Arkansas 23789 709 165 5\r## 5 06 California 29454 1358 109 3\r## 6 08 Colorado 32401 1125 109 5\r## 7 09 Connecticut 35326 1123 195 5\r## 8 10 Delaware 31560 1076 247 10\r## 9 11 District of Columbia 43198 1424 681 17\r## 10 12 Florida 25952 1077 70 3\r## # ... with 42 more rows\r As fun√ß√µes pivot_ tem diversos outros argumentos e cobrem diversos casos de uso. Vejam este exemplo da documenta√ß√£o de pivot_longer:\nanscombe\r ## x1 x2 x3 x4 y1 y2 y3 y4\r## 1 10 10 10 8 8.04 9.14 7.46 6.58\r## 2 8 8 8 8 6.95 8.14 6.77 5.76\r## 3 13 13 13 8 7.58 8.74 12.74 7.71\r## 4 9 9 9 8 8.81 8.77 7.11 8.84\r## 5 11 11 11 8 8.33 9.26 7.81 8.47\r## 6 14 14 14 8 9.96 8.10 8.84 7.04\r## 7 6 6 6 8 7.24 6.13 6.08 5.25\r## 8 4 4 4 19 4.26 3.10 5.39 12.50\r## 9 12 12 12 8 10.84 9.13 8.15 5.56\r## 10 7 7 7 8 4.82 7.26 6.42 7.91\r## 11 5 5 5 8 5.68 4.74 5.73 6.89\r Podemos transformar esse banco de dados rapidamente usando um dos argumentos de pivot_longer, chamado names_pattern.\nanscombe %\u0026gt;% pivot_longer(everything(),\rnames_to = c(\u0026quot;.value\u0026quot;, \u0026quot;set\u0026quot;),\rnames_pattern = \u0026quot;(.)(.)\u0026quot;)\r ## # A tibble: 44 x 3\r## set x y\r## \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt;\r## 1 1 10 8.04\r## 2 2 10 9.14\r## 3 3 10 7.46\r## 4 4 8 6.58\r## 5 1 8 6.95\r## 6 2 8 8.14\r## 7 3 8 6.77\r## 8 4 8 5.76\r## 9 1 13 7.58\r## 10 2 13 8.74\r## # ... with 34 more rows\r Esse exemplo √© interessante, porque ele se aproveita de uma \u0026ldquo;regular expression\u0026rdquo;, tema da parte do nosso curso em que falaremos sobre manipula√ß√£o de strings com o stringr. Resumidas as contas, as colunas se chamam \u0026ldquo;x1, x2, x3 \u0026hellip;\u0026rdquo; e a string \u0026ldquo;(.)(.)\u0026rdquo; indica que h√° dois \u0026ldquo;grupos\u0026rdquo; formados por um caractere cada. A string \u0026ldquo;.value\u0026rdquo; que vai no argumento de cima √© um atalho da fun√ß√£o para dizer \u0026ldquo;pegue o valor de todas as c√©lulas das vari√°veis selecionadas\u0026rdquo;, aqui, todas. Ou seja, ele indica para a fun√ß√£o que o primeiro caractere \u0026ldquo;x\u0026rdquo; ou \u0026ldquo;y\u0026rdquo; definir√° uma nova vari√°vel e armazenar√° os valores das celulas, enquanto o segundo grupo \u0026ldquo;1\u0026rdquo;, \u0026ldquo;2\u0026rdquo;, \u0026ldquo;3\u0026rdquo; ou \u0026ldquo;4\u0026rdquo; formar√° uma segunda vari√°vel chamada \u0026ldquo;set\u0026rdquo; que cont√©m apenas os nomes das colunas. Deu um n√≥ na cabe√ßa?\nUma √∫ltima preocupa√ß√£o ao utilizar a reformata√ß√£o de dados √© o que ocorre com os valores NA. Vejamos este exemplo:\nacoes \u0026lt;- tibble(\rano = c(2015, 2015, 2015, 2015, 2016, 2016, 2016),\rqdr = c( 1, 2, 3, 4, 2, 3, 4),\rlucro = c(1.88, 0.59, 0.35, NA, 0.92, 0.17, 2.66)\r)\r Existem dois tipos de valor nulo, expl√≠cito se diz de um valor nulo como aquele NA que aparece na vari√°vel lucro. Impl√≠cito √© o valor que ocorre no primeiro quadrimestre de 2016, onde sequer foi adicionada uma linha no banco de dados. Os valores impl√≠citos s√£o muito sacanas, porque eles n√£o s√£o imediatamente vis√≠veis.\nacoes %\u0026gt;% pivot_wider(names_from = ano, values_from = lucro)\r ## # A tibble: 4 x 3\r## qdr `2015` `2016`\r## \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt;\r## 1 1 1.88 NA ## 2 2 0.59 0.92\r## 3 3 0.35 0.17\r## 4 4 NA 2.66\r Ao transformar o banco, o valor impl√≠cito ficou expl√≠cito. Caso voc√™ n√£o esteja interessado neste valor, voc√™ pode passar o values_drop_na durante a transforma√ß√£o de volta ao formato original.\nacoes %\u0026gt;% pivot_wider(names_from = ano, values_from = lucro) %\u0026gt;% pivot_longer(c(`2015`, `2016`),\rnames_to = \u0026quot;ano\u0026quot;,\rvalues_to = \u0026quot;lucro\u0026quot;,\rvalues_drop_na = TRUE)\r ## # A tibble: 6 x 3\r## qdr ano lucro\r## \u0026lt;dbl\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt;\r## 1 1 2015 1.88\r## 2 2 2015 0.59\r## 3 2 2016 0.92\r## 4 3 2015 0.35\r## 5 3 2016 0.17\r## 6 4 2016 2.66\r Que faz os valores missing desaparecerem do resultado.\ncomplete pode ser usada pra tornar valores impl√≠citos, expl√≠citos! A fun√ß√£o toma todas as colunas pedidas e verifica todas as combina√ß√µes poss√≠veis de valores, preenchendo as lacunas com NA. Cuidado ao utilizar complete com valores num√©ricos ou conjuntos de colunas com muitas combina√ß√µes poss√≠veis, pois o n√∫mero de combina√ß√µes pode ser infinitamente grande e travar sua sess√£o!\nacoes %\u0026gt;% complete(ano, qdr)\r ## # A tibble: 8 x 3\r## ano qdr lucro\r## \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt;\r## 1 2015 1 1.88\r## 2 2015 2 0.59\r## 3 2015 3 0.35\r## 4 2015 4 NA ## 5 2016 1 NA ## 6 2016 2 0.92\r## 7 2016 3 0.17\r## 8 2016 4 2.66\r Pra encerrar, fill serve para aqueles casos em que um valor missing indica que a √∫ltima observa√ß√£o deve ser repetida. Pesquisadores brasileiros das antigas podem lembrar-se do Censo de 1991, em que o IBGE registrava os arquivos de dom√≠cilio e pessoas com esse sistema. Em ingl√™s, isso se chama LOCF, ou \u0026ldquo;last observation carried forward\u0026rdquo;.\ntreatment \u0026lt;- tribble(\r~ person, ~ treatment, ~response,\r\u0026quot;Derrick Whitmore\u0026quot;, 1, 7,\rNA, 2, 10,\rNA, 3, 9,\r\u0026quot;Katherine Burke\u0026quot;, 1, 4\r)\rtreatment\r ## # A tibble: 4 x 3\r## person treatment response\r## \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt;\r## 1 Derrick Whitmore 1 7\r## 2 \u0026lt;NA\u0026gt; 2 10\r## 3 \u0026lt;NA\u0026gt; 3 9\r## 4 Katherine Burke 1 4\r treatment %\u0026gt;% fill(person)\r ## # A tibble: 4 x 3\r## person treatment response\r## \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt;\r## 1 Derrick Whitmore 1 7\r## 2 Derrick Whitmore 2 10\r## 3 Derrick Whitmore 3 9\r## 4 Katherine Burke 1 4\r tidyr tem tamb√©m outras funcionalidades relevantes para modelagem estat√≠stica, mas acho que isso sai um pouco do escopo do curso. Quem sabe a gente n√£o faz um curso posterior s√≥ sobre modelagem no tidyverse?\nRevis√£o readr O pacote readr apresenta uma fam√≠lia de fun√ß√µes para substituir as fun√ß√µes do base relacionadas a importa√ß√£o de arquivos em formato texto, seja delimitado ou largura-fixa. S√£o elas,\n read_delim read_csv read_csv2 read_tsv read_table read_fwf  E assim sucessivamente. Durante o processo de importa√ß√£o, voc√™ pode querer especificar o tipo de coluna com cols ou cols_only, usando o argumento col_types. Ou use uma string do tipo \u0026ldquo;ddcdiDT\u0026rdquo; em que cada letra √© um tipo de vari√°vel.\n col_integer col_double col_factor col_character  Etc. Voc√™ tamb√©m pode querer definir caracter√≠sticas de localiza√ß√£o, como a codifica√ß√£o de caracteres, os separadores de decimal e de milhar e etc. A melhor forma de fazer isso √© definir um locale.\nAh, e voc√™ sempre pode salvar com write_, inclusive salvando/lendo compactado para bzip, gzip ou xzip.\ntibble Tibbles s√£o uma vers√£o do data.frame com algumas regrinhas novas. Vou apenas repet√≠-las aqui de forma resumida.\n tibbles tem um m√©todo print mais bonito e amig√°vel, especialmente para bancos com muitas observa√ß√µes e vari√°veis. elas s√£o estritas com opera√ß√µes de subsetting com [ e $. elas n√£o aceita a reciclagem de argumento de tamanho diferente de 1.  tidyr tidyr √© um pacote de reformata√ß√£o de bancos, criando novas linhas e colunas a partir da reorganiza√ß√£o das vari√°veis e valores existentes. Suas principais opera√ß√µes s√£o:\n pivot_longer para converter colunas em linhas pivot_wider para converter linhas em colunas separate para separar uma coluna em v√°rias com base em caracteres unite para unir diversas colunas em uma com base em caracteres  Ufa. Acabou n√©? Posso ir dormir j√°? Claro, s√≥ fazer uns exerc√≠cios!\nExerc√≠cios  Como voc√™ importaria o banco \u0026ldquo;epa78.csv\u0026rdquo;  file \u0026lt;- readr_example(\u0026quot;epa78.txt\u0026quot;)\r Importe o banco \u0026ldquo;challenge.csv\u0026rdquo; e resolva os problemas com o tipo da coluna.  file \u0026lt;- readr_example(\u0026quot;challenge.csv\u0026quot;)\r Com o banco sala_aula dado a seguir, transforme-o para que ele contenha as vari√°veis nome, avalia√ß√£o e nota.  sala_aula \u0026lt;- tribble(\r~name, ~teste1, ~teste2, ~prova1,\r\u0026quot;Billy\u0026quot;, \u0026quot;\u0026lt;NA\u0026gt;\u0026quot;, \u0026quot;D\u0026quot; , \u0026quot;C\u0026quot;,\r\u0026quot;Suzy\u0026quot;, \u0026quot;F\u0026quot;, \u0026quot;\u0026lt;NA\u0026gt;\u0026quot;, \u0026quot;\u0026lt;NA\u0026gt;\u0026quot;,\r\u0026quot;Lionel\u0026quot;, \u0026quot;B\u0026quot;, \u0026quot;C\u0026quot; , \u0026quot;B\u0026quot;,\r\u0026quot;Jenny\u0026quot;, \u0026quot;A\u0026quot;, \u0026quot;A\u0026quot; , \u0026quot;B\u0026quot;\r)\r Transforme o banco relig_income para que ele contenha as colunas religi√£o, renda e frequ√™ncia.  relig_income\r ## # A tibble: 18 x 11\r## religion `\u0026lt;$10k` `$10-20k` `$20-30k` `$30-40k` `$40-50k` `$50-75k` `$75-100k`\r## \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt;\r## 1 Agnostic 27 34 60 81 76 137 122\r## 2 Atheist 12 27 37 52 35 70 73\r## 3 Buddhist 27 21 30 34 33 58 62\r## 4 Catholic 418 617 732 670 638 1116 949\r## 5 Don‚Äôt k~ 15 14 15 11 10 35 21\r## 6 Evangel~ 575 869 1064 982 881 1486 949\r## 7 Hindu 1 9 7 9 11 34 47\r## 8 Histori~ 228 244 236 238 197 223 131\r## 9 Jehovah~ 20 27 24 24 21 30 15\r## 10 Jewish 19 19 25 25 30 95 69\r## 11 Mainlin~ 289 495 619 655 651 1107 939\r## 12 Mormon 29 40 48 51 56 112 85\r## 13 Muslim 6 7 9 10 9 23 16\r## 14 Orthodox 13 17 23 32 32 47 38\r## 15 Other C~ 9 7 11 13 13 14 18\r## 16 Other F~ 20 33 40 46 49 63 46\r## 17 Other W~ 5 2 3 4 2 7 3\r## 18 Unaffil~ 217 299 374 365 341 528 407\r## # ... with 3 more variables: $100-150k \u0026lt;dbl\u0026gt;, \u0026gt;150k \u0026lt;dbl\u0026gt;,\r## # Don't know/refused \u0026lt;dbl\u0026gt;\r Transforme o banco billboard para que ele contenha apenas uma coluna \u0026ldquo;semana\u0026rdquo; e uma coluna com a posi√ß√£o da m√∫sica no ranking.  # Dica, voc√™ pode selecionar v√°rias colunas usando o atalho wk1:wk76\rbillboard  ## # A tibble: 317 x 79\r## artist track date.entered wk1 wk2 wk3 wk4 wk5 wk6 wk7 wk8\r## \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;date\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt;\r## 1 2 Pac Baby D~ 2000-02-26 87 82 72 77 87 94 99 NA\r## 2 2Ge+her The Ha~ 2000-09-02 91 87 92 NA NA NA NA NA\r## 3 3 Doors~ Krypto~ 2000-04-08 81 70 68 67 66 57 54 53\r## 4 3 Doors~ Loser 2000-10-21 76 76 72 69 67 65 55 59\r## 5 504 Boyz Wobble~ 2000-04-15 57 34 25 17 17 31 36 49\r## 6 98^0 Give M~ 2000-08-19 51 39 34 26 26 19 2 2\r## 7 A*Teens Dancin~ 2000-07-08 97 97 96 95 100 NA NA NA\r## 8 Aaliyah I Don'~ 2000-01-29 84 62 51 41 38 35 35 38\r## 9 Aaliyah Try Ag~ 2000-03-18 59 53 38 28 21 18 16 14\r## 10 Adams, ~ Open M~ 2000-08-26 76 76 74 69 68 67 61 58\r## # ... with 307 more rows, and 68 more variables: wk9 \u0026lt;dbl\u0026gt;, wk10 \u0026lt;dbl\u0026gt;,\r## # wk11 \u0026lt;dbl\u0026gt;, wk12 \u0026lt;dbl\u0026gt;, wk13 \u0026lt;dbl\u0026gt;, wk14 \u0026lt;dbl\u0026gt;, wk15 \u0026lt;dbl\u0026gt;, wk16 \u0026lt;dbl\u0026gt;,\r## # wk17 \u0026lt;dbl\u0026gt;, wk18 \u0026lt;dbl\u0026gt;, wk19 \u0026lt;dbl\u0026gt;, wk20 \u0026lt;dbl\u0026gt;, wk21 \u0026lt;dbl\u0026gt;, wk22 \u0026lt;dbl\u0026gt;,\r## # wk23 \u0026lt;dbl\u0026gt;, wk24 \u0026lt;dbl\u0026gt;, wk25 \u0026lt;dbl\u0026gt;, wk26 \u0026lt;dbl\u0026gt;, wk27 \u0026lt;dbl\u0026gt;, wk28 \u0026lt;dbl\u0026gt;,\r## # wk29 \u0026lt;dbl\u0026gt;, wk30 \u0026lt;dbl\u0026gt;, wk31 \u0026lt;dbl\u0026gt;, wk32 \u0026lt;dbl\u0026gt;, wk33 \u0026lt;dbl\u0026gt;, wk34 \u0026lt;dbl\u0026gt;,\r## # wk35 \u0026lt;dbl\u0026gt;, wk36 \u0026lt;dbl\u0026gt;, wk37 \u0026lt;dbl\u0026gt;, wk38 \u0026lt;dbl\u0026gt;, wk39 \u0026lt;dbl\u0026gt;, wk40 \u0026lt;dbl\u0026gt;,\r## # wk41 \u0026lt;dbl\u0026gt;, wk42 \u0026lt;dbl\u0026gt;, wk43 \u0026lt;dbl\u0026gt;, wk44 \u0026lt;dbl\u0026gt;, wk45 \u0026lt;dbl\u0026gt;, wk46 \u0026lt;dbl\u0026gt;,\r## # wk47 \u0026lt;dbl\u0026gt;, wk48 \u0026lt;dbl\u0026gt;, wk49 \u0026lt;dbl\u0026gt;, wk50 \u0026lt;dbl\u0026gt;, wk51 \u0026lt;dbl\u0026gt;, wk52 \u0026lt;dbl\u0026gt;,\r## # wk53 \u0026lt;dbl\u0026gt;, wk54 \u0026lt;dbl\u0026gt;, wk55 \u0026lt;dbl\u0026gt;, wk56 \u0026lt;dbl\u0026gt;, wk57 \u0026lt;dbl\u0026gt;, wk58 \u0026lt;dbl\u0026gt;,\r## # wk59 \u0026lt;dbl\u0026gt;, wk60 \u0026lt;dbl\u0026gt;, wk61 \u0026lt;dbl\u0026gt;, wk62 \u0026lt;dbl\u0026gt;, wk63 \u0026lt;dbl\u0026gt;, wk64 \u0026lt;dbl\u0026gt;,\r## # wk65 \u0026lt;dbl\u0026gt;, wk66 \u0026lt;lgl\u0026gt;, wk67 \u0026lt;lgl\u0026gt;, wk68 \u0026lt;lgl\u0026gt;, wk69 \u0026lt;lgl\u0026gt;, wk70 \u0026lt;lgl\u0026gt;,\r## # wk71 \u0026lt;lgl\u0026gt;, wk72 \u0026lt;lgl\u0026gt;, wk73 \u0026lt;lgl\u0026gt;, wk74 \u0026lt;lgl\u0026gt;, wk75 \u0026lt;lgl\u0026gt;, wk76 \u0026lt;lgl\u0026gt;\r  Experimente fazer o caminho inverso dos exerc√≠cios 3 a 5, devolvendo os datasets ao seu formato original. O que voc√™ observou?\n  O que os argumentos extra e fill em separate fazem? Utilize o exemplo a seguir como guia.\n  tibble(x = c(\u0026quot;a,b,c\u0026quot;, \u0026quot;d,e,f,g\u0026quot;, \u0026quot;h,i,j\u0026quot;)) %\u0026gt;% separate(x, c(\u0026quot;um\u0026quot;, \u0026quot;dois\u0026quot;, \u0026quot;tres\u0026quot;))\r ## Warning: Expected 3 pieces. Additional pieces discarded in 1 rows [2].\r ## # A tibble: 3 x 3\r## um dois tres ## \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt;\r## 1 a b c ## 2 d e f ## 3 h i j\r tibble(x = c(\u0026quot;a,b,c\u0026quot;, \u0026quot;d,e\u0026quot;, \u0026quot;f,g,i\u0026quot;)) %\u0026gt;% separate(x, c(\u0026quot;um\u0026quot;, \u0026quot;dois\u0026quot;, \u0026quot;tres\u0026quot;))\r ## Warning: Expected 3 pieces. Missing pieces filled with `NA` in 1 rows [2].\r ## # A tibble: 3 x 3\r## um dois tres ## \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt;\r## 1 a b c ## 2 d e \u0026lt;NA\u0026gt; ## 3 f g i\r  Tanto unite como separate possuem um argumento remove. Pra que ele serve e quando voc√™ o utilizaria no valor FALSE?\n  Compare o argumento values_fill em pivot_wider e fill em complete. Qual √© a diferen√ßa?\n  Agradecimentos Esse material √© uma adapta√ß√£o livre das vinhetas dos pacotes tidyr, readr e tibble e do cap√≠tulo Tidy Data do R for Data Science, de Wickham \u0026amp; Grolemund.\n","date":1621728000,"expirydate":-62135596800,"kind":"page","lang":"en","lastmod":1621728000,"objectID":"0bad4868b4cebec13d81438fabee26ad","permalink":"https://laddem.github.io/courses/tidyverse/dia1/","publishdate":"2021-05-23T00:00:00Z","relpermalink":"/courses/tidyverse/dia1/","section":"courses","summary":"Um modelo de ci√™ncia de dados Uma forma esquem√°tica, mas √∫til de encarar o processo de an√°lise de dados e de produ√ß√£o de conhecimento a partir de informa√ß√µes secund√°rias √© esta figura:","tags":null,"title":"readr, tibble e tidyr","type":"book"},{"authors":null,"categories":null,"content":"\r\r\r\r\r\r\r\r\r\r\r\r\r\r\r\r\r\r\r\r\r\r\r\r\r\r\r\r\r\r\r\r\r\r\r\r\r\r\r\r\r\r\r\r\r\r\r\r\r\r\r\r\r\r\r\r\r\r\r\r\r\r\r\rOpera√ß√µes em vari√°veis e bancos de dados Hoje vamos apresentar dois pacotes com finalidades mais espec√≠ficas para trabalhar com vari√°veis de tipo caractere e fator e um pacote super importante para as opera√ß√µes com bancos de dados.\nO pacote stringr √© uma s√©rie de adapta√ß√µes da biblioteca stringi e serve para a manipula√ß√£o de vari√°veis texto, incluindo fun√ß√µes para detec√ß√£o, modifica√ß√£o, substitui√ß√£o, remo√ß√£o de texto em vari√°veis caractere. Para dominar esse assunto, √© necess√°rio compreender o conceito de ‚Äúregex,‚Äù ou ‚Äúexpress√£o regular,‚Äù que foge um pouco do escopo do curso, mas que ser√° introduzido brevemente.\nO pacote forcats cont√©m uma s√©rie de fun√ß√µes para trabalhar com o tipo factor. S√£o fun√ß√µes que facilitam opera√ß√µes envolvendo esse tipo de vari√°vel, como contagens, troca dos nomes das categorias, agrupamento de categorias, recodifica√ß√£o, plotagem, etc.\nO pacote dplyr √© um dos pilares do tidyverse e ele tem dois pap√©is principais: opera√ß√µes de manipula√ß√£o de banco de dados simples e opera√ß√µes de bancos de dados relacionais. No primeiro tipo s√£o inclu√≠das as opera√ß√µes de cria√ß√£o e modifica√ß√£o de vari√°veis, medidas resumo globais e por grupos, sele√ß√£o de vari√°veis, mudan√ßa da ordem das linhas e colunas, etc. No segundo tipo, s√£o as opera√ß√µes de tipo _join, em que uma vari√°vel chave √© utilizada para combinar registros de dois bancos de dados distintos.\nOs pacotes stringr e forcats s√£o mais diretos, mas o dplyr pode representar um certo n√≠vel de abstra√ß√£o que pode incomodar usu√°rios de longa data do R, portanto, vamos nos esfor√ßar para demonstrar as vantagens de mudar seu workflow para incluir as fun√ß√µes desse pacote atrav√©s de compara√ß√µes com o R base.\ndplyr dplyr para manipula√ß√£o de dados Talvez o pacote mais utilizado de todo o tidyverse, dplyr √© um pacote de manipula√ß√£o de bancos de dados inspirado pela linguagem SQL. A ideia √© concatenar opera√ß√µes de sele√ß√£o de vari√°veis, filtragem de observa√ß√£o, arranjo e ordenamento, deriva√ß√£o de vari√°veis, computa√ß√£o de medidas resumo para o banco todo ou para grupos. As fun√ß√µes b√°sicas e mais utilizadas s√£o, portanto:\n select filter arrange mutate summarize group_by  Para praticar, vamos usar o dataset flights, que cont√©m informa√ß√µes sobre os v√¥os sa√≠dos de Nova Iorque em 2013.\nlibrary(nycflights13)\rlibrary(dplyr)\r ## ## Attaching package: 'dplyr'\r## The following objects are masked from 'package:stats':\r## ## filter, lag\r## The following objects are masked from 'package:base':\r## ## intersect, setdiff, setequal, union\r flights\r ## # A tibble: 336,776 x 19\r## year month day dep_time sched_dep_time dep_delay arr_time sched_arr_time\r## \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;int\u0026gt; \u0026lt;int\u0026gt;\r## 1 2013 1 1 517 515 2 830 819\r## 2 2013 1 1 533 529 4 850 830\r## 3 2013 1 1 542 540 2 923 850\r## 4 2013 1 1 544 545 -1 1004 1022\r## 5 2013 1 1 554 600 -6 812 837\r## 6 2013 1 1 554 558 -4 740 728\r## 7 2013 1 1 555 600 -5 913 854\r## 8 2013 1 1 557 600 -3 709 723\r## 9 2013 1 1 557 600 -3 838 846\r## 10 2013 1 1 558 600 -2 753 745\r## # ... with 336,766 more rows, and 11 more variables: arr_delay \u0026lt;dbl\u0026gt;,\r## # carrier \u0026lt;chr\u0026gt;, flight \u0026lt;int\u0026gt;, tailnum \u0026lt;chr\u0026gt;, origin \u0026lt;chr\u0026gt;, dest \u0026lt;chr\u0026gt;,\r## # air_time \u0026lt;dbl\u0026gt;, distance \u0026lt;dbl\u0026gt;, hour \u0026lt;dbl\u0026gt;, minute \u0026lt;dbl\u0026gt;, time_hour \u0026lt;dttm\u0026gt;\r glimpse(flights)\r ## Rows: 336,776\r## Columns: 19\r## $ year \u0026lt;int\u0026gt; 2013, 2013, 2013, 2013, 2013, 2013, 2013, 2013, 2013, 2~\r## $ month \u0026lt;int\u0026gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1~\r## $ day \u0026lt;int\u0026gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1~\r## $ dep_time \u0026lt;int\u0026gt; 517, 533, 542, 544, 554, 554, 555, 557, 557, 558, 558, ~\r## $ sched_dep_time \u0026lt;int\u0026gt; 515, 529, 540, 545, 600, 558, 600, 600, 600, 600, 600, ~\r## $ dep_delay \u0026lt;dbl\u0026gt; 2, 4, 2, -1, -6, -4, -5, -3, -3, -2, -2, -2, -2, -2, -1~\r## $ arr_time \u0026lt;int\u0026gt; 830, 850, 923, 1004, 812, 740, 913, 709, 838, 753, 849,~\r## $ sched_arr_time \u0026lt;int\u0026gt; 819, 830, 850, 1022, 837, 728, 854, 723, 846, 745, 851,~\r## $ arr_delay \u0026lt;dbl\u0026gt; 11, 20, 33, -18, -25, 12, 19, -14, -8, 8, -2, -3, 7, -1~\r## $ carrier \u0026lt;chr\u0026gt; \u0026quot;UA\u0026quot;, \u0026quot;UA\u0026quot;, \u0026quot;AA\u0026quot;, \u0026quot;B6\u0026quot;, \u0026quot;DL\u0026quot;, \u0026quot;UA\u0026quot;, \u0026quot;B6\u0026quot;, \u0026quot;EV\u0026quot;, \u0026quot;B6\u0026quot;, \u0026quot;~\r## $ flight \u0026lt;int\u0026gt; 1545, 1714, 1141, 725, 461, 1696, 507, 5708, 79, 301, 4~\r## $ tailnum \u0026lt;chr\u0026gt; \u0026quot;N14228\u0026quot;, \u0026quot;N24211\u0026quot;, \u0026quot;N619AA\u0026quot;, \u0026quot;N804JB\u0026quot;, \u0026quot;N668DN\u0026quot;, \u0026quot;N394~\r## $ origin \u0026lt;chr\u0026gt; \u0026quot;EWR\u0026quot;, \u0026quot;LGA\u0026quot;, \u0026quot;JFK\u0026quot;, \u0026quot;JFK\u0026quot;, \u0026quot;LGA\u0026quot;, \u0026quot;EWR\u0026quot;, \u0026quot;EWR\u0026quot;, \u0026quot;LGA\u0026quot;,~\r## $ dest \u0026lt;chr\u0026gt; \u0026quot;IAH\u0026quot;, \u0026quot;IAH\u0026quot;, \u0026quot;MIA\u0026quot;, \u0026quot;BQN\u0026quot;, \u0026quot;ATL\u0026quot;, \u0026quot;ORD\u0026quot;, \u0026quot;FLL\u0026quot;, \u0026quot;IAD\u0026quot;,~\r## $ air_time \u0026lt;dbl\u0026gt; 227, 227, 160, 183, 116, 150, 158, 53, 140, 138, 149, 1~\r## $ distance \u0026lt;dbl\u0026gt; 1400, 1416, 1089, 1576, 762, 719, 1065, 229, 944, 733, ~\r## $ hour \u0026lt;dbl\u0026gt; 5, 5, 5, 5, 6, 5, 6, 6, 6, 6, 6, 6, 6, 6, 6, 5, 6, 6, 6~\r## $ minute \u0026lt;dbl\u0026gt; 15, 29, 40, 45, 0, 58, 0, 0, 0, 0, 0, 0, 0, 0, 0, 59, 0~\r## $ time_hour \u0026lt;dttm\u0026gt; 2013-01-01 05:00:00, 2013-01-01 05:00:00, 2013-01-01 0~\r Podemos filtrar nossas linhas: filter\n# Voos de primeiro de janeiro\rflights %\u0026gt;% filter(month == 1, day == 1)\r ## # A tibble: 842 x 19\r## year month day dep_time sched_dep_time dep_delay arr_time sched_arr_time\r## \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;int\u0026gt; \u0026lt;int\u0026gt;\r## 1 2013 1 1 517 515 2 830 819\r## 2 2013 1 1 533 529 4 850 830\r## 3 2013 1 1 542 540 2 923 850\r## 4 2013 1 1 544 545 -1 1004 1022\r## 5 2013 1 1 554 600 -6 812 837\r## 6 2013 1 1 554 558 -4 740 728\r## 7 2013 1 1 555 600 -5 913 854\r## 8 2013 1 1 557 600 -3 709 723\r## 9 2013 1 1 557 600 -3 838 846\r## 10 2013 1 1 558 600 -2 753 745\r## # ... with 832 more rows, and 11 more variables: arr_delay \u0026lt;dbl\u0026gt;,\r## # carrier \u0026lt;chr\u0026gt;, flight \u0026lt;int\u0026gt;, tailnum \u0026lt;chr\u0026gt;, origin \u0026lt;chr\u0026gt;, dest \u0026lt;chr\u0026gt;,\r## # air_time \u0026lt;dbl\u0026gt;, distance \u0026lt;dbl\u0026gt;, hour \u0026lt;dbl\u0026gt;, minute \u0026lt;dbl\u0026gt;, time_hour \u0026lt;dttm\u0026gt;\r # Voos a partir de junho\rflights %\u0026gt;% filter(month \u0026gt; 6)\r ## # A tibble: 170,618 x 19\r## year month day dep_time sched_dep_time dep_delay arr_time sched_arr_time\r## \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;int\u0026gt; \u0026lt;int\u0026gt;\r## 1 2013 10 1 447 500 -13 614 648\r## 2 2013 10 1 522 517 5 735 757\r## 3 2013 10 1 536 545 -9 809 855\r## 4 2013 10 1 539 545 -6 801 827\r## 5 2013 10 1 539 545 -6 917 933\r## 6 2013 10 1 544 550 -6 912 932\r## 7 2013 10 1 549 600 -11 653 716\r## 8 2013 10 1 550 600 -10 648 700\r## 9 2013 10 1 550 600 -10 649 659\r## 10 2013 10 1 551 600 -9 727 730\r## # ... with 170,608 more rows, and 11 more variables: arr_delay \u0026lt;dbl\u0026gt;,\r## # carrier \u0026lt;chr\u0026gt;, flight \u0026lt;int\u0026gt;, tailnum \u0026lt;chr\u0026gt;, origin \u0026lt;chr\u0026gt;, dest \u0026lt;chr\u0026gt;,\r## # air_time \u0026lt;dbl\u0026gt;, distance \u0026lt;dbl\u0026gt;, hour \u0026lt;dbl\u0026gt;, minute \u0026lt;dbl\u0026gt;, time_hour \u0026lt;dttm\u0026gt;\r # Voos sa√≠dos do aeroporto JFK\rflights %\u0026gt;% filter(origin == \u0026quot;JFK\u0026quot;)\r ## # A tibble: 111,279 x 19\r## year month day dep_time sched_dep_time dep_delay arr_time sched_arr_time\r## \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;int\u0026gt; \u0026lt;int\u0026gt;\r## 1 2013 1 1 542 540 2 923 850\r## 2 2013 1 1 544 545 -1 1004 1022\r## 3 2013 1 1 557 600 -3 838 846\r## 4 2013 1 1 558 600 -2 849 851\r## 5 2013 1 1 558 600 -2 853 856\r## 6 2013 1 1 558 600 -2 924 917\r## 7 2013 1 1 559 559 0 702 706\r## 8 2013 1 1 606 610 -4 837 845\r## 9 2013 1 1 611 600 11 945 931\r## 10 2013 1 1 613 610 3 925 921\r## # ... with 111,269 more rows, and 11 more variables: arr_delay \u0026lt;dbl\u0026gt;,\r## # carrier \u0026lt;chr\u0026gt;, flight \u0026lt;int\u0026gt;, tailnum \u0026lt;chr\u0026gt;, origin \u0026lt;chr\u0026gt;, dest \u0026lt;chr\u0026gt;,\r## # air_time \u0026lt;dbl\u0026gt;, distance \u0026lt;dbl\u0026gt;, hour \u0026lt;dbl\u0026gt;, minute \u0026lt;dbl\u0026gt;, time_hour \u0026lt;dttm\u0026gt;\r # Voos com destino ao aeroporto de Albuquerque\rflights %\u0026gt;% filter(dest == \u0026quot;ABQ\u0026quot;)\r ## # A tibble: 254 x 19\r## year month day dep_time sched_dep_time dep_delay arr_time sched_arr_time\r## \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;int\u0026gt; \u0026lt;int\u0026gt;\r## 1 2013 10 1 1955 2001 -6 2213 2248\r## 2 2013 10 2 2010 2001 9 2230 2248\r## 3 2013 10 3 1955 2001 -6 2232 2248\r## 4 2013 10 4 2017 2001 16 2304 2248\r## 5 2013 10 5 1959 1959 0 2226 2246\r## 6 2013 10 6 1959 2001 -2 2234 2248\r## 7 2013 10 7 2002 2001 1 2233 2248\r## 8 2013 10 8 1957 2001 -4 2216 2248\r## 9 2013 10 9 1957 2001 -4 2220 2248\r## 10 2013 10 10 2011 2001 10 2235 2248\r## # ... with 244 more rows, and 11 more variables: arr_delay \u0026lt;dbl\u0026gt;,\r## # carrier \u0026lt;chr\u0026gt;, flight \u0026lt;int\u0026gt;, tailnum \u0026lt;chr\u0026gt;, origin \u0026lt;chr\u0026gt;, dest \u0026lt;chr\u0026gt;,\r## # air_time \u0026lt;dbl\u0026gt;, distance \u0026lt;dbl\u0026gt;, hour \u0026lt;dbl\u0026gt;, minute \u0026lt;dbl\u0026gt;, time_hour \u0026lt;dttm\u0026gt;\r # Voos com atraso de at√© 10 minutos\rflights %\u0026gt;% filter(dep_delay \u0026lt;= 10)\r ## # A tibble: 245,687 x 19\r## year month day dep_time sched_dep_time dep_delay arr_time sched_arr_time\r## \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;int\u0026gt; \u0026lt;int\u0026gt;\r## 1 2013 1 1 517 515 2 830 819\r## 2 2013 1 1 533 529 4 850 830\r## 3 2013 1 1 542 540 2 923 850\r## 4 2013 1 1 544 545 -1 1004 1022\r## 5 2013 1 1 554 600 -6 812 837\r## 6 2013 1 1 554 558 -4 740 728\r## 7 2013 1 1 555 600 -5 913 854\r## 8 2013 1 1 557 600 -3 709 723\r## 9 2013 1 1 557 600 -3 838 846\r## 10 2013 1 1 558 600 -2 753 745\r## # ... with 245,677 more rows, and 11 more variables: arr_delay \u0026lt;dbl\u0026gt;,\r## # carrier \u0026lt;chr\u0026gt;, flight \u0026lt;int\u0026gt;, tailnum \u0026lt;chr\u0026gt;, origin \u0026lt;chr\u0026gt;, dest \u0026lt;chr\u0026gt;,\r## # air_time \u0026lt;dbl\u0026gt;, distance \u0026lt;dbl\u0026gt;, hour \u0026lt;dbl\u0026gt;, minute \u0026lt;dbl\u0026gt;, time_hour \u0026lt;dttm\u0026gt;\r # Voos com atraso de cerca de 10 minutos\rflights %\u0026gt;% filter(near(dep_delay, 10, tol = 2))\r ## # A tibble: 8,677 x 19\r## year month day dep_time sched_dep_time dep_delay arr_time sched_arr_time\r## \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;int\u0026gt; \u0026lt;int\u0026gt;\r## 1 2013 1 1 611 600 11 945 931\r## 2 2013 1 1 709 700 9 852 832\r## 3 2013 1 1 826 817 9 1145 1158\r## 4 2013 1 1 851 840 11 1215 1206\r## 5 2013 1 1 1011 1001 10 1133 1128\r## 6 2013 1 1 1208 1158 10 1540 1502\r## 7 2013 1 1 1240 1229 11 1451 1428\r## 8 2013 1 1 1310 1300 10 1559 1554\r## 9 2013 1 1 1330 1321 9 1613 1536\r## 10 2013 1 1 1511 1500 11 1753 1742\r## # ... with 8,667 more rows, and 11 more variables: arr_delay \u0026lt;dbl\u0026gt;,\r## # carrier \u0026lt;chr\u0026gt;, flight \u0026lt;int\u0026gt;, tailnum \u0026lt;chr\u0026gt;, origin \u0026lt;chr\u0026gt;, dest \u0026lt;chr\u0026gt;,\r## # air_time \u0026lt;dbl\u0026gt;, distance \u0026lt;dbl\u0026gt;, hour \u0026lt;dbl\u0026gt;, minute \u0026lt;dbl\u0026gt;, time_hour \u0026lt;dttm\u0026gt;\r # Voos que ocorreram entre abril e maio\rflights %\u0026gt;% filter(between(month, 4, 5))\r ## # A tibble: 57,126 x 19\r## year month day dep_time sched_dep_time dep_delay arr_time sched_arr_time\r## \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;int\u0026gt; \u0026lt;int\u0026gt;\r## 1 2013 4 1 454 500 -6 636 640\r## 2 2013 4 1 509 515 -6 743 814\r## 3 2013 4 1 526 530 -4 812 827\r## 4 2013 4 1 534 540 -6 833 850\r## 5 2013 4 1 542 545 -3 914 920\r## 6 2013 4 1 543 545 -2 921 927\r## 7 2013 4 1 551 600 -9 748 659\r## 8 2013 4 1 552 600 -8 641 701\r## 9 2013 4 1 553 600 -7 725 735\r## 10 2013 4 1 554 600 -6 752 805\r## # ... with 57,116 more rows, and 11 more variables: arr_delay \u0026lt;dbl\u0026gt;,\r## # carrier \u0026lt;chr\u0026gt;, flight \u0026lt;int\u0026gt;, tailnum \u0026lt;chr\u0026gt;, origin \u0026lt;chr\u0026gt;, dest \u0026lt;chr\u0026gt;,\r## # air_time \u0026lt;dbl\u0026gt;, distance \u0026lt;dbl\u0026gt;, hour \u0026lt;dbl\u0026gt;, minute \u0026lt;dbl\u0026gt;, time_hour \u0026lt;dttm\u0026gt;\r Podemos combinar v√°rias condi√ß√µes usando operadores l√≥gicos\n# Voos at√© 15 de abril ou at√© 15 de maio\rflights %\u0026gt;% filter(\rbetween(month, 4, 5), # mesmo que usar \u0026amp;\rbetween(day, 1, 15)\r)\r ## # A tibble: 28,176 x 19\r## year month day dep_time sched_dep_time dep_delay arr_time sched_arr_time\r## \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;int\u0026gt; \u0026lt;int\u0026gt;\r## 1 2013 4 1 454 500 -6 636 640\r## 2 2013 4 1 509 515 -6 743 814\r## 3 2013 4 1 526 530 -4 812 827\r## 4 2013 4 1 534 540 -6 833 850\r## 5 2013 4 1 542 545 -3 914 920\r## 6 2013 4 1 543 545 -2 921 927\r## 7 2013 4 1 551 600 -9 748 659\r## 8 2013 4 1 552 600 -8 641 701\r## 9 2013 4 1 553 600 -7 725 735\r## 10 2013 4 1 554 600 -6 752 805\r## # ... with 28,166 more rows, and 11 more variables: arr_delay \u0026lt;dbl\u0026gt;,\r## # carrier \u0026lt;chr\u0026gt;, flight \u0026lt;int\u0026gt;, tailnum \u0026lt;chr\u0026gt;, origin \u0026lt;chr\u0026gt;, dest \u0026lt;chr\u0026gt;,\r## # air_time \u0026lt;dbl\u0026gt;, distance \u0026lt;dbl\u0026gt;, hour \u0026lt;dbl\u0026gt;, minute \u0026lt;dbl\u0026gt;, time_hour \u0026lt;dttm\u0026gt;\r # Voos entre 15 de abril e 15 de maio\rflights %\u0026gt;% filter(\rmonth == 4 \u0026amp; between(day, 15, 30) | # OU\rmonth == 5 \u0026amp; between(day, 1, 15)\r)\r ## # A tibble: 29,101 x 19\r## year month day dep_time sched_dep_time dep_delay arr_time sched_arr_time\r## \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;int\u0026gt; \u0026lt;int\u0026gt;\r## 1 2013 4 15 2 2359 3 341 339\r## 2 2013 4 15 453 500 -7 639 640\r## 3 2013 4 15 511 515 -4 741 802\r## 4 2013 4 15 527 530 -3 806 813\r## 5 2013 4 15 527 529 -2 750 743\r## 6 2013 4 15 537 540 -3 846 840\r## 7 2013 4 15 542 545 -3 931 927\r## 8 2013 4 15 551 600 -9 728 758\r## 9 2013 4 15 552 600 -8 835 850\r## 10 2013 4 15 552 600 -8 648 701\r## # ... with 29,091 more rows, and 11 more variables: arr_delay \u0026lt;dbl\u0026gt;,\r## # carrier \u0026lt;chr\u0026gt;, flight \u0026lt;int\u0026gt;, tailnum \u0026lt;chr\u0026gt;, origin \u0026lt;chr\u0026gt;, dest \u0026lt;chr\u0026gt;,\r## # air_time \u0026lt;dbl\u0026gt;, distance \u0026lt;dbl\u0026gt;, hour \u0026lt;dbl\u0026gt;, minute \u0026lt;dbl\u0026gt;, time_hour \u0026lt;dttm\u0026gt;\r # Voos em todas os primeiros 7 dias de cada m√™s, exceto em janeiro e dezembro\rflights %\u0026gt;% filter(\rbetween(day, 1, 7),\r!month %in% c(1, 12)\r)\r ## # A tibble: 64,365 x 19\r## year month day dep_time sched_dep_time dep_delay arr_time sched_arr_time\r## \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;int\u0026gt; \u0026lt;int\u0026gt;\r## 1 2013 10 1 447 500 -13 614 648\r## 2 2013 10 1 522 517 5 735 757\r## 3 2013 10 1 536 545 -9 809 855\r## 4 2013 10 1 539 545 -6 801 827\r## 5 2013 10 1 539 545 -6 917 933\r## 6 2013 10 1 544 550 -6 912 932\r## 7 2013 10 1 549 600 -11 653 716\r## 8 2013 10 1 550 600 -10 648 700\r## 9 2013 10 1 550 600 -10 649 659\r## 10 2013 10 1 551 600 -9 727 730\r## # ... with 64,355 more rows, and 11 more variables: arr_delay \u0026lt;dbl\u0026gt;,\r## # carrier \u0026lt;chr\u0026gt;, flight \u0026lt;int\u0026gt;, tailnum \u0026lt;chr\u0026gt;, origin \u0026lt;chr\u0026gt;, dest \u0026lt;chr\u0026gt;,\r## # air_time \u0026lt;dbl\u0026gt;, distance \u0026lt;dbl\u0026gt;, hour \u0026lt;dbl\u0026gt;, minute \u0026lt;dbl\u0026gt;, time_hour \u0026lt;dttm\u0026gt;\r # Voos saidos de JFK, excluindo aqueles para os quais n√£o tem informa√ß√µes de hor√°rio de sa√≠da\rflights %\u0026gt;% filter(\rorigin == \u0026quot;JFK\u0026quot;, !is.na(dep_time)\r)\r ## # A tibble: 109,416 x 19\r## year month day dep_time sched_dep_time dep_delay arr_time sched_arr_time\r## \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;int\u0026gt; \u0026lt;int\u0026gt;\r## 1 2013 1 1 542 540 2 923 850\r## 2 2013 1 1 544 545 -1 1004 1022\r## 3 2013 1 1 557 600 -3 838 846\r## 4 2013 1 1 558 600 -2 849 851\r## 5 2013 1 1 558 600 -2 853 856\r## 6 2013 1 1 558 600 -2 924 917\r## 7 2013 1 1 559 559 0 702 706\r## 8 2013 1 1 606 610 -4 837 845\r## 9 2013 1 1 611 600 11 945 931\r## 10 2013 1 1 613 610 3 925 921\r## # ... with 109,406 more rows, and 11 more variables: arr_delay \u0026lt;dbl\u0026gt;,\r## # carrier \u0026lt;chr\u0026gt;, flight \u0026lt;int\u0026gt;, tailnum \u0026lt;chr\u0026gt;, origin \u0026lt;chr\u0026gt;, dest \u0026lt;chr\u0026gt;,\r## # air_time \u0026lt;dbl\u0026gt;, distance \u0026lt;dbl\u0026gt;, hour \u0026lt;dbl\u0026gt;, minute \u0026lt;dbl\u0026gt;, time_hour \u0026lt;dttm\u0026gt;\r # Voos com mais de 30 minutos de atraso em janeiro ou dezembro\rflights %\u0026gt;% filter(\rdep_delay \u0026gt; 30, xor(month == 1, month == 12)\r)\r ## # A tibble: 8,221 x 19\r## year month day dep_time sched_dep_time dep_delay arr_time sched_arr_time\r## \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;int\u0026gt; \u0026lt;int\u0026gt;\r## 1 2013 1 1 732 645 47 1011 941\r## 2 2013 1 1 749 710 39 939 850\r## 3 2013 1 1 811 630 101 1047 830\r## 4 2013 1 1 826 715 71 1136 1045\r## 5 2013 1 1 848 1835 853 1001 1950\r## 6 2013 1 1 903 820 43 1045 955\r## 7 2013 1 1 909 810 59 1331 1315\r## 8 2013 1 1 953 921 32 1320 1241\r## 9 2013 1 1 957 733 144 1056 853\r## 10 2013 1 1 1025 951 34 1258 1302\r## # ... with 8,211 more rows, and 11 more variables: arr_delay \u0026lt;dbl\u0026gt;,\r## # carrier \u0026lt;chr\u0026gt;, flight \u0026lt;int\u0026gt;, tailnum \u0026lt;chr\u0026gt;, origin \u0026lt;chr\u0026gt;, dest \u0026lt;chr\u0026gt;,\r## # air_time \u0026lt;dbl\u0026gt;, distance \u0026lt;dbl\u0026gt;, hour \u0026lt;dbl\u0026gt;, minute \u0026lt;dbl\u0026gt;, time_hour \u0026lt;dttm\u0026gt;\r E assim sucessivamente.\nDa mesma forma, temos select para selecionar as vari√°veis do banco. As duas grandes novidades s√£o que voc√™ n√£o precisa utilizar aspas na sele√ß√£o de vari√°veis e que select introduz v√°rias helper functions para facilitar a sele√ß√£o de vari√°veis parecidas.\n# Selecionar as colunas ano, mes, dia, horario de saida e horario de chegada\rflights %\u0026gt;% select(year, month, day, dep_time, arr_time)\r ## # A tibble: 336,776 x 5\r## year month day dep_time arr_time\r## \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;int\u0026gt;\r## 1 2013 1 1 517 830\r## 2 2013 1 1 533 850\r## 3 2013 1 1 542 923\r## 4 2013 1 1 544 1004\r## 5 2013 1 1 554 812\r## 6 2013 1 1 554 740\r## 7 2013 1 1 555 913\r## 8 2013 1 1 557 709\r## 9 2013 1 1 557 838\r## 10 2013 1 1 558 753\r## # ... with 336,766 more rows\r # Utilizando helpers\rflights %\u0026gt;% select(year:dep_time, arr_time)\r ## # A tibble: 336,776 x 5\r## year month day dep_time arr_time\r## \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;int\u0026gt;\r## 1 2013 1 1 517 830\r## 2 2013 1 1 533 850\r## 3 2013 1 1 542 923\r## 4 2013 1 1 544 1004\r## 5 2013 1 1 554 812\r## 6 2013 1 1 554 740\r## 7 2013 1 1 555 913\r## 8 2013 1 1 557 709\r## 9 2013 1 1 557 838\r## 10 2013 1 1 558 753\r## # ... with 336,766 more rows\r # Mais helpers\rflights %\u0026gt;% select(year:day, starts_with(\u0026quot;dep\u0026quot;), starts_with(\u0026quot;arr\u0026quot;))\r ## # A tibble: 336,776 x 7\r## year month day dep_time dep_delay arr_time arr_delay\r## \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;int\u0026gt; \u0026lt;dbl\u0026gt;\r## 1 2013 1 1 517 2 830 11\r## 2 2013 1 1 533 4 850 20\r## 3 2013 1 1 542 2 923 33\r## 4 2013 1 1 544 -1 1004 -18\r## 5 2013 1 1 554 -6 812 -25\r## 6 2013 1 1 554 -4 740 12\r## 7 2013 1 1 555 -5 913 19\r## 8 2013 1 1 557 -3 709 -14\r## 9 2013 1 1 557 -3 838 -8\r## 10 2013 1 1 558 -2 753 8\r## # ... with 336,766 more rows\r flights %\u0026gt;% select(year:day, ends_with(\u0026quot;time\u0026quot;))\r ## # A tibble: 336,776 x 8\r## year month day dep_time sched_dep_time arr_time sched_arr_time air_time\r## \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;dbl\u0026gt;\r## 1 2013 1 1 517 515 830 819 227\r## 2 2013 1 1 533 529 850 830 227\r## 3 2013 1 1 542 540 923 850 160\r## 4 2013 1 1 544 545 1004 1022 183\r## 5 2013 1 1 554 600 812 837 116\r## 6 2013 1 1 554 558 740 728 150\r## 7 2013 1 1 555 600 913 854 158\r## 8 2013 1 1 557 600 709 723 53\r## 9 2013 1 1 557 600 838 846 140\r## 10 2013 1 1 558 600 753 745 138\r## # ... with 336,766 more rows\r flights %\u0026gt;% select(year:day, c(ends_with(\u0026quot;time\u0026quot;)) \u0026amp; !contains(\u0026quot;sched\u0026quot;))\r ## # A tibble: 336,776 x 6\r## year month day dep_time arr_time air_time\r## \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;dbl\u0026gt;\r## 1 2013 1 1 517 830 227\r## 2 2013 1 1 533 850 227\r## 3 2013 1 1 542 923 160\r## 4 2013 1 1 544 1004 183\r## 5 2013 1 1 554 812 116\r## 6 2013 1 1 554 740 150\r## 7 2013 1 1 555 913 158\r## 8 2013 1 1 557 709 53\r## 9 2013 1 1 557 838 140\r## 10 2013 1 1 558 753 138\r## # ... with 336,766 more rows\r # Voc√™ pode mudar o nome das colunas durante um call para select\rflights %\u0026gt;% select(ano = year, mes = month, dia = day)\r ## # A tibble: 336,776 x 3\r## ano mes dia\r## \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;int\u0026gt;\r## 1 2013 1 1\r## 2 2013 1 1\r## 3 2013 1 1\r## 4 2013 1 1\r## 5 2013 1 1\r## 6 2013 1 1\r## 7 2013 1 1\r## 8 2013 1 1\r## 9 2013 1 1\r## 10 2013 1 1\r## # ... with 336,766 more rows\r # Ou voc√™ pode usar rename para mudar os nomes sem selecionar vari√°veis\rflights %\u0026gt;% rename(ano = year, mes = month, dia = day)\r ## # A tibble: 336,776 x 19\r## ano mes dia dep_time sched_dep_time dep_delay arr_time sched_arr_time\r## \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;int\u0026gt; \u0026lt;int\u0026gt;\r## 1 2013 1 1 517 515 2 830 819\r## 2 2013 1 1 533 529 4 850 830\r## 3 2013 1 1 542 540 2 923 850\r## 4 2013 1 1 544 545 -1 1004 1022\r## 5 2013 1 1 554 600 -6 812 837\r## 6 2013 1 1 554 558 -4 740 728\r## 7 2013 1 1 555 600 -5 913 854\r## 8 2013 1 1 557 600 -3 709 723\r## 9 2013 1 1 557 600 -3 838 846\r## 10 2013 1 1 558 600 -2 753 745\r## # ... with 336,766 more rows, and 11 more variables: arr_delay \u0026lt;dbl\u0026gt;,\r## # carrier \u0026lt;chr\u0026gt;, flight \u0026lt;int\u0026gt;, tailnum \u0026lt;chr\u0026gt;, origin \u0026lt;chr\u0026gt;, dest \u0026lt;chr\u0026gt;,\r## # air_time \u0026lt;dbl\u0026gt;, distance \u0026lt;dbl\u0026gt;, hour \u0026lt;dbl\u0026gt;, minute \u0026lt;dbl\u0026gt;, time_hour \u0026lt;dttm\u0026gt;\r S√£o realmente muitas possibilidades, vejam a documenta√ß√£o e os exemplos em ?select.\nUtilizando arrange podemos facilmente organizar nosso banco a partir de vari√°veis de interesse:\n# Selecionar algumas vari√°veis e ver organizar de acordar com os mais adiantados\rflights %\u0026gt;% select(year:day,matches(\u0026quot;^dep|^arr\u0026quot;)) %\u0026gt;% arrange(dep_delay, arr_delay)\r ## # A tibble: 336,776 x 7\r## year month day dep_time dep_delay arr_time arr_delay\r## \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;int\u0026gt; \u0026lt;dbl\u0026gt;\r## 1 2013 12 7 2040 -43 40 48\r## 2 2013 2 3 2022 -33 2240 -58\r## 3 2013 11 10 1408 -32 1549 -10\r## 4 2013 1 11 1900 -30 2233 -10\r## 5 2013 1 29 1703 -27 1947 -10\r## 6 2013 8 9 729 -26 1002 7\r## 7 2013 3 30 2030 -25 2213 -37\r## 8 2013 10 23 1907 -25 2143 0\r## 9 2013 5 5 934 -24 1225 -44\r## 10 2013 9 18 1631 -24 1812 -33\r## # ... with 336,766 more rows\r # Ou os mais atrasados\rflights %\u0026gt;% select(year:day,matches(\u0026quot;^dep|^arr\u0026quot;)) %\u0026gt;% arrange(-dep_delay, -arr_delay)\r ## # A tibble: 336,776 x 7\r## year month day dep_time dep_delay arr_time arr_delay\r## \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;int\u0026gt; \u0026lt;dbl\u0026gt;\r## 1 2013 1 9 641 1301 1242 1272\r## 2 2013 6 15 1432 1137 1607 1127\r## 3 2013 1 10 1121 1126 1239 1109\r## 4 2013 9 20 1139 1014 1457 1007\r## 5 2013 7 22 845 1005 1044 989\r## 6 2013 4 10 1100 960 1342 931\r## 7 2013 3 17 2321 911 135 915\r## 8 2013 6 27 959 899 1236 850\r## 9 2013 7 22 2257 898 121 895\r## 10 2013 12 5 756 896 1058 878\r## # ... with 336,766 more rows\r √â basicamente isso, voc√™ pode especificar uma ou muitas colunas para organizar, decidir se a ordem √© ascendente ou descendente e pronto.\nUtilizando mutate, voc√™ cria vari√°veis derivadas das originais. Como tibble, essa fun√ß√£o avalia seus argumentos de maneira pregui√ßosa e sequencial, o que permite voc√™ criar vari√°veis derivadas umas das outras muito facilmente.\nflights %\u0026gt;% select(sched_dep_time, dep_time, sched_arr_time, arr_time) %\u0026gt;% mutate(atraso_decolagem = dep_time - sched_dep_time,\ratraso_pouso = arr_time - sched_arr_time,\ratraso_dec_horas = atraso_decolagem / 60,\ratraso_pouso_horas = atraso_pouso / 60)\r ## # A tibble: 336,776 x 8\r## sched_dep_time dep_time sched_arr_time arr_time atraso_decolagem atraso_pouso\r## \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;int\u0026gt;\r## 1 515 517 819 830 2 11\r## 2 529 533 830 850 4 20\r## 3 540 542 850 923 2 73\r## 4 545 544 1022 1004 -1 -18\r## 5 600 554 837 812 -46 -25\r## 6 558 554 728 740 -4 12\r## 7 600 555 854 913 -45 59\r## 8 600 557 723 709 -43 -14\r## 9 600 557 846 838 -43 -8\r## 10 600 558 745 753 -42 8\r## # ... with 336,766 more rows, and 2 more variables: atraso_dec_horas \u0026lt;dbl\u0026gt;,\r## # atraso_pouso_horas \u0026lt;dbl\u0026gt;\r # Transmute √© um atalho para quando voc√™ quer apenas as vari√°veis resultado e n√£o est√° interessado nas intermedi√°rias.\rflights %\u0026gt;% transmute(atraso_decolagem = dep_time - sched_dep_time,\ratraso_pouso = arr_time - sched_arr_time,\ratraso_dec_horas = atraso_decolagem / 60,\ratraso_pouso_horas = atraso_pouso / 60)\r ## # A tibble: 336,776 x 4\r## atraso_decolagem atraso_pouso atraso_dec_horas atraso_pouso_horas\r## \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt;\r## 1 2 11 0.0333 0.183\r## 2 4 20 0.0667 0.333\r## 3 2 73 0.0333 1.22 ## 4 -1 -18 -0.0167 -0.3 ## 5 -46 -25 -0.767 -0.417\r## 6 -4 12 -0.0667 0.2 ## 7 -45 59 -0.75 0.983\r## 8 -43 -14 -0.717 -0.233\r## 9 -43 -8 -0.717 -0.133\r## 10 -42 8 -0.7 0.133\r## # ... with 336,766 more rows\r Usando o pipe, √© fazer diversas opera√ß√µes de transforma√ß√£o de vari√°veis simult√¢neamente em um √∫nico call sem a necessidade de repetir o nome do objeto e $ a cada refer√™ncia. mutate √© uma fun√ß√£o extremamente flex√≠vel, voc√™ pode chamar qualquer fun√ß√£o que retorne um vetor de tamanho 1 ou de tamanho do n√∫mero de linhas do banco l√° dentro para criar uma vari√°vel.\ndesabafo \u0026lt;- function(x) {\ry \u0026lt;- floor(x / 60)\rdplyr::case_when(\r# Condi√ß√µes ~ Resultados\ry \u0026lt; 0 ~ \u0026quot;Opa, vou chegar cedo!\u0026quot;,\ry \u0026lt; 1 ~ \u0026quot;Atraso de menos de 1 hora √© toler√°vel\u0026quot;,\ry \u0026gt;= 1 ~ paste0(\u0026quot;Atraso de mais de \u0026quot;, y, \u0026quot; horas √© f***.\u0026quot;),\rTRUE ~ \u0026quot;Ahn?\u0026quot; # Condi√ß√£o guarda-chuva\r)\r}\rflights %\u0026gt;% select(dep_delay) %\u0026gt;% mutate(desabafo = desabafo(dep_delay)) %\u0026gt;% sample_n(10)\r ## # A tibble: 10 x 2\r## dep_delay desabafo ## \u0026lt;dbl\u0026gt; \u0026lt;chr\u0026gt; ## 1 -5 Opa, vou chegar cedo! ## 2 23 Atraso de menos de 1 hora √© toler√°vel\r## 3 -4 Opa, vou chegar cedo! ## 4 -3 Opa, vou chegar cedo! ## 5 -8 Opa, vou chegar cedo! ## 6 -3 Opa, vou chegar cedo! ## 7 -5 Opa, vou chegar cedo! ## 8 22 Atraso de menos de 1 hora √© toler√°vel\r## 9 23 Atraso de menos de 1 hora √© toler√°vel\r## 10 -2 Opa, vou chegar cedo!\r Utilizando summarize voc√™ tira medidas resumo das suas colunas de interesse:\nflights %\u0026gt;% summarize(atraso_decolagem_medio = mean(dep_delay, na.rm = T),\ratraso_decolagem_desvpad = sd(dep_delay, na.rm = T),\ratraso_pouso_medio = mean(arr_delay, na.rm = T),\ratraso_pouso_desvpad = sd(arr_delay, na.rm = T),\rn_voos = n())\r ## # A tibble: 1 x 5\r## atraso_decolagem_~ atraso_decolagem_~ atraso_pouso_me~ atraso_pouso_de~ n_voos\r## \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;int\u0026gt;\r## 1 12.6 40.2 6.90 44.6 336776\r Parece uma bobagem, mas quando voc√™ junta isso com a √∫ltima fun√ß√£o, group_by, √© poss√≠vel obter diversas estat√≠sticas de interesse muito rapidamente e para v√°rios dom√≠nios:\n# Por m√™s\rflights %\u0026gt;% group_by(month) %\u0026gt;% summarize(atraso_decolagem_medio = mean(dep_delay, na.rm = T),\ratraso_decolagem_desvpad = sd(dep_delay, na.rm = T),\ratraso_pouso_medio = mean(arr_delay, na.rm = T),\ratraso_pouso_desvpad = sd(arr_delay, na.rm = T),\rn_voos = n())\r ## # A tibble: 12 x 6\r## month atraso_decolagem_~ atraso_decolagem_~ atraso_pouso_me~ atraso_pouso_de~\r## \u0026lt;int\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt;\r## 1 1 10.0 36.4 6.13 40.4\r## 2 2 10.8 36.3 5.61 39.5\r## 3 3 13.2 40.1 5.81 44.1\r## 4 4 13.9 43.0 11.2 47.5\r## 5 5 13.0 39.4 3.52 44.2\r## 6 6 20.8 51.5 16.5 56.1\r## 7 7 21.7 51.6 16.7 57.1\r## 8 8 12.6 37.7 6.04 42.6\r## 9 9 6.72 35.6 -4.02 39.7\r## 10 10 6.24 29.7 -0.167 32.6\r## 11 11 5.44 27.6 0.461 31.4\r## 12 12 16.6 41.9 14.9 46.1\r## # ... with 1 more variable: n_voos \u0026lt;int\u0026gt;\r # Por m√™s e aeroporto de origem\rflights %\u0026gt;% group_by(month, origin) %\u0026gt;% summarize(atraso_decolagem_medio = mean(dep_delay, na.rm = T),\ratraso_decolagem_desvpad = sd(dep_delay, na.rm = T),\ratraso_pouso_medio = mean(arr_delay, na.rm = T),\ratraso_pouso_desvpad = sd(arr_delay, na.rm = T),\rn_voos = n())\r ## `summarise()` has grouped output by 'month'. You can override using the `.groups` argument.\r## # A tibble: 36 x 7\r## # Groups: month [12]\r## month origin atraso_decolagem_medio atraso_decolagem_desvp~ atraso_pouso_med~\r## \u0026lt;int\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt;\r## 1 1 EWR 14.9 40.8 12.8 ## 2 1 JFK 8.62 36.0 1.37\r## 3 1 LGA 5.64 29.7 3.38\r## 4 2 EWR 13.1 37.2 8.78\r## 5 2 JFK 11.8 37.4 4.39\r## 6 2 LGA 6.96 33.4 3.15\r## 7 3 EWR 18.1 44.1 10.6 ## 8 3 JFK 10.7 35.3 2.58\r## 9 3 LGA 10.2 39.7 3.74\r## 10 4 EWR 17.4 43.9 14.1 ## # ... with 26 more rows, and 2 more variables: atraso_pouso_desvpad \u0026lt;dbl\u0026gt;,\r## # n_voos \u0026lt;int\u0026gt;\r Uma vez que voc√™ se familiariza com a gram√°tica do dplyr, o processo de an√°lise explorat√≥ria se torna bastante trivial e at√© certo ponto, prazeiroso. Mas o que eu realmente gosto √© que ele tamb√©m se torna visualmente √≥bvio para o leitor, com cada chamado podendo ser lido como uma declara√ß√£o:\n Utilizando o banco de dados flights, agrupe as observa√ß√µes por m√™s e aeroporto de origem, ent√£o, calcule as m√©dias e desvios padr√£o dos atrasos no pouso e na decolagem e o n√∫mero de v√¥os para cada grupo.\n Voc√™ tamb√©m pode rapidamente introduzir ou retirar passos em cada chamado deste utilizando o pipe, por exemplo:\nflights %\u0026gt;% group_by(month, origin) %\u0026gt;% summarize(atraso_decolagem_medio = mean(dep_delay, na.rm = T),\ratraso_decolagem_desvpad = sd(dep_delay, na.rm = T),\ratraso_pouso_medio = mean(arr_delay, na.rm = T),\ratraso_pouso_desvpad = sd(arr_delay, na.rm = T),\rn_voos = n()) %\u0026gt;% arrange(-atraso_decolagem_medio)\r ## `summarise()` has grouped output by 'month'. You can override using the `.groups` argument.\r## # A tibble: 36 x 7\r## # Groups: month [12]\r## month origin atraso_decolagem_medio atraso_decolagem_desvp~ atraso_pouso_med~\r## \u0026lt;int\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt;\r## 1 7 JFK 23.8 53.3 20.2 ## 2 6 EWR 22.5 50.8 16.9 ## 3 7 EWR 22.0 49.5 15.5 ## 4 12 EWR 21.0 45.7 19.6 ## 5 6 JFK 20.5 50.2 17.6 ## 6 6 LGA 19.3 53.6 14.8 ## 7 7 LGA 19.0 52.0 14.2 ## 8 3 EWR 18.1 44.1 10.6 ## 9 4 EWR 17.4 43.9 14.1 ## 10 5 EWR 15.4 39.0 5.38\r## # ... with 26 more rows, and 2 more variables: atraso_pouso_desvpad \u0026lt;dbl\u0026gt;,\r## # n_voos \u0026lt;int\u0026gt;\r E a leitura fica:\n Utilizando o banco de dados flights, agrupe as observa√ß√µes por m√™s e aeroporto de origem, ent√£o, calcule as m√©dias e desvios padr√£o dos atrasos no pouso e na decolagem e o n√∫mero de v√¥os para cada grupo, ent√£o, ordene os resultados pelo maior atraso.\n De quebra, voc√™ ainda leva para casa um dado no formato ‚Äútabela,‚Äù f√°cil de exportar para outros softwares para embelezamento e publica√ß√£o. Veja:\nresumo \u0026lt;- flights %\u0026gt;% group_by(month, origin) %\u0026gt;% summarize(atraso_decolagem_medio = mean(dep_delay, na.rm = T),\ratraso_decolagem_desvpad = sd(dep_delay, na.rm = T),\ratraso_pouso_medio = mean(arr_delay, na.rm = T),\ratraso_pouso_desvpad = sd(arr_delay, na.rm = T),\rn_voos = n()) %\u0026gt;% arrange(-atraso_decolagem_medio)\r ## `summarise()` has grouped output by 'month'. You can override using the `.groups` argument.\r print(resumo, n = Inf)\r ## # A tibble: 36 x 7\r## # Groups: month [12]\r## month origin atraso_decolagem_medio atraso_decolagem_desvp~ atraso_pouso_med~\r## \u0026lt;int\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt;\r## 1 7 JFK 23.8 53.3 20.2 ## 2 6 EWR 22.5 50.8 16.9 ## 3 7 EWR 22.0 49.5 15.5 ## 4 12 EWR 21.0 45.7 19.6 ## 5 6 JFK 20.5 50.2 17.6 ## 6 6 LGA 19.3 53.6 14.8 ## 7 7 LGA 19.0 52.0 14.2 ## 8 3 EWR 18.1 44.1 10.6 ## 9 4 EWR 17.4 43.9 14.1 ## 10 5 EWR 15.4 39.0 5.38 ## 11 1 EWR 14.9 40.8 12.8 ## 12 12 JFK 14.8 39.1 12.7 ## 13 12 LGA 13.6 39.8 12.0 ## 14 8 EWR 13.5 37.6 6.71 ## 15 2 EWR 13.1 37.2 8.78 ## 16 8 JFK 12.9 36.3 5.91 ## 17 5 JFK 12.5 38.5 2.12 ## 18 4 JFK 12.2 41.2 7.01 ## 19 2 JFK 11.8 37.4 4.39 ## 20 4 LGA 11.5 43.4 12.0 ## 21 8 LGA 11.2 39.2 5.41 ## 22 3 JFK 10.7 35.3 2.58 ## 23 5 LGA 10.6 40.6 2.80 ## 24 3 LGA 10.2 39.7 3.74 ## 25 10 EWR 8.64 32.7 2.60 ## 26 1 JFK 8.62 36.0 1.37 ## 27 9 EWR 7.29 35.0 -4.73 ## 28 2 LGA 6.96 33.4 3.15 ## 29 11 EWR 6.72 28.8 0.672\r## 30 9 JFK 6.64 32.5 -4.46 ## 31 9 LGA 6.21 39.0 -2.83 ## 32 1 LGA 5.64 29.7 3.38 ## 33 10 LGA 5.31 30.1 0.186\r## 34 11 LGA 4.77 26.6 1.55 ## 35 11 JFK 4.68 27.1 -0.873\r## 36 10 JFK 4.59 25.2 -3.59 ## # ... with 2 more variables: atraso_pouso_desvpad \u0026lt;dbl\u0026gt;, n_voos \u0026lt;int\u0026gt;\r Lembrem-se que √© necess√°rio atribuir \u0026lt;- os resultados das opera√ß√µes para que elas sejam salvas. Em geral, meu workflow √© assim:\n# Come√ßo com o banco\rflights\r ## # A tibble: 336,776 x 19\r## year month day dep_time sched_dep_time dep_delay arr_time sched_arr_time\r## \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;int\u0026gt; \u0026lt;int\u0026gt;\r## 1 2013 1 1 517 515 2 830 819\r## 2 2013 1 1 533 529 4 850 830\r## 3 2013 1 1 542 540 2 923 850\r## 4 2013 1 1 544 545 -1 1004 1022\r## 5 2013 1 1 554 600 -6 812 837\r## 6 2013 1 1 554 558 -4 740 728\r## 7 2013 1 1 555 600 -5 913 854\r## 8 2013 1 1 557 600 -3 709 723\r## 9 2013 1 1 557 600 -3 838 846\r## 10 2013 1 1 558 600 -2 753 745\r## # ... with 336,766 more rows, and 11 more variables: arr_delay \u0026lt;dbl\u0026gt;,\r## # carrier \u0026lt;chr\u0026gt;, flight \u0026lt;int\u0026gt;, tailnum \u0026lt;chr\u0026gt;, origin \u0026lt;chr\u0026gt;, dest \u0026lt;chr\u0026gt;,\r## # air_time \u0026lt;dbl\u0026gt;, distance \u0026lt;dbl\u0026gt;, hour \u0026lt;dbl\u0026gt;, minute \u0026lt;dbl\u0026gt;, time_hour \u0026lt;dttm\u0026gt;\r # Seleciono algumas vari√°veis\rflights %\u0026gt;% select(month, dep_delay, arr_delay)\r ## # A tibble: 336,776 x 3\r## month dep_delay arr_delay\r## \u0026lt;int\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt;\r## 1 1 2 11\r## 2 1 4 20\r## 3 1 2 33\r## 4 1 -1 -18\r## 5 1 -6 -25\r## 6 1 -4 12\r## 7 1 -5 19\r## 8 1 -3 -14\r## 9 1 -3 -8\r## 10 1 -2 8\r## # ... with 336,766 more rows\r # Recorto algumas observa√ß√µes\rflights %\u0026gt;% select(month, dep_delay, arr_delay) %\u0026gt;% filter(between(month, 1, 6))\r ## # A tibble: 166,158 x 3\r## month dep_delay arr_delay\r## \u0026lt;int\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt;\r## 1 1 2 11\r## 2 1 4 20\r## 3 1 2 33\r## 4 1 -1 -18\r## 5 1 -6 -25\r## 6 1 -4 12\r## 7 1 -5 19\r## 8 1 -3 -14\r## 9 1 -3 -8\r## 10 1 -2 8\r## # ... with 166,148 more rows\r # Escolho os dominios e calculo as medidas resumo\rflights %\u0026gt;% select(month, dep_delay, arr_delay) %\u0026gt;% filter(between(month, 1, 6)) %\u0026gt;% group_by(month) %\u0026gt;% summarise(atraso_dec_medio = mean(dep_delay, na.rm = T),\ratraso_pou_medio = mean(arr_delay, na.rm = T))\r ## # A tibble: 6 x 3\r## month atraso_dec_medio atraso_pou_medio\r## \u0026lt;int\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt;\r## 1 1 10.0 6.13\r## 2 2 10.8 5.61\r## 3 3 13.2 5.81\r## 4 4 13.9 11.2 ## 5 5 13.0 3.52\r## 6 6 20.8 16.5\r # Acho bom organizar pelos atrasos maiores\rflights %\u0026gt;% select(month, dep_delay, arr_delay) %\u0026gt;% filter(between(month, 1, 6)) %\u0026gt;% group_by(month) %\u0026gt;% summarise(atraso_dec_medio = mean(dep_delay, na.rm = T),\ratraso_pou_medio = mean(arr_delay, na.rm = T)) %\u0026gt;% arrange(-atraso_dec_medio, -atraso_pou_medio)\r ## # A tibble: 6 x 3\r## month atraso_dec_medio atraso_pou_medio\r## \u0026lt;int\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt;\r## 1 6 20.8 16.5 ## 2 4 13.9 11.2 ## 3 3 13.2 5.81\r## 4 5 13.0 3.52\r## 5 2 10.8 5.61\r## 6 1 10.0 6.13\r # Estou satisfeito, salvo meu resultado em outro objeto\ratrasos \u0026lt;- flights %\u0026gt;% select(month, dep_delay, arr_delay) %\u0026gt;% filter(between(month, 1, 6)) %\u0026gt;% group_by(month) %\u0026gt;% summarise(atraso_dec_medio = mean(dep_delay, na.rm = T),\ratraso_pou_medio = mean(arr_delay, na.rm = T)) %\u0026gt;% arrange(-atraso_dec_medio, -atraso_pou_medio)\ratrasos\r ## # A tibble: 6 x 3\r## month atraso_dec_medio atraso_pou_medio\r## \u0026lt;int\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt;\r## 1 6 20.8 16.5 ## 2 4 13.9 11.2 ## 3 3 13.2 5.81\r## 4 5 13.0 3.52\r## 5 2 10.8 5.61\r## 6 1 10.0 6.13\r Desta forma, consigo construir interativamente meus c√°lculos, verificando a cada passo se estou obtendo o resultado esperado. Visto de outra perspectiva, se encontro um c√≥digo programado desta forma que n√£o funciona, posso ir apagando cada %\u0026gt;% para identificar onde o problema ocorreu.\nEspero que tenha ficado claro que o assunto n√£o se encerra por aqui. Existem diversas outras fun√ß√µes √∫teis no pacote, como count, if_else, case_when, top_n, bind_rows, bind_cols, as novas fun√ß√µes across e c_across e muitas, muitas outras. Nos livros voc√™s encontram v√°rios outros exemplos e fun√ß√µes para facilitar o processo de an√°lise de dados, mas nossa expectativa √© que essa apresenta√ß√£o seja um ponto de partida para voc√™s se aprofundarem no seu pr√≥prio ritmo.\ndplyr para bancos de dados relacionais Nesta se√ß√£o, o nosso problema n√£o √© mais a an√°lise de dados presentes em um banco, mas o problema de relacionar informa√ß√µes sobre uma mesma unidade de an√°lise que est√£o presentes em v√°rios bancos de dados distintos.\nO banco nycflights13 cont√©m v√°rias tabelas que se relacionam, e elas funcionam como um excelente exemplo de banco de dados relacionais.\nNote que al√©m do banco de dados dos v√¥os, temos informa√ß√µes sobre clima, avi√µes e companhias a√©reas. Para n√≥s, pode ser relevante reunir informa√ß√µes de diferentes fontes em um mesmo banco de dados, algo que √© poss√≠vel atrav√©s de joins. Por uma quest√£o de tempo, n√£o vamos entrar muito a fundo no assunto, mas vamos introduzir dois conceitos chave e partir pros exemplos.\n  chaves s√£o as vari√°veis que identificam cada observa√ß√£o em um banco de dados de forma √∫nica. Uma chave √© dita ‚Äúprim√°ria‚Äù quando identifica uma observa√ß√£o na sua pr√≥pria tabela e ‚Äúexterna‚Äù quando ela identifica uma observa√ß√£o em outra tabela. Assim, qualquer opera√ß√£o de join √© uma forma de relacionar uma chave prim√°ria e uma chave externa. Essa jun√ß√£o de chaves √© uma rela√ß√£o, e as rela√ß√µes podem ser 1 para 1, 1 para muitos ou muitos para 1.\n  joins s√£o tipos de opera√ß√£o no qual se opta por priorizar um grupo de observa√ß√µes em detrimento de outras. Podemos v√™-los didaticamente a partir de duas figuras:\n  A primeira figura √© interessante porque nos d√° uma ideia de quais observa√ß√µes ser√£o mantidas e quais ser√£o descartadas, podemos imagin√°-la como uma abstra√ß√£o da nossa escolha.\n Quero todas as informa√ß√µes sobre os v√¥os e os aeroportos, e as duas s√£o igualmente importantes (inner_join, x = flights, y = airports).\n  Quero todas as observa√ß√µes do banco v√¥os e as informa√ß√µes dispon√≠veis sobre a aeronave (left_join, x = flights, y = planes).\n  Quero todas as informa√ß√µes tanto sobre os v√¥os quanto sobre o clima em cada dia (full_join, x = flights, y = weather).\n  Quero as informa√ß√µes dos v√¥os realizados pelas companhias a√©reas - minha prioridade s√£o as cias. √°reas (right_join, x = flights, y = carriers).\n A segunda figura √© interessante porque elas mostra a mec√¢nica de um join: cada observa√ß√£o tem a sua chave marcada com a observa√ß√£o correspondente no outro banco. Se as chaves s√£o iguais, a opera√ß√£o √© realizada, se as chaves n√£o s√£o iguais, a opera√ß√£o n√£o √© realizada. Dependendo do tipo de join, uma, as duas ou nenhuma das observa√ß√µes √© descartada do banco resultante.\n Antes de come√ßar a trabalhar com bancos relacionais, √© uma boa ideia dar uma explorada nas chaves, vendo suas contagens, se h√° erros de digita√ß√£o, etc. Por uma quest√£o de tempo, vamos pular essa fase.\n Se as nossas chaves forem perfeitinhas, e inclusive tiverem o mesmo nome nas duas tabelas, basta invocar o tipo de join desejado.\n# Vamos dar uma enxugada no flights para poder ver o efeito dos joins com maior facilidade.\rflights2 \u0026lt;- flights %\u0026gt;% select(year:day, hour, origin, dest, tailnum, carrier)\rflights2\r ## # A tibble: 336,776 x 8\r## year month day hour origin dest tailnum carrier\r## \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; ## 1 2013 1 1 5 EWR IAH N14228 UA ## 2 2013 1 1 5 LGA IAH N24211 UA ## 3 2013 1 1 5 JFK MIA N619AA AA ## 4 2013 1 1 5 JFK BQN N804JB B6 ## 5 2013 1 1 6 LGA ATL N668DN DL ## 6 2013 1 1 5 EWR ORD N39463 UA ## 7 2013 1 1 6 EWR FLL N516JB B6 ## 8 2013 1 1 6 LGA IAD N829AS EV ## 9 2013 1 1 6 JFK MCO N593JB B6 ## 10 2013 1 1 6 LGA ORD N3ALAA AA ## # ... with 336,766 more rows\r # Chaves perfeitas, mesmo nome nos dois bancos = natural join\rflights2 %\u0026gt;% left_join(weather) # Moleza\r ## Joining, by = c(\u0026quot;year\u0026quot;, \u0026quot;month\u0026quot;, \u0026quot;day\u0026quot;, \u0026quot;hour\u0026quot;, \u0026quot;origin\u0026quot;)\r## # A tibble: 336,776 x 18\r## year month day hour origin dest tailnum carrier temp dewp humid\r## \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt;\r## 1 2013 1 1 5 EWR IAH N14228 UA 39.0 28.0 64.4\r## 2 2013 1 1 5 LGA IAH N24211 UA 39.9 25.0 54.8\r## 3 2013 1 1 5 JFK MIA N619AA AA 39.0 27.0 61.6\r## 4 2013 1 1 5 JFK BQN N804JB B6 39.0 27.0 61.6\r## 5 2013 1 1 6 LGA ATL N668DN DL 39.9 25.0 54.8\r## 6 2013 1 1 5 EWR ORD N39463 UA 39.0 28.0 64.4\r## 7 2013 1 1 6 EWR FLL N516JB B6 37.9 28.0 67.2\r## 8 2013 1 1 6 LGA IAD N829AS EV 39.9 25.0 54.8\r## 9 2013 1 1 6 JFK MCO N593JB B6 37.9 27.0 64.3\r## 10 2013 1 1 6 LGA ORD N3ALAA AA 39.9 25.0 54.8\r## # ... with 336,766 more rows, and 7 more variables: wind_dir \u0026lt;dbl\u0026gt;,\r## # wind_speed \u0026lt;dbl\u0026gt;, wind_gust \u0026lt;dbl\u0026gt;, precip \u0026lt;dbl\u0026gt;, pressure \u0026lt;dbl\u0026gt;,\r## # visib \u0026lt;dbl\u0026gt;, time_hour \u0026lt;dttm\u0026gt;\r flights2 %\u0026gt;% left_join(airlines) # Moleza\r ## Joining, by = \u0026quot;carrier\u0026quot;\r## # A tibble: 336,776 x 9\r## year month day hour origin dest tailnum carrier name ## \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; ## 1 2013 1 1 5 EWR IAH N14228 UA United Air Lines Inc. ## 2 2013 1 1 5 LGA IAH N24211 UA United Air Lines Inc. ## 3 2013 1 1 5 JFK MIA N619AA AA American Airlines Inc. ## 4 2013 1 1 5 JFK BQN N804JB B6 JetBlue Airways ## 5 2013 1 1 6 LGA ATL N668DN DL Delta Air Lines Inc. ## 6 2013 1 1 5 EWR ORD N39463 UA United Air Lines Inc. ## 7 2013 1 1 6 EWR FLL N516JB B6 JetBlue Airways ## 8 2013 1 1 6 LGA IAD N829AS EV ExpressJet Airlines Inc.\r## 9 2013 1 1 6 JFK MCO N593JB B6 JetBlue Airways ## 10 2013 1 1 6 LGA ORD N3ALAA AA American Airlines Inc. ## # ... with 336,766 more rows\r # Chaves perfeitas, mas h√° vari√°veis nos dois bancos com o mesmo nome e que n√£o s√£o chaves\r# √â necess√°rio especificar qual a chave\rflights2 %\u0026gt;% left_join(planes, by = \u0026quot;tailnum\u0026quot;)\r ## # A tibble: 336,776 x 16\r## year.x month day hour origin dest tailnum carrier year.y type ## \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;int\u0026gt; \u0026lt;chr\u0026gt; ## 1 2013 1 1 5 EWR IAH N14228 UA 1999 Fixed wing mult~\r## 2 2013 1 1 5 LGA IAH N24211 UA 1998 Fixed wing mult~\r## 3 2013 1 1 5 JFK MIA N619AA AA 1990 Fixed wing mult~\r## 4 2013 1 1 5 JFK BQN N804JB B6 2012 Fixed wing mult~\r## 5 2013 1 1 6 LGA ATL N668DN DL 1991 Fixed wing mult~\r## 6 2013 1 1 5 EWR ORD N39463 UA 2012 Fixed wing mult~\r## 7 2013 1 1 6 EWR FLL N516JB B6 2000 Fixed wing mult~\r## 8 2013 1 1 6 LGA IAD N829AS EV 1998 Fixed wing mult~\r## 9 2013 1 1 6 JFK MCO N593JB B6 2004 Fixed wing mult~\r## 10 2013 1 1 6 LGA ORD N3ALAA AA NA \u0026lt;NA\u0026gt; ## # ... with 336,766 more rows, and 6 more variables: manufacturer \u0026lt;chr\u0026gt;,\r## # model \u0026lt;chr\u0026gt;, engines \u0026lt;int\u0026gt;, seats \u0026lt;int\u0026gt;, speed \u0026lt;int\u0026gt;, engine \u0026lt;chr\u0026gt;\r Veja que tanto flights2 quanto planes tem uma vari√°vel chamada year, mas elas significados diferentes. Em flights2 √© o ano do v√¥o, enquanto em planes √© o ano em que a aeronave entra em servi√ßo. Na hora que fazemos o join, uma recebe o sufixo ‚Äúx‚Äù e a outra ‚Äúy‚Äù para a indicar a diferen√ßa. Voc√™ pode especificar o sufixo desejado para evitar confus√£o:\nflights2 %\u0026gt;% left_join(planes, by = \u0026quot;tailnum\u0026quot;, suffix = c(\u0026quot;_flight\u0026quot;, \u0026quot;_entered_service\u0026quot;))\r ## # A tibble: 336,776 x 16\r## year_flight month day hour origin dest tailnum carrier year_entered_serv~\r## \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;int\u0026gt;\r## 1 2013 1 1 5 EWR IAH N14228 UA 1999\r## 2 2013 1 1 5 LGA IAH N24211 UA 1998\r## 3 2013 1 1 5 JFK MIA N619AA AA 1990\r## 4 2013 1 1 5 JFK BQN N804JB B6 2012\r## 5 2013 1 1 6 LGA ATL N668DN DL 1991\r## 6 2013 1 1 5 EWR ORD N39463 UA 2012\r## 7 2013 1 1 6 EWR FLL N516JB B6 2000\r## 8 2013 1 1 6 LGA IAD N829AS EV 1998\r## 9 2013 1 1 6 JFK MCO N593JB B6 2004\r## 10 2013 1 1 6 LGA ORD N3ALAA AA NA\r## # ... with 336,766 more rows, and 7 more variables: type \u0026lt;chr\u0026gt;,\r## # manufacturer \u0026lt;chr\u0026gt;, model \u0026lt;chr\u0026gt;, engines \u0026lt;int\u0026gt;, seats \u0026lt;int\u0026gt;, speed \u0026lt;int\u0026gt;,\r## # engine \u0026lt;chr\u0026gt;\r Um aviso: cuidado com os produtos cartesianos. N√£o h√° um bom exemplo aqui no caso do flights porque o banco j√° est√° limpinho, mas se voc√™ especificar chaves com uma rela√ß√£o ‚Äúmuitos para muitos,‚Äù ele vai registrar no banco novo uma linha para cada combina√ß√£o poss√≠vel de vari√°veis. Em bancos maiores, isso geralmente estoura sua mem√≥ria e trava o R. Veja este pequeno exemplo de brinquedo.\nx \u0026lt;- tribble(\r~key, ~val_x,\r1, \u0026quot;x1\u0026quot;,\r2, \u0026quot;x2\u0026quot;,\r2, \u0026quot;x3\u0026quot;,\r3, \u0026quot;x4\u0026quot;\r)\ry \u0026lt;- tribble(\r~key, ~val_y,\r1, \u0026quot;y1\u0026quot;,\r2, \u0026quot;y2\u0026quot;,\r2, \u0026quot;y3\u0026quot;,\r3, \u0026quot;y4\u0026quot;\r)\rleft_join(x, y, by = \u0026quot;key\u0026quot;)\r ## # A tibble: 6 x 3\r## key val_x val_y\r## \u0026lt;dbl\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt;\r## 1 1 x1 y1 ## 2 2 x2 y2 ## 3 2 x2 y3 ## 4 2 x3 y2 ## 5 2 x3 y3 ## 6 3 x4 y4\r Veja que no resultado foi criada uma linha para cada combina√ß√£o de val_x e val_y que tem a mesma chave repetida. Podem at√© existir situa√ß√µes em que isso seja o que voc√™ quer mesmo, mas na minha experi√™ncia at√© o momento isso √© problema com as chaves duplicadas e √© sinal de que h√° algo errado.\nMas pera√≠, se voc√™ falou que tem 4 tipos de join, porque s√≥ d√° exemplo de left_join?\nNa pr√°tica, opera√ß√µes relacionais s√£o feitas de forma intencional: escolhemos bancos de dados de acordo com o valor que atribu√≠mos a informa√ß√£o presente nele e pin√ßamos informa√ß√µes relacionadas de outros lugares para adicionar aquilo que √© nosso foco. Por isso, na maioria dos casos, o left_join √© o mais usual, porque preserva todas as informa√ß√µes do meu banco x e adiciona apenas as informa√ß√µes do banco y que combinaram com sucesso. Isso garante que eu n√£o vou perder nenhuma informa√ß√£o do meu banco principal.\nPra encerrar essa parte, mais exemplos de joins.\n# Minhas chaves tem nomes diferentes, ent√£o uso um vetor do tipo c(\u0026quot;chave_x\u0026quot; = \u0026quot;chave_y\u0026quot;)\rflights2 %\u0026gt;% left_join(airports, c(\u0026quot;dest\u0026quot; = \u0026quot;faa\u0026quot;))\r ## # A tibble: 336,776 x 15\r## year month day hour origin dest tailnum carrier name lat lon alt\r## \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt;\r## 1 2013 1 1 5 EWR IAH N14228 UA Georg~ 30.0 -95.3 97\r## 2 2013 1 1 5 LGA IAH N24211 UA Georg~ 30.0 -95.3 97\r## 3 2013 1 1 5 JFK MIA N619AA AA Miami~ 25.8 -80.3 8\r## 4 2013 1 1 5 JFK BQN N804JB B6 \u0026lt;NA\u0026gt; NA NA NA\r## 5 2013 1 1 6 LGA ATL N668DN DL Harts~ 33.6 -84.4 1026\r## 6 2013 1 1 5 EWR ORD N39463 UA Chica~ 42.0 -87.9 668\r## 7 2013 1 1 6 EWR FLL N516JB B6 Fort ~ 26.1 -80.2 9\r## 8 2013 1 1 6 LGA IAD N829AS EV Washi~ 38.9 -77.5 313\r## 9 2013 1 1 6 JFK MCO N593JB B6 Orlan~ 28.4 -81.3 96\r## 10 2013 1 1 6 LGA ORD N3ALAA AA Chica~ 42.0 -87.9 668\r## # ... with 336,766 more rows, and 3 more variables: tz \u0026lt;dbl\u0026gt;, dst \u0026lt;chr\u0026gt;,\r## # tzone \u0026lt;chr\u0026gt;\r # Mesma coisa, s√≥ que agora juntando as informa√ß√µes da origem ao inv√©s do destino\rflights2 %\u0026gt;% left_join(airports, c(\u0026quot;origin\u0026quot; = \u0026quot;faa\u0026quot;))\r ## # A tibble: 336,776 x 15\r## year month day hour origin dest tailnum carrier name lat lon alt\r## \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt;\r## 1 2013 1 1 5 EWR IAH N14228 UA Newar~ 40.7 -74.2 18\r## 2 2013 1 1 5 LGA IAH N24211 UA La Gu~ 40.8 -73.9 22\r## 3 2013 1 1 5 JFK MIA N619AA AA John ~ 40.6 -73.8 13\r## 4 2013 1 1 5 JFK BQN N804JB B6 John ~ 40.6 -73.8 13\r## 5 2013 1 1 6 LGA ATL N668DN DL La Gu~ 40.8 -73.9 22\r## 6 2013 1 1 5 EWR ORD N39463 UA Newar~ 40.7 -74.2 18\r## 7 2013 1 1 6 EWR FLL N516JB B6 Newar~ 40.7 -74.2 18\r## 8 2013 1 1 6 LGA IAD N829AS EV La Gu~ 40.8 -73.9 22\r## 9 2013 1 1 6 JFK MCO N593JB B6 John ~ 40.6 -73.8 13\r## 10 2013 1 1 6 LGA ORD N3ALAA AA La Gu~ 40.8 -73.9 22\r## # ... with 336,766 more rows, and 3 more variables: tz \u0026lt;dbl\u0026gt;, dst \u0026lt;chr\u0026gt;,\r## # tzone \u0026lt;chr\u0026gt;\r O assunto, obviamente, n√£o p√°ra por a√≠. Nos livros voc√™s encontrar√£o mais exemplos e fun√ß√µes, como √© o caso do semi_join e do anti_join e das opera√ß√µes ‚Äúset,‚Äù intersect, union e setdiff, mas isso fica pra voc√™s explorarem por conta pr√≥pria e virem tirar as d√∫vidas depois!\nstringr stringr cont√©m uma fam√≠lia de fun√ß√µes, todas come√ßadas em str_, cuja principal preocupa√ß√£o √© a consist√™ncia. As fun√ß√µes do base para strings s√£o muito √∫teis, por√©m, seus argumentos est√£o numa ordem um pouco estranha, algumas fun√ß√µes s√£o vetorizadas e outras n√£o. Quando voc√™ se acostuma, at√© que n√£o √© t√£o ruim, mas voltando para o assunto discutido ontem de tornar o seu c√≥digo mais leg√≠vel, √© interessante ter a simplicidade oferecida.\nBasic√£o da string Como este curso j√° √© pra praticantes de R, vou pular algumas coisas muito b√°sicas de string, vamos ao que interessa.\nDeterminados caracteres tem um significado especial dentro das strings. Quem j√° tentou copiar e colar um caminho de arquivo do Windows pro R sabe disso. Ent√£o, nesses casos, √© precisar ‚Äúescapar‚Äù caracteres. Por exemplo, se voc√™ quiser escrever aspas, voc√™ usar a contrabarra \\ para ‚Äúescapar‚Äù um caractere.\naspa_simples \u0026lt;- '\\'' # ou \u0026quot;'\u0026quot;\raspa_dupla \u0026lt;- \u0026quot;\\\u0026quot;\u0026quot; # ou '\u0026quot;'\r A regra do escape √© simples, ent√£o se voc√™ quiser colocar uma contrabarra \\\nx \u0026lt;- c(\u0026quot;\\\\\u0026quot;, \u0026quot;\\\u0026quot;\u0026quot;)\rx\r ## [1] \u0026quot;\\\\\u0026quot; \u0026quot;\\\u0026quot;\u0026quot;\r writeLines(x)\r ## \\\r## \u0026quot;\r Outros caracteres especiais √∫teis: \u0026quot;\\n\u0026quot; para pular uma linha, \\t para Tab. Voc√™ pode ver os outros na ajuda das aspas \u0026quot;, basta digitar no console ?\u0026quot;'\u0026quot; ou ?'\u0026quot;'.\nOutra coisa que d√° pra fazer, se voc√™ precisar incluir um caractere distinto, √© usar unicode:\nx \u0026lt;- \u0026quot;\\u00b5\u0026quot;\rx\r ## [1] \u0026quot;¬µ\u0026quot;\r Ok, mas e o pacote stringr? Bem, ele tem o intuito de facilitar e dar consist√™ncia, ent√£o, todas as fun√ß√µes do pacote come√ßam com as iniciais str_ justamente para serem utilizadas com o autocompletar do RStudio, que pode ser acessada com os atalhos Ctrl + Espa√ßo ou Tab. Vamos ver agora alguns exemplos de fun√ß√µes do pacote.\nComprimento da string em caracteres:\nlibrary(stringr)\r# No RStudio, basta digitar 'str_' e apertar Tab ou Ctrl + Espa√ßo\rx \u0026lt;- \u0026quot;Ministro Sinistro\u0026quot;\rstr_length(x)\r ## [1] 17\r x \u0026lt;- c(\u0026quot;Ministro Sinistro\u0026quot;, \u0026quot;Abelha Gulosa\u0026quot;, \u0026quot;p\u0026quot;)\rstr_length(x)\r ## [1] 17 13 1\r Concatena√ß√£o de strings:\nstr_c(\u0026quot;x\u0026quot;, \u0026quot;y\u0026quot;, \u0026quot;z\u0026quot;)\r ## [1] \u0026quot;xyz\u0026quot;\r Use o argumento sep para definir caracteres que aparecer√£o entre as strings originais:\nstr_c(\u0026quot;x\u0026quot;, \u0026quot;y\u0026quot;, \u0026quot;z\u0026quot;, sep = \u0026quot; + \u0026quot;)\r ## [1] \u0026quot;x + y + z\u0026quot;\r Voc√™ pode trabalhar com strings que cont√©m NAs:\nx \u0026lt;- c(\u0026quot;abc\u0026quot;, NA)\rstr_c(\u0026quot;|-\u0026quot;, x, \u0026quot;-|\u0026quot;)\r ## [1] \u0026quot;|-abc-|\u0026quot; NA\r str_c(\u0026quot;|-\u0026quot;, str_replace_na(x), \u0026quot;-|\u0026quot;)\r ## [1] \u0026quot;|-abc-|\u0026quot; \u0026quot;|-NA-|\u0026quot;\r str_c √© uma fun√ß√£o vetorizada e automaticamente recicla seus argumentos pra ter o tamanho do maior:\n# Eu na gradua√ß√£o\rstr_c(\u0026quot;Profe, me d√° mais \u0026quot;, c(\u0026quot;1\u0026quot;, \u0026quot;2\u0026quot;, \u0026quot;3\u0026quot;), \u0026quot; semanas pra entregar, por favor!\u0026quot;)\r ## [1] \u0026quot;Profe, me d√° mais 1 semanas pra entregar, por favor!\u0026quot;\r## [2] \u0026quot;Profe, me d√° mais 2 semanas pra entregar, por favor!\u0026quot;\r## [3] \u0026quot;Profe, me d√° mais 3 semanas pra entregar, por favor!\u0026quot;\r # Eu de manh√£\rstr_c(\u0026quot;S√≥ mais \u0026quot;, c(\u0026quot;5\u0026quot;, \u0026quot;10\u0026quot;, \u0026quot;20\u0026quot;, \u0026quot;30\u0026quot;), \u0026quot; minutinhos e eu acordo!\u0026quot;)\r ## [1] \u0026quot;S√≥ mais 5 minutinhos e eu acordo!\u0026quot; \u0026quot;S√≥ mais 10 minutinhos e eu acordo!\u0026quot;\r## [3] \u0026quot;S√≥ mais 20 minutinhos e eu acordo!\u0026quot; \u0026quot;S√≥ mais 30 minutinhos e eu acordo!\u0026quot;\r Se algum dos objetos passados para str_c tiver tamanho 0, ele √© descartado. √ötil para usar com testes l√≥gicos.\nnome \u0026lt;- \u0026quot;Vinicius\u0026quot;\rsobrenome \u0026lt;- \u0026quot;Maia\u0026quot;\rtem_nome_do_meio \u0026lt;- FALSE\rstr_c(\r\u0026quot;Meu nome √© \u0026quot;, nome, \u0026quot; \u0026quot;,\r# isso aqui retorna um vetor tamanho 0\rif (tem_nome_do_meio) \u0026quot; de Souza\u0026quot;, sobrenome,\r\u0026quot;.\u0026quot;\r)\r ## [1] \u0026quot;Meu nome √© Vinicius Maia.\u0026quot;\r Conhecedores de paste reconhecer√£o o argumento collapse, que serve para transformar vetores de strings em uma √∫nica string.\nstr_c(c(\u0026quot;Nat√°lia\u0026quot;, \u0026quot;Martins\u0026quot;, \u0026quot;Arruda\u0026quot;), collapse = \u0026quot; \u0026quot;)\r ## [1] \u0026quot;Nat√°lia Martins Arruda\u0026quot;\r De forma similar, conhecedores de substring dever√£o imediatamente reconhecer essa:\nx \u0026lt;- c(\u0026quot;Ma√ß√£\u0026quot;, \u0026quot;Banana\u0026quot;, \u0026quot;Abacaxi\u0026quot;)\rstr_sub(x, 1, 3)\r ## [1] \u0026quot;Ma√ß\u0026quot; \u0026quot;Ban\u0026quot; \u0026quot;Aba\u0026quot;\r str_sub(x, -3, -1)\r ## [1] \u0026quot;a√ß√£\u0026quot; \u0026quot;ana\u0026quot; \u0026quot;axi\u0026quot;\r str_sub n√£o vai dar erro se a string for muito curta:\nstr_sub(\u0026quot;a\u0026quot;, 1, 5)\r ## [1] \u0026quot;a\u0026quot;\r D√° pra usar a forma str_sub(x) \u0026lt;- para modificar partes de strings\nstr_sub(x, 1, 1) \u0026lt;- str_to_lower(str_sub(x, 1, 1))\rx\r ## [1] \u0026quot;ma√ß√£\u0026quot; \u0026quot;banana\u0026quot; \u0026quot;abacaxi\u0026quot;\r Note o uso de str_to_lower para mudar para min√∫sculas. O contr√°rio √© str_to_upper, tamb√©m h√° uma para t√≠tulos, str_to_title, e para a primeira letra de uma frase, str_to_sentence.\nx \u0026lt;- \u0026quot;Ministro Sinistro\u0026quot;\rstr_to_lower(x)\r ## [1] \u0026quot;ministro sinistro\u0026quot;\r str_to_upper(x)\r ## [1] \u0026quot;MINISTRO SINISTRO\u0026quot;\r str_to_sentence(x)\r ## [1] \u0026quot;Ministro sinistro\u0026quot;\r str_to_title(x)\r ## [1] \u0026quot;Ministro Sinistro\u0026quot;\r Como vimos no readr, algumas quest√µes relacionadas a strings dependem da l√≠ngua, ou, na linguagem do pacote, s√£o ‚Äúlocale dependent.‚Äù Por isso nas fun√ß√µes onde isso √© relevante, o argumento se chama locale. Isso n√£o √© super relevante para quem trabalha com o ingl√™s ou as l√≠nguas do oeste europeu, considerando que a maioria das l√≠nguas tem ra√≠zes similares, mas pode ser muito importante para outros idiomas. Vejamos este exemplo com a mudan√ßa da ordem das strings.\nx \u0026lt;- c(\u0026quot;abacaxi\u0026quot;, \u0026quot;escarola\u0026quot;, \u0026quot;banana\u0026quot;)\rstr_sort(x, locale = \u0026quot;en\u0026quot;) # Ingl√™s\r ## [1] \u0026quot;abacaxi\u0026quot; \u0026quot;banana\u0026quot; \u0026quot;escarola\u0026quot;\r str_sort(x, locale = \u0026quot;haw\u0026quot;) # Havaiano\r ## [1] \u0026quot;abacaxi\u0026quot; \u0026quot;escarola\u0026quot; \u0026quot;banana\u0026quot;\r √â justamente para esses casos que str_sort e str_order oferecem a alternativa de voc√™ especificar o locale.\nTrabalhando com padr√µes e ‚Äúexpress√µes regulares‚Äù Express√µes regulares s√£o quase uma linguagem de programa√ß√£o em si, aqui, vamos dar uma passada muito r√°pida e ver alguns exemplos simples. S√£o uma ferramenta muito √∫til, mas talvez n√£o do interesse de todos.\nBasicamente, a ideia √© fazer uma pesquisa na string, em busca de um padr√£o espec√≠fico. Pode ser uma palavra, um espa√ßo em branco, uma quebra de linha. Pode ficar muito complexo ou ser bem b√°sico. O nosso objetivo aqui √© que todos tenham a capacidade de trabalhar com padr√µes simples para corrigir inconsist√™ncias em bancos de dados, como no exemplo da aula anterior das colunas do dataset da OMS.\nPara visualizar padr√µes, vamos usar duas helper functions, str_view e str_view_all.\nx \u0026lt;- c(\u0026quot;mam√£o\u0026quot;, \u0026quot;banana\u0026quot;, \u0026quot;ananas\u0026quot;)\rstr_view(x, \u0026quot;an\u0026quot;)\r \r{\"x\":{\"html\":\"\\n mam√£o\\n banana\\n ananas\\n\"},\"evals\":[],\"jsHooks\":[]}\rO resultado sai na aba ‚ÄúViewer‚Äù do seu RStudio.\nO primeiro padr√£o que podemos usar √© o ., que identifica qualquer caractere. As vezes na documenta√ß√£o esse tipo de padr√£o gen√©rico √© chamado de ‚Äúwildcard.‚Äù\nstr_view(x, \u0026quot;.a.\u0026quot;)\r \r{\"x\":{\"html\":\"\\n mam√£o\\n banana\\n ananas\\n\"},\"evals\":[],\"jsHooks\":[]}\rA forma de ler essa opera√ß√£o √©: ‚ÄúIdentifique qualquer conjunto de caracteres que tenha uma letra a no meio deles.‚Äù\nSe voc√™ quiser identificar um . numa string, voc√™ precisa usar o escape \\. Por√©m, a barra tamb√©m √© um escape! Ent√£o, ao escrever express√µes regulares, precisamos usar \\\\. Veja:\ndot \u0026lt;- \u0026quot;.\u0026quot;\rcat(dot)\r ## .\r # erro\rdot \u0026lt;- \u0026quot;\\.\u0026quot;\r ## Error: '\\.' √© uma seq√º√™ncia de escape n√£o reconhecida na cadeia de caracteres come√ßando com \u0026quot;\u0026quot;\\.\u0026quot;\r # agora sim\rdot \u0026lt;- \u0026quot;\\\\.\u0026quot;\rcat(dot)\r ## \\.\r Agora em um exemplo:\nx \u0026lt;- c(\u0026quot;Praia.\u0026quot;, \u0026quot;Agora.\u0026quot;, \u0026quot;Ou.\u0026quot;, \u0026quot;Me.\u0026quot;, \u0026quot;Rebelo.\u0026quot;)\rstr_view(x, \u0026quot;a\\\\.\u0026quot;)\r \r{\"x\":{\"html\":\"\\n Praia.\\n Agora.\\n Ou.\\n Me.\\n Rebelo.\\n\"},\"evals\":[],\"jsHooks\":[]}\rstr_view(x, \u0026quot;u\\\\.\u0026quot;)\r \r{\"x\":{\"html\":\"\\n Praia.\\n Agora.\\n Ou.\\n Me.\\n Rebelo.\\n\"},\"evals\":[],\"jsHooks\":[]}\rstr_view(x, \u0026quot;o\\\\.\u0026quot;)\r \r{\"x\":{\"html\":\"\\n Praia.\\n Agora.\\n Ou.\\n Me.\\n Rebelo.\\n\"},\"evals\":[],\"jsHooks\":[]}\rT√°, mas se a contrabarra √© utilizada para denotar uma express√£o regular tipo o ., como eu fa√ßo para pesquisar uma contrabarra?\nx \u0026lt;- \u0026quot;Jake Peralta √© o melhor detetive\\\\g√™nio\u0026quot;\rcat(x)\r ## Jake Peralta √© o melhor detetive\\g√™nio\r A solu√ß√£o √© escapar o escape do escape, sacou?\nstr_view(x, \u0026quot;\\\\\\\\\u0026quot;)\r \r{\"x\":{\"html\":\"\\n Jake Peralta √© o melhor detetive\\\\g√™nio\\n\"},\"evals\":[],\"jsHooks\":[]}\r√â enrolado mesmo‚Ä¶\nPara n√£o estender muito o assunto, vamos ver v√°rios exemplos de caracteres especiais a ser usados em express√µes regulares.\n^ encontra o in√≠cio de uma string\nx \u0026lt;- c(\u0026quot;ma√ß√£\u0026quot;, \u0026quot;banana\u0026quot;, \u0026quot;mam√£o\u0026quot;)\rstr_view(x, \u0026quot;^m\u0026quot;)\r \r{\"x\":{\"html\":\"\\n ma√ß√£\\n banana\\n mam√£o\\n\"},\"evals\":[],\"jsHooks\":[]}\r$ encontra o final\nstr_view(x, \u0026quot;a$\u0026quot;)\r \r{\"x\":{\"html\":\"\\n ma√ß√£\\n banana\\n mam√£o\\n\"},\"evals\":[],\"jsHooks\":[]}\rPara for√ßar a express√£o a achar apenas a palavra completa, use os dois\nx \u0026lt;- c(\u0026quot;vitamina de banana\u0026quot;, \u0026quot;sundae de banana\u0026quot;, \u0026quot;banana\u0026quot;)\rstr_view(x, \u0026quot;banana\u0026quot;)\r \r{\"x\":{\"html\":\"\\n vitamina de banana\\n sundae de banana\\n banana\\n\"},\"evals\":[],\"jsHooks\":[]}\rstr_view(x, \u0026quot;^banana$\u0026quot;)\r \r{\"x\":{\"html\":\"\\n vitamina de banana\\n sundae de banana\\n banana\\n\"},\"evals\":[],\"jsHooks\":[]}\rUse classes de caracteres para encontrar gen√©ricos\nQualquer digito:\nx \u0026lt;- \u0026quot;15 de Maio de 2021.\u0026quot;\rstr_view(x, \u0026quot;\\\\d\u0026quot;)\r \r{\"x\":{\"html\":\"\\n 15 de Maio de 2021.\\n\"},\"evals\":[],\"jsHooks\":[]}\rQualquer espa√ßo em branco:\nstr_view(x, \u0026quot;\\\\s\u0026quot;)\r \r{\"x\":{\"html\":\"\\n 15de Maio de 2021.\\n\"},\"evals\":[],\"jsHooks\":[]}\rQualquer caractere de um grupo: [abc]\nstr_view(x, \u0026quot;[M]\u0026quot;)\r \r{\"x\":{\"html\":\"\\n 15 de Maio de 2021.\\n\"},\"evals\":[],\"jsHooks\":[]}\rstr_view(x, \u0026quot;[eM]\u0026quot;)\r \r{\"x\":{\"html\":\"\\n 15 de Maio de 2021.\\n\"},\"evals\":[],\"jsHooks\":[]}\rstr_view(x, \u0026quot;[deM]\u0026quot;)\r \r{\"x\":{\"html\":\"\\n 15 de Maio de 2021.\\n\"},\"evals\":[],\"jsHooks\":[]}\rQualquer caractere menos esses: [^abc]\nstr_view(x, \u0026quot;[^15]\u0026quot;)\r \r{\"x\":{\"html\":\"\\n 15de Maio de 2021.\\n\"},\"evals\":[],\"jsHooks\":[]}\rstr_view(x, \u0026quot;[^15 de]\u0026quot;)\r \r{\"x\":{\"html\":\"\\n 15 de Maio de 2021.\\n\"},\"evals\":[],\"jsHooks\":[]}\rstr_view(x, \u0026quot;[^15 de Maio de ]\u0026quot;)\r \r{\"x\":{\"html\":\"\\n 15 de Maio de 2021.\\n\"},\"evals\":[],\"jsHooks\":[]}\rUsar uma classe pra evitar digitar 5 milh√µes de contrabarras\nstr_view(x, \u0026quot;[.]\u0026quot;)\r \r{\"x\":{\"html\":\"\\n 15 de Maio de 2021.\\n\"},\"evals\":[],\"jsHooks\":[]}\rstr_view(\u0026quot;a*c\u0026quot;, \u0026quot;[*]\u0026quot;)\r \r{\"x\":{\"html\":\"\\n a*c\\n\"},\"evals\":[],\"jsHooks\":[]}\rVoc√™ pode misturar strings com classes tamb√©m\nx \u0026lt;- c(\u0026quot;15 de Maio de 2021.\u0026quot;, \u0026quot;16 de Maio de 2021.\u0026quot;)\rstr_view(x, \u0026quot;1[56] de Maio\u0026quot;)\r \r{\"x\":{\"html\":\"\\n 15 de Maio de 2021.\\n 16 de Maio de 2021.\\n\"},\"evals\":[],\"jsHooks\":[]}\rInfelizmente, alguns caracteres tem significado especial dentro das classes, e voc√™ tem que usar contrabarras para fugir deles: ] \\ ^ e -.\nVoc√™ pode lidar com repeti√ß√µes\nx \u0026lt;- c(\u0026quot;Mariele\u0026quot;, \u0026quot;Marielle\u0026quot;, \u0026quot;Mariellle\u0026quot;, \u0026quot;Marie\u0026quot;)\rstr_view(x, \u0026quot;Mariell?e\u0026quot;) # l aparece 0 ou 1 vez\r \r{\"x\":{\"html\":\"\\n Mariele\\n Marielle\\n Mariellle\\n Marie\\n\"},\"evals\":[],\"jsHooks\":[]}\rstr_view(x, \u0026quot;Mariel+e\u0026quot;) # l aparece 1 ou + vezes\r \r{\"x\":{\"html\":\"\\n Mariele\\n Marielle\\n Mariellle\\n Marie\\n\"},\"evals\":[],\"jsHooks\":[]}\rstr_view(x, \u0026quot;Mariel*\u0026quot;) # l aparece 0 ou + vezes\r \r{\"x\":{\"html\":\"\\n Mariele\\n Marielle\\n Mariellle\\n Marie\\n\"},\"evals\":[],\"jsHooks\":[]}\rstr_view(x, \u0026quot;Mariel{0}\u0026quot;) # l aparece exatamente 0 vezes\r \r{\"x\":{\"html\":\"\\n Mariele\\n Marielle\\n Mariellle\\n Marie\\n\"},\"evals\":[],\"jsHooks\":[]}\rstr_view(x, \u0026quot;Mariel{1}\u0026quot;) # l aparece exatamente 1 vez\r \r{\"x\":{\"html\":\"\\n Mariele\\n Marielle\\n Mariellle\\n Marie\\n\"},\"evals\":[],\"jsHooks\":[]}\rstr_view(x, \u0026quot;Mariel{2}\u0026quot;) # l aparece exatamente 2 vezes\r \r{\"x\":{\"html\":\"\\n Mariele\\n Marielle\\n Mariellle\\n Marie\\n\"},\"evals\":[],\"jsHooks\":[]}\rstr_view(x, \u0026quot;Mariel{3}\u0026quot;) # l aparece exatamente 3 vezes\r \r{\"x\":{\"html\":\"\\n Mariele\\n Marielle\\n Mariellle\\n Marie\\n\"},\"evals\":[],\"jsHooks\":[]}\rstr_view(x, \u0026quot;Mariel{1,}\u0026quot;) # l aparece exatamente 1 vez ou mais\r \r{\"x\":{\"html\":\"\\n Mariele\\n Marielle\\n Mariellle\\n Marie\\n\"},\"evals\":[],\"jsHooks\":[]}\rstr_view(x, \u0026quot;Mariel{2,}\u0026quot;) # l aparece exatamente 2 vezes ou mais\r \r{\"x\":{\"html\":\"\\n Mariele\\n Marielle\\n Mariellle\\n Marie\\n\"},\"evals\":[],\"jsHooks\":[]}\rstr_view(x, \u0026quot;Mariel{1,2}\u0026quot;) # l aparece de 1 a 2 vezes\r \r{\"x\":{\"html\":\"\\n Mariele\\n Marielle\\n Mariellle\\n Marie\\n\"},\"evals\":[],\"jsHooks\":[]}\rstr_view(x, \u0026quot;Mariel{2,3}\u0026quot;) # l aparece de 2 a 3 vezes\r \r{\"x\":{\"html\":\"\\n Mariele\\n Marielle\\n Mariellle\\n Marie\\n\"},\"evals\":[],\"jsHooks\":[]}\rEsse assunto √© enorme, e ainda estamos s√≥ na superf√≠cie. H√° grupos, lookarounds, e muitos outros detalhes envolvendo express√µes regulares, e voc√™s podem consultar os livros de refer√™ncia para mergulhar mais fundo. Mas vamos parar por aqui para nos concentrar no que interessa.\nEm geral, temos um banco de dados com strings problem√°ticas, tipo erros de digita√ß√£o, inconsist√™ncias etc. O primeiro passo, em geral, √© detectar os problemas.\nx \u0026lt;- c(\u0026quot;S√£o Paulo\u0026quot;, \u0026quot;SAO PAULO\u0026quot;, \u0026quot;Sao Paulo\u0026quot;, \u0026quot;sp\u0026quot;, \u0026quot;SP\u0026quot;, \u0026quot;Sp\u0026quot;)\rstr_detect(x, \u0026quot;√£\u0026quot;)\r ## [1] TRUE FALSE FALSE FALSE FALSE FALSE\r str_detect(x, \u0026quot;[Ss][Pp]\u0026quot;)\r ## [1] FALSE FALSE FALSE TRUE TRUE TRUE\r str_detect(x, \u0026quot;[Ss][Aa][Oo]\u0026quot;)\r ## [1] FALSE TRUE TRUE FALSE FALSE FALSE\r Voc√™ pode se utilizar do fato da resposta ser um vetor l√≥gico para descobrir quantos problemas voc√™ tem\n# Contagens\rstr_detect(x, \u0026quot;√£\u0026quot;) %\u0026gt;% sum()\r ## [1] 1\r str_detect(x, \u0026quot;[Ss][Pp]\u0026quot;) %\u0026gt;% sum()\r ## [1] 3\r str_detect(x, \u0026quot;[Ss][Aa][Oo]\u0026quot;) %\u0026gt;% sum()\r ## [1] 2\r # Propor√ß√µes\rstr_detect(x, \u0026quot;√£\u0026quot;) %\u0026gt;% mean()\r ## [1] 0.1666667\r str_detect(x, \u0026quot;[Ss][Pp]\u0026quot;) %\u0026gt;% mean()\r ## [1] 0.5\r str_detect(x, \u0026quot;[Ss][Aa][Oo]\u0026quot;) %\u0026gt;% mean()\r ## [1] 0.3333333\r Depois de detectar seus problemas, voc√™ pode querer extrair uma parte dos seus casos: use str_subset\nstr_subset(x, \u0026quot;[Ss][Pp]\u0026quot;)\r ## [1] \u0026quot;sp\u0026quot; \u0026quot;SP\u0026quot; \u0026quot;Sp\u0026quot;\r Em geral, no entanto, voc√™ vai estar trabalhando num data frame. Ent√£o use dplyr::filter e str_detect.\ndf \u0026lt;- tibble::tibble(\rnome = c(\u0026quot;Marcos\u0026quot;, \u0026quot;rog√©rio\u0026quot;, \u0026quot;cebolinha\u0026quot;, \u0026quot;Bei√ßola\u0026quot;, \u0026quot;nadir\u0026quot;, \u0026quot;Monica\u0026quot;),\ruf = x,\rdtnsc = c(\u0026quot;15 de Maio de 1980\u0026quot;, \u0026quot;1 de Jan de 2001\u0026quot;, \u0026quot;6 de Ago de 1993\u0026quot;, \u0026quot;20 de Abril de 1964\u0026quot;, \u0026quot;24 de Nov de 1975\u0026quot;, \u0026quot;14 de Dezembro de 1997\u0026quot;)\r)\rdf %\u0026gt;% dplyr::filter(str_detect(uf, \u0026quot;[Ss][Pp]\u0026quot;))\r ## # A tibble: 3 x 3\r## nome uf dtnsc ## \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; ## 1 Bei√ßola sp 20 de Abril de 1964 ## 2 nadir SP 24 de Nov de 1975 ## 3 Monica Sp 14 de Dezembro de 1997\r Voc√™ pode contar quantos matches voc√™ tem str_count\nstr_count(x, \u0026quot;o\u0026quot;)\r ## [1] 2 0 2 0 0 0\r str_count(x, \u0026quot;[Oo]\u0026quot;)\r ## [1] 2 2 2 0 0 0\r # e usar num data frame\rdf %\u0026gt;% dplyr::mutate(vogais = str_count(uf, \u0026quot;[aeiou]\u0026quot;),\rconsoantes = str_count(uf, \u0026quot;[^aeiou]\u0026quot;))\r ## # A tibble: 6 x 5\r## nome uf dtnsc vogais consoantes\r## \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;int\u0026gt; \u0026lt;int\u0026gt;\r## 1 Marcos S√£o Paulo 15 de Maio de 1980 4 5\r## 2 rog√©rio SAO PAULO 1 de Jan de 2001 0 9\r## 3 cebolinha Sao Paulo 6 de Ago de 1993 5 4\r## 4 Bei√ßola sp 20 de Abril de 1964 0 2\r## 5 nadir SP 24 de Nov de 1975 0 2\r## 6 Monica Sp 14 de Dezembro de 1997 0 2\r Voc√™ pode extrair str_extract as informa√ß√µes que voc√™ quer\nstr_extract(df$dtnsc, \u0026quot;\\\\d+\u0026quot;)\r ## [1] \u0026quot;15\u0026quot; \u0026quot;1\u0026quot; \u0026quot;6\u0026quot; \u0026quot;20\u0026quot; \u0026quot;24\u0026quot; \u0026quot;14\u0026quot;\r str_extract(df$dtnsc, \u0026quot;\\\\d+$\u0026quot;)\r ## [1] \u0026quot;1980\u0026quot; \u0026quot;2001\u0026quot; \u0026quot;1993\u0026quot; \u0026quot;1964\u0026quot; \u0026quot;1975\u0026quot; \u0026quot;1997\u0026quot;\r str_extract(df$dtnsc, \u0026quot;\\\\D+\u0026quot;)\r ## [1] \u0026quot; de Maio de \u0026quot; \u0026quot; de Jan de \u0026quot; \u0026quot; de Ago de \u0026quot; \u0026quot; de Abril de \u0026quot; ## [5] \u0026quot; de Nov de \u0026quot; \u0026quot; de Dezembro de \u0026quot;\r # Na tibble\rdf %\u0026gt;% dplyr::mutate(\rdia = str_extract(dtnsc, \u0026quot;\\\\d+\u0026quot;),\rmes = str_extract(df$dtnsc, \u0026quot;\\\\D+\u0026quot;),\rano = str_extract(dtnsc, \u0026quot;\\\\d+$\u0026quot;))\r ## # A tibble: 6 x 6\r## nome uf dtnsc dia mes ano ## \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt;\r## 1 Marcos S√£o Paulo 15 de Maio de 1980 15 \u0026quot; de Maio de \u0026quot; 1980 ## 2 rog√©rio SAO PAULO 1 de Jan de 2001 1 \u0026quot; de Jan de \u0026quot; 2001 ## 3 cebolinha Sao Paulo 6 de Ago de 1993 6 \u0026quot; de Ago de \u0026quot; 1993 ## 4 Bei√ßola sp 20 de Abril de 1964 20 \u0026quot; de Abril de \u0026quot; 1964 ## 5 nadir SP 24 de Nov de 1975 24 \u0026quot; de Nov de \u0026quot; 1975 ## 6 Monica Sp 14 de Dezembro de 1997 14 \u0026quot; de Dezembro de \u0026quot; 1997\r # Melhor ainda\rdf %\u0026gt;% tidyr::extract(\rdtnsc, c(\u0026quot;dia\u0026quot;, \u0026quot;mes\u0026quot;, \u0026quot;ano\u0026quot;), regex = \u0026quot;(\\\\d+) de (\\\\D+) de (\\\\d+$)\u0026quot;\r)\r ## # A tibble: 6 x 5\r## nome uf dia mes ano ## \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt;\r## 1 Marcos S√£o Paulo 15 Maio 1980 ## 2 rog√©rio SAO PAULO 1 Jan 2001 ## 3 cebolinha Sao Paulo 6 Ago 1993 ## 4 Bei√ßola sp 20 Abril 1964 ## 5 nadir SP 24 Nov 1975 ## 6 Monica Sp 14 Dezembro 1997\r Similar a ideia de extra√ß√£o, podemos substituir com str_replace\nstr_replace(x, \u0026quot;[Ss][Pp]\u0026quot;, \u0026quot;S√£o Paulo\u0026quot;)\r ## [1] \u0026quot;S√£o Paulo\u0026quot; \u0026quot;SAO PAULO\u0026quot; \u0026quot;Sao Paulo\u0026quot; \u0026quot;S√£o Paulo\u0026quot; \u0026quot;S√£o Paulo\u0026quot; \u0026quot;S√£o Paulo\u0026quot;\r str_replace(x, \u0026quot;SAO PAULO\u0026quot;, \u0026quot;S√£o Paulo\u0026quot;)\r ## [1] \u0026quot;S√£o Paulo\u0026quot; \u0026quot;S√£o Paulo\u0026quot; \u0026quot;Sao Paulo\u0026quot; \u0026quot;sp\u0026quot; \u0026quot;SP\u0026quot; \u0026quot;Sp\u0026quot;\r str_replace(x, \u0026quot;a\u0026quot;, \u0026quot;√£\u0026quot;)\r ## [1] \u0026quot;S√£o P√£ulo\u0026quot; \u0026quot;SAO PAULO\u0026quot; \u0026quot;S√£o Paulo\u0026quot; \u0026quot;sp\u0026quot; \u0026quot;SP\u0026quot; \u0026quot;Sp\u0026quot;\r Tanto str_extract quanto str_replace substituem apenas a primeira marca, se voc√™ quiser substituir todas, utilize str_..._all\nstr_extract_all(x, \u0026quot;a\u0026quot;, simplify = TRUE)\r ## [,1] [,2]\r## [1,] \u0026quot;a\u0026quot; \u0026quot;\u0026quot; ## [2,] \u0026quot;\u0026quot; \u0026quot;\u0026quot; ## [3,] \u0026quot;a\u0026quot; \u0026quot;a\u0026quot; ## [4,] \u0026quot;\u0026quot; \u0026quot;\u0026quot; ## [5,] \u0026quot;\u0026quot; \u0026quot;\u0026quot; ## [6,] \u0026quot;\u0026quot; \u0026quot;\u0026quot;\r str_replace_all(x, \u0026quot;a\u0026quot;, \u0026quot;√£\u0026quot;)\r ## [1] \u0026quot;S√£o P√£ulo\u0026quot; \u0026quot;SAO PAULO\u0026quot; \u0026quot;S√£o P√£ulo\u0026quot; \u0026quot;sp\u0026quot; \u0026quot;SP\u0026quot; \u0026quot;Sp\u0026quot;\r O assunto n√£o acaba, mas vamos parar por aqui. Novamente, recomendo consultarem os materiais para quem quiser ir mais a fundo nisso. √â bem capaz de no andar da carruagem aparecerem outros exemplos nos quais a manipula√ß√£o de strings pode ser importante.\nforcats Esse √© um pacotinho muito que facilita bastante a vida de quem trabalha com vari√°vel categ√≥rica, ou, no R, os factors. Ele consiste em uma s√©rie de ‚Äúhelper functions‚Äù baseadas em fun√ß√µes do base e do stats que trabalham com os componentes de um factor, ou seja, seus levels e seus values.\nImagino que todos aqui est√£o familiarizados com fatores e com a sua cria√ß√£o, ent√£o vamos direto ao que interessa. Educa√ß√£o √© um vetor de caracteres que vem com os n√≠veis educacionais de um popula√ß√£o.\neducacao \u0026lt;- c(\u0026quot;Superior\u0026quot;, \u0026quot;Fundamental\u0026quot;, \u0026quot;M√©dio\u0026quot;, \u0026quot;Superior\u0026quot;, \u0026quot;Fundamental\u0026quot;, \u0026quot;M√©dio\u0026quot;,\r\u0026quot;Superior\u0026quot;, \u0026quot;Fundamental\u0026quot;, \u0026quot;M√©dio\u0026quot;, \u0026quot;Superior\u0026quot;, \u0026quot;Fundamental\u0026quot;, \u0026quot;M√©dio\u0026quot;)\rx \u0026lt;- factor(educacao, levels = c(\u0026quot;Fundamental\u0026quot;, \u0026quot;M√©dio\u0026quot;, \u0026quot;Superior\u0026quot;))\rx\r ## [1] Superior Fundamental M√©dio Superior Fundamental M√©dio ## [7] Superior Fundamental M√©dio Superior Fundamental M√©dio ## Levels: Fundamental M√©dio Superior\r levels(x)\r ## [1] \u0026quot;Fundamental\u0026quot; \u0026quot;M√©dio\u0026quot; \u0026quot;Superior\u0026quot;\r relevel(x, \u0026quot;Superior\u0026quot;)\r ## [1] Superior Fundamental M√©dio Superior Fundamental M√©dio ## [7] Superior Fundamental M√©dio Superior Fundamental M√©dio ## Levels: Superior Fundamental M√©dio\r Em geral, diversas tarefas envolvendo fatores no base n√£o s√£o muito simples. Por exemplo, se eu quiser modificar os nomes dos n√≠veis de um fator depois dele j√° estar criado, modificar a ordem dos n√≠veis, ou agrupar diversos n√≠veis em um s√≥. forcats vem justamente oferecer solu√ß√µes nesse sentido. Normalmente, estamos trabalhando com bancos de dados, e n√£o com um vetor solit√°rio, por isso, vamos usar o gss_cat, uma amostra do General Social Survey aplicado pelo NORC e pela Universidade de Chicago, que vem no pacote forcats.\nlibrary(forcats)\rgss_cat\r ## # A tibble: 21,483 x 9\r## year marital age race rincome partyid relig denom tvhours\r## \u0026lt;int\u0026gt; \u0026lt;fct\u0026gt; \u0026lt;int\u0026gt; \u0026lt;fct\u0026gt; \u0026lt;fct\u0026gt; \u0026lt;fct\u0026gt; \u0026lt;fct\u0026gt; \u0026lt;fct\u0026gt; \u0026lt;int\u0026gt;\r## 1 2000 Never ma~ 26 White $8000 to ~ Ind,near r~ Protesta~ Souther~ 12\r## 2 2000 Divorced 48 White $8000 to ~ Not str re~ Protesta~ Baptist~ NA\r## 3 2000 Widowed 67 White Not appli~ Independent Protesta~ No deno~ 2\r## 4 2000 Never ma~ 39 White Not appli~ Ind,near r~ Orthodox~ Not app~ 4\r## 5 2000 Divorced 25 White Not appli~ Not str de~ None Not app~ 1\r## 6 2000 Married 25 White $20000 - ~ Strong dem~ Protesta~ Souther~ NA\r## 7 2000 Never ma~ 36 White $25000 or~ Not str re~ Christian Not app~ 3\r## 8 2000 Divorced 44 White $7000 to ~ Ind,near d~ Protesta~ Luthera~ NA\r## 9 2000 Married 44 White $25000 or~ Not str de~ Protesta~ Other 0\r## 10 2000 Married 47 White $25000 or~ Strong rep~ Protesta~ Souther~ 3\r## # ... with 21,473 more rows\r Contagens\nUma das primeiras coisas que interessa ao lidar com fatores, √© obter suas contagens, o que √© algo muito simples utilizando a gram√°tica do dplyr.\n# Fun√ß√£o count\rgss_cat %\u0026gt;% count(race)\r ## # A tibble: 3 x 2\r## race n\r## \u0026lt;fct\u0026gt; \u0026lt;int\u0026gt;\r## 1 Other 1959\r## 2 Black 3129\r## 3 White 16395\r # Incluindo n√≠veis com contagem = 0.\rgss_cat %\u0026gt;% count(race, .drop = FALSE)\r ## # A tibble: 4 x 2\r## race n\r## \u0026lt;fct\u0026gt; \u0026lt;int\u0026gt;\r## 1 Other 1959\r## 2 Black 3129\r## 3 White 16395\r## 4 Not applicable 0\r # Visualiza√ß√£o com ggplot\rlibrary(ggplot2)\rgss_cat %\u0026gt;% ggplot(aes(race)) + geom_bar()\r # Incluindo n√≠veis com contagem = 0.\rgss_cat %\u0026gt;% ggplot(aes(race)) + geom_bar() + scale_x_discrete(drop = FALSE)\r Note o uso do argumento drop nos dois casos, para indicar que casos com 0 observa√ß√µes n√£o devem ser removidos do resultado.\nModificando a ordem A segunda tarefa comum quando trabalhamos com fatores √© modificar a ordem em que eles aparecem. N√£o √© tanto o caso quando trabalhamos com fatores ordenados, mas diversos tipos de vari√°veis categ√≥ricas n√£o possuem uma ordem l√≥gica pre-definida e, mesmo assim, nos interessa apresent√°-los de acordo com uma determinada hierarquia visual, seja porque eles s√£o os mais frequentes ou porque queremos destacar algum elemento em particular. forcats implementa diversas estrat√©gias de reordenamento de fatores. Vamos v√™-las brevemente.\nDigamos que eu queira saber o tempo m√©dio de televis√£o assistida por membros das diversas religi√µes. Eu poderia produzir um sum√°rio e depois plotar isso num gr√°fico.\nrelig_summary \u0026lt;- gss_cat %\u0026gt;%\rgroup_by(relig) %\u0026gt;%\rsummarise(\rage = mean(age, na.rm = TRUE),\rtvhours = mean(tvhours, na.rm = TRUE),\rn = n()\r)\rrelig_summary %\u0026gt;% ggplot(aes(tvhours, relig)) + geom_point()\r O display est√° t√©cnicamente correto, mas a forma desorganizada dos n√≠veis no eixo Y dificulta a nossa capacidade de fazer compara√ß√µes. Talvez fosse mais interessante ordenar este resultado por ordem decrescente do n√∫mero de horas de tv. Mas, como fazer isso de forma direta, sem precisar realizar diversas computa√ß√µes?\n# Direto no plot\rrelig_summary %\u0026gt;% ggplot(aes(tvhours, fct_reorder(relig, tvhours))) + geom_point()\r # Antes de passar o data.frame para a plotagem\rrelig_summary %\u0026gt;% mutate(relig = fct_reorder(relig, tvhours)) %\u0026gt;% ggplot(aes(tvhours, relig)) + geom_point()\r Note como posso aplicar a transforma√ß√£o diretamente na vari√°vel durante o processo de plotagem, ou antes, e uma invoca√ß√£o de mutate. Na minha opini√£o, o segundo jeito √© o mais adequado, por duas raz√µes: √© mais f√°cil de digitar, inserir e retirar do c√≥digo e √© mais f√°cil para um leitor identificar que uma transforma√ß√£o foi feita na vari√°vel plotada.\nOutro exemplo: que tal exarminarmos a rela√ß√£o entre a idade e a renda declarada? Primeiro, √© preciso construir um sum√°rio, parecido com o primeiro:\nrincome_summary \u0026lt;- gss_cat %\u0026gt;%\rgroup_by(rincome) %\u0026gt;%\rsummarise(\rage = mean(age, na.rm = TRUE),\rtvhours = mean(tvhours, na.rm = TRUE),\rn = n()\r)\rrincome_summary %\u0026gt;% mutate(rincome = fct_reorder(rincome, age)) %\u0026gt;% ggplot(aes(age, rincome)) + geom_point()\r Aqui, o reordenamento das vari√°veis de acordo com a idade n√£o faz muito sentido, porque os n√≠veis de renda tem uma ordem pr√≥pria. Nesse caso, n√£o √© recomendado utilizar fct_reorder.\nrincome_summary %\u0026gt;% ggplot(aes(age, rincome)) + geom_point()\r S√≥ que ao plotar, notamos um problema: a categoria ‚ÄúNot applicable‚Äù ficou primeiro e isso desorganiza visualmente nosso gr√°fico. Sem problema! Utilizamos fct_relevel para modificar a ordem de uma vari√°vel arbitrariamente. O padr√£o √© colocar pro come√ßo (Parecido com o comportamento de stats::relevel), mas voc√™ pode especificar outra posi√ß√£o.\nrincome_summary %\u0026gt;% mutate(rincome = fct_relevel(rincome, \u0026quot;Not applicable\u0026quot;)) %\u0026gt;% ggplot(aes(age, rincome)) + geom_point()\r Notem como nos exemplos acima, o uso do %\u0026gt;% nos permite alterar partes do nosso c√≥digo de maneira interativa para chegar no resultado desejado.\nOutro tipo de mudan√ßa de ordem interessante ocorre quando temos uma terceira ‚Äúdimens√£o‚Äù no nosso gr√°fico. Em geral, utilizamos cores, formas ou linhas quebradas para diferenciar entre categorias e gostar√≠amos que a nossa legenda acompanhasse a tend√™ncia do gr√°fico. Compare:\nby_age \u0026lt;- gss_cat %\u0026gt;%\rfilter(!is.na(age)) %\u0026gt;%\rcount(age, marital) %\u0026gt;%\rgroup_by(age) %\u0026gt;%\rmutate(prop = n / sum(n))\r# Sem altera√ß√£o na ordem\rby_age %\u0026gt;% ggplot(aes(age, prop, colour = marital)) +\rgeom_line(na.rm = TRUE)\r # Com altera√ß√£o na ordem\rggplot(by_age, aes(age, prop, colour = fct_reorder2(marital, age, prop))) +\rgeom_line() +\rlabs(colour = \u0026quot;marital\u0026quot;)\r No caso de fct_reorder2, √© melhor fazer a altera√ß√£o de ordem dentro da fun√ß√£o gr√°fica, pois dentro uma invoca√ß√£o de mutate, ela n√£o funcionou durante meus testes.\nPor √∫ltimo, podemos querer ordenar um gr√°fico de barras de acordo com a frequ√™ncia das categorias, o que podemos fazer com fct_infreq e fct_rev (opcional).\ngss_cat %\u0026gt;%\rmutate(marital = marital %\u0026gt;% fct_infreq()) %\u0026gt;%\rggplot(aes(marital)) +\rgeom_bar()\r # OU\rgss_cat %\u0026gt;%\rmutate(marital = marital %\u0026gt;% fct_infreq() %\u0026gt;% fct_rev()) %\u0026gt;%\rggplot(aes(marital)) +\rgeom_bar()\r Notem o uso do pipe na hora de modificar a vari√°vel ‚Äúmarital.‚Äù\nModificando os n√≠veis O outro tipo de opera√ß√£o bastante comum √© a altera√ß√£o nos n√≠ves do fator. Em geral, queremos que os nossos n√≠veis sejam representativos das nossas categorias de an√°lise, sejam de f√°cil leitura e entendimento e contenham um n√∫mero significativo de observa√ß√µes. Por essa raz√£o, frequentemente precisamos alterar os r√≥tulos, agrupar categorias, etc.\nVejamos o exemplo da vari√°vel partyid, que registra a identifica√ß√£o do entrevistado com os partidos pol√≠ticos dos EUA.\ngss_cat %\u0026gt;% count(partyid)\r ## # A tibble: 10 x 2\r## partyid n\r## \u0026lt;fct\u0026gt; \u0026lt;int\u0026gt;\r## 1 No answer 154\r## 2 Don't know 1\r## 3 Other party 393\r## 4 Strong republican 2314\r## 5 Not str republican 3032\r## 6 Ind,near rep 1791\r## 7 Independent 4119\r## 8 Ind,near dem 2499\r## 9 Not str democrat 3690\r## 10 Strong democrat 3490\r Vamos supor que, por qualquer motivo, essa forma de representa√ß√£o das categorias n√£o nos satisfaz. Vejamos algumas das ferramentas que podemos utilizar para modificar esse fator.\nPodemos, simplesmente, reescrever essas categorias de forma mais completa:\ngss_cat %\u0026gt;% mutate(partyid = fct_recode(partyid,\r\u0026quot;Republicano, forte\u0026quot; = \u0026quot;Strong republican\u0026quot;,\r\u0026quot;Republicano, fraco\u0026quot; = \u0026quot;Not str republican\u0026quot;,\r\u0026quot;Independente, pr√≥x. repub.\u0026quot; = \u0026quot;Ind,near rep\u0026quot;,\r\u0026quot;Independente, pr√≥x. democ.\u0026quot; = \u0026quot;Ind,near dem\u0026quot;,\r\u0026quot;Independente\u0026quot; = \u0026quot;Independent\u0026quot;,\r\u0026quot;Democrata, forte\u0026quot; = \u0026quot;Strong democrat\u0026quot;,\r\u0026quot;Democrata, fraco\u0026quot; = \u0026quot;Not str democrat\u0026quot;,\r\u0026quot;Outro partido\u0026quot; = \u0026quot;Other party\u0026quot;,\r\u0026quot;N√£o sei\u0026quot; = \u0026quot;Don't know\u0026quot;,\r\u0026quot;Sem resposta\u0026quot; = \u0026quot;No answer\u0026quot;\r)) %\u0026gt;% count(partyid)\r ## # A tibble: 10 x 2\r## partyid n\r## \u0026lt;fct\u0026gt; \u0026lt;int\u0026gt;\r## 1 Sem resposta 154\r## 2 N√£o sei 1\r## 3 Outro partido 393\r## 4 Republicano, forte 2314\r## 5 Republicano, fraco 3032\r## 6 Independente, pr√≥x. repub. 1791\r## 7 Independente 4119\r## 8 Independente, pr√≥x. democ. 2499\r## 9 Democrata, fraco 3690\r## 10 Democrata, forte 3490\r A fun√ß√£o utilizada √© fct_recode e ela √© a mais gen√©rica e flex√≠vel de todas, por√©m, exige que cada n√≠vel seja modificado individualmente. Dentro dela, √© poss√≠vel agrupar v√°rios n√≠veis associando v√°rios n√≠veis antigos a um mesmo n√≠vel novo. Veja o exemplo:\ngss_cat %\u0026gt;% mutate(partyid = fct_recode(partyid,\r\u0026quot;Republicano, forte\u0026quot; = \u0026quot;Strong republican\u0026quot;,\r\u0026quot;Republicano, fraco\u0026quot; = \u0026quot;Not str republican\u0026quot;,\r\u0026quot;Independente, pr√≥x. repub.\u0026quot; = \u0026quot;Ind,near rep\u0026quot;,\r\u0026quot;Independente, pr√≥x. democ.\u0026quot; = \u0026quot;Ind,near dem\u0026quot;,\r\u0026quot;Independente\u0026quot; = \u0026quot;Independent\u0026quot;,\r\u0026quot;Democrata, forte\u0026quot; = \u0026quot;Strong democrat\u0026quot;,\r\u0026quot;Democrata, fraco\u0026quot; = \u0026quot;Not str democrat\u0026quot;,\r# Note o nome\r\u0026quot;Outro\u0026quot; = \u0026quot;Other party\u0026quot;,\r\u0026quot;Outro\u0026quot; = \u0026quot;Don't know\u0026quot;,\r\u0026quot;Outro\u0026quot; = \u0026quot;No answer\u0026quot;\r)) %\u0026gt;% count(partyid)\r ## # A tibble: 8 x 2\r## partyid n\r## \u0026lt;fct\u0026gt; \u0026lt;int\u0026gt;\r## 1 Outro 548\r## 2 Republicano, forte 2314\r## 3 Republicano, fraco 3032\r## 4 Independente, pr√≥x. repub. 1791\r## 5 Independente 4119\r## 6 Independente, pr√≥x. democ. 2499\r## 7 Democrata, fraco 3690\r## 8 Democrata, forte 3490\r Se voc√™ quiser recategorizar um fator que tem muitos n√≠veis para um menor, com poucos n√≠veis, utilize fct_collapse:\ngss_cat %\u0026gt;%\rmutate(partyid = fct_collapse(partyid,\rOutro = c(\u0026quot;No answer\u0026quot;, \u0026quot;Don't know\u0026quot;, \u0026quot;Other party\u0026quot;),\rRepublicano = c(\u0026quot;Strong republican\u0026quot;, \u0026quot;Not str republican\u0026quot;),\rIndependente = c(\u0026quot;Ind,near rep\u0026quot;, \u0026quot;Independent\u0026quot;, \u0026quot;Ind,near dem\u0026quot;),\rDemocrata = c(\u0026quot;Not str democrat\u0026quot;, \u0026quot;Strong democrat\u0026quot;)\r)) %\u0026gt;%\rcount(partyid)\r ## # A tibble: 4 x 2\r## partyid n\r## \u0026lt;fct\u0026gt; \u0026lt;int\u0026gt;\r## 1 Outro 548\r## 2 Republicano 5346\r## 3 Independente 8409\r## 4 Democrata 7180\r Repare que do lado esquerdo, nos valores novos, n√£o foi necess√°rio usar aspas. √â preciso cuidado com essa caracter√≠stica dos verbos do tidyverse. Ela se chama ‚Äútidy evaluation‚Äù e est√° um pouco fora do escopo do curso. Basicamente, se rolar d√∫vida ou der erros, se for usar acentos ou algum caractere diferente, use aspas.\ngss_cat %\u0026gt;%\rmutate(partyid = fct_collapse(partyid,\r\u0026quot;Outro\u0026quot; = c(\u0026quot;No answer\u0026quot;, \u0026quot;Don't know\u0026quot;, \u0026quot;Other party\u0026quot;),\r\u0026quot;Republicano\u0026quot; = c(\u0026quot;Strong republican\u0026quot;, \u0026quot;Not str republican\u0026quot;),\r\u0026quot;Independente\u0026quot; = c(\u0026quot;Ind,near rep\u0026quot;, \u0026quot;Independent\u0026quot;, \u0026quot;Ind,near dem\u0026quot;),\r\u0026quot;Democrata\u0026quot; = c(\u0026quot;Not str democrat\u0026quot;, \u0026quot;Strong democrat\u0026quot;)\r)) %\u0026gt;%\rcount(partyid)\r ## # A tibble: 4 x 2\r## partyid n\r## \u0026lt;fct\u0026gt; \u0026lt;int\u0026gt;\r## 1 Outro 548\r## 2 Republicano 5346\r## 3 Independente 8409\r## 4 Democrata 7180\r Outro tipo de mudan√ßa importante no n√∫mero de n√≠veis √© agrupar os n√≠veis menos frequentes, por exemplo, para produzir uma visualiza√ß√£o que d√™ maior destaque aos n√≠veis mais frequentes. Esse √© o trabalho de fct_lump.\ngss_cat %\u0026gt;% mutate(relig = fct_lump(relig, n = 5)) %\u0026gt;% count(relig)\r ## # A tibble: 6 x 2\r## relig n\r## \u0026lt;fct\u0026gt; \u0026lt;int\u0026gt;\r## 1 Christian 689\r## 2 None 3523\r## 3 Jewish 388\r## 4 Catholic 5124\r## 5 Protestant 10846\r## 6 Other 913\r Note que usando o argumento n eu indico quantos n√≠veis eu quero. No caso, escolhi os 5 n√≠veis mais frequentes e todos os outros s√£o autom√°ticamente agrupados na categoria ‚ÄúOther.‚Äù Posso mudar esse nome tamb√©m:\ngss_cat %\u0026gt;% mutate(relig = fct_lump(relig, n = 5, other_level = \u0026quot;Outros\u0026quot;)) %\u0026gt;% count(relig)\r ## # A tibble: 6 x 2\r## relig n\r## \u0026lt;fct\u0026gt; \u0026lt;int\u0026gt;\r## 1 Christian 689\r## 2 None 3523\r## 3 Jewish 388\r## 4 Catholic 5124\r## 5 Protestant 10846\r## 6 Outros 913\r Exerc√≠cios   Encontre os v√¥os que:\n Atrasaram mais de duas horas Com destino a Houston (IAH ou HOU) Operados pela United, American ou Delta Decolaram entre julho e setembro Chegaram com mais de duas horas de atraso, mas n√£o decolaram com atraso Atrasaram mais de uma hora para decolar, mas recuperaram mais de 30 minutos durante o voo Decolaram entre a meia-noite e 6 da manh√£ (inclusive)    Reordene suas colunas para encontrar os voos mais r√°pidos (maior velocidade de voo).\n  Teste v√°rias maneiras diferentes de selecionar as vari√°veis dep_time, dep_delay, arr_time e arr_delay usando as v√°rias helper functions de select.\n  As vari√°veis dep_time e sched_dep_time est√£o num formato incorreto (veja ?flights). Converta-as com mutate para um valor em minutos passados desde a meia-noite. Dica: utilize %/% e %%.\n  O que o c√≥digo abaixo est√° fazendo? Porque mesmo ap√≥s o c√≥digo abaixo continuam existindo diferen√ßas entre os valores das vari√°veis air_time e travel_time?\n  flights %\u0026gt;% select(air_time, dep_time, arr_time, dep_delay, arr_delay) %\u0026gt;% mutate(dep_hour = dep_time %/% 100,\rdep_min = dep_time %% 100,\rdep_time2 = dep_hour * 60 + dep_min,\rarr_hour = arr_time %/% 100,\rarr_min = arr_time %% 100,\rarr_time2 = arr_hour * 60 + arr_min,\rtravel_time = arr_time2 - dep_time2) %\u0026gt;% select(-dep_hour, -dep_min, -arr_hour, -arr_min)\r ## # A tibble: 336,776 x 8\r## air_time dep_time arr_time dep_delay arr_delay dep_time2 arr_time2\r## \u0026lt;dbl\u0026gt; \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt;\r## 1 227 517 830 2 11 317 510\r## 2 227 533 850 4 20 333 530\r## 3 160 542 923 2 33 342 563\r## 4 183 544 1004 -1 -18 344 604\r## 5 116 554 812 -6 -25 354 492\r## 6 150 554 740 -4 12 354 460\r## 7 158 555 913 -5 19 355 553\r## 8 53 557 709 -3 -14 357 429\r## 9 140 557 838 -3 -8 357 518\r## 10 138 558 753 -2 8 358 473\r## # ... with 336,766 more rows, and 1 more variable: travel_time \u0026lt;dbl\u0026gt;\r Use o stringr para concatenar as seguintes strings em uma frase  x \u0026lt;- \u0026quot;.\u0026quot;\ry \u0026lt;- \u0026quot;feliz\u0026quot;\rw \u0026lt;- \u0026quot;acordei\u0026quot;\rz \u0026lt;- \u0026quot;hoje\u0026quot;\r Corrija as inconsist√™ncias nas colunas pa√≠s, primeiro_nome, segundo_nome e crie uma nova coluna nomes contendo as duas anteriores. No final, ordene o banco em ordem alfab√©tica.  df \u0026lt;- tibble::tribble(\r~pais, ~primeiro_nome, ~segundo_nome,\r# -------|----------------|-------------|\r\u0026quot;BRASIL\u0026quot;, \u0026quot;ISABELA\u0026quot;, \u0026quot;MARTINS\u0026quot;,\r\u0026quot;Brasil\u0026quot;, \u0026quot;Eduardo\u0026quot;, \u0026quot;cabellos\u0026quot;,\r\u0026quot;brasil\u0026quot;, \u0026quot;m√°rcia\u0026quot;, \u0026quot;pinto\u0026quot;,\r\u0026quot;bRaSiL\u0026quot;, \u0026quot;rog√©rio\u0026quot;, \u0026quot;Marinho\u0026quot;,\r)\r Transforme a string c(\u0026quot;Seu nome\u0026quot;, \u0026quot;Seu sobrenome da m√£e\u0026quot;, \u0026quot;Seu sobrenome do pai\u0026quot;) na string \u0026quot;SEU SOBRENOME DO PAI, sua inicial do nome. sua inicial da m√£e.\u0026quot;, como numa cita√ß√£o. Veja o exemplo abaixo:  # Transforme\rc(\u0026quot;Vin√≠cius\u0026quot;, \u0026quot;de Souza\u0026quot;, \u0026quot;Maia\u0026quot;)\r ## [1] \u0026quot;Vin√≠cius\u0026quot; \u0026quot;de Souza\u0026quot; \u0026quot;Maia\u0026quot;\r # Resultado\r\u0026quot;MAIA, V. S.\u0026quot;\r ## [1] \u0026quot;MAIA, V. S.\u0026quot;\r DESAFIO: Nos microdados da √°rea de sa√∫de, √© comum que a vari√°vel idade esteja registrada da seguinte forma: ‚Äú150,‚Äù ‚Äú219,‚Äù ‚Äú312,‚Äù ‚Äú471.‚Äù Esses c√≥digos indicam primeiro qual a unidade de medida da idade e segundo o valor desta unidade, 1 = horas, 2 = dias, 3 = meses, 4 = anos. Proponha um c√≥digo usando stringr para transformar o vetor abaixo em um valor num√©rico.  # N√£o precisa se preocupar com essa parte\rx \u0026lt;- as.character(round(c(\rrunif(25, 100, 124),\rrunif(25, 201, 230),\rrunif(25, 301, 312),\rrunif(25, 401, 499)\r)))\r# Como voc√™ transformaria esse vetor em n√∫mero?\rx\r ## [1] \u0026quot;115\u0026quot; \u0026quot;113\u0026quot; \u0026quot;119\u0026quot; \u0026quot;121\u0026quot; \u0026quot;118\u0026quot; \u0026quot;116\u0026quot; \u0026quot;100\u0026quot; \u0026quot;108\u0026quot; \u0026quot;113\u0026quot; \u0026quot;119\u0026quot; \u0026quot;121\u0026quot; \u0026quot;103\u0026quot;\r## [13] \u0026quot;116\u0026quot; \u0026quot;111\u0026quot; \u0026quot;111\u0026quot; \u0026quot;115\u0026quot; \u0026quot;114\u0026quot; \u0026quot;102\u0026quot; \u0026quot;116\u0026quot; \u0026quot;103\u0026quot; \u0026quot;120\u0026quot; \u0026quot;115\u0026quot; \u0026quot;123\u0026quot; \u0026quot;103\u0026quot;\r## [25] \u0026quot;119\u0026quot; \u0026quot;230\u0026quot; \u0026quot;228\u0026quot; \u0026quot;225\u0026quot; \u0026quot;214\u0026quot; \u0026quot;225\u0026quot; \u0026quot;206\u0026quot; \u0026quot;207\u0026quot; \u0026quot;208\u0026quot; \u0026quot;202\u0026quot; \u0026quot;210\u0026quot; \u0026quot;229\u0026quot;\r## [37] \u0026quot;204\u0026quot; \u0026quot;207\u0026quot; \u0026quot;215\u0026quot; \u0026quot;218\u0026quot; \u0026quot;223\u0026quot; \u0026quot;221\u0026quot; \u0026quot;205\u0026quot; \u0026quot;214\u0026quot; \u0026quot;220\u0026quot; \u0026quot;227\u0026quot; \u0026quot;202\u0026quot; \u0026quot;224\u0026quot;\r## [49] \u0026quot;214\u0026quot; \u0026quot;201\u0026quot; \u0026quot;305\u0026quot; \u0026quot;310\u0026quot; \u0026quot;309\u0026quot; \u0026quot;310\u0026quot; \u0026quot;305\u0026quot; \u0026quot;305\u0026quot; \u0026quot;309\u0026quot; \u0026quot;303\u0026quot; \u0026quot;312\u0026quot; \u0026quot;310\u0026quot;\r## [61] \u0026quot;303\u0026quot; \u0026quot;302\u0026quot; \u0026quot;305\u0026quot; \u0026quot;303\u0026quot; \u0026quot;304\u0026quot; \u0026quot;306\u0026quot; \u0026quot;309\u0026quot; \u0026quot;304\u0026quot; \u0026quot;303\u0026quot; \u0026quot;309\u0026quot; \u0026quot;306\u0026quot; \u0026quot;311\u0026quot;\r## [73] \u0026quot;306\u0026quot; \u0026quot;307\u0026quot; \u0026quot;310\u0026quot; \u0026quot;417\u0026quot; \u0026quot;477\u0026quot; \u0026quot;470\u0026quot; \u0026quot;493\u0026quot; \u0026quot;414\u0026quot; \u0026quot;446\u0026quot; \u0026quot;402\u0026quot; \u0026quot;423\u0026quot; \u0026quot;476\u0026quot;\r## [85] \u0026quot;432\u0026quot; \u0026quot;490\u0026quot; \u0026quot;499\u0026quot; \u0026quot;429\u0026quot; \u0026quot;414\u0026quot; \u0026quot;455\u0026quot; \u0026quot;409\u0026quot; \u0026quot;462\u0026quot; \u0026quot;447\u0026quot; \u0026quot;483\u0026quot; \u0026quot;458\u0026quot; \u0026quot;471\u0026quot;\r## [97] \u0026quot;402\u0026quot; \u0026quot;423\u0026quot; \u0026quot;464\u0026quot; \u0026quot;483\u0026quot;\r  Explore as contagens da vari√°vel rincome em gss_cat, ela ficaria bem representada num gr√°fico? De qual tipo?\n  Qual a religi√£o mais comum em gss_cat? Qual o partido (partyid) mais popular?\n  A que religi√£o se refere a vari√°vel denom? Voc√™ pode descobrir isso fazendo uma tabela de contagens?\n  Como voc√™ poderia diminuir o n√∫mero de categorias da vari√°vel rincome do banco gss_cat?\n  ","date":1621728000,"expirydate":-62135596800,"kind":"page","lang":"en","lastmod":1621728000,"objectID":"fa0304036676bc16efc6e61759597fd7","permalink":"https://laddem.github.io/courses/tidyverse/dia2/","publishdate":"2021-05-23T00:00:00Z","relpermalink":"/courses/tidyverse/dia2/","section":"courses","summary":"Opera√ß√µes em vari√°veis e bancos de dados Hoje vamos apresentar dois pacotes com finalidades mais espec√≠ficas para trabalhar com vari√°veis de tipo caractere e fator e um pacote super importante para as opera√ß√µes com bancos de dados.","tags":null,"title":"stringr, forcats e dplyr","type":"book"},{"authors":null,"categories":null,"content":"O pacote ggplot2 e a \u0026ldquo;gram√°tica dos gr√°ficos\u0026rdquo; Ainda me lembro da primeira vez que li o terceiro cap√≠tulo de R for Data Science em que o conceito de visualiza√ß√£o de dados √© apresentado junto com a ideia de data.frame e o c√≥digo utilizado para gerar o gr√°fico. Acho que se o termo sobrecarga infromacional n√£o existisse, eu teria inventado ele na hora.\nAnedotas a parte, n√£o √© culpa do autor. O livro pressup√µe um certo conhecimento pr√©vio que eu n√£o tinha quando o li pela primeira vez. Imagino que a maioria de voc√™s j√° viu gr√°ficos na vida e at√© construiu um ou dois deles usando esse ou outros softwares estat√≠sticos. O que talvez nem todos tenham claro na mente √© que os gr√°ficos s√£o uma codifica√ß√£o num sistema de coordenadas das informa√ß√µes presentes em um banco de dados atrav√©s de escalas. Vamos destrinchar um pouco melhor isso:\nSuponha que voc√™ tenha o banco de dados mpg, presente na biblioteca ggplot2.\nlibrary(ggplot2)\rmpg\r ## # A tibble: 234 x 11\r## manufacturer model displ year cyl trans drv cty hwy fl class\r## \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt;\r## 1 audi a4 1.8 1999 4 auto(l~ f 18 29 p comp~\r## 2 audi a4 1.8 1999 4 manual~ f 21 29 p comp~\r## 3 audi a4 2 2008 4 manual~ f 20 31 p comp~\r## 4 audi a4 2 2008 4 auto(a~ f 21 30 p comp~\r## 5 audi a4 2.8 1999 6 auto(l~ f 16 26 p comp~\r## 6 audi a4 2.8 1999 6 manual~ f 18 26 p comp~\r## 7 audi a4 3.1 2008 6 auto(a~ f 18 27 p comp~\r## 8 audi a4 quat~ 1.8 1999 4 manual~ 4 18 26 p comp~\r## 9 audi a4 quat~ 1.8 1999 4 auto(l~ 4 16 25 p comp~\r## 10 audi a4 quat~ 2 2008 4 manual~ 4 20 28 p comp~\r## # ... with 224 more rows\r De posse desse banco, voc√™ gostaria de construir um gr√°fico relacionando a efici√™ncia do combust√≠vel de um carro (hwy) com o seu peso (displ). S√°bio e malandro no ggplot2, voc√™ escreve o c√≥digo a seguir:\nggplot(mpg, aes(displ,hwy, color = class)) +\rgeom_point()\r Mas fica a d√∫vida: que escolhas foram feitas no momento de traduzir a minha inten√ß√£o de produzir um diagrama de dispers√£o (scatterplot) do peso com o consumo de gasolina para a representa√ß√£o gr√°fica diante de n√≥s? Que unidades de medidas est√£o dispostas nos eixos X e Y? Qual o sistema de coordenadas no qual isto foi representado? Quem define os limites de in√≠cio e fim de cada eixo? Como cada ponto recebeu a sua cor? Essas perguntas podem parecer √≥bvias ou tontas, dependendo da perspectiva e da experi√™ncia do usu√°rio, mas elas s√£o centrais para entender como construir e modificar gr√°ficos no ggplot2.\nO pacote √© inspirado pela Gram√°tica dos Gr√°ficos, e procura decompor o processo de produ√ß√£o de gr√°ficos em uma sequ√™ncia de camadas que v√£o se sobrepondo at√© chegar no objeto desejado.\n a camada dos dados e do mapeamento est√©tico (que vari√°veis v√£o em quais eixos/escalas) a camada dos objetos geom√©tricos (pontos, linhas, barras, etc.) a camada das escalas (natural? logar√≠tmica? escala de cores?) a camada das facetas (mini gr√°ficos separados por alguma caracter√≠stica) a camada das transforma√ß√µes estat√≠sticas (distribui√ß√µes de probabilidade, contagens, propor√ß√µes, etc.) o sistema de coordenadas (cartesiano? polar?)  Obviamente, nem todo gr√°fico possui essa complexidade, e na verdade, a maioria dos gr√°ficos que fazemos se encaixa num pequeno subgrupo de todas essas especifica√ß√µes, ent√£o porque toda essa complexidade?\nPorque n√£o? Em primeiro lugar, se voc√™ est√° produzindo visualiza√ß√µes simples que cumprem seu prop√≥sito, voc√™ n√£o precisa se preocupar com quase nada disso, os padr√µes do ggplot2, via de regra, se encaixam perfeitamente na maioria dos problemas e, em segundo lugar, se voc√™ sentir a necessidade de ir mais fundo e produzir visualiza√ß√µes mais complexas, as mesmas ferramentas que voc√™ j√° conhece est√£o a sua disposi√ß√£o.\nTr√™s gr√°ficos para entender a mec√¢nica do ggplot2 Scatterplots Voltemos para o nosso gr√°fico original, vamos decomp√¥-lo em suas camadas como se estiv√©ssemos construindo ele passo-a-passo:\n# Primeiro, a camada dos dados e mapeamentos est√©ticos\rggplot(\r# Dados\rdata = mpg,\r# Que vari√°vel vai em que eixo\rmapping = aes(x = displ, y = hwy)\r)\r Examinando a sa√≠da, vemos que ggplot desenhou um canvas com nossas vari√°veis, mas ainda nenhum objeto geom√©trico. Tudo bem, adicionamos (+) uma camada de objetos geom√©tricos, no caso, pontos.\n# Objetos geom√©tricos come√ßam com \u0026quot;geom_\u0026quot;\rggplot(data = mpg, mapping = aes(x = displ, y = hwy)) + # adicionamos\rgeom_point()\r Agora, nosso gr√°fico j√° tem uma cara de diagrama de dispers√£o. Mas ainda n√£o tem as cores das classes de autom√≥vel. Tudo bem, voltamos para a primeira camada e informamos que queremos um terceiro mapeamento est√©tico.\n# A cor √© mapeada a vari√°vel class\rggplot(data = mpg, mapping = aes(\rx = displ, y = hwy,\rcolor = class) # novo mapeamento est√©tico\r) + # adicionamos\rgeom_point()\r Ok, chegamos no gr√°fico original. Mas como podem entender melhor as outras camadas? Vamos pensar, por exemplo, que talvez queiramos trabalhar a vari√°vel hwy numa escala logar√≠tmica. Poder√≠amos transformar a vari√°vel original, claro, mas o ggplot2 nos permite especificar as transforma√ß√µes diretamente nas escalas do gr√°fico!\nggplot(data = mpg, mapping = aes(x = displ, y = hwy, color = class)) +\rgeom_point() + # adicionando uma nova \u0026quot;camada\u0026quot;\rscale_y_continuous(trans = \u0026quot;log\u0026quot;)\r Mas voc√™, leitor, n√£o ficou satisfeito. Voc√™ queria era transformar a vari√°vel displ em ra√≠z quadrada. Tudo bem:\nggplot(data = mpg, mapping = aes(x = displ, y = hwy, color = class)) +\rgeom_point() +\rscale_x_continuous(trans = \u0026quot;sqrt\u0026quot;) # especificamos a transforma√ß√£o na escala de x\r Outro leitor n√£o estava interessado nas escalas dos eixos x ou y, que s√£o cont√≠nuas nesse caso, mas sim na sele√ß√£o de cores utilizadas para representar a escala das cores. Por ser um leitor conhecedor das formas de defici√™ncia visual crom√°tica, ele optou pelas paletas de cores do Colorbrewer:\nggplot(data = mpg, mapping = aes(x = displ, y = hwy, color = class)) +\rgeom_point() +\rscale_color_brewer(palette = \u0026quot;Set1\u0026quot;) # transforma√ß√£o da escala de cores\r Um ge√≥grafo entrou na conversa e disse que o sistema cartesiano de coordenadas estava iludindo os leitores a pensar que a rela√ß√£o entre peso e consumo de combust√≠vel estava distorcida pelas diferen√ßas entre as unidades de medida das vari√°veis, produzida pelo sistema cartesiano de coordenadas, ent√£o ele sugeriu que us√°ssemos um sistema de coordenadas fixas:\nggplot(data = mpg, mapping = aes(x = displ, y = hwy, color = class)) +\rgeom_point() +\rscale_color_brewer(palette = \u0026quot;Set1\u0026quot;) +\rcoord_fixed()\r Ficou horr√≠vel, esse ge√≥grafo n√£o sabe nada. Como recompensa pela sua ignor√¢ncia, agora ele ocupa um cargo no primeiro escal√£o do Minist√©rio da Sa√∫de.\nOutro pesquisador estava interessado em visualizar as rela√ß√µes entre consumo, peso e classe, mas levando em considera√ß√£o o fabricante do ve√≠culo, ent√£o, ele sugeriu que constru√≠ssemos um gr√°fico para cada. Voc√™, que √© pregui√ßoso, usou a capacidade do ggplot2 de dividir gr√°ficos atrav√©s da introdu√ß√£o de uma camada de facets.\nggplot(data = mpg, mapping = aes(x = displ, y = hwy, color = class)) +\rgeom_point() +\rscale_color_brewer(palette = \u0026quot;Set1\u0026quot;) + # adicionamos mais uma camada\rfacet_wrap(~manufacturer) # de facetas\r Agora, muito satisfeitos com o resultado do nosso trabalho, resolvemos incluir o gr√°fico numa publica√ß√£o, mas do jeito que est√°, n√£o d√°. Ent√£o adicionamos mais algumas camadas para torn√°-lo apresent√°vel.\nggplot(data = mpg, mapping = aes(x = displ, y = hwy, color = class)) +\rgeom_point() +\rscale_color_brewer(palette = \u0026quot;Set1\u0026quot;) + facet_wrap(~manufacturer) +\r# Colocamos os nomes nos eixos\rlabs(title = \u0026quot;Rela√ß√£o entre peso e economia de combust√≠vel de autom√≥veis\u0026quot;,\rsubtitle = \u0026quot;Separado por categoria e fabricante\u0026quot;,\rx = \u0026quot;Peso do ve√≠culo em toneladas\u0026quot;,\ry = \u0026quot;Consumo em milhas por gal√£o de 3,5l\u0026quot;,\rcolor = \u0026quot;Categoria\u0026quot;,\rcaption = \u0026quot;Fonte: Ag√™ncia de Prote√ß√£o Ambiental Estadunidense.\u0026quot;) +\r# Escolhemos um tema bonito\rtheme_light() +\r# Mudamos a posi√ß√£o da legenda, pra ficar mais jeitozinho\rtheme(legend.position = \u0026quot;bottom\u0026quot;)\r Pronto. Mam√£e vai ficar orgulhosa.\nBrincadeiras a parte, entendendo um pouco melhor a gram√°tica do gr√°fico, podemos construir nossas visualiza√ß√µes passo a passo, at√© chegar no resultado desejado.\nLineplots O segundo exemplo que quero mostrar pra voc√™s √© a constru√ß√£o de gr√°ficos com linhas. Eles s√£o interessantes porque d√£o bastante dor de cabe√ßa pra quem est√° come√ßando. Vamos continuar brincando com o mpg.\nAgora que eu fiz meu diagrama de dispers√£o, estou interessado em come√ßar um processo de modelagem, mas primeiro quero ter uma no√ß√£o visual da rela√ß√£o entre as vari√°veis.\nggplot(mpg, aes(displ, hwy)) +\rgeom_point() +\rgeom_smooth()\r ## `geom_smooth()` using method = 'loess' and formula 'y ~ x'\r geom_smooth ajusta um modelo aos dados e desenha a linha com os valores preditos. Agora que temos dois objetos geom√©tricos, talvez seja interessante ver o que acontece se eu colocar as cores das classes.\nggplot(mpg, aes(displ, hwy, color = class)) +\rgeom_point() +\rgeom_smooth(se = FALSE)\r ## `geom_smooth()` using method = 'loess' and formula 'y ~ x'\r Veja que ele fez o poss√≠vel para aplicar as escalas nos dois objetos geom√©tricos. Eu pedi para geom_smooth tirar os intervalos de confian√ßa para melhorar a visibilidade. Mas e seu eu quisesse ver a cor dos pontos, mas manter a linha de tend√™ncia geral? Voc√™ pode especificar mapeamentos est√©ticos gerais (na primeira camada) ou mapeamentos est√©ticos locais (dentro de cada camada geom√©trica).\nggplot(mpg, aes(displ, hwy)) + # mapeamentos gerais, se aplicam a todos os objetos\rgeom_point(aes(color = class)) + # mapeamento local, s√≥ se aplica aqui\rgeom_smooth(se = FALSE)\r ## `geom_smooth()` using method = 'loess' and formula 'y ~ x'\r Ok, mas e se eu quisesse um modelo linear ao inv√©s de um \u0026ldquo;Smoother de Loess\u0026rdquo;?\nggplot(mpg, aes(displ, hwy)) + geom_point(aes(color = class)) +\rgeom_smooth(method = lm)\r ## `geom_smooth()` using formula 'y ~ x'\r N√£o vou entrar muito nos argumentos de cada objeto geom√©trico e fun√ß√£o, voc√™s podem aprender isso na pr√°tica olhando a documenta√ß√£o das fun√ß√µes que s√£o do interesse de voc√™s. ?geom_smooth para ver todas as possibilidades. Uma dica boa √© usar geom_smooth para verificar intera√ß√µes entre vari√°veis num√©ricas e fatores.\nggplot(mpg, aes(displ, hwy, color = factor(cyl))) + geom_point() +\rgeom_smooth(method = lm)\r ## `geom_smooth()` using formula 'y ~ x'\r Ok, mas e se temos um gr√°fico de linhas mais tradicional, tipo uma s√©rie hist√≥rica?\neconomics\r ## # A tibble: 574 x 6\r## date pce pop psavert uempmed unemploy\r## \u0026lt;date\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt;\r## 1 1967-07-01 507. 198712 12.6 4.5 2944\r## 2 1967-08-01 510. 198911 12.6 4.7 2945\r## 3 1967-09-01 516. 199113 11.9 4.6 2958\r## 4 1967-10-01 512. 199311 12.9 4.9 3143\r## 5 1967-11-01 517. 199498 12.8 4.7 3066\r## 6 1967-12-01 525. 199657 11.8 4.8 3018\r## 7 1968-01-01 531. 199808 11.7 5.1 2878\r## 8 1968-02-01 534. 199920 12.3 4.5 3001\r## 9 1968-03-01 544. 200056 11.7 4.1 2877\r## 10 1968-04-01 544 200208 12.3 4.6 2709\r## # ... with 564 more rows\r Podemos criar um gr√°fico de linhas tendo como base a data (date) e alguma das vari√°veis registradas, como a taxa de desemprego.\nggplot(economics, aes(x = date, y = uempmed)) +\rgeom_line()\r Ou o consumo em bilh√µes de d√≥lares\nggplot(economics, aes(x = date, y = pce)) +\rgeom_line()\r Ou a popula√ß√£o\nggplot(economics, aes(x = date, y = pop)) +\rgeom_line()\r Ok, mas eu quero comparar visualmente o que ocorre com uma vari√°vel quando a outra muda. Podemos recorrer ao que aprendemos sobre mapeamentos est√©ticos globais e locais.\nggplot(economics, aes(x = date)) +\rgeom_line(aes(y = uempmed)) +\rgeom_line(aes(y = pce)) +\rgeom_line(aes(y = pop))\r Ficou meio ruim, porque as vari√°vel tem grandezas distintas. Podemos tentar resolver esse problema aplicando transforma√ß√µes na vari√°vel idade, mas meio que pra qualquer lugar onde caminhos, batemos numa parede ou noutra. Esse tipo de solu√ß√£o √© muito frequente entre pessoas que vem do base pro ggplot2, porque no base estamos acostumado a ideia de adicionar mais objetos geom√©tricos ao nosso gr√°fico original adicionando invoca√ß√µes √† fun√ß√µes como lines ou text. Por√©m, a solu√ß√£o preferida no tidyverse √© aplicar uma transforma√ß√£o no banco original de tal forma que as nossas vari√°veis num√©ricas caiam todas num par que especifica o nome da vari√°vel | e o valor dela.\nlibrary(tidyr)\reconomics %\u0026gt;% pivot_longer(cols = -date,\rnames_to = \u0026quot;variavel\u0026quot;,\rvalues_to = \u0026quot;valor\u0026quot;)\r ## # A tibble: 2,870 x 3\r## date variavel valor\r## \u0026lt;date\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt;\r## 1 1967-07-01 pce 507. ## 2 1967-07-01 pop 198712 ## 3 1967-07-01 psavert 12.6\r## 4 1967-07-01 uempmed 4.5\r## 5 1967-07-01 unemploy 2944 ## 6 1967-08-01 pce 510. ## 7 1967-08-01 pop 198911 ## 8 1967-08-01 psavert 12.6\r## 9 1967-08-01 uempmed 4.7\r## 10 1967-08-01 unemploy 2945 ## # ... with 2,860 more rows\r Talvez n√£o fique imediatamente claro para todos porque eu optei por esta solu√ß√£o, mas talvez essa pr√≥xima figura fale mais que mil palavras.\neconomics %\u0026gt;% pivot_longer(cols = -date,\rnames_to = \u0026quot;variavel\u0026quot;,\rvalues_to = \u0026quot;valor\u0026quot;) %\u0026gt;% ggplot(aes(date, valor)) +\rgeom_line() +\rfacet_wrap(~variavel, scales = \u0026quot;free_y\u0026quot;, ncol = 1)\r A √™nfase em usar tidy data no tidyverse decorre do fato de que todos os pacotes s√£o programados para usar a forma de organiza√ß√£o do banco como uma alavanca para facilitar a an√°lise de dados. Vejam esta outra pipeline.\n# Como vamos fazer algumas transforma√ß√µes nos dados, vamos carregar o dplyr aqui\rlibrary(dplyr)\r ## ## Attaching package: 'dplyr'\r ## The following objects are masked from 'package:stats':\r## ## filter, lag\r ## The following objects are masked from 'package:base':\r## ## intersect, setdiff, setequal, union\r economics %\u0026gt;% pivot_longer(cols = -date,\rnames_to = \u0026quot;variavel\u0026quot;,\rvalues_to = \u0026quot;valor\u0026quot;) %\u0026gt;% filter(variavel %in% c(\u0026quot;psavert\u0026quot;, \u0026quot;uempmed\u0026quot;)) %\u0026gt;% ggplot(aes(date, valor, color = variavel, shape = variavel)) +\rgeom_line()\r E agora vejam um dos erros mais comuns de quem est√° come√ßando:\neconomics %\u0026gt;% pivot_longer(cols = -date,\rnames_to = \u0026quot;variavel\u0026quot;,\rvalues_to = \u0026quot;valor\u0026quot;) %\u0026gt;% filter(variavel %in% c(\u0026quot;psavert\u0026quot;, \u0026quot;uempmed\u0026quot;)) %\u0026gt;% ggplot(aes(date, valor)) +\rgeom_line()\r Ao n√£o especificar uma separa√ß√£o entre grupos, o ggplot2 n√£o interpreta meus dados! Ele simplesmente conecta as observa√ß√µes mais ou menos na ordem em que elas aparecem no eixo x. Para resolver esse problema, precisamos especificar grupos! Seja indiretamente, atrav√©s de uma escala de cores, formas ou tipos de linha, seja diretamente atrav√©s da est√©tica groups.\neconomics %\u0026gt;% pivot_longer(cols = -date,\rnames_to = \u0026quot;variavel\u0026quot;,\rvalues_to = \u0026quot;valor\u0026quot;) %\u0026gt;% filter(variavel %in% c(\u0026quot;psavert\u0026quot;, \u0026quot;uempmed\u0026quot;)) %\u0026gt;% ggplot(aes(date, valor, group = variavel)) +\rgeom_line()\r economics %\u0026gt;% pivot_longer(cols = -date,\rnames_to = \u0026quot;variavel\u0026quot;,\rvalues_to = \u0026quot;valor\u0026quot;) %\u0026gt;% filter(variavel %in% c(\u0026quot;psavert\u0026quot;, \u0026quot;uempmed\u0026quot;)) %\u0026gt;% ggplot(aes(date, valor, color = variavel, linetype = variavel)) +\rgeom_line()\r Legal n√©?\nBarcharts Para terminar e ilustrar alguns exemplos de transforma√ß√£o estat√≠stica, vamos fazer alguns gr√°ficos de barras usando o diamonds, um banco de dados para fazer a alegria das piores pessoas na hist√≥ria da humanidade.\ndiamonds\r ## # A tibble: 53,940 x 10\r## carat cut color clarity depth table price x y z\r## \u0026lt;dbl\u0026gt; \u0026lt;ord\u0026gt; \u0026lt;ord\u0026gt; \u0026lt;ord\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;int\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt;\r## 1 0.23 Ideal E SI2 61.5 55 326 3.95 3.98 2.43\r## 2 0.21 Premium E SI1 59.8 61 326 3.89 3.84 2.31\r## 3 0.23 Good E VS1 56.9 65 327 4.05 4.07 2.31\r## 4 0.29 Premium I VS2 62.4 58 334 4.2 4.23 2.63\r## 5 0.31 Good J SI2 63.3 58 335 4.34 4.35 2.75\r## 6 0.24 Very Good J VVS2 62.8 57 336 3.94 3.96 2.48\r## 7 0.24 Very Good I VVS1 62.3 57 336 3.95 3.98 2.47\r## 8 0.26 Very Good H SI1 61.9 55 337 4.07 4.11 2.53\r## 9 0.22 Fair E VS2 65.1 61 337 3.87 3.78 2.49\r## 10 0.23 Very Good H VS1 59.4 61 338 4 4.05 2.39\r## # ... with 53,930 more rows\r Que tal um gr√°fico b√°sico, do n√∫mero de diamantes de acordo com a qualidade de seu corte (cut). Olhando a ajuda do ?geom_bar voc√™ vai na certeza de que voc√™ entendeu a aula e escreve o seguinte c√≥digo:\nggplot(diamonds, aes(x = cut, color = cut)) +\rgeom_bar()\r E agora, voc√™ fica olhando pro seu computador com cara de tacho. O que aconteceu? Bom, no caso de geoms com duas dimens√µes, podem existir casos em que voc√™ quer dar mapeamentos est√©ticos distintos para as bordas e para o conte√∫do deles. Por isso, existem as est√©ticas color e fill. Voc√™ pode pensar nelas como a casca do p√£o e o recheio.\nggplot(diamonds, aes(x = cut, fill = cut)) +\rgeom_bar()\r Mas, voc√™ ainda n√£o est√° satisfeito. Pela sua ampla experi√™ncia com uma das ind√∫strias mais sangrentas e retr√≥gadas do planeta voc√™ entende que a qualidade do corte n√£o √© o suficiente para determinar o valor de um diamante, ent√£o voc√™ quer ver a distribui√ß√£o tamb√©m pelo n√≠vel de transpar√™ncia do diamante, codificado na vari√°vel clarity.\nggplot(diamonds, aes(x = cut, fill = clarity)) +\rgeom_bar()\r Esse √© um primeiro passo interessante, e se tivessemos apenas duas ou tr√™s categorias, a gente poderia parar por a√≠. Mas no geral, para facilitar compara√ß√µes, queremos poder controlar o posicionamento das barras. Isso √© poss√≠vel ajustando o argumento position dos geoms onde isso √© necess√°rio.\n# O padr√£o\rggplot(diamonds, aes(x = cut, fill = clarity)) +\rgeom_bar(position = \u0026quot;stack\u0026quot;)\r # O certo\rggplot(diamonds, aes(x = cut, fill = clarity)) +\rgeom_bar(position = \u0026quot;dodge\u0026quot;)\r # Empilhadas a 100%, para facilitar compara√ß√µes entre categorias\rggplot(diamonds, aes(x = cut, fill = clarity)) +\rgeom_bar(position = \u0026quot;fill\u0026quot;)\r Pode parecer jocoso, mas em 99% dos casos, o correto √© voc√™ usar barras lado-a-lado, assim voc√™ visualmente pode comparar as categorias simplesmente comparando a altura das barras. Da pr√≥xima vez que voc√™ pensar em construir um gr√°fico de pizza, desista e fa√ßa um gr√°fico de barras com position = \u0026quot;dodge\u0026quot;. Seus leitores v√£o agradecer.\nEsse exemplo tamb√©m √© legal para gente olhar um pouco para a parte de transforma√ß√µes estat√≠sticas nas vari√°veis:\ndiamonds2 \u0026lt;- diamonds %\u0026gt;% count(cut) %\u0026gt;% mutate(prop = n/sum(n))\rdiamonds2 %\u0026gt;% ggplot() +\rgeom_bar(aes(x = cut, y = prop), stat = \u0026quot;identity\u0026quot;)\r Por padr√£o, geom_bar j√° faz o primeiro passo e utiliza as contagens (stat_count) para produzir o gr√°fico de barras, mas eu posso mudar esse comportamento atrav√©s do argumento stat. Eu tamb√©m posso querer mostrar propr√ß√µes ao inv√©s de contagens de outra forma mais sucinta.\nggplot(diamonds, aes(x = cut, # ao fazer isso, eu mudo o padr√£o de contagens para propor√ß√µes.\ry = stat(prop), # preciso especificar o grupo, se n√£o todas as barras v√£o a 100%.\rgroup = 1)) +\rgeom_bar()\r Voc√™ pode construir seus gr√°ficos a partir de transforma√ß√µes estat√≠sticas ao inv√©s de objetos geom√©tricos:\nggplot(data = diamonds) + stat_summary(\rmapping = aes(x = cut, y = depth),\rfun.min = min,\rfun.max = max,\rfun = median\r)\r As transforma√ß√µes estat√≠sticas come√ßam sempre com stat_ e cada uma tem um objeto geom√©trico padr√£o, que voc√™ pode mudar com o argumento geom.\nggplot(data = diamonds) + stat_summary(\rmapping = aes(x = cut, y = depth),\rfun.min = min,\rfun.max = max,\r# N√£o d√° pra mostrar a mediana com barras de erro, sorry\r#fun = median,\rgeom = \u0026quot;errorbar\u0026quot;\r)\r E era basicamente isso que eu tinha a dizer sobre como construir gr√°ficos no ggplot2! Abaixo, uma se√ß√£o com alguns detalhes para quem tiver interesse nessa parte de embelezamento dos gr√°ficos.\nPerfumaria Essa se√ß√£o pretende introduzir um pouco uma parte de customiza√ß√£o dos gr√°ficos. Frequentemente, as publica√ß√µes de regras mais estritas sobre formatos, fontes, temas, etc. As op√ß√µes padr√£o do ggplot2 podem n√£o se acomodar, ent√£o, cabe a n√≥s ajeitar essa reta final.\nT√≠tulos e r√≥tulos A melhor maneira de ajustar t√≠tulos e r√≥tulos √© atrav√©s de labs, porque voc√™ resolve tudo em uma s√≥ invoca√ß√£o. Mas tamb√©m h√° uma fun√ß√£o ggtitle. Com ela, √© poss√≠vel setar apenas t√≠tulo e subt√≠tulo.\nggplot(mpg, aes(displ, hwy, color = class)) +\rgeom_point() +\rggtitle(\u0026quot;T√≠tulo do gr√°fico\u0026quot;, \u0026quot;Subt√≠tulo do gr√°fico\u0026quot;)\r A maioria das op√ß√µes de customiza√ß√£o mais fina est√° na camada theme. Internamente, cada elemento do gr√°fico √© controlado por uma fun√ß√£o element_, por exemplo, element_text desenha textos e recebe argumentos relativos a isso, como fam√≠lia da fonte, tamanho, cor, etc.\nAli, voc√™ tem um controle mais direto sobre a constru√ß√£o do gr√°fico. No que diz respeito aos r√≥tulos, podemos mudar a fonte do t√≠tulo.\nggplot(mpg, aes(displ, hwy, color = class)) +\rgeom_point() +\rggtitle(\u0026quot;T√≠tulo do gr√°fico\u0026quot;, \u0026quot;Subt√≠tulo do gr√°fico\u0026quot;) +\r# Family √© meio complicado de mudar, mas voc√™ pode escolher serif, sans ou mono\rtheme(plot.title = element_text(family = \u0026quot;serif\u0026quot;, face = \u0026quot;bold\u0026quot;, colour = \u0026quot;red\u0026quot;),\rplot.subtitle = element_text(family = \u0026quot;mono\u0026quot;, face = \u0026quot;italic\u0026quot;, color = \u0026quot;forestgreen\u0026quot;))\r Usando uma s√≠ntaxe similar e os argumentos da fun√ß√£o element_text, voc√™ pode mudar qual outro elemento textual do gr√°fico.\nEixos Continuando o nosso frankenstein, podemos fazer altera√ß√µes nos eixos, como remover peda√ßos de um eixo, modificar sua forma, seu √¢ngulo e ajustar sua posi√ß√£o.\nggplot(mpg, aes(displ, hwy, color = class)) +\rgeom_point() +\rggtitle(\u0026quot;T√≠tulo do gr√°fico\u0026quot;, \u0026quot;Subt√≠tulo do gr√°fico\u0026quot;) +\r# Family √© meio complicado de mudar, mas voc√™ pode escolher serif, sans ou mono\rtheme(plot.title = element_text(family = \u0026quot;serif\u0026quot;, face = \u0026quot;bold\u0026quot;, colour = \u0026quot;red\u0026quot;),\rplot.subtitle = element_text(family = \u0026quot;mono\u0026quot;, face = \u0026quot;italic\u0026quot;, color = \u0026quot;forestgreen\u0026quot;),\r# voc√™ pode remover peda√ßos inteiros do gr√°fico com \u0026quot;element_blank()\u0026quot;\raxis.ticks.y = element_blank(),\raxis.text.y = element_blank(),\raxis.title.y = element_blank(),\r# voc√™ pode mudar a orienta√ß√£o, angulo, posi√ß√£o e at√© formato de elementos\raxis.title = element_text(angle = 90, hjust = 1),\raxis.text.x = element_text(angle = 45, vjust = 1),\raxis.ticks.x = element_line(\rcolour = \u0026quot;royalblue3\u0026quot;,\rarrow = grid::arrow(angle = 45, length = unit(0.5, \u0026quot;cm\u0026quot;), ends = \u0026quot;first\u0026quot;, type = \u0026quot;closed\u0026quot;))\r)\r Realmente, o c√©u √© o limite e voc√™ pode deixar o seu gr√°fico t√£o horr√≠vel quanto voc√™ quiser.\nLegendas Legendas no ggplot2 s√£o controladas em alguns lugares diferentes. Elas s√£o tratadas como guias (guides) no sentido de que s√£o guias para o leitor. Vamos pegar outra vari√°vel de cores, para poder brincar com diferentes tipos de legenda.\nggplot(mpg, aes(displ, hwy, color = cyl)) +\rgeom_point()\r Por padr√£o, ele entende cilindros como num√©rico e faz uma barra de cores cont√≠nua. Mas eu quero uma legenda!\n# Jeito 1 - Simples e r√°pido\rggplot(mpg, aes(displ, hwy, color = cyl)) +\rgeom_point() +\rguides(color = \u0026quot;legend\u0026quot;)\r # Jeito 2 - Posso mudar detalhes!\rggplot(mpg, aes(displ, hwy, color = cyl)) +\rgeom_point() +\rguides(color = guide_legend(title = \u0026quot;Cilindrossss\u0026quot;,\rtitle.position = \u0026quot;right\u0026quot;,\rlabel.position = \u0026quot;bottom\u0026quot;,\rdirection = \u0026quot;horizontal\u0026quot;))\r # Jeito 3 - Mexendo diretamente nas escalas\rggplot(mpg, aes(displ, hwy, color = cyl)) +\rgeom_point() +\r# Minha escala de cores preferida\rscale_color_viridis_c(guide = \u0026quot;legend\u0026quot;, option = \u0026quot;B\u0026quot;)\r # Jeito 3 - de novo, mas agora usando a especifica√ß√£o mais completa do guia\rggplot(mpg, aes(displ, hwy, color = cyl)) +\rgeom_point() +\r# Minha escala de cores preferida\rscale_color_viridis_c(\rguide = guide_legend(title = \u0026quot;Cilindrossss\u0026quot;,\rtitle.position = \u0026quot;right\u0026quot;,\rlabel.position = \u0026quot;bottom\u0026quot;,\rdirection = \u0026quot;horizontal\u0026quot;), option = \u0026quot;B\u0026quot;)\r Em qualquer lugar onde voc√™ possa especificar guides, voc√™ pode passar o valor FALSE para remover a legenda.\n# Na camada \u0026quot;guides()\u0026quot;\rggplot(mpg, aes(displ, hwy, color = cyl, size = cyl)) +\rgeom_point() +\rguides(color = FALSE)\r # Na pr√≥pria escala\rggplot(mpg, aes(displ, hwy, color = cyl, size = cyl)) +\rgeom_point() +\rscale_size(guide = FALSE)\r # B√¥nus = no tema, mas a√≠ voc√™ remove todas\rggplot(mpg, aes(displ, hwy, color = cyl, size = cyl)) +\rgeom_point() +\rtheme(legend.position = \u0026quot;none\u0026quot;)\r Escalas J√° dei uma palhinha de editar escalas, antes, ent√£o aqui vai um pouco mais de detalhe:\nggplot(mpg, aes(displ, hwy, color = cyl, size = cyl)) +\rgeom_point()\r # Mudar as cores manualmente\rcores \u0026lt;- c(\u0026quot;red\u0026quot;, \u0026quot;green\u0026quot;, \u0026quot;blue\u0026quot;, \u0026quot;yellow\u0026quot;, \u0026quot;purple\u0026quot;, \u0026quot;tomato\u0026quot;, \u0026quot;wheat2\u0026quot;)\rggplot(mpg, aes(displ, hwy, color = class, size = cyl)) +\rgeom_point() +\rscale_color_manual(values = cores)\r # Mudar os tamanhos\rggplot(mpg, aes(displ, hwy, color = class, size = cyl)) +\rgeom_point() +\rscale_color_manual(values = cores) +\r# scale_radius para fazer proprcional ao raio\rscale_radius(range = c(3,6))\r ggplot(mpg, aes(displ, hwy, color = class, size = cyl)) +\rgeom_point() +\rscale_color_manual(values = cores) +\r# scale_size para fazer proprcional a √°rea\rscale_size(range = c(2,4))\r √â poss√≠vel aplicar transforma√ß√µes na vari√°vel diretamente na escala, mudar o n√∫mero de breaks e especificar labels e alterar os limites do gr√°fico manualmente.\nggplot(mpg, aes(displ, hwy, color = class, size = cyl)) +\rgeom_point() +\rscale_x_continuous(trans = \u0026quot;sqrt\u0026quot;, name = \u0026quot;Peso\u0026quot;) +\rscale_y_continuous(\rname = \u0026quot;Consumo (rodovia)\u0026quot;,\rlimits = c(0, 50),\rbreaks = c(10, 20, 30, 40, 50), labels = c(\u0026quot;fogo no clima\u0026quot;, \u0026quot;aquecimento global\u0026quot;, \u0026quot;caldeira planet√°ria\u0026quot;, \u0026quot;deixa pra pr√≥xima gera√ß√£o\u0026quot;, \u0026quot;desastre em c√¢mera lenta\u0026quot;))\r Cada escala vai ter argumentos espec√≠ficos que fazem sentido em seu pr√≥prio contexto. Escalas cont√≠nuas tem argumentos para transforma√ß√£o estat√≠stica, escalas discretas n√£o aceitam argumentos cont√≠nuos e etc.\nIsto encerra nossa parte de ggplot2, que tal uns exerc√≠cios pra esquentar?\nExerc√≠cios  O que tem de errado no c√≥digo abaixo? Por que os pontos n√£o ficaram azuis?  ggplot(data = mpg) + geom_point(mapping = aes(x = displ, y = hwy, color = \u0026quot;blue\u0026quot;))\r  Utilizando o banco mpg, fa√ßa o diagrama de dispers√£o de displ por hwy e mapeie a cor para class, o tamanho para cyl e a forma para manufacturer. Como esses atributos est√©ticos se comportam diferente para vari√°veis categ√≥ricas vs cont√≠nuas?\n  Utilizando o diamonds, crie um diagrama de dispers√£o que relacione carat com price. Explore algumas outras vari√°veis utilizando escalas de cor para ver se voc√™ identifica algum padr√£o. Aplique transforma√ß√µes nas vari√°veis que voc√™ considerar justificadas.\n  Ainda continuando o exemplo anterior, aplique um geom_smooth utilizando v√°rias op√ß√µes de method para as vari√°veis originais ou transformadas.\n  No nosso gr√°fico de barras usando stat(prop) a gente precisou colocar group = 1, porque? Qual √© a diferen√ßa entre esses dois c√≥digos?\n  ggplot(data = diamonds) + geom_bar(mapping = aes(x = cut, y = after_stat(prop)))\r ggplot(data = diamonds) + geom_bar(mapping = aes(x = cut, fill = color, y = after_stat(prop)))\r stat_smooth √© muito parecido com geom_smooth, mas h√° uma diferen√ßa sutil. Compare os c√≥digos abaixo.  ggplot(mpg, aes(displ, hwy)) + geom_point() +\rgeom_smooth()\r ## `geom_smooth()` using method = 'loess' and formula 'y ~ x'\r ggplot(mpg, aes(displ, hwy)) + geom_point() +\rstat_smooth(geom = \u0026quot;step\u0026quot;)\r ## `geom_smooth()` using method = 'loess' and formula 'y ~ x'\r ggplot(mpg, aes(displ, hwy)) + geom_point() +\rstat_smooth(geom = \u0026quot;linerange\u0026quot;)\r ## `geom_smooth()` using method = 'loess' and formula 'y ~ x'\r ggplot(mpg, aes(displ, hwy)) + geom_point() +\rstat_smooth(geom = \u0026quot;errorbar\u0026quot;)\r ## `geom_smooth()` using method = 'loess' and formula 'y ~ x'\r ggplot(mpg, aes(displ, hwy)) + geom_point() +\rstat_smooth(geom = \u0026quot;crossbar\u0026quot;)\r ## `geom_smooth()` using method = 'loess' and formula 'y ~ x'\r  Usando o mpg e facet_grid, crie um scatterplot que contenha displ no eixo x, hwy no eixo y, class na cor, drv nas facetas-coluna e cyl nas facetas linha.\n  Voc√™ acha que os dois gr√°ficos abaixo ficar√£o diferentes um do outro? Porque? Tente responder antes de rodar o c√≥digo.\n  ggplot(data = mpg, mapping = aes(x = displ, y = hwy)) + geom_point() + geom_smooth()\r ## `geom_smooth()` using method = 'loess' and formula 'y ~ x'\r ggplot() + geom_point(data = mpg, mapping = aes(x = displ, y = hwy)) + geom_smooth(data = mpg, mapping = aes(x = displ, y = hwy))\r ## `geom_smooth()` using method = 'loess' and formula 'y ~ x'\r Tente recriar o seguinte gr√°fico  ## `geom_smooth()` using formula 'y ~ x'\r Transforme o gr√°fico seguir em um gr√°fico de pizza usando coord_polar.  ggplot(diamonds, aes(cut, fill = cut)) +\rgeom_bar()\r ","date":1621728000,"expirydate":-62135596800,"kind":"page","lang":"en","lastmod":1621728000,"objectID":"b9e37b7e1055bb09bf3bd731ebee0b86","permalink":"https://laddem.github.io/courses/tidyverse/dia3/","publishdate":"2021-05-23T00:00:00Z","relpermalink":"/courses/tidyverse/dia3/","section":"courses","summary":"O pacote ggplot2 e a \u0026ldquo;gram√°tica dos gr√°ficos\u0026rdquo; Ainda me lembro da primeira vez que li o terceiro cap√≠tulo de R for Data Science em que o conceito de visualiza√ß√£o de dados √© apresentado junto com a ideia de data.","tags":null,"title":"ggplot2","type":"book"},{"authors":null,"categories":null,"content":"O autor dos pacotes do tidyverse core √© completamente fascinado por gatos, por isso, tantas refer√™ncias ao bixo nos nomes dos pacotes. \u0026ldquo;Purr\u0026rdquo; (em ingl√™s) √© o som que os gatos fazem quando sentem prazer. Pra n√£o ficar uma coisa solta no come√ßo da aula, aqui uma foto de gatinho pra voc√™s:\nO assunto da aula de hoje √© talvez um pouco mais abstrato do que as aulas anteriores. Vamos falar bastante de fun√ß√µes, loops e programa√ß√£o funcional. S√£o termos que fazem parte do jarg√£o da computa√ß√£o, mas que mesmo usu√°rios veteranos do R como software estat√≠stico para an√°lise de dados podem ter pouca familiaridade. Ao inv√©s de come√ßar definindo o que vamos fazer, vou come√ßar definindo o que n√£o vamos.\n  N√£o vamos revisar a fundo o assunto de itera√ß√µes. Os livros fazem um bom servi√ßo, √© um assunto espinhoso e n√£o basta compreender os conceitos, tem que botar a m√£o na massa pra ter um entendimento n√£o apenas da teoria, mas tamb√©m para conseguir resolver os muitos problemas que aparecem quando voc√™ est√° construindo itera√ß√µes com maior n√≠vel de complexidade.\n  N√£o vamos cavar fundo em todos os aspectos da programa√ß√£o funcional ou de todas as fun√ß√µes do purrr. S√£o muitas e temos poucas horas.\n  Agora o que SIM vamos fazer √© revisar muito brevemente a sintaxe de um for loop, ver em que situa√ß√µes a gente o utilizaria e como voc√™ pode substituir seus v√°rios for loops por fun√ß√µes no purrr, com exemplos de aplica√ß√£o quando poss√≠vel. Se der tempo, vamos entrar um pouco na ideia de utilizar programa√ß√£o funcional para resolver problemas mais gen√©ricos em que precisamos generalizar alguma tarefa.\n# Primeiro, nossos pacotes!\rlibrary(tidyverse) # o purrr j√° √© carregado automaticamente junto com os outros,\r ## -- Attaching packages --------------------------------------- tidyverse 1.3.1 --\r ## v ggplot2 3.3.3 v purrr 0.3.4\r## v tibble 3.1.2 v dplyr 1.0.6\r## v tidyr 1.1.3 v stringr 1.4.0\r## v readr 1.4.0 v forcats 0.5.1\r ## -- Conflicts ------------------------------------------ tidyverse_conflicts() --\r## x dplyr::filter() masks stats::filter()\r## x dplyr::lag() masks stats::lag()\r # Se quiser carregar apenas o purrr, descomente a linha abaixo\r# library(purrr)\r Itera√ß√µes Do ponto de vista pr√°tico, uma itera√ß√£o √© uma repeti√ß√£o uma linha de c√≥digo de tal forma que apenas uma pequena parte previs√≠vel do c√≥digo muda entre uma repeti√ß√£o e outra. Por exemplo, digamos que voc√™ vai calcular uma soma de x.\nx \u0026lt;- runif(100, 0, 1000)\rx\r ## [1] 225.093967 466.946190 883.812438 87.936952 817.297665 959.868374\r## [7] 238.111861 832.283389 517.254072 102.303256 429.861933 994.676597\r## [13] 80.038906 91.034775 315.595919 669.703517 666.710230 425.227435\r## [19] 497.996177 169.809868 677.356086 627.092270 59.883331 766.776678\r## [25] 149.171108 905.846157 544.019980 536.797568 155.848320 622.688184\r## [31] 967.633909 585.653757 699.380320 189.194041 768.424587 571.151547\r## [37] 794.404194 773.359030 59.930340 432.662018 560.213616 676.552325\r## [43] 865.665243 534.298338 184.087156 378.304177 979.344523 455.709585\r## [49] 385.905114 158.846492 508.830850 522.506361 611.013883 926.345360\r## [55] 476.592277 468.897322 559.445858 927.857062 424.459786 848.563421\r## [61] 690.474162 836.675233 226.751909 965.321906 42.961176 578.897402\r## [67] 278.689574 97.974729 847.269263 351.362806 617.868732 228.979437\r## [73] 217.598302 279.653980 602.528267 902.524905 109.103549 874.569871\r## [79] 3.867538 246.845225 971.238817 460.380726 858.708653 273.029658\r## [85] 79.749562 889.292917 775.435723 623.977954 376.979606 17.145635\r## [91] 648.954440 591.458843 806.026611 252.165876 22.365448 657.280677\r## [97] 999.726557 189.202339 267.494455 940.787127\r Esque√ßa, por um instante, a fun√ß√£o sum. O c√°lculo da soma se d√° pela soma de todos os elementos do vetor x. Ent√£o, √© necess√°rio repetir a opera√ß√£o de soma atrav√©s da acumula√ß√£o dos valores. Veja que √© tudo totalmente previs√≠vel, cada nova repeti√ß√£o simplesmente adiciona mais um valor ao vetor original e esse valor pode ser encontrado na pr√≥xima posi√ß√£o de x. Esse √© o t√≠pico caso de itera√ß√£o. No R, a melhor pr√°tica √© inicializar uma vari√°vel antes e salvar os resultados da itera√ß√£o nela.\n# Inicializa√ß√£o\rresult \u0026lt;- x[[1]]\r# Sequ√™ncia\rfor (i in 2:length(x)) {\r# Corpo\rresult \u0026lt;- result + x[[i]]\r}\r# Comparando os dois resultados\rresult\r ## [1] 51513.6\r sum(x)\r ## [1] 51513.6\r Outro exemplo de mesmo tipo √© repeti√ß√£o de uma mesma opera√ß√£o em v√°rios vetores/colunas/vari√°veis comuns. Por exemplo, se eu tenho um data.frame com tr√™s colunas num√©ricas e eu gostaria de calcular a soma de cada uma.\n# Data.frame\rdf \u0026lt;- tibble(x = rnorm(100, 50, 25),\ry = rnorm(100, 100, 25),\rz = rnorm(100, 200, 25))\r# Inicializa√ß√£o\rresult \u0026lt;- vector(mode = \u0026quot;double\u0026quot;, length = length(df))\r# Sequ√™ncia\rfor (i in seq_along(df)) {\rresult[[i]] \u0026lt;- sum(df[[i]])\r}\r# Resultado\rresult\r ## [1] 5143.487 9739.920 19452.666\r Essa √© a minha revis√£o de 5 minutos de itera√ß√£o em R usando for loops. Como j√° √© de costume, tem muito mais. Por exemplo, existe um outro tipo de iterador no R b√°sico chamado while, que tem um funcionamento diferente do for. Ao inv√©s de voc√™ ter um resultado de tamanho previs√≠vel, voc√™ pode ter um resultado de tamanho desconhecido. Vou deixar o while para voc√™s pesquisarem porque o bom e velho for costuma cobrir a maioria dos casos de uso do cientista de dados.\nPrograma√ß√£o funcional Beleza, agora que j√° dominamos (ou n√£o) o for loop, encontramos v√°rias situa√ß√µes em que a gente gostaria de realizar a mesma opera√ß√£o v√°rias vezes, mas, o for loop √© como uma feijoada: √© gostoso, mas √© pesado. For loops em geral s√£o \u0026ldquo;verbosos\u0026rdquo;, voc√™ precisa escrever bastante para chegar em um determinado resultado e, depois de escrever alguns, voc√™ cansa de ter que repetir todos os peda√ßos dele. E se voc√™ pudesse abstrair o loop para uma fun√ß√£o? A√≠ voc√™ n√£o precisaria escrever toda aquela parafernalha.\nsoma \u0026lt;- function(x) {\rresult \u0026lt;- 0\rfor (i in 1:length(x)) {\rresult \u0026lt;- result + x[[i]]\r}\rresult\r}\rsoma(x)\r ## [1] 51513.6\r Ao fazer isso, eu ganho duas vantagens:\n  Manuten√ß√£o: sempre que eu precisar repetir a opera√ß√£o, eu consigo simplificar muito meu c√≥digo. N√£o preciso escrever um for loop para cada soma que eu precisar fazer. Se meus requerimentos mudarem no futuro, eu s√≥ preciso mudar um peda√ßo de c√≥digo.\n  Leitura: o humano que l√™ um for loop vai precisar de um minuto para se familiarizar com a opera√ß√£o e entender o que est√° sendo iterado, calculado, etc. O humano que l√™ \u0026ldquo;soma\u0026rdquo; sabe que ocorrer√° uma soma. Voc√™ alinha a expectativa com a execu√ß√£o.\n  Outro exemplo.\nsoma_xyz \u0026lt;- function(x) {\rsoma_xyz \u0026lt;- vector(mode = \u0026quot;double\u0026quot;, length = nrow(x))\rfor (i in seq_along(x[[1]])) {\rsoma_xyz[[i]] \u0026lt;- x[[1]][[i]] + x[[2]][[i]] + x[[3]][i]\r}\rsoma_xyz\r}\rdf$soma_xyz2 \u0026lt;- soma_xyz(df)\rdf\r ## # A tibble: 100 x 4\r## x y z soma_xyz2\r## \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt;\r## 1 31.0 91.0 182. 304.\r## 2 51.9 91.1 188. 331.\r## 3 51.3 85.1 229. 365.\r## 4 80.0 139. 179. 398.\r## 5 80.5 50.1 228. 359.\r## 6 59.8 122. 231. 413.\r## 7 69.4 135. 242. 446.\r## 8 16.5 76.6 234. 327.\r## 9 69.2 107. 189. 365.\r## 10 51.6 75.2 234. 361.\r## # ... with 90 more rows\r Outra vantagem de ter na m√£o uma fun√ß√£o, √© que eu posso me apropriar das ferramentas de programa√ß√£o funcional do R. S√£o as fun√ß√µes da fam√≠lia apply, que recebem uma lista de objetos e aplicam uma fun√ß√£o em cada um. Basicamente, aquela abstra√ß√£o do for loop que estavamos buscando.\nVejam como eu posso recriar o exemplo das somas das colunas do data.frame usando a fun√ß√£o soma.\nsapply(df, soma)\r ## x y z soma_xyz2 ## 5143.487 9739.920 19452.666 34336.074\r Eu sei, o exemplo √© muito simples pra ter uma aplica√ß√£o real. At√© porque j√° vimos como fazer esse tipo de opera√ß√£o com summarize l√° atr√°s. Mas talvez, na hora que voc√™ estiver realizando alguma opera√ß√£o de repeti√ß√£o, voc√™ se lembre dessa possibilidade e ela lhe seja √∫til.\no pacote purrr At√© o momento, nos limitamos a utilizar fun√ß√µes presentes no base, mas o verdadeiro intuito dessa aula √© introduzir as facilidade trazidas pelas fun√ß√µes do tidyverse. No pacote purrr, s√£o importadas fun√ß√µes com diversas funcionalidades que facilitam o trabalho com objetos mais complexos, como listas (pense sa√≠da de modelo), itera√ß√µes envolvendo mais de um argumento (pense escrever diversos objetos em diversos arquivos distintos) e assim sucessivamente. Abaixo, segue uma lista das fun√ß√µes do pacote com uma descri√ß√£o curta.\n  a fam√≠lia map_(): similar a fam√≠lia apply do R base. Recebe uma lista de objetos de entrada e uma fun√ß√£o e devolve uma lista com os resultados.\n  map2_(): mesma coisa, s√≥ que voc√™ pode passar duas listas de objetos e uma fun√ß√£o que requer dois argumentos vari√°veis. pmap() √© a generaliza√ß√£o, em que voc√™ passa p listas e uma fun√ß√£o que pede p argumentos.\n  imap(): aplica uma fun√ß√£o tanto ao vetor, como a seu nome/√≠ndice. √â meio louco, mas √© muito √∫til para alguns casos de uso.\n  modify_(): permite aplicar altera√ß√µes no objeto estilo o que voc√™ faria com uma pipeline de filter %\u0026gt;% mutate\n  safely(): e suas irm√£s possibly() e quietly() ajudam a obter resultados mesmo quando h√° ocorre um erro na itera√ß√£o.\n  transpose(), flatten_: manipulam e reformatam listas.\n  invoke_map(): aplica uma lista de fun√ß√µes a uma (opcional) segunda lista de par√¢metros.\n  reduce() e accumulate(): generalizam as opera√ß√µes de sumariza√ß√£o (pense soma acumulada, m√©dia, limite, fatorial)\n  pluck(): pesca elementos de uma lista com uma sintaxe linear e bonitinha.\n  E muito mais coisas\n  No interesse de ir direto ao ponto e n√£o tentar ser exaustivo, vamos ver algumas delas em mais detalhe.\nA fun√ß√£o map Essa fun√ß√£o √© praticamente uma c√≥pia de lapply.\ndf %\u0026gt;% lapply(sum)\r ## $x\r## [1] 5143.487\r## ## $y\r## [1] 9739.92\r## ## $z\r## [1] 19452.67\r## ## $soma_xyz2\r## [1] 34336.07\r df %\u0026gt;% map(sum)\r ## $x\r## [1] 5143.487\r## ## $y\r## [1] 9739.92\r## ## $z\r## [1] 19452.67\r## ## $soma_xyz2\r## [1] 34336.07\r Embora existam pequenas diferen√ßas t√©cnicas entre elas, a principal vantagem de map √© a possibilidade de criar fun√ß√µes an√¥nimas com uma s√≠ntaxe enxuta. Pense, por exemplo, em elevar ao quadrado.\ndf %\u0026gt;% lapply(function(x) x ^ 2)\r ## $x\r## [1] 963.798425 2689.631568 2636.289299 6407.686421 6483.401508\r## [6] 3576.407300 4821.200204 271.838261 4794.752257 2663.713324\r## [11] 1269.154807 2810.472272 7733.236266 6633.116709 5544.943339\r## [16] 1276.384278 474.645743 530.431720 3967.496532 3503.986006\r## [21] 4195.830138 6536.191280 2123.966230 1896.230863 320.311269\r## [26] 2713.855093 5381.268996 2205.452174 1047.781254 826.682084\r## [31] 2402.199045 5385.394322 2185.874731 5499.186633 8254.465662\r## [36] 3073.557849 5293.252928 2556.876189 3757.490933 1106.909116\r## [41] 1172.640022 7124.351428 875.948131 1428.390668 1426.113597\r## [46] 644.544767 3285.989441 853.645977 1.357369 2407.567674\r## [51] 5042.688807 5971.962098 4296.292935 124.644964 128.512784\r## [56] 7094.788796 6758.841939 3363.246840 881.306860 5323.336414\r## [61] 3396.128177 6276.881787 1185.356939 2587.379920 838.544288\r## [66] 882.065801 3046.336401 2404.123388 1843.174212 5069.910793\r## [71] 1426.091409 911.092383 12730.733608 6053.560724 3040.006719\r## [76] 658.250295 3402.752115 1192.989288 702.982204 959.240469\r## [81] 2427.061850 2819.283784 10924.963453 2645.464063 561.923775\r## [86] 12385.985694 3377.797601 1343.722757 383.297474 176.408849\r## [91] 4730.214023 955.567165 199.646662 6515.078501 1036.390327\r## [96] 1897.596732 2503.095741 236.412280 5393.150328 7001.526245\r## ## $y\r## [1] 8284.074 8303.088 7248.696 19391.930 2513.737 14851.220 18185.189\r## [8] 5865.938 11469.122 5650.669 10981.344 9473.321 9651.519 4452.080\r## [15] 6911.495 5374.510 11412.073 8851.945 10147.838 8415.336 6150.245\r## [22] 10513.858 11171.249 7657.689 3992.072 5309.097 9101.852 5460.790\r## [29] 10432.513 18788.381 4017.091 4116.322 3185.162 17520.537 3186.135\r## [36] 20143.963 10421.231 13894.456 7658.279 13681.015 15217.759 7052.142\r## [43] 12370.005 18450.451 5580.275 27559.470 9870.916 16777.651 14345.106\r## [50] 12084.487 11485.295 8327.790 26203.364 5477.594 8668.665 13172.393\r## [57] 12254.427 8711.024 9961.140 1268.758 7689.774 15604.880 9159.717\r## [64] 2758.645 10634.015 7599.150 14277.682 9006.049 11517.774 14155.260\r## [71] 10073.476 9203.164 4397.964 9118.102 6600.212 22169.380 7813.854\r## [78] 4461.388 10345.651 18106.926 7387.860 4662.773 20930.433 20457.998\r## [85] 9300.546 10149.361 7864.841 7646.981 7404.943 7709.098 7451.508\r## [92] 6907.973 6798.440 2214.701 12265.324 8910.786 8559.719 5810.114\r## [99] 4509.739 24625.748\r## ## $z\r## [1] 33154.90 35301.39 52433.74 32066.30 52077.27 53418.40 58521.86 54728.30\r## [9] 35690.17 54670.05 30497.10 29415.67 43156.04 32921.73 41698.45 55566.30\r## [17] 43630.23 49193.06 54089.95 38195.18 34639.45 30576.09 49807.56 40702.65\r## [25] 20512.02 30184.61 36949.72 58733.16 26796.23 47936.82 51652.77 33534.37\r## [33] 35970.26 23678.10 48648.95 33974.30 52570.99 30830.01 35836.79 36227.24\r## [41] 35372.95 34173.24 33564.92 31669.90 26779.00 31282.84 48986.23 43579.62\r## [49] 35944.99 29879.19 35826.63 26734.84 28090.00 20681.89 27921.49 40456.99\r## [57] 41507.86 24353.79 46273.41 42284.43 40001.73 41300.76 39745.56 27884.99\r## [65] 34581.60 34593.96 51853.12 50778.22 30045.59 37364.14 40176.84 20330.91\r## [73] 20957.48 43953.10 53487.80 33438.31 33781.46 47470.47 32914.79 33808.00\r## [81] 44550.95 32464.52 44696.09 36404.34 41732.33 17360.01 46148.44 55470.45\r## [89] 33890.15 31730.22 36964.04 47231.90 24258.20 36893.01 42387.00 48762.97\r## [97] 37281.18 43244.78 34961.56 34329.15\r## ## $soma_xyz2\r## [1] 92505.32 109474.68 133567.02 158701.52 128781.37 170397.94 199094.67\r## [8] 106940.59 133412.35 130031.19 99257.32 103590.54 155173.98 108643.62\r## [15] 130900.51 118861.27 113900.96 114860.63 157051.32 119969.06 108448.68\r## [22] 128338.79 140592.54 110757.80 50310.62 89218.94 130309.35 131920.52\r## [29] 88926.02 148046.10 115372.46 102827.80 85760.45 129887.12 135324.67\r## [36] 145687.48 163315.25 118353.26 114322.46 115988.37 119495.42 124780.60\r## [43] 104991.71 123613.33 76235.66 135621.24 142887.30 135058.53 96427.49\r## [50] 110126.02 135027.30 110252.64 156041.87 52435.15 73733.57 160112.69\r## [57] 157328.59 94484.55 118752.53 98729.56 119696.62 165952.07 108569.13\r## [64] 73103.77 101149.61 91728.55 161922.28 136362.02 104710.31 147054.80\r## [71] 114630.97 72201.81 104920.71 146645.60 135168.17 127743.12 109247.74\r## [78] 101895.35 95884.19 122082.54 119915.96 90938.77 212162.11 148428.93\r## [85] 105254.30 118194.15 130772.38 129330.50 83939.26 77959.99 120658.28\r## [92] 109796.45 63671.81 102305.42 121677.47 128724.35 112649.55 89732.36\r## [99] 107303.92 181375.75\r df %\u0026gt;% map(~ .x ^ 2)\r ## $x\r## [1] 963.798425 2689.631568 2636.289299 6407.686421 6483.401508\r## [6] 3576.407300 4821.200204 271.838261 4794.752257 2663.713324\r## [11] 1269.154807 2810.472272 7733.236266 6633.116709 5544.943339\r## [16] 1276.384278 474.645743 530.431720 3967.496532 3503.986006\r## [21] 4195.830138 6536.191280 2123.966230 1896.230863 320.311269\r## [26] 2713.855093 5381.268996 2205.452174 1047.781254 826.682084\r## [31] 2402.199045 5385.394322 2185.874731 5499.186633 8254.465662\r## [36] 3073.557849 5293.252928 2556.876189 3757.490933 1106.909116\r## [41] 1172.640022 7124.351428 875.948131 1428.390668 1426.113597\r## [46] 644.544767 3285.989441 853.645977 1.357369 2407.567674\r## [51] 5042.688807 5971.962098 4296.292935 124.644964 128.512784\r## [56] 7094.788796 6758.841939 3363.246840 881.306860 5323.336414\r## [61] 3396.128177 6276.881787 1185.356939 2587.379920 838.544288\r## [66] 882.065801 3046.336401 2404.123388 1843.174212 5069.910793\r## [71] 1426.091409 911.092383 12730.733608 6053.560724 3040.006719\r## [76] 658.250295 3402.752115 1192.989288 702.982204 959.240469\r## [81] 2427.061850 2819.283784 10924.963453 2645.464063 561.923775\r## [86] 12385.985694 3377.797601 1343.722757 383.297474 176.408849\r## [91] 4730.214023 955.567165 199.646662 6515.078501 1036.390327\r## [96] 1897.596732 2503.095741 236.412280 5393.150328 7001.526245\r## ## $y\r## [1] 8284.074 8303.088 7248.696 19391.930 2513.737 14851.220 18185.189\r## [8] 5865.938 11469.122 5650.669 10981.344 9473.321 9651.519 4452.080\r## [15] 6911.495 5374.510 11412.073 8851.945 10147.838 8415.336 6150.245\r## [22] 10513.858 11171.249 7657.689 3992.072 5309.097 9101.852 5460.790\r## [29] 10432.513 18788.381 4017.091 4116.322 3185.162 17520.537 3186.135\r## [36] 20143.963 10421.231 13894.456 7658.279 13681.015 15217.759 7052.142\r## [43] 12370.005 18450.451 5580.275 27559.470 9870.916 16777.651 14345.106\r## [50] 12084.487 11485.295 8327.790 26203.364 5477.594 8668.665 13172.393\r## [57] 12254.427 8711.024 9961.140 1268.758 7689.774 15604.880 9159.717\r## [64] 2758.645 10634.015 7599.150 14277.682 9006.049 11517.774 14155.260\r## [71] 10073.476 9203.164 4397.964 9118.102 6600.212 22169.380 7813.854\r## [78] 4461.388 10345.651 18106.926 7387.860 4662.773 20930.433 20457.998\r## [85] 9300.546 10149.361 7864.841 7646.981 7404.943 7709.098 7451.508\r## [92] 6907.973 6798.440 2214.701 12265.324 8910.786 8559.719 5810.114\r## [99] 4509.739 24625.748\r## ## $z\r## [1] 33154.90 35301.39 52433.74 32066.30 52077.27 53418.40 58521.86 54728.30\r## [9] 35690.17 54670.05 30497.10 29415.67 43156.04 32921.73 41698.45 55566.30\r## [17] 43630.23 49193.06 54089.95 38195.18 34639.45 30576.09 49807.56 40702.65\r## [25] 20512.02 30184.61 36949.72 58733.16 26796.23 47936.82 51652.77 33534.37\r## [33] 35970.26 23678.10 48648.95 33974.30 52570.99 30830.01 35836.79 36227.24\r## [41] 35372.95 34173.24 33564.92 31669.90 26779.00 31282.84 48986.23 43579.62\r## [49] 35944.99 29879.19 35826.63 26734.84 28090.00 20681.89 27921.49 40456.99\r## [57] 41507.86 24353.79 46273.41 42284.43 40001.73 41300.76 39745.56 27884.99\r## [65] 34581.60 34593.96 51853.12 50778.22 30045.59 37364.14 40176.84 20330.91\r## [73] 20957.48 43953.10 53487.80 33438.31 33781.46 47470.47 32914.79 33808.00\r## [81] 44550.95 32464.52 44696.09 36404.34 41732.33 17360.01 46148.44 55470.45\r## [89] 33890.15 31730.22 36964.04 47231.90 24258.20 36893.01 42387.00 48762.97\r## [97] 37281.18 43244.78 34961.56 34329.15\r## ## $soma_xyz2\r## [1] 92505.32 109474.68 133567.02 158701.52 128781.37 170397.94 199094.67\r## [8] 106940.59 133412.35 130031.19 99257.32 103590.54 155173.98 108643.62\r## [15] 130900.51 118861.27 113900.96 114860.63 157051.32 119969.06 108448.68\r## [22] 128338.79 140592.54 110757.80 50310.62 89218.94 130309.35 131920.52\r## [29] 88926.02 148046.10 115372.46 102827.80 85760.45 129887.12 135324.67\r## [36] 145687.48 163315.25 118353.26 114322.46 115988.37 119495.42 124780.60\r## [43] 104991.71 123613.33 76235.66 135621.24 142887.30 135058.53 96427.49\r## [50] 110126.02 135027.30 110252.64 156041.87 52435.15 73733.57 160112.69\r## [57] 157328.59 94484.55 118752.53 98729.56 119696.62 165952.07 108569.13\r## [64] 73103.77 101149.61 91728.55 161922.28 136362.02 104710.31 147054.80\r## [71] 114630.97 72201.81 104920.71 146645.60 135168.17 127743.12 109247.74\r## [78] 101895.35 95884.19 122082.54 119915.96 90938.77 212162.11 148428.93\r## [85] 105254.30 118194.15 130772.38 129330.50 83939.26 77959.99 120658.28\r## [92] 109796.45 63671.81 102305.42 121677.47 128724.35 112649.55 89732.36\r## [99] 107303.92 181375.75\r Atrav√©s do uso de f√≥rmulas ~ √© poss√≠vel especificar fun√ß√µes an√¥nimas simples economizando caracteres e utilizando o autocompletar.\nQue tal esta pipeline?\nlibrary(nycflights13)\r# M√©dias de todas as vari√°veis num√©ricas usando where()\rflights %\u0026gt;% select(where(is.numeric)) %\u0026gt;% map(mean)\r ## $year\r## [1] 2013\r## ## $month\r## [1] 6.54851\r## ## $day\r## [1] 15.71079\r## ## $dep_time\r## [1] NA\r## ## $sched_dep_time\r## [1] 1344.255\r## ## $dep_delay\r## [1] NA\r## ## $arr_time\r## [1] NA\r## ## $sched_arr_time\r## [1] 1536.38\r## ## $arr_delay\r## [1] NA\r## ## $flight\r## [1] 1971.924\r## ## $air_time\r## [1] NA\r## ## $distance\r## [1] 1039.913\r## ## $hour\r## [1] 13.18025\r## ## $minute\r## [1] 26.2301\r Ou esta\n# Propor√ß√£o de missings em todas as vari√°veis\rflights %\u0026gt;% map(is.na) %\u0026gt;% map(mean)\r ## $year\r## [1] 0\r## ## $month\r## [1] 0\r## ## $day\r## [1] 0\r## ## $dep_time\r## [1] 0.02451184\r## ## $sched_dep_time\r## [1] 0\r## ## $dep_delay\r## [1] 0.02451184\r## ## $arr_time\r## [1] 0.0258718\r## ## $sched_arr_time\r## [1] 0\r## ## $arr_delay\r## [1] 0.02800081\r## ## $carrier\r## [1] 0\r## ## $flight\r## [1] 0\r## ## $tailnum\r## [1] 0.007458964\r## ## $origin\r## [1] 0\r## ## $dest\r## [1] 0\r## ## $air_time\r## [1] 0.02800081\r## ## $distance\r## [1] 0\r## ## $hour\r## [1] 0\r## ## $minute\r## [1] 0\r## ## $time_hour\r## [1] 0\r # Contagem de missings em todas as vari√°veis\rflights %\u0026gt;% map(is.na) %\u0026gt;% map(sum)\r ## $year\r## [1] 0\r## ## $month\r## [1] 0\r## ## $day\r## [1] 0\r## ## $dep_time\r## [1] 8255\r## ## $sched_dep_time\r## [1] 0\r## ## $dep_delay\r## [1] 8255\r## ## $arr_time\r## [1] 8713\r## ## $sched_arr_time\r## [1] 0\r## ## $arr_delay\r## [1] 9430\r## ## $carrier\r## [1] 0\r## ## $flight\r## [1] 0\r## ## $tailnum\r## [1] 2512\r## ## $origin\r## [1] 0\r## ## $dest\r## [1] 0\r## ## $air_time\r## [1] 9430\r## ## $distance\r## [1] 0\r## ## $hour\r## [1] 0\r## ## $minute\r## [1] 0\r## ## $time_hour\r## [1] 0\r A outra grande vantagem do map √© ter acesso f√°cil ao controle do tipo de sa√≠da.\n# Vetor num√©rico\rflights %\u0026gt;% map(is.na) %\u0026gt;% map_dbl(mean)\r ## year month day dep_time sched_dep_time ## 0.000000000 0.000000000 0.000000000 0.024511842 0.000000000 ## dep_delay arr_time sched_arr_time arr_delay carrier ## 0.024511842 0.025871796 0.000000000 0.028000808 0.000000000 ## flight tailnum origin dest air_time ## 0.000000000 0.007458964 0.000000000 0.000000000 0.028000808 ## distance hour minute time_hour ## 0.000000000 0.000000000 0.000000000 0.000000000\r # Vetor de caracteres\rflights %\u0026gt;% map(is.na) %\u0026gt;% map_chr(mean)\r ## year month day dep_time sched_dep_time ## \u0026quot;0.000000\u0026quot; \u0026quot;0.000000\u0026quot; \u0026quot;0.000000\u0026quot; \u0026quot;0.024512\u0026quot; \u0026quot;0.000000\u0026quot; ## dep_delay arr_time sched_arr_time arr_delay carrier ## \u0026quot;0.024512\u0026quot; \u0026quot;0.025872\u0026quot; \u0026quot;0.000000\u0026quot; \u0026quot;0.028001\u0026quot; \u0026quot;0.000000\u0026quot; ## flight tailnum origin dest air_time ## \u0026quot;0.000000\u0026quot; \u0026quot;0.007459\u0026quot; \u0026quot;0.000000\u0026quot; \u0026quot;0.000000\u0026quot; \u0026quot;0.028001\u0026quot; ## distance hour minute time_hour ## \u0026quot;0.000000\u0026quot; \u0026quot;0.000000\u0026quot; \u0026quot;0.000000\u0026quot; \u0026quot;0.000000\u0026quot;\r Um exemplo um pouco mais elaborado: avalia√ß√£o inicial de vari√°veis em um modelo. Em geral, √© comum rodar um modelo para cada vari√°vel num√©rica para ver como elas se comportam.\nrespvar \u0026lt;- \u0026quot;hwy\u0026quot;\rpredvars \u0026lt;- names(select(mpg, where(is.numeric), -hwy))\rtibble(\rnames = predvars,\rfit = map(names, ~lm(paste0(respvar, \u0026quot;~\u0026quot;, .x), data = mpg)),\rsummary = map(fit, summary),\rr2 = map_dbl(summary, \u0026quot;r.squared\u0026quot;),\rFStat = map_df(summary, \u0026quot;fstatistic\u0026quot;),\rcoefs = map_df(fit, coef),\r)\r ## # A tibble: 4 x 6\r## names fit summary r2 FStat$value $numdf $dendf coefs$`(Interce~ $displ\r## \u0026lt;chr\u0026gt; \u0026lt;list\u0026gt; \u0026lt;list\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt;\r## 1 displ \u0026lt;lm\u0026gt; \u0026lt;smmry~ 5.87e-1 329. 1 232 35.7 -3.53\r## 2 year \u0026lt;lm\u0026gt; \u0026lt;smmry~ 4.66e-6 0.00108 1 232 17.7 NA ## 3 cyl \u0026lt;lm\u0026gt; \u0026lt;smmry~ 5.81e-1 321. 1 232 40.0 NA ## 4 cty \u0026lt;lm\u0026gt; \u0026lt;smmry~ 9.14e-1 2459. 1 232 0.892 NA\r Ok, a sa√≠da n√£o est√° muito bonitinha! Mas com um pouco mais de trabalho, programadores melhores que eu fizeram isso:\nmodels \u0026lt;- tibble(\rnames = predvars,\rfit = map(names, ~lm(paste0(respvar, \u0026quot;~\u0026quot;, .x), data = mpg)),\rtidied = fit %\u0026gt;% map(broom::tidy),\rglanced = fit %\u0026gt;% map(broom::glance),\raugmented = fit %\u0026gt;% map(broom::augment)\r)\rmodels\r ## # A tibble: 4 x 5\r## names fit tidied glanced augmented ## \u0026lt;chr\u0026gt; \u0026lt;list\u0026gt; \u0026lt;list\u0026gt; \u0026lt;list\u0026gt; \u0026lt;list\u0026gt; ## 1 displ \u0026lt;lm\u0026gt; \u0026lt;tibble [2 x 5]\u0026gt; \u0026lt;tibble [1 x 12]\u0026gt; \u0026lt;tibble [234 x 8]\u0026gt;\r## 2 year \u0026lt;lm\u0026gt; \u0026lt;tibble [2 x 5]\u0026gt; \u0026lt;tibble [1 x 12]\u0026gt; \u0026lt;tibble [234 x 8]\u0026gt;\r## 3 cyl \u0026lt;lm\u0026gt; \u0026lt;tibble [2 x 5]\u0026gt; \u0026lt;tibble [1 x 12]\u0026gt; \u0026lt;tibble [234 x 8]\u0026gt;\r## 4 cty \u0026lt;lm\u0026gt; \u0026lt;tibble [2 x 5]\u0026gt; \u0026lt;tibble [1 x 12]\u0026gt; \u0026lt;tibble [234 x 8]\u0026gt;\r Grande coisa, Vin√≠cius, o output √© ileg√≠vel! Calma! Lembram da primeira aula em que eu comentei que havia mais fun√ß√µes no tidyr?\n# Coeficientes\rmodels %\u0026gt;% select(tidied) %\u0026gt;%\rtidyr::unnest(tidied) %\u0026gt;% filter(term != \u0026quot;(Intercept)\u0026quot;)\r ## # A tibble: 4 x 5\r## term estimate std.error statistic p.value\r## \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt;\r## 1 displ -3.53 0.195 -18.2 2.04e- 46\r## 2 year 0.00285 0.0867 0.0329 9.74e- 1\r## 3 cyl -2.82 0.157 -17.9 1.18e- 45\r## 4 cty 1.34 0.0270 49.6 1.87e-125\r # Estat√≠sticas do modelo\rmodels %\u0026gt;% select(names, glanced) %\u0026gt;% unnest(glanced)\r ## # A tibble: 4 x 13\r## names r.squared adj.r.squared sigma statistic p.value df logLik AIC\r## \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt;\r## 1 displ 0.587 0.585 3.84 329. 2.04e- 46 1 -646. 1297.\r## 2 year 0.00000466 -0.00431 5.97 0.00108 9.74e- 1 1 -749. 1504.\r## 3 cyl 0.581 0.579 3.87 321. 1.18e- 45 1 -647. 1301.\r## 4 cty 0.914 0.913 1.75 2459. 1.87e-125 1 -462. 931.\r## # ... with 4 more variables: BIC \u0026lt;dbl\u0026gt;, deviance \u0026lt;dbl\u0026gt;, df.residual \u0026lt;int\u0026gt;,\r## # nobs \u0026lt;int\u0026gt;\r # Bancos \u0026quot;aumentados\u0026quot; com valores ajustados, res√≠duos, dist√¢ncias de cook, etc.\rmodels %\u0026gt;% filter(names == \u0026quot;displ\u0026quot;) %\u0026gt;% select(names, augmented) %\u0026gt;% unnest(augmented)\r ## # A tibble: 234 x 9\r## names hwy displ .fitted .resid .hat .sigma .cooksd .std.resid\r## \u0026lt;chr\u0026gt; \u0026lt;int\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt;\r## 1 displ 29 1.8 29.3 -0.343 0.0115 3.84 0.0000468 -0.0898\r## 2 displ 29 1.8 29.3 -0.343 0.0115 3.84 0.0000468 -0.0898\r## 3 displ 31 2 28.6 2.36 0.00984 3.84 0.00191 0.619 ## 4 displ 30 2 28.6 1.36 0.00984 3.84 0.000634 0.357 ## 5 displ 26 2.8 25.8 0.188 0.00543 3.84 0.00000660 0.0491\r## 6 displ 26 2.8 25.8 0.188 0.00543 3.84 0.00000660 0.0491\r## 7 displ 27 3.1 24.8 2.25 0.00463 3.84 0.000802 0.587 ## 8 displ 26 1.8 29.3 -3.34 0.0115 3.84 0.00445 -0.876 ## 9 displ 25 1.8 29.3 -4.34 0.0115 3.83 0.00751 -1.14 ## 10 displ 28 2 28.6 -0.636 0.00984 3.84 0.000138 -0.167 ## # ... with 224 more rows\r Isso aqui √© s√≥ uma palhinha de modelagem com o tidyverse, mas acho que √© uma demonstra√ß√£o muito convincente da aplicabilidade dos exemplos que vimos usando programa√ß√£o funcional.\nOutro exemplo mais simples com map2: salvar v√°rios arquivos de uma vez s√≥.\ndf1 \u0026lt;- tibble(x = rnorm(100), y = rnorm(100), z = rnorm(100))\rdf2 \u0026lt;- tibble(x = rnorm(100), y = rnorm(100), z = rnorm(100))\rdf3 \u0026lt;- tibble(x = rnorm(100), y = rnorm(100), z = rnorm(100))\rdf4 \u0026lt;- tibble(x = rnorm(100), y = rnorm(100), z = rnorm(100))\rdfs \u0026lt;- list(df1, df2, df3, df4)\rdfs\r ## [[1]]\r## # A tibble: 100 x 3\r## x y z\r## \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt;\r## 1 -0.142 -0.924 0.762 ## 2 0.405 -1.33 -0.196 ## 3 -0.0639 -0.399 -0.260 ## 4 -0.0699 0.0876 1.57 ## 5 0.827 -0.335 1.01 ## 6 0.187 0.419 -0.442 ## 7 1.14 -0.224 -0.0744\r## 8 -0.514 -1.27 0.896 ## 9 0.645 0.510 1.10 ## 10 -0.810 -0.246 0.589 ## # ... with 90 more rows\r## ## [[2]]\r## # A tibble: 100 x 3\r## x y z\r## \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt;\r## 1 1.54 0.923 -1.32 ## 2 -0.0135 -0.975 -0.0527\r## 3 1.36 -0.369 -0.434 ## 4 2.25 -0.254 0.207 ## 5 1.41 -1.43 -1.19 ## 6 0.357 0.408 -0.183 ## 7 1.32 0.773 0.427 ## 8 0.622 0.379 -1.06 ## 9 1.09 -1.27 -0.699 ## 10 1.66 1.75 -1.14 ## # ... with 90 more rows\r## ## [[3]]\r## # A tibble: 100 x 3\r## x y z\r## \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt;\r## 1 -0.306 1.11 1.28 ## 2 2.70 1.65 0.579\r## 3 0.904 0.558 2.16 ## 4 -0.335 1.92 -0.144\r## 5 0.443 0.521 1.07 ## 6 0.744 0.241 -1.57 ## 7 -1.48 -0.941 0.268\r## 8 -0.00240 0.304 1.13 ## 9 0.368 -0.987 0.577\r## 10 -2.07 0.0147 1.22 ## # ... with 90 more rows\r## ## [[4]]\r## # A tibble: 100 x 3\r## x y z\r## \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt;\r## 1 -0.753 0.894 -1.85 ## 2 0.960 1.53 1.12 ## 3 2.23 2.12 -0.230\r## 4 -1.15 -0.968 0.190\r## 5 1.34 1.73 0.459\r## 6 -1.44 -1.94 0.200\r## 7 0.170 -2.97 0.692\r## 8 -0.627 0.702 -0.512\r## 9 -1.50 -0.0865 -0.407\r## 10 0.633 1.15 -0.273\r## # ... with 90 more rows\r paths \u0026lt;- sprintf(\u0026quot;arquivo%s.csv\u0026quot;, 1:4)\rpaths\r ## [1] \u0026quot;arquivo1.csv\u0026quot; \u0026quot;arquivo2.csv\u0026quot; \u0026quot;arquivo3.csv\u0026quot; \u0026quot;arquivo4.csv\u0026quot;\r map2(dfs, paths, ~write_csv(x = .x, file = .y))\r ## [[1]]\r## # A tibble: 100 x 3\r## x y z\r## \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt;\r## 1 -0.142 -0.924 0.762 ## 2 0.405 -1.33 -0.196 ## 3 -0.0639 -0.399 -0.260 ## 4 -0.0699 0.0876 1.57 ## 5 0.827 -0.335 1.01 ## 6 0.187 0.419 -0.442 ## 7 1.14 -0.224 -0.0744\r## 8 -0.514 -1.27 0.896 ## 9 0.645 0.510 1.10 ## 10 -0.810 -0.246 0.589 ## # ... with 90 more rows\r## ## [[2]]\r## # A tibble: 100 x 3\r## x y z\r## \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt;\r## 1 1.54 0.923 -1.32 ## 2 -0.0135 -0.975 -0.0527\r## 3 1.36 -0.369 -0.434 ## 4 2.25 -0.254 0.207 ## 5 1.41 -1.43 -1.19 ## 6 0.357 0.408 -0.183 ## 7 1.32 0.773 0.427 ## 8 0.622 0.379 -1.06 ## 9 1.09 -1.27 -0.699 ## 10 1.66 1.75 -1.14 ## # ... with 90 more rows\r## ## [[3]]\r## # A tibble: 100 x 3\r## x y z\r## \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt;\r## 1 -0.306 1.11 1.28 ## 2 2.70 1.65 0.579\r## 3 0.904 0.558 2.16 ## 4 -0.335 1.92 -0.144\r## 5 0.443 0.521 1.07 ## 6 0.744 0.241 -1.57 ## 7 -1.48 -0.941 0.268\r## 8 -0.00240 0.304 1.13 ## 9 0.368 -0.987 0.577\r## 10 -2.07 0.0147 1.22 ## # ... with 90 more rows\r## ## [[4]]\r## # A tibble: 100 x 3\r## x y z\r## \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt;\r## 1 -0.753 0.894 -1.85 ## 2 0.960 1.53 1.12 ## 3 2.23 2.12 -0.230\r## 4 -1.15 -0.968 0.190\r## 5 1.34 1.73 0.459\r## 6 -1.44 -1.94 0.200\r## 7 0.170 -2.97 0.692\r## 8 -0.627 0.702 -0.512\r## 9 -1.50 -0.0865 -0.407\r## 10 0.633 1.15 -0.273\r## # ... with 90 more rows\r E se eu quiser ler um banco de dados que est√° em v√°rios arquivos diferentes? Vamos usar os que acabamos de criar\n# Bum! Uma linha\rpaths %\u0026gt;% map_dfr(read_csv, .id = \u0026quot;arquivo\u0026quot;)\r ## ## -- Column specification --------------------------------------------------------\r## cols(\r## x = col_double(),\r## y = col_double(),\r## z = col_double()\r## )\r## ## ## -- Column specification --------------------------------------------------------\r## cols(\r## x = col_double(),\r## y = col_double(),\r## z = col_double()\r## )\r## ## ## -- Column specification --------------------------------------------------------\r## cols(\r## x = col_double(),\r## y = col_double(),\r## z = col_double()\r## )\r## ## ## -- Column specification --------------------------------------------------------\r## cols(\r## x = col_double(),\r## y = col_double(),\r## z = col_double()\r## )\r ## # A tibble: 400 x 4\r## arquivo x y z\r## \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt;\r## 1 1 -0.142 -0.924 0.762 ## 2 1 0.405 -1.33 -0.196 ## 3 1 -0.0639 -0.399 -0.260 ## 4 1 -0.0699 0.0876 1.57 ## 5 1 0.827 -0.335 1.01 ## 6 1 0.187 0.419 -0.442 ## 7 1 1.14 -0.224 -0.0744\r## 8 1 -0.514 -1.27 0.896 ## 9 1 0.645 0.510 1.10 ## 10 1 -0.810 -0.246 0.589 ## # ... with 390 more rows\r As possibilidades s√£o in√∫meras. A regra √© a seguinte: viu uma tarefa que precisa ser repetida muitas vezes? Pense com carinho em usar uma fun√ß√£o vetorizada atrav√©s de map_.\nPredicados O objetivo de um fun√ß√£o predicado √© selecionar elementos de uma lista com base em uma fun√ß√£o. Em geral, s√£o fun√ß√µes simples que retornam um valor TRUE ou FALSE com base em alguma caracter√≠stica do objeto, como o tipo.\nl \u0026lt;- list(c(\u0026quot;a\u0026quot;, \u0026quot;b\u0026quot;, \u0026quot;c\u0026quot;), c(1, 2, 3))\rl %\u0026gt;% str()\r ## List of 2\r## $ : chr [1:3] \u0026quot;a\u0026quot; \u0026quot;b\u0026quot; \u0026quot;c\u0026quot;\r## $ : num [1:3] 1 2 3\r l %\u0026gt;% keep(is.numeric) %\u0026gt;% str()\r ## List of 1\r## $ : num [1:3] 1 2 3\r l %\u0026gt;% keep(is.character) %\u0026gt;% str()\r ## List of 1\r## $ : chr [1:3] \u0026quot;a\u0026quot; \u0026quot;b\u0026quot; \u0026quot;c\u0026quot;\r O uso mais frequente que vejo de keep e discard √© como uma esp√©cie de atalho para select. Como data.frames s√£o secretamente listas, voc√™ pode rapidamente selecionar todas as vari√°veis do banco que tenham o mesmo tipo.\nflights %\u0026gt;% keep(is.numeric)\r ## # A tibble: 336,776 x 14\r## year month day dep_time sched_dep_time dep_delay arr_time sched_arr_time\r## \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;int\u0026gt; \u0026lt;int\u0026gt;\r## 1 2013 1 1 517 515 2 830 819\r## 2 2013 1 1 533 529 4 850 830\r## 3 2013 1 1 542 540 2 923 850\r## 4 2013 1 1 544 545 -1 1004 1022\r## 5 2013 1 1 554 600 -6 812 837\r## 6 2013 1 1 554 558 -4 740 728\r## 7 2013 1 1 555 600 -5 913 854\r## 8 2013 1 1 557 600 -3 709 723\r## 9 2013 1 1 557 600 -3 838 846\r## 10 2013 1 1 558 600 -2 753 745\r## # ... with 336,766 more rows, and 6 more variables: arr_delay \u0026lt;dbl\u0026gt;,\r## # flight \u0026lt;int\u0026gt;, air_time \u0026lt;dbl\u0026gt;, distance \u0026lt;dbl\u0026gt;, hour \u0026lt;dbl\u0026gt;, minute \u0026lt;dbl\u0026gt;\r flights %\u0026gt;% discard(is.character)\r ## # A tibble: 336,776 x 15\r## year month day dep_time sched_dep_time dep_delay arr_time sched_arr_time\r## \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;int\u0026gt; \u0026lt;int\u0026gt;\r## 1 2013 1 1 517 515 2 830 819\r## 2 2013 1 1 533 529 4 850 830\r## 3 2013 1 1 542 540 2 923 850\r## 4 2013 1 1 544 545 -1 1004 1022\r## 5 2013 1 1 554 600 -6 812 837\r## 6 2013 1 1 554 558 -4 740 728\r## 7 2013 1 1 555 600 -5 913 854\r## 8 2013 1 1 557 600 -3 709 723\r## 9 2013 1 1 557 600 -3 838 846\r## 10 2013 1 1 558 600 -2 753 745\r## # ... with 336,766 more rows, and 7 more variables: arr_delay \u0026lt;dbl\u0026gt;,\r## # flight \u0026lt;int\u0026gt;, air_time \u0026lt;dbl\u0026gt;, distance \u0026lt;dbl\u0026gt;, hour \u0026lt;dbl\u0026gt;, minute \u0026lt;dbl\u0026gt;,\r## # time_hour \u0026lt;dttm\u0026gt;\r Como outros aspectos do purrr, a grande vantagem aqui √© a generalidade. Essas fun√ß√µes funcionam em qualquer lista de objetos e n√£o apenas em data.frames.\nLidando com a presen√ßa de erros A pr√≥xima dica forte √© utilizar os adv√©rbios (chique) safely() e companhia para lidar com erros.\nx \u0026lt;- list(a = c(1,2,3), b = c(\u0026quot;a\u0026quot;, \u0026quot;b\u0026quot;, \u0026quot;c\u0026quot;), c = c(99, 88, 77))\rx %\u0026gt;% map(sum)\r ## Error in .Primitive(\u0026quot;sum\u0026quot;)(..., na.rm = na.rm): 'type' inv√°lido (character) do argumento\r N√£o conseguimos nada! A mensagem de erro nem nos informa onde o problema ocorreu. E agora?\nx %\u0026gt;% map(safely(sum)) %\u0026gt;% str()\r ## List of 3\r## $ a:List of 2\r## ..$ result: num 6\r## ..$ error : NULL\r## $ b:List of 2\r## ..$ result: NULL\r## ..$ error :List of 2\r## .. ..$ message: chr \u0026quot;'type' inv√°lido (character) do argumento\u0026quot;\r## .. ..$ call : language .Primitive(\u0026quot;sum\u0026quot;)(..., na.rm = na.rm)\r## .. ..- attr(*, \u0026quot;class\u0026quot;)= chr [1:3] \u0026quot;simpleError\u0026quot; \u0026quot;error\u0026quot; \u0026quot;condition\u0026quot;\r## $ c:List of 2\r## ..$ result: num 264\r## ..$ error : NULL\r x %\u0026gt;% map(possibly(sum, otherwise = NA_real_)) %\u0026gt;% str()\r ## List of 3\r## $ a: num 6\r## $ b: num NA\r## $ c: num 264\r Essas fun√ß√µes permitem alterar a sa√≠da de uma fun√ß√£o quando ocorrer um erro. quietly √© parecido, mas ela captura mais a sa√≠da do R, o texto em si.\nx \u0026lt;- list(1, -1)\rx %\u0026gt;% map(quietly(log)) %\u0026gt;% str()\r ## List of 2\r## $ :List of 4\r## ..$ result : num 0\r## ..$ output : chr \u0026quot;\u0026quot;\r## ..$ warnings: chr(0) ## ..$ messages: chr(0) ## $ :List of 4\r## ..$ result : num NaN\r## ..$ output : chr \u0026quot;\u0026quot;\r## ..$ warnings: chr \u0026quot;NaNs produzidos\u0026quot;\r## ..$ messages: chr(0)\r Chamando listas de fun√ß√µes Vamos supor que voc√™ tem um vetor de n√∫meros e voc√™ quer aplicar um monte de fun√ß√µes diferentes nele, mas voc√™ n√£o quer ter que ficar copiando e colando tudo.\nnumeros \u0026lt;- rnorm(25, 50, 10)\rnumeros\r ## [1] 42.20048 38.07047 40.98823 66.99693 47.80056 45.23199 58.43128 45.39271\r## [9] 58.51740 57.56044 61.02015 34.67480 57.13596 49.33671 21.79235 48.01163\r## [17] 48.88481 55.32602 33.49729 49.72942 34.46436 56.32152 67.10447 53.74201\r## [25] 48.43169\r Nessas situa√ß√µes, voc√™ gostaria de chamar v√°rias fun√ß√µes no mesmo objeto ou grupo de objetos, mas voc√™ n√£o sabe bem como fazer isso\u0026hellip; Ent√£o, invoke_map vem ao resgate.\nfuncs \u0026lt;- list(\u0026quot;mean\u0026quot;, \u0026quot;sd\u0026quot;, \u0026quot;IQR\u0026quot;, \u0026quot;sum\u0026quot;, \u0026quot;length\u0026quot;, \u0026quot;range\u0026quot;, \u0026quot;min\u0026quot;, \u0026quot;max\u0026quot;)\rargs \u0026lt;- list(list(na.rm = T, trim = 0.05),\rlist(na.rm=T), list(type = 2),\rlist(na.rm = T), list(),\rlist(na.rm = T), list(na.rm = T), list(na.rm = T))\rfuncs %\u0026gt;% str()\r ## List of 8\r## $ : chr \u0026quot;mean\u0026quot;\r## $ : chr \u0026quot;sd\u0026quot;\r## $ : chr \u0026quot;IQR\u0026quot;\r## $ : chr \u0026quot;sum\u0026quot;\r## $ : chr \u0026quot;length\u0026quot;\r## $ : chr \u0026quot;range\u0026quot;\r## $ : chr \u0026quot;min\u0026quot;\r## $ : chr \u0026quot;max\u0026quot;\r args %\u0026gt;% str()\r ## List of 8\r## $ :List of 2\r## ..$ na.rm: logi TRUE\r## ..$ trim : num 0.05\r## $ :List of 1\r## ..$ na.rm: logi TRUE\r## $ :List of 1\r## ..$ type: num 2\r## $ :List of 1\r## ..$ na.rm: logi TRUE\r## $ : list()\r## $ :List of 1\r## ..$ na.rm: logi TRUE\r## $ :List of 1\r## ..$ na.rm: logi TRUE\r## $ :List of 1\r## ..$ na.rm: logi TRUE\r invoke_map(funcs, args, x = numeros) %\u0026gt;% glimpse()\r ## List of 8\r## $ : num 49.2\r## $ : num 11\r## $ : num 14.9\r## $ : num 1221\r## $ : int 25\r## $ : num [1:2] 21.8 67.1\r## $ : num 21.8\r## $ : num 67.1\r Fica mais bonito se voc√™ nomear os argumentos, ai o output fica melhorzinho.\nnames(funcs) \u0026lt;- unlist(funcs)\rinvoke_map(funcs, args, x = numeros) %\u0026gt;% glimpse()\r ## List of 8\r## $ mean : num 49.2\r## $ sd : num 11\r## $ IQR : num 14.9\r## $ sum : num 1221\r## $ length: int 25\r## $ range : num [1:2] 21.8 67.1\r## $ min : num 21.8\r## $ max : num 67.1\r Claro que esse exemplo aqui talvez n√£o seja √∫til para voc√™s, mas espero que quando voc√™s encontrarem uma situa√ß√£o em que voc√™ gostaria de aplicar uma bateria de fun√ß√µes no mesmo objeto ou grupo de objetos, voc√™s se lembrem dessa possibilidade.\nreduce e accumulate Essas duas fun√ß√µes s√£o desenhadas para fazer aplica√ß√µes recursivas de fun√ß√µes que recebem dois argumentos (operadores matem√°ticos, _joins, etc. Recursividade em linhas gerais, √© voc√™ repetir uma opera√ß√£o com o resultado da repeti√ß√£o anterior. Pense em somas ou produtos acumulados, em que o pr√≥ximo valor √© determinado pela aplica√ß√£o de uma regra sobre o anterior.\naccumulate(1:10, `+`)\r ## [1] 1 3 6 10 15 21 28 36 45 55\r accumulate(1:10, `*`)\r ## [1] 1 2 6 24 120 720 5040 40320 362880\r## [10] 3628800\r A principal diferen√ßa entre accumulate e reduce √© que a primeira guarda os resultados intermedi√°rios, enquanto a segunda retorna apenas o √∫ltimo.\nreduce(1:10, `+`)\r ## [1] 55\r reduce(1:10, `*`)\r ## [1] 3628800\r Uma aplica√ß√£o bastante pr√°tica dessas fun√ß√µes √© a produ√ß√£o de um √∫nico banco de dados a partir de v√°rios arquivos separados.\n# Lembra dos nossos arquivos l√° em cima?\rpaths\r ## [1] \u0026quot;arquivo1.csv\u0026quot; \u0026quot;arquivo2.csv\u0026quot; \u0026quot;arquivo3.csv\u0026quot; \u0026quot;arquivo4.csv\u0026quot;\r Vamos fingir que n√£o temos acesso a map_dfr e precisamos importar esses objetos e todos comp√µem um √∫nico banco. Imaginaem que tratam-se de dados por ano.\ndfs \u0026lt;- map(paths, read_csv)\r ## ## -- Column specification --------------------------------------------------------\r## cols(\r## x = col_double(),\r## y = col_double(),\r## z = col_double()\r## )\r## ## ## -- Column specification --------------------------------------------------------\r## cols(\r## x = col_double(),\r## y = col_double(),\r## z = col_double()\r## )\r## ## ## -- Column specification --------------------------------------------------------\r## cols(\r## x = col_double(),\r## y = col_double(),\r## z = col_double()\r## )\r## ## ## -- Column specification --------------------------------------------------------\r## cols(\r## x = col_double(),\r## y = col_double(),\r## z = col_double()\r## )\r glimpse(dfs)\r ## List of 4\r## $ : spec_tbl_df [100 x 3] (S3: spec_tbl_df/tbl_df/tbl/data.frame)\r## ..$ x: num [1:100] -0.1423 0.405 -0.0639 -0.0699 0.8265 ...\r## ..$ y: num [1:100] -0.9244 -1.3257 -0.3995 0.0876 -0.3349 ...\r## ..$ z: num [1:100] 0.762 -0.196 -0.26 1.568 1.009 ...\r## ..- attr(*, \u0026quot;spec\u0026quot;)=\r## .. .. cols(\r## .. .. x = col_double(),\r## .. .. y = col_double(),\r## .. .. z = col_double()\r## .. .. )\r## $ : spec_tbl_df [100 x 3] (S3: spec_tbl_df/tbl_df/tbl/data.frame)\r## ..$ x: num [1:100] 1.5431 -0.0135 1.3621 2.2513 1.4092 ...\r## ..$ y: num [1:100] 0.923 -0.975 -0.369 -0.254 -1.433 ...\r## ..$ z: num [1:100] -1.3211 -0.0527 -0.4336 0.2069 -1.1874 ...\r## ..- attr(*, \u0026quot;spec\u0026quot;)=\r## .. .. cols(\r## .. .. x = col_double(),\r## .. .. y = col_double(),\r## .. .. z = col_double()\r## .. .. )\r## $ : spec_tbl_df [100 x 3] (S3: spec_tbl_df/tbl_df/tbl/data.frame)\r## ..$ x: num [1:100] -0.306 2.702 0.904 -0.335 0.443 ...\r## ..$ y: num [1:100] 1.109 1.646 0.558 1.918 0.521 ...\r## ..$ z: num [1:100] 1.276 0.579 2.159 -0.144 1.069 ...\r## ..- attr(*, \u0026quot;spec\u0026quot;)=\r## .. .. cols(\r## .. .. x = col_double(),\r## .. .. y = col_double(),\r## .. .. z = col_double()\r## .. .. )\r## $ : spec_tbl_df [100 x 3] (S3: spec_tbl_df/tbl_df/tbl/data.frame)\r## ..$ x: num [1:100] -0.753 0.96 2.231 -1.145 1.338 ...\r## ..$ y: num [1:100] 0.894 1.526 2.123 -0.968 1.732 ...\r## ..$ z: num [1:100] -1.849 1.123 -0.23 0.19 0.459 ...\r## ..- attr(*, \u0026quot;spec\u0026quot;)=\r## .. .. cols(\r## .. .. x = col_double(),\r## .. .. y = col_double(),\r## .. .. z = col_double()\r## .. .. )\r new_df \u0026lt;- reduce(dfs, bind_rows)\rnew_df\r ## # A tibble: 400 x 3\r## x y z\r## \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt;\r## 1 -0.142 -0.924 0.762 ## 2 0.405 -1.33 -0.196 ## 3 -0.0639 -0.399 -0.260 ## 4 -0.0699 0.0876 1.57 ## 5 0.827 -0.335 1.01 ## 6 0.187 0.419 -0.442 ## 7 1.14 -0.224 -0.0744\r## 8 -0.514 -1.27 0.896 ## 9 0.645 0.510 1.10 ## 10 -0.810 -0.246 0.589 ## # ... with 390 more rows\r O resultado √© o mesmo observado em map_dfr, mas essa abordagem √© gen√©rica, ou seja, ela se aplica para qualquer grupo de objetos e para qualquer fun√ß√£o que recebe dois argumentos e precisa ser repetida de maneira recursiva.\n# Apaga os arquivos pra eles n√£o ficarem ai gastando mem√≥ria a toa\rfile.remove(paths)\r ## [1] TRUE TRUE TRUE TRUE\r pluck Esta fun√ß√£o √© um atalho para as tesouras duplas do r [[. Seu objeto √© facilitar a leitura de c√≥digos que pescam elementos profundos de uma lista aninhada.\nl \u0026lt;- list(\rlist(-1, x = 1, y = c(2), z = \u0026quot;a\u0026quot;),\rlist(-2, x = 4, y = c(5, 6), z = \u0026quot;b\u0026quot;),\rlist(-3, x = 8, y = c(9, 10, 11))\r)\rglimpse(l)\r ## List of 3\r## $ :List of 4\r## ..$ : num -1\r## ..$ x: num 1\r## ..$ y: num 2\r## ..$ z: chr \u0026quot;a\u0026quot;\r## $ :List of 4\r## ..$ : num -2\r## ..$ x: num 4\r## ..$ y: num [1:2] 5 6\r## ..$ z: chr \u0026quot;b\u0026quot;\r## $ :List of 3\r## ..$ : num -3\r## ..$ x: num 8\r## ..$ y: num [1:3] 9 10 11\r Se voc√™ chamar map_ nessa lista, voc√™ pode extrair os elementos delas pelo nome.\nmap_dbl(l, \u0026quot;x\u0026quot;)\r ## [1] 1 4 8\r map(l, \u0026quot;y\u0026quot;)\r ## [[1]]\r## [1] 2\r## ## [[2]]\r## [1] 5 6\r## ## [[3]]\r## [1] 9 10 11\r map(l, \u0026quot;z\u0026quot;)\r ## [[1]]\r## [1] \u0026quot;a\u0026quot;\r## ## [[2]]\r## [1] \u0026quot;b\u0026quot;\r## ## [[3]]\r## NULL\r Ou pela posi√ß√£o na lista\nmap_dbl(l, 1)\r ## [1] -1 -2 -3\r map_dbl(l, 2)\r ## [1] 1 4 8\r map(l, 3)\r ## [[1]]\r## [1] 2\r## ## [[2]]\r## [1] 5 6\r## ## [[3]]\r## [1] 9 10 11\r Ou os dois\nmap_dbl(l, list(\u0026quot;x\u0026quot;, 1))\r ## [1] 1 4 8\r map(l, list(\u0026quot;z\u0026quot;, 1))\r ## [[1]]\r## [1] \u0026quot;a\u0026quot;\r## ## [[2]]\r## [1] \u0026quot;b\u0026quot;\r## ## [[3]]\r## NULL\r map(l, list(\u0026quot;y\u0026quot;, 3))\r ## [[1]]\r## NULL\r## ## [[2]]\r## NULL\r## ## [[3]]\r## [1] 11\r Se um componente n√£o existir, voc√™ recebe um erro\nmap_chr(l, \u0026quot;z\u0026quot;)\r ## Error: Result 3 must be a single string, not NULL of length 0\r Mas voc√™ pode resolver isso passando um valor padr√£o\nmap_chr(l, \u0026quot;z\u0026quot;, .default = NA_character_)\r ## [1] \u0026quot;a\u0026quot; \u0026quot;b\u0026quot; NA\r Tudo isso funciona com base na fun√ß√£o pluck\npluck(l, 1)\r ## [[1]]\r## [1] -1\r## ## $x\r## [1] 1\r## ## $y\r## [1] 2\r## ## $z\r## [1] \u0026quot;a\u0026quot;\r pluck(l, 1, 2)\r ## [1] 1\r pluck(l, 2, 3)\r ## [1] 5 6\r pluck(l, 1, \u0026quot;x\u0026quot;)\r ## [1] 1\r pluck(l, 2, \u0026quot;z\u0026quot;)\r ## [1] \u0026quot;b\u0026quot;\r pluck(l, 3, \u0026quot;y\u0026quot;)\r ## [1] 9 10 11\r Exerc√≠cios   Utilize uma das fun√ß√µes map_ para:\n  Calcular a m√©dia de cada coluna em mtcars.\n  Determinar o tipo de cada coluna em flights.\n  Computar o n√∫mero de valores √∫nicos em cada coluna de iris.\n  Gere 10 distribui√ß√µes aleat√≥rias (rnorm) com m√©dias -10, 0, 10 e 100.\n  Como voc√™ pode criar um vetor indicando se cada coluna em um data.frame √© um fator?\n  Usando as fun√ß√µes predicado keep e discard:\n  Selecione todas as colunas caractere no banco flights.\n  Descarte os caracteres em mpg.\n  Selecione os fatores ordenados em diamonds.\n  Descarte as vari√°veis n√£o-num√©ricas em iris\n  Imagine que voc√™ tem um diret√≥rio cheio de arquivos .csv que correspondem a um √∫nico banco de dados. Voc√™ tem os caminhos de todos eles num vetor com a forma c(arquivo_1.csv, ..., arquivo_n.csv). Como voc√™ importaria esses arquivos? Tente fazer duas solu√ß√µes diferentes.\n  Escreva um c√≥digo sucinto que implemente v√°rios modelos lineares especificados por voc√™. Salve os resultados numa tibble com colunas-lista. Depois, extraia os resultados com unnest(). Use o exemplo como guia.\n  mtcars\r ## mpg cyl disp hp drat wt qsec vs am gear carb\r## Mazda RX4 21.0 6 160.0 110 3.90 2.620 16.46 0 1 4 4\r## Mazda RX4 Wag 21.0 6 160.0 110 3.90 2.875 17.02 0 1 4 4\r## Datsun 710 22.8 4 108.0 93 3.85 2.320 18.61 1 1 4 1\r## Hornet 4 Drive 21.4 6 258.0 110 3.08 3.215 19.44 1 0 3 1\r## Hornet Sportabout 18.7 8 360.0 175 3.15 3.440 17.02 0 0 3 2\r## Valiant 18.1 6 225.0 105 2.76 3.460 20.22 1 0 3 1\r## Duster 360 14.3 8 360.0 245 3.21 3.570 15.84 0 0 3 4\r## Merc 240D 24.4 4 146.7 62 3.69 3.190 20.00 1 0 4 2\r## Merc 230 22.8 4 140.8 95 3.92 3.150 22.90 1 0 4 2\r## Merc 280 19.2 6 167.6 123 3.92 3.440 18.30 1 0 4 4\r## Merc 280C 17.8 6 167.6 123 3.92 3.440 18.90 1 0 4 4\r## Merc 450SE 16.4 8 275.8 180 3.07 4.070 17.40 0 0 3 3\r## Merc 450SL 17.3 8 275.8 180 3.07 3.730 17.60 0 0 3 3\r## Merc 450SLC 15.2 8 275.8 180 3.07 3.780 18.00 0 0 3 3\r## Cadillac Fleetwood 10.4 8 472.0 205 2.93 5.250 17.98 0 0 3 4\r## Lincoln Continental 10.4 8 460.0 215 3.00 5.424 17.82 0 0 3 4\r## Chrysler Imperial 14.7 8 440.0 230 3.23 5.345 17.42 0 0 3 4\r## Fiat 128 32.4 4 78.7 66 4.08 2.200 19.47 1 1 4 1\r## Honda Civic 30.4 4 75.7 52 4.93 1.615 18.52 1 1 4 2\r## Toyota Corolla 33.9 4 71.1 65 4.22 1.835 19.90 1 1 4 1\r## Toyota Corona 21.5 4 120.1 97 3.70 2.465 20.01 1 0 3 1\r## Dodge Challenger 15.5 8 318.0 150 2.76 3.520 16.87 0 0 3 2\r## AMC Javelin 15.2 8 304.0 150 3.15 3.435 17.30 0 0 3 2\r## Camaro Z28 13.3 8 350.0 245 3.73 3.840 15.41 0 0 3 4\r## Pontiac Firebird 19.2 8 400.0 175 3.08 3.845 17.05 0 0 3 2\r## Fiat X1-9 27.3 4 79.0 66 4.08 1.935 18.90 1 1 4 1\r## Porsche 914-2 26.0 4 120.3 91 4.43 2.140 16.70 0 1 5 2\r## Lotus Europa 30.4 4 95.1 113 3.77 1.513 16.90 1 1 5 2\r## Ford Pantera L 15.8 8 351.0 264 4.22 3.170 14.50 0 1 5 4\r## Ferrari Dino 19.7 6 145.0 175 3.62 2.770 15.50 0 1 5 6\r## Maserati Bora 15.0 8 301.0 335 3.54 3.570 14.60 0 1 5 8\r## Volvo 142E 21.4 4 121.0 109 4.11 2.780 18.60 1 1 4 2\r modelos \u0026lt;- c(\u0026quot;mpg ~ wt\u0026quot;,\r\u0026quot;mpg ~ wt + cyl\u0026quot;,\r\u0026quot;mpg ~ wt + cyl + drat\u0026quot;,\r\u0026quot;mpg ~ wt + cyl + drat + am\u0026quot;)\r ","date":1621728000,"expirydate":-62135596800,"kind":"page","lang":"en","lastmod":1621728000,"objectID":"8fc2c9a43ba39b58554f36d137f8df4b","permalink":"https://laddem.github.io/courses/tidyverse/dia4/","publishdate":"2021-05-23T00:00:00Z","relpermalink":"/courses/tidyverse/dia4/","section":"courses","summary":"O autor dos pacotes do tidyverse core √© completamente fascinado por gatos, por isso, tantas refer√™ncias ao bixo nos nomes dos pacotes. \u0026ldquo;Purr\u0026rdquo; (em ingl√™s) √© o som que os gatos fazem quando sentem prazer.","tags":null,"title":"purrr","type":"book"},{"authors":null,"categories":null,"content":"Solu√ß√µes dos exerc√≠cios.\nreadr, tibble, tidyr # N√£o esque√ßa dos pacotes!\rlibrary(tidyverse)\r ## -- Attaching packages --------------------------------------- tidyverse 1.3.1 --\r ## v ggplot2 3.3.3 v purrr 0.3.4\r## v tibble 3.1.2 v dplyr 1.0.6\r## v tidyr 1.1.3 v stringr 1.4.0\r## v readr 1.4.0 v forcats 0.5.1\r ## -- Conflicts ------------------------------------------ tidyverse_conflicts() --\r## x dplyr::filter() masks stats::filter()\r## x dplyr::lag() masks stats::lag()\r  Como voc√™ importaria o banco \u0026ldquo;epa78.csv\u0026rdquo;  file \u0026lt;- readr_example(\u0026quot;epa78.txt\u0026quot;)\r Primeiro, √© bom verificar como est√£o dispostas as informa√ß√µes no arquivo texto\nread_lines(file, n_max = 10)\r ## [1] \u0026quot;ALFA ROMEO ALFA ROMEO 78010003\u0026quot;\r## [2] \u0026quot;ALFETTA 03 81 8 74 7 89 9 ALFETTA 78010053\u0026quot;\r## [3] \u0026quot;SPIDER 2000 01 SPIDER 2000 78010103\u0026quot;\r## [4] \u0026quot;AMC AMC 78020002\u0026quot;\r## [5] \u0026quot;GREMLIN 03 79 9 79 9 GREMLIN 78020053\u0026quot;\r## [6] \u0026quot;PACER 04 89 11 89 11 PACER 78020103\u0026quot;\r## [7] \u0026quot;PACER WAGON 07 90 26 91 26 PACER WAGON 78020153\u0026quot;\r## [8] \u0026quot;CONCORD 04 88 12 90 11 90 11 83 16 CONCORD 78020203\u0026quot;\r## [9] \u0026quot;CONCORD WAGON 07 91 30 91 30 CONCORD WAGON 78020253\u0026quot;\r## [10] \u0026quot;MATADOR COUPE 05 97 14 97 14 MATADOR COUPE 78020303\u0026quot;\r Ao identificar que se trata de um arquivo colunado, mas que as colunas s√£o separadas por espa√ßos, escolho o read_fwf com o fwf_empty.\ndic \u0026lt;- fwf_empty(file)\rdf \u0026lt;- read_fwf(file, col_positions = dic)\r ## ## -- Column specification --------------------------------------------------------\r## cols(\r## X1 = col_character(),\r## X2 = col_character(),\r## X3 = col_double(),\r## X4 = col_double(),\r## X5 = col_double(),\r## X6 = col_double(),\r## X7 = col_double(),\r## X8 = col_double(),\r## X9 = col_double(),\r## X10 = col_double(),\r## X11 = col_character(),\r## X12 = col_double()\r## )\r df\r ## # A tibble: 20 x 12\r## X1 X2 X3 X4 X5 X6 X7 X8 X9 X10 X11 X12\r## \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt;\r## 1 ALFA RO~ \u0026lt;NA\u0026gt; NA NA NA NA NA NA NA NA ALFA R~ 7.80e7\r## 2 ALFETTA 03 81 8 74 7 89 9 NA NA ALFETTA 7.80e7\r## 3 SPIDER ~ 01 NA NA NA NA NA NA NA NA SPIDER~ 7.80e7\r## 4 AMC \u0026lt;NA\u0026gt; NA NA NA NA NA NA NA NA AMC 7.80e7\r## 5 GREMLIN 03 79 9 NA NA NA NA 79 9 GREMLIN 7.80e7\r## 6 PACER 04 89 11 NA NA NA NA 89 11 PACER 7.80e7\r## 7 PACER W~ 07 90 26 91 26 NA NA NA NA PACER ~ 7.80e7\r## 8 CONCORD 04 88 12 90 11 90 11 83 16 CONCORD 7.80e7\r## 9 CONCORD~ 07 91 30 NA NA 91 30 NA NA CONCOR~ 7.80e7\r## 10 MATADOR~ 05 97 14 97 14 NA NA NA NA MATADO~ 7.80e7\r## 11 MATADOR~ 06 110 20 NA NA 110 20 NA NA MATADO~ 7.80e7\r## 12 MATADOR~ 09 112 50 NA NA 112 50 NA NA MATADO~ 7.80e7\r## 13 ASTON M~ \u0026lt;NA\u0026gt; NA NA NA NA NA NA NA NA ASTON ~ 7.80e7\r## 14 ASTON M~ \u0026lt;NA\u0026gt; NA NA NA NA NA NA NA NA ASTON ~ 7.80e7\r## 15 AUDI \u0026lt;NA\u0026gt; NA NA NA NA NA NA NA NA AUDI 7.81e7\r## 16 FOX 03 84 11 84 11 84 11 NA NA FOX 7.81e7\r## 17 FOX WAG~ 07 83 40 NA NA 83 40 NA NA FOX WA~ 7.81e7\r## 18 5000 04 90 15 NA NA 90 15 NA NA 5000 7.81e7\r## 19 AVANTI \u0026lt;NA\u0026gt; NA NA NA NA NA NA NA NA AVANTI 7.81e7\r## 20 AVANTI ~ 02 75 8 75 8 NA NA NA NA AVANTI~ 7.81e7\r Importe o banco \u0026ldquo;challenge.csv\u0026rdquo; e resolva os problemas com o tipo da coluna.  Ao verificar as primeiras 10 linhas do banco, podemos notar algo estranho\nfile \u0026lt;- readr_example(\u0026quot;challenge.csv\u0026quot;)\rread_lines(file, n_max = 10)\r ## [1] \u0026quot;x,y\u0026quot; \u0026quot;404,NA\u0026quot; \u0026quot;4172,NA\u0026quot; \u0026quot;3004,NA\u0026quot; \u0026quot;787,NA\u0026quot; \u0026quot;37,NA\u0026quot; \u0026quot;2332,NA\u0026quot;\r## [8] \u0026quot;2489,NA\u0026quot; \u0026quot;1449,NA\u0026quot; \u0026quot;3665,NA\u0026quot;\r Parece ser um arquivo csv comum, com duas colunas, mas uma delas parece ter apenas NAs. Se a gente proceder com a importa√ß√£o padr√£o, chegaremos em\ndf \u0026lt;- read_csv(file)\r ## ## -- Column specification --------------------------------------------------------\r## cols(\r## x = col_double(),\r## y = col_logical()\r## )\r ## Warning: 1000 parsing failures.\r## row col expected actual file\r## 1001 y 1/0/T/F/TRUE/FALSE 2015-01-16 'C:/Users/vinic/Documents/R/win-library/4.1/readr/extdata/challenge.csv'\r## 1002 y 1/0/T/F/TRUE/FALSE 2018-05-18 'C:/Users/vinic/Documents/R/win-library/4.1/readr/extdata/challenge.csv'\r## 1003 y 1/0/T/F/TRUE/FALSE 2015-09-05 'C:/Users/vinic/Documents/R/win-library/4.1/readr/extdata/challenge.csv'\r## 1004 y 1/0/T/F/TRUE/FALSE 2012-11-28 'C:/Users/vinic/Documents/R/win-library/4.1/readr/extdata/challenge.csv'\r## 1005 y 1/0/T/F/TRUE/FALSE 2020-01-13 'C:/Users/vinic/Documents/R/win-library/4.1/readr/extdata/challenge.csv'\r## .... ... .................. .......... ........................................................................\r## See problems(...) for more details.\r df\r ## # A tibble: 2,000 x 2\r## x y ## \u0026lt;dbl\u0026gt; \u0026lt;lgl\u0026gt;\r## 1 404 NA ## 2 4172 NA ## 3 3004 NA ## 4 787 NA ## 5 37 NA ## 6 2332 NA ## 7 2489 NA ## 8 1449 NA ## 9 3665 NA ## 10 3863 NA ## # ... with 1,990 more rows\r No console de voc√™s, deve aparecer que foram importadas as colunas x como double e y como logical. Mas uma chuva de \u0026ldquo;parsing failures\u0026rdquo;, indicando que expected = 1/0/T/F/TRUE/FALSE, actual = 2015-01-16.\nNa verdade, ao tentar adivinhar o tipo de colunas, o readr l√™ as primeiras 1000 observa√ß√µes em busca de um padr√£o. Voc√™ pode resolver esse problema:\n# 1. Aumentando o n√∫mero de observa√ß√µes utilizadas para adivinhar as colunas\rdf \u0026lt;- read_csv(file, guess_max = 1001)\r ## ## -- Column specification --------------------------------------------------------\r## cols(\r## x = col_double(),\r## y = col_date(format = \u0026quot;\u0026quot;)\r## )\r # A espec√≠fica√ß√£o da coluna Y agora √© \u0026lt;date\u0026gt;\rdf\r ## # A tibble: 2,000 x 2\r## x y ## \u0026lt;dbl\u0026gt; \u0026lt;date\u0026gt; ## 1 404 NA ## 2 4172 NA ## 3 3004 NA ## 4 787 NA ## 5 37 NA ## 6 2332 NA ## 7 2489 NA ## 8 1449 NA ## 9 3665 NA ## 10 3863 NA ## # ... with 1,990 more rows\r # 2. escolhendo diretamente o tipo de coluna antes da importa√ß√£o\rtipos \u0026lt;- cols(\ry = col_date()\r)\rdf \u0026lt;- read_csv(file, col_types = tipos)\r# Mesmo resultado\rdf\r ## # A tibble: 2,000 x 2\r## x y ## \u0026lt;dbl\u0026gt; \u0026lt;date\u0026gt; ## 1 404 NA ## 2 4172 NA ## 3 3004 NA ## 4 787 NA ## 5 37 NA ## 6 2332 NA ## 7 2489 NA ## 8 1449 NA ## 9 3665 NA ## 10 3863 NA ## # ... with 1,990 more rows\r Com o banco sala_aula dado a seguir, transforme-o para que ele contenha as vari√°veis nome, avalia√ß√£o e nota.  sala_aula \u0026lt;- tribble(\r~name, ~teste1, ~teste2, ~prova1,\r\u0026quot;Billy\u0026quot;, \u0026quot;\u0026lt;NA\u0026gt;\u0026quot;, \u0026quot;D\u0026quot; , \u0026quot;C\u0026quot;,\r\u0026quot;Suzy\u0026quot;, \u0026quot;F\u0026quot;, \u0026quot;\u0026lt;NA\u0026gt;\u0026quot;, \u0026quot;\u0026lt;NA\u0026gt;\u0026quot;,\r\u0026quot;Lionel\u0026quot;, \u0026quot;B\u0026quot;, \u0026quot;C\u0026quot; , \u0026quot;B\u0026quot;,\r\u0026quot;Jenny\u0026quot;, \u0026quot;A\u0026quot;, \u0026quot;A\u0026quot; , \u0026quot;B\u0026quot;\r)\r √â sempre bom come√ßar planejando o banco que queremos construir. Queremos um banco que tenha 3 vari√°veis: o nome, o tipo de prova aplicada e a nota de cada aluno. Para isso, precisamos colocar os nomes das colunas teste1, teste2 e prova1 numa vari√°vel e os valores das c√©lulas em outra. Vamos chamar essas colunas de \u0026ldquo;avalia√ß√£o\u0026rdquo; e \u0026ldquo;nota\u0026rdquo;, elas formam um par.\nAgora vamos chamar pivot_wider e especificar esses argumentos.\nsala_aula %\u0026gt;% pivot_longer(\r# Primeiro, identificamos as colunas que ser√£o modificadas\rcols = c(teste1, teste2, prova1),\r# Agora, indicamos os nomes das colunas que receber√£o\r# os nomes das colunas transformadas\rnames_to = \u0026quot;avaliacao\u0026quot;,\r# os valores das c√©lulas\rvalues_to = \u0026quot;nota\u0026quot;\r)\r ## # A tibble: 12 x 3\r## name avaliacao nota ## \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt;\r## 1 Billy teste1 \u0026lt;NA\u0026gt; ## 2 Billy teste2 D ## 3 Billy prova1 C ## 4 Suzy teste1 F ## 5 Suzy teste2 \u0026lt;NA\u0026gt; ## 6 Suzy prova1 \u0026lt;NA\u0026gt; ## 7 Lionel teste1 B ## 8 Lionel teste2 C ## 9 Lionel prova1 B ## 10 Jenny teste1 A ## 11 Jenny teste2 A ## 12 Jenny prova1 B\r Transforme o banco relig_income para que ele contenha as colunas religi√£o, renda e frequ√™ncia.  relig_income\r ## # A tibble: 18 x 11\r## religion `\u0026lt;$10k` `$10-20k` `$20-30k` `$30-40k` `$40-50k` `$50-75k` `$75-100k`\r## \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt;\r## 1 Agnostic 27 34 60 81 76 137 122\r## 2 Atheist 12 27 37 52 35 70 73\r## 3 Buddhist 27 21 30 34 33 58 62\r## 4 Catholic 418 617 732 670 638 1116 949\r## 5 Don‚Äôt k~ 15 14 15 11 10 35 21\r## 6 Evangel~ 575 869 1064 982 881 1486 949\r## 7 Hindu 1 9 7 9 11 34 47\r## 8 Histori~ 228 244 236 238 197 223 131\r## 9 Jehovah~ 20 27 24 24 21 30 15\r## 10 Jewish 19 19 25 25 30 95 69\r## 11 Mainlin~ 289 495 619 655 651 1107 939\r## 12 Mormon 29 40 48 51 56 112 85\r## 13 Muslim 6 7 9 10 9 23 16\r## 14 Orthodox 13 17 23 32 32 47 38\r## 15 Other C~ 9 7 11 13 13 14 18\r## 16 Other F~ 20 33 40 46 49 63 46\r## 17 Other W~ 5 2 3 4 2 7 3\r## 18 Unaffil~ 217 299 374 365 341 528 407\r## # ... with 3 more variables: $100-150k \u0026lt;dbl\u0026gt;, \u0026gt;150k \u0026lt;dbl\u0026gt;,\r## # Don't know/refused \u0026lt;dbl\u0026gt;\r O banco relig_income parece ter uma organiza√ß√£o em que temos 2 vari√°veis, mas uma delas est√° numa coluna \u0026ldquo;religion\u0026rdquo; e a outra est√° em 10 colunas, \u0026ldquo;income\u0026rdquo;. Queremos um banco que tenha 3 colunas: a religi√£o, o n√≠vel de renda, e o n√∫mero de pessoas em cada combina√ß√£o das duas primeiras.\nComo no exer√≠cio anterior, vamos chamar pivot_longer e especificar\nrelig_income %\u0026gt;% pivot_longer(\r# As colunas a serem modificadas, notem o uso de ':' para selecionar v√°rias\r# colunas em sequ√™ncia\rcols = `\u0026lt;$10k`:`Don't know/refused`,\r# Vari√°vel recebe os nomes da antiga coluna\rnames_to = \u0026quot;nivel_renda\u0026quot;,\r# Vari√°vel recebe os valores das c√©lulas\rvalues_to = \u0026quot;contagem\u0026quot;\r)\r ## # A tibble: 180 x 3\r## religion nivel_renda contagem\r## \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt;\r## 1 Agnostic \u0026lt;$10k 27\r## 2 Agnostic $10-20k 34\r## 3 Agnostic $20-30k 60\r## 4 Agnostic $30-40k 81\r## 5 Agnostic $40-50k 76\r## 6 Agnostic $50-75k 137\r## 7 Agnostic $75-100k 122\r## 8 Agnostic $100-150k 109\r## 9 Agnostic \u0026gt;150k 84\r## 10 Agnostic Don't know/refused 96\r## # ... with 170 more rows\r Transforme o banco billboard para que ele contenha apenas uma coluna \u0026ldquo;semana\u0026rdquo; e uma coluna com a posi√ß√£o da m√∫sica no ranking.   Dica, voc√™ pode selecionar v√°rias colunas usando o atalho wk1:wk76\n billboard\r ## # A tibble: 317 x 79\r## artist track date.entered wk1 wk2 wk3 wk4 wk5 wk6 wk7 wk8\r## \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;date\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt;\r## 1 2 Pac Baby D~ 2000-02-26 87 82 72 77 87 94 99 NA\r## 2 2Ge+her The Ha~ 2000-09-02 91 87 92 NA NA NA NA NA\r## 3 3 Doors~ Krypto~ 2000-04-08 81 70 68 67 66 57 54 53\r## 4 3 Doors~ Loser 2000-10-21 76 76 72 69 67 65 55 59\r## 5 504 Boyz Wobble~ 2000-04-15 57 34 25 17 17 31 36 49\r## 6 98^0 Give M~ 2000-08-19 51 39 34 26 26 19 2 2\r## 7 A*Teens Dancin~ 2000-07-08 97 97 96 95 100 NA NA NA\r## 8 Aaliyah I Don'~ 2000-01-29 84 62 51 41 38 35 35 38\r## 9 Aaliyah Try Ag~ 2000-03-18 59 53 38 28 21 18 16 14\r## 10 Adams, ~ Open M~ 2000-08-26 76 76 74 69 68 67 61 58\r## # ... with 307 more rows, and 68 more variables: wk9 \u0026lt;dbl\u0026gt;, wk10 \u0026lt;dbl\u0026gt;,\r## # wk11 \u0026lt;dbl\u0026gt;, wk12 \u0026lt;dbl\u0026gt;, wk13 \u0026lt;dbl\u0026gt;, wk14 \u0026lt;dbl\u0026gt;, wk15 \u0026lt;dbl\u0026gt;, wk16 \u0026lt;dbl\u0026gt;,\r## # wk17 \u0026lt;dbl\u0026gt;, wk18 \u0026lt;dbl\u0026gt;, wk19 \u0026lt;dbl\u0026gt;, wk20 \u0026lt;dbl\u0026gt;, wk21 \u0026lt;dbl\u0026gt;, wk22 \u0026lt;dbl\u0026gt;,\r## # wk23 \u0026lt;dbl\u0026gt;, wk24 \u0026lt;dbl\u0026gt;, wk25 \u0026lt;dbl\u0026gt;, wk26 \u0026lt;dbl\u0026gt;, wk27 \u0026lt;dbl\u0026gt;, wk28 \u0026lt;dbl\u0026gt;,\r## # wk29 \u0026lt;dbl\u0026gt;, wk30 \u0026lt;dbl\u0026gt;, wk31 \u0026lt;dbl\u0026gt;, wk32 \u0026lt;dbl\u0026gt;, wk33 \u0026lt;dbl\u0026gt;, wk34 \u0026lt;dbl\u0026gt;,\r## # wk35 \u0026lt;dbl\u0026gt;, wk36 \u0026lt;dbl\u0026gt;, wk37 \u0026lt;dbl\u0026gt;, wk38 \u0026lt;dbl\u0026gt;, wk39 \u0026lt;dbl\u0026gt;, wk40 \u0026lt;dbl\u0026gt;,\r## # wk41 \u0026lt;dbl\u0026gt;, wk42 \u0026lt;dbl\u0026gt;, wk43 \u0026lt;dbl\u0026gt;, wk44 \u0026lt;dbl\u0026gt;, wk45 \u0026lt;dbl\u0026gt;, wk46 \u0026lt;dbl\u0026gt;,\r## # wk47 \u0026lt;dbl\u0026gt;, wk48 \u0026lt;dbl\u0026gt;, wk49 \u0026lt;dbl\u0026gt;, wk50 \u0026lt;dbl\u0026gt;, wk51 \u0026lt;dbl\u0026gt;, wk52 \u0026lt;dbl\u0026gt;,\r## # wk53 \u0026lt;dbl\u0026gt;, wk54 \u0026lt;dbl\u0026gt;, wk55 \u0026lt;dbl\u0026gt;, wk56 \u0026lt;dbl\u0026gt;, wk57 \u0026lt;dbl\u0026gt;, wk58 \u0026lt;dbl\u0026gt;,\r## # wk59 \u0026lt;dbl\u0026gt;, wk60 \u0026lt;dbl\u0026gt;, wk61 \u0026lt;dbl\u0026gt;, wk62 \u0026lt;dbl\u0026gt;, wk63 \u0026lt;dbl\u0026gt;, wk64 \u0026lt;dbl\u0026gt;,\r## # wk65 \u0026lt;dbl\u0026gt;, wk66 \u0026lt;lgl\u0026gt;, wk67 \u0026lt;lgl\u0026gt;, wk68 \u0026lt;lgl\u0026gt;, wk69 \u0026lt;lgl\u0026gt;, wk70 \u0026lt;lgl\u0026gt;,\r## # wk71 \u0026lt;lgl\u0026gt;, wk72 \u0026lt;lgl\u0026gt;, wk73 \u0026lt;lgl\u0026gt;, wk74 \u0026lt;lgl\u0026gt;, wk75 \u0026lt;lgl\u0026gt;, wk76 \u0026lt;lgl\u0026gt;\r Da mesma forma como fizemos nos anteriores, queremos transformar as v√°rias wk1:wk76 em um par de colunas, uma que me diga a semana e a outra que me diga em que posi√ß√£o no ranking a m√∫sica estava.\nbillboard %\u0026gt;% pivot_longer(\r# Colunas que ser√£o transformadas\rcols = wk1:wk76,\r# Nome da vari√°vel que receber√° os nomes das colunas\rnames_to = \u0026quot;semana\u0026quot;,\r# Nome da vari√°vel que receber√° os valores das c√©lulas\rvalues_to = \u0026quot;posicao_rank\u0026quot;,\r# Nesse caso, uso o argumento opcional para eliminar os NAs\rvalues_drop_na = TRUE\r# Experimente mudar este argumento para FALSE e veja o resultado\r# Quando uma m√∫sica n√£o est√° mais nas paradas, ela recebe NA. Acho\r# justificado excluir os NAs nesse caso.\r)\r ## # A tibble: 5,307 x 5\r## artist track date.entered semana posicao_rank\r## \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;date\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt;\r## 1 2 Pac Baby Don't Cry (Keep... 2000-02-26 wk1 87\r## 2 2 Pac Baby Don't Cry (Keep... 2000-02-26 wk2 82\r## 3 2 Pac Baby Don't Cry (Keep... 2000-02-26 wk3 72\r## 4 2 Pac Baby Don't Cry (Keep... 2000-02-26 wk4 77\r## 5 2 Pac Baby Don't Cry (Keep... 2000-02-26 wk5 87\r## 6 2 Pac Baby Don't Cry (Keep... 2000-02-26 wk6 94\r## 7 2 Pac Baby Don't Cry (Keep... 2000-02-26 wk7 99\r## 8 2Ge+her The Hardest Part Of ... 2000-09-02 wk1 91\r## 9 2Ge+her The Hardest Part Of ... 2000-09-02 wk2 87\r## 10 2Ge+her The Hardest Part Of ... 2000-09-02 wk3 92\r## # ... with 5,297 more rows\r Experimente fazer o caminho inverso dos exerc√≠cios 3 a 5, devolvendo os datasets ao seu formato original. O que voc√™ observou?  Vou come√ßar enxugando os c√≥digos anteriores para criar os resultados que produzimos e salv√°-los em objetos.\nsala_aula_long \u0026lt;- sala_aula %\u0026gt;% pivot_longer(\rcols = c(teste1, teste2, prova1),\rnames_to = \u0026quot;avaliacao\u0026quot;,\rvalues_to = \u0026quot;nota\u0026quot;\r)\rrelig_income_long \u0026lt;- relig_income %\u0026gt;% pivot_longer(\rcols = `\u0026lt;$10k`:`Don't know/refused`,\rnames_to = \u0026quot;nivel_renda\u0026quot;,\rvalues_to = \u0026quot;contagem\u0026quot;\r)\rbillboard_long \u0026lt;- billboard %\u0026gt;% pivot_longer(\rcols = wk1:wk76,\rnames_to = \u0026quot;semana\u0026quot;,\rvalues_to = \u0026quot;posicao_rank\u0026quot;,\rvalues_drop_na = TRUE\r)\rsala_aula_long\r ## # A tibble: 12 x 3\r## name avaliacao nota ## \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt;\r## 1 Billy teste1 \u0026lt;NA\u0026gt; ## 2 Billy teste2 D ## 3 Billy prova1 C ## 4 Suzy teste1 F ## 5 Suzy teste2 \u0026lt;NA\u0026gt; ## 6 Suzy prova1 \u0026lt;NA\u0026gt; ## 7 Lionel teste1 B ## 8 Lionel teste2 C ## 9 Lionel prova1 B ## 10 Jenny teste1 A ## 11 Jenny teste2 A ## 12 Jenny prova1 B\r relig_income_long\r ## # A tibble: 180 x 3\r## religion nivel_renda contagem\r## \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt;\r## 1 Agnostic \u0026lt;$10k 27\r## 2 Agnostic $10-20k 34\r## 3 Agnostic $20-30k 60\r## 4 Agnostic $30-40k 81\r## 5 Agnostic $40-50k 76\r## 6 Agnostic $50-75k 137\r## 7 Agnostic $75-100k 122\r## 8 Agnostic $100-150k 109\r## 9 Agnostic \u0026gt;150k 84\r## 10 Agnostic Don't know/refused 96\r## # ... with 170 more rows\r billboard_long\r ## # A tibble: 5,307 x 5\r## artist track date.entered semana posicao_rank\r## \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;date\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt;\r## 1 2 Pac Baby Don't Cry (Keep... 2000-02-26 wk1 87\r## 2 2 Pac Baby Don't Cry (Keep... 2000-02-26 wk2 82\r## 3 2 Pac Baby Don't Cry (Keep... 2000-02-26 wk3 72\r## 4 2 Pac Baby Don't Cry (Keep... 2000-02-26 wk4 77\r## 5 2 Pac Baby Don't Cry (Keep... 2000-02-26 wk5 87\r## 6 2 Pac Baby Don't Cry (Keep... 2000-02-26 wk6 94\r## 7 2 Pac Baby Don't Cry (Keep... 2000-02-26 wk7 99\r## 8 2Ge+her The Hardest Part Of ... 2000-09-02 wk1 91\r## 9 2Ge+her The Hardest Part Of ... 2000-09-02 wk2 87\r## 10 2Ge+her The Hardest Part Of ... 2000-09-02 wk3 92\r## # ... with 5,297 more rows\r O caminho inverso desses bancos de dados, √© utilizar pivot_wider. Aqui, vamos escolher um par de colunas que cont√©m:\n O nome das colunas que queremos criar O valor que queremos passar para as c√©lulas dessas novas colunas  Vamos ver exemplos comentados como no anterior\nsala_aula_long %\u0026gt;% pivot_wider(\r# Aqui, identificamos colunas que N√ÉO SER√ÉO MODIFICADAS\r# √â o contr√°rio de pivot_longer. Por padr√£o, s√£o todas as que n√£o s√£o\r# mencionadas na transforma√ß√£o, mas para deixar bem claro, # vou deixar expl√≠cito.\rid_cols = name,\r# Vari√°vel com os nomes para as novas colunas\rnames_from = avaliacao,\r# Vari√°vel com os valores para as c√©lulas\rvalues_from = nota\r)\r ## # A tibble: 4 x 4\r## name teste1 teste2 prova1\r## \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; ## 1 Billy \u0026lt;NA\u0026gt; D C ## 2 Suzy F \u0026lt;NA\u0026gt; \u0026lt;NA\u0026gt; ## 3 Lionel B C B ## 4 Jenny A A B\r relig_income_long %\u0026gt;% pivot_wider(\r# Colunas n√£o modificadas\rid_cols = religion,\r# Vari√°vel com os nomes para as novas colunas\rnames_from = nivel_renda,\r# Vari√°vel com os valores para as c√©lulas\rvalues_from = contagem\r)\r ## # A tibble: 18 x 11\r## religion `\u0026lt;$10k` `$10-20k` `$20-30k` `$30-40k` `$40-50k` `$50-75k` `$75-100k`\r## \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt;\r## 1 Agnostic 27 34 60 81 76 137 122\r## 2 Atheist 12 27 37 52 35 70 73\r## 3 Buddhist 27 21 30 34 33 58 62\r## 4 Catholic 418 617 732 670 638 1116 949\r## 5 Don‚Äôt k~ 15 14 15 11 10 35 21\r## 6 Evangel~ 575 869 1064 982 881 1486 949\r## 7 Hindu 1 9 7 9 11 34 47\r## 8 Histori~ 228 244 236 238 197 223 131\r## 9 Jehovah~ 20 27 24 24 21 30 15\r## 10 Jewish 19 19 25 25 30 95 69\r## 11 Mainlin~ 289 495 619 655 651 1107 939\r## 12 Mormon 29 40 48 51 56 112 85\r## 13 Muslim 6 7 9 10 9 23 16\r## 14 Orthodox 13 17 23 32 32 47 38\r## 15 Other C~ 9 7 11 13 13 14 18\r## 16 Other F~ 20 33 40 46 49 63 46\r## 17 Other W~ 5 2 3 4 2 7 3\r## 18 Unaffil~ 217 299 374 365 341 528 407\r## # ... with 3 more variables: $100-150k \u0026lt;dbl\u0026gt;, \u0026gt;150k \u0026lt;dbl\u0026gt;,\r## # Don't know/refused \u0026lt;dbl\u0026gt;\r billboard_long %\u0026gt;% pivot_wider(\r# Colunas n√£o modificadas\rid_cols = c(artist, track, date.entered),\r# Vari√°vel com os nomes para as novas colunas\rnames_from = semana,\r# Vari√°vel com os valores para as c√©lulas\rvalues_from = posicao_rank\r)\r ## # A tibble: 317 x 68\r## artist track date.entered wk1 wk2 wk3 wk4 wk5 wk6 wk7 wk8\r## \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;date\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt;\r## 1 2 Pac Baby D~ 2000-02-26 87 82 72 77 87 94 99 NA\r## 2 2Ge+her The Ha~ 2000-09-02 91 87 92 NA NA NA NA NA\r## 3 3 Doors~ Krypto~ 2000-04-08 81 70 68 67 66 57 54 53\r## 4 3 Doors~ Loser 2000-10-21 76 76 72 69 67 65 55 59\r## 5 504 Boyz Wobble~ 2000-04-15 57 34 25 17 17 31 36 49\r## 6 98^0 Give M~ 2000-08-19 51 39 34 26 26 19 2 2\r## 7 A*Teens Dancin~ 2000-07-08 97 97 96 95 100 NA NA NA\r## 8 Aaliyah I Don'~ 2000-01-29 84 62 51 41 38 35 35 38\r## 9 Aaliyah Try Ag~ 2000-03-18 59 53 38 28 21 18 16 14\r## 10 Adams, ~ Open M~ 2000-08-26 76 76 74 69 68 67 61 58\r## # ... with 307 more rows, and 57 more variables: wk9 \u0026lt;dbl\u0026gt;, wk10 \u0026lt;dbl\u0026gt;,\r## # wk11 \u0026lt;dbl\u0026gt;, wk12 \u0026lt;dbl\u0026gt;, wk13 \u0026lt;dbl\u0026gt;, wk14 \u0026lt;dbl\u0026gt;, wk15 \u0026lt;dbl\u0026gt;, wk16 \u0026lt;dbl\u0026gt;,\r## # wk17 \u0026lt;dbl\u0026gt;, wk18 \u0026lt;dbl\u0026gt;, wk19 \u0026lt;dbl\u0026gt;, wk20 \u0026lt;dbl\u0026gt;, wk21 \u0026lt;dbl\u0026gt;, wk22 \u0026lt;dbl\u0026gt;,\r## # wk23 \u0026lt;dbl\u0026gt;, wk24 \u0026lt;dbl\u0026gt;, wk25 \u0026lt;dbl\u0026gt;, wk26 \u0026lt;dbl\u0026gt;, wk27 \u0026lt;dbl\u0026gt;, wk28 \u0026lt;dbl\u0026gt;,\r## # wk29 \u0026lt;dbl\u0026gt;, wk30 \u0026lt;dbl\u0026gt;, wk31 \u0026lt;dbl\u0026gt;, wk32 \u0026lt;dbl\u0026gt;, wk33 \u0026lt;dbl\u0026gt;, wk34 \u0026lt;dbl\u0026gt;,\r## # wk35 \u0026lt;dbl\u0026gt;, wk36 \u0026lt;dbl\u0026gt;, wk37 \u0026lt;dbl\u0026gt;, wk38 \u0026lt;dbl\u0026gt;, wk39 \u0026lt;dbl\u0026gt;, wk40 \u0026lt;dbl\u0026gt;,\r## # wk41 \u0026lt;dbl\u0026gt;, wk42 \u0026lt;dbl\u0026gt;, wk43 \u0026lt;dbl\u0026gt;, wk44 \u0026lt;dbl\u0026gt;, wk45 \u0026lt;dbl\u0026gt;, wk46 \u0026lt;dbl\u0026gt;,\r## # wk47 \u0026lt;dbl\u0026gt;, wk48 \u0026lt;dbl\u0026gt;, wk49 \u0026lt;dbl\u0026gt;, wk50 \u0026lt;dbl\u0026gt;, wk51 \u0026lt;dbl\u0026gt;, wk52 \u0026lt;dbl\u0026gt;,\r## # wk53 \u0026lt;dbl\u0026gt;, wk54 \u0026lt;dbl\u0026gt;, wk55 \u0026lt;dbl\u0026gt;, wk56 \u0026lt;dbl\u0026gt;, wk57 \u0026lt;dbl\u0026gt;, wk58 \u0026lt;dbl\u0026gt;,\r## # wk59 \u0026lt;dbl\u0026gt;, wk60 \u0026lt;dbl\u0026gt;, wk61 \u0026lt;dbl\u0026gt;, wk62 \u0026lt;dbl\u0026gt;, wk63 \u0026lt;dbl\u0026gt;, wk64 \u0026lt;dbl\u0026gt;,\r## # wk65 \u0026lt;dbl\u0026gt;\r Tanto pivot_longer quanto pivot_wider tem mais argumentos para lidar com situa√ß√µes complexas, como quando voc√™ precisa aplicar transforma√ß√µes em vari√°veis antes de reformatar o banco ou precisa utilizar m√∫ltiplas colunas, mas eu deixo isso para voc√™s descobrirem por conta pr√≥pria quando estiverem confort√°veis com a sintaxe b√°sica.\nO que os argumentos extra e fill em separate fazem? Utilize o exemplo a seguir como guia.  tibble(x = c(\u0026quot;a,b,c\u0026quot;, \u0026quot;d,e,f,g\u0026quot;, \u0026quot;h,i,j\u0026quot;)) %\u0026gt;% separate(x, c(\u0026quot;um\u0026quot;, \u0026quot;dois\u0026quot;, \u0026quot;tres\u0026quot;))\r ## Warning: Expected 3 pieces. Additional pieces discarded in 1 rows [2].\r ## # A tibble: 3 x 3\r## um dois tres ## \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt;\r## 1 a b c ## 2 d e f ## 3 h i j\r tibble(x = c(\u0026quot;a,b,c\u0026quot;, \u0026quot;d,e\u0026quot;, \u0026quot;f,g,i\u0026quot;)) %\u0026gt;% separate(x, c(\u0026quot;um\u0026quot;, \u0026quot;dois\u0026quot;, \u0026quot;tres\u0026quot;))\r ## Warning: Expected 3 pieces. Missing pieces filled with `NA` in 1 rows [2].\r ## # A tibble: 3 x 3\r## um dois tres ## \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt;\r## 1 a b c ## 2 d e \u0026lt;NA\u0026gt; ## 3 f g i\r Por padr√£o, separate espera que todas as colunas sendo separadas tenham o mesmo comprimento. Por exemplo, no primeiro caso, indicamos que vamos criar tr√™s novas colunas, chamadas de \u0026ldquo;um\u0026rdquo;, \u0026ldquo;dois\u0026rdquo; e \u0026ldquo;tres\u0026rdquo;. Mas os vetores tem tamanhos diferentes. Um deles tem 4 letras ao inv√©s de 3. No segundo exemplo, um deles tem duas letras ao inv√©s de tr√™s. Esse tipo de situa√ß√£o √© bastante comum quando lidamos com erros de digita√ß√£o. Ent√£o, o que fazer com o elemento que est√° sobrando ou faltando?\n# Sobrando\rtibble(x = c(\u0026quot;a,b,c\u0026quot;, \u0026quot;d,e,f,g\u0026quot;, \u0026quot;h,i,j\u0026quot;)) %\u0026gt;% separate(x, c(\u0026quot;um\u0026quot;, \u0026quot;dois\u0026quot;, \u0026quot;tres\u0026quot;), extra = \u0026quot;warn\u0026quot;) # avise que ocorreu (padr√£o)\r ## Warning: Expected 3 pieces. Additional pieces discarded in 1 rows [2].\r ## # A tibble: 3 x 3\r## um dois tres ## \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt;\r## 1 a b c ## 2 d e f ## 3 h i j\r tibble(x = c(\u0026quot;a,b,c\u0026quot;, \u0026quot;d,e,f,g\u0026quot;, \u0026quot;h,i,j\u0026quot;)) %\u0026gt;% separate(x, c(\u0026quot;um\u0026quot;, \u0026quot;dois\u0026quot;, \u0026quot;tres\u0026quot;), extra = \u0026quot;drop\u0026quot;) # descarte o que sobrou\r ## # A tibble: 3 x 3\r## um dois tres ## \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt;\r## 1 a b c ## 2 d e f ## 3 h i j\r tibble(x = c(\u0026quot;a,b,c\u0026quot;, \u0026quot;d,e,f,g\u0026quot;, \u0026quot;h,i,j\u0026quot;)) %\u0026gt;% separate(x, c(\u0026quot;um\u0026quot;, \u0026quot;dois\u0026quot;, \u0026quot;tres\u0026quot;), extra = \u0026quot;merge\u0026quot;) # junte com o √∫ltimo\r ## # A tibble: 3 x 3\r## um dois tres ## \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt;\r## 1 a b c ## 2 d e f,g ## 3 h i j\r # Note especialmente no √∫ltimo caso o que ocorreu com as colunas.\r# Faltando\rtibble(x = c(\u0026quot;a,b,c\u0026quot;, \u0026quot;d,e\u0026quot;, \u0026quot;f,g,i\u0026quot;)) %\u0026gt;% separate(x, c(\u0026quot;um\u0026quot;, \u0026quot;dois\u0026quot;, \u0026quot;tres\u0026quot;), fill = \u0026quot;warn\u0026quot;) # avise e preencha a direita\r ## Warning: Expected 3 pieces. Missing pieces filled with `NA` in 1 rows [2].\r ## # A tibble: 3 x 3\r## um dois tres ## \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt;\r## 1 a b c ## 2 d e \u0026lt;NA\u0026gt; ## 3 f g i\r tibble(x = c(\u0026quot;a,b,c\u0026quot;, \u0026quot;d,e\u0026quot;, \u0026quot;f,g,i\u0026quot;)) %\u0026gt;% separate(x, c(\u0026quot;um\u0026quot;, \u0026quot;dois\u0026quot;, \u0026quot;tres\u0026quot;), fill = \u0026quot;left\u0026quot;) # preencha a esquerda\r ## # A tibble: 3 x 3\r## um dois tres ## \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt;\r## 1 a b c ## 2 \u0026lt;NA\u0026gt; d e ## 3 f g i\r tibble(x = c(\u0026quot;a,b,c\u0026quot;, \u0026quot;d,e\u0026quot;, \u0026quot;f,g,i\u0026quot;)) %\u0026gt;% separate(x, c(\u0026quot;um\u0026quot;, \u0026quot;dois\u0026quot;, \u0026quot;tres\u0026quot;), fill = \u0026quot;right\u0026quot;) # preencha a direta\r ## # A tibble: 3 x 3\r## um dois tres ## \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt;\r## 1 a b c ## 2 d e \u0026lt;NA\u0026gt; ## 3 f g i\r # Note na sua sa√≠da do R como ficou a tibble e onde foram colocados NAs\r# em cada caso\r Tanto unite como separate possuem um argumento remove. Pra que ele serve e quando voc√™ o utilizaria no valor FALSE?  Acho que a melhor forma de compreender isso √© utilizar um banco de dados. Vamos pegar aquele da popula√ß√£o retirado da Wikip√©dia.\npopulacao \u0026lt;- tribble(\r~Rank, ~Country, ~Population,\t~'% of world', ~Day, ~Month, ~Year, ~Source,\r1L, \u0026quot;China\u0026quot;, 1411778724, \u0026quot;17.9%\u0026quot;, \u0026quot;1\u0026quot;, \u0026quot;Nov\u0026quot;, \u0026quot;2020\u0026quot;, \u0026quot;Seventh Census on 2020\u0026quot;,\r2L, \u0026quot;India\u0026quot;, 1377123716, \u0026quot;17.5%\u0026quot;, \u0026quot;19\u0026quot;, \u0026quot;May\u0026quot;, \u0026quot;2021\u0026quot;, \u0026quot;National population clock[3]\u0026quot;,\r3L, \u0026quot;United States\u0026quot;, 331695937, \u0026quot;4.22%\u0026quot;, \u0026quot;19\u0026quot;, \u0026quot;May\u0026quot;, \u0026quot;2021\u0026quot;, \u0026quot;National population clock[4]\u0026quot;,\r4L, \u0026quot;Indonesia\u0026quot;, 271350000, \u0026quot;3.45%\u0026quot;, \u0026quot;31\u0026quot;, \u0026quot;Dec\u0026quot;, \u0026quot;2020\u0026quot;, \u0026quot;National annual estimate[5]\u0026quot;,\r5L, \u0026quot;Pakistan\u0026quot;, 225200000, \u0026quot;2.86%\u0026quot;, \u0026quot;1\u0026quot;, \u0026quot;Jul\u0026quot;, \u0026quot;2021\u0026quot;, \u0026quot;UN projection[2]\u0026quot;,\r6L, \u0026quot;Brazil\u0026quot;, 213154869, \u0026quot;2.71%\u0026quot;, \u0026quot;19\u0026quot;, \u0026quot;May\u0026quot;, \u0026quot;2021\u0026quot;, \u0026quot;National population clock[6]\u0026quot;,\r7L, \u0026quot;Nigeria\u0026quot;, 211401000, \u0026quot;2.69%\u0026quot;, \u0026quot;1\u0026quot;, \u0026quot;Jul\u0026quot;, \u0026quot;2021\u0026quot;, \u0026quot;UN projection[2]\u0026quot;,\r8L, \u0026quot;Bangladesh\u0026quot;, 170689832, \u0026quot;2.17%\u0026quot;, \u0026quot;19\u0026quot;, \u0026quot;May\u0026quot;, \u0026quot;2021\u0026quot;, \u0026quot;National population clock[7]\u0026quot;,\r9L, \u0026quot;Russia\u0026quot;, 146171015, \u0026quot;1.86%\u0026quot;, \u0026quot;1\u0026quot;, \u0026quot;Jan\u0026quot;, \u0026quot;2021\u0026quot;, \u0026quot;National annual estimate[8]\u0026quot;,\r10L, \u0026quot;Mexico\u0026quot;, 126014024, \u0026quot;1.60%\u0026quot;, \u0026quot;2\u0026quot;, \u0026quot;Mar\u0026quot;, \u0026quot;2020\u0026quot;, \u0026quot;2020 census result[9]\u0026quot;\r)\rpopulacao\r ## # A tibble: 10 x 8\r## Rank Country Population `% of world` Day Month Year Source ## \u0026lt;int\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; ## 1 1 China 1411778724 17.9% 1 Nov 2020 Seventh Census o~\r## 2 2 India 1377123716 17.5% 19 May 2021 National populat~\r## 3 3 United Sta~ 331695937 4.22% 19 May 2021 National populat~\r## 4 4 Indonesia 271350000 3.45% 31 Dec 2020 National annual ~\r## 5 5 Pakistan 225200000 2.86% 1 Jul 2021 UN projection[2] ## 6 6 Brazil 213154869 2.71% 19 May 2021 National populat~\r## 7 7 Nigeria 211401000 2.69% 1 Jul 2021 UN projection[2] ## 8 8 Bangladesh 170689832 2.17% 19 May 2021 National populat~\r## 9 9 Russia 146171015 1.86% 1 Jan 2021 National annual ~\r## 10 10 Mexico 126014024 1.60% 2 Mar 2020 2020 census resu~\r Vamos ver dois exemplos, um com unite e outro com separate para exemplificar o que remove faz.\n# Unir as colunas Day, Month, Year, remove = TRUE\rpopulacao %\u0026gt;% unite(Data, Day, Month, Year, remove = TRUE) # padr√£o\r ## # A tibble: 10 x 6\r## Rank Country Population `% of world` Data Source ## \u0026lt;int\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; ## 1 1 China 1411778724 17.9% 1_Nov_2020 Seventh Census on 2020 ## 2 2 India 1377123716 17.5% 19_May_20~ National population cl~\r## 3 3 United Stat~ 331695937 4.22% 19_May_20~ National population cl~\r## 4 4 Indonesia 271350000 3.45% 31_Dec_20~ National annual estima~\r## 5 5 Pakistan 225200000 2.86% 1_Jul_2021 UN projection[2] ## 6 6 Brazil 213154869 2.71% 19_May_20~ National population cl~\r## 7 7 Nigeria 211401000 2.69% 1_Jul_2021 UN projection[2] ## 8 8 Bangladesh 170689832 2.17% 19_May_20~ National population cl~\r## 9 9 Russia 146171015 1.86% 1_Jan_2021 National annual estima~\r## 10 10 Mexico 126014024 1.60% 2_Mar_2020 2020 census result[9]\r # Unir as colunas Day, Month, Year, remove = FALSE\rpopulacao %\u0026gt;% unite(Data, Day, Month, Year, remove = FALSE)\r ## # A tibble: 10 x 9\r## Rank Country Population `% of world` Data Day Month Year Source ## \u0026lt;int\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; ## 1 1 China 1411778724 17.9% 1_Nov_~ 1 Nov 2020 Seventh Ce~\r## 2 2 India 1377123716 17.5% 19_May~ 19 May 2021 National p~\r## 3 3 United S~ 331695937 4.22% 19_May~ 19 May 2021 National p~\r## 4 4 Indonesia 271350000 3.45% 31_Dec~ 31 Dec 2020 National a~\r## 5 5 Pakistan 225200000 2.86% 1_Jul_~ 1 Jul 2021 UN project~\r## 6 6 Brazil 213154869 2.71% 19_May~ 19 May 2021 National p~\r## 7 7 Nigeria 211401000 2.69% 1_Jul_~ 1 Jul 2021 UN project~\r## 8 8 Banglade~ 170689832 2.17% 19_May~ 19 May 2021 National p~\r## 9 9 Russia 146171015 1.86% 1_Jan_~ 1 Jan 2021 National a~\r## 10 10 Mexico 126014024 1.60% 2_Mar_~ 2 Mar 2020 2020 censu~\r # Vejam o que aconteceu com as colunas nos dois bancos.\r Agora com separate: Separar a coluna year em s√©culo e ano, apenas como exemplo\n# remove = TRUE, padr√£o\rpopulacao %\u0026gt;% separate(Year, c(\u0026quot;seculo\u0026quot;, \u0026quot;ano\u0026quot;), sep = 2, remove = TRUE)\r ## # A tibble: 10 x 9\r## Rank Country Population `% of world` Day Month seculo ano Source ## \u0026lt;int\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; ## 1 1 China 1411778724 17.9% 1 Nov 20 20 Seventh Cen~\r## 2 2 India 1377123716 17.5% 19 May 20 21 National po~\r## 3 3 United S~ 331695937 4.22% 19 May 20 21 National po~\r## 4 4 Indonesia 271350000 3.45% 31 Dec 20 20 National an~\r## 5 5 Pakistan 225200000 2.86% 1 Jul 20 21 UN projecti~\r## 6 6 Brazil 213154869 2.71% 19 May 20 21 National po~\r## 7 7 Nigeria 211401000 2.69% 1 Jul 20 21 UN projecti~\r## 8 8 Banglade~ 170689832 2.17% 19 May 20 21 National po~\r## 9 9 Russia 146171015 1.86% 1 Jan 20 21 National an~\r## 10 10 Mexico 126014024 1.60% 2 Mar 20 20 2020 census~\r # remove = FALSE\rpopulacao %\u0026gt;% separate(Year, c(\u0026quot;seculo\u0026quot;, \u0026quot;ano\u0026quot;), sep = 2, remove = FALSE)\r ## # A tibble: 10 x 10\r## Rank Country Population `% of world` Day Month Year seculo ano Source ## \u0026lt;int\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; ## 1 1 China 1411778724 17.9% 1 Nov 2020 20 20 Sevent~\r## 2 2 India 1377123716 17.5% 19 May 2021 20 21 Nation~\r## 3 3 United ~ 331695937 4.22% 19 May 2021 20 21 Nation~\r## 4 4 Indones~ 271350000 3.45% 31 Dec 2020 20 20 Nation~\r## 5 5 Pakistan 225200000 2.86% 1 Jul 2021 20 21 UN pro~\r## 6 6 Brazil 213154869 2.71% 19 May 2021 20 21 Nation~\r## 7 7 Nigeria 211401000 2.69% 1 Jul 2021 20 21 UN pro~\r## 8 8 Banglad~ 170689832 2.17% 19 May 2021 20 21 Nation~\r## 9 9 Russia 146171015 1.86% 1 Jan 2021 20 21 Nation~\r## 10 10 Mexico 126014024 1.60% 2 Mar 2020 20 20 2020 c~\r # Vejam o que aconteceu com as colunas nos dois bancos.\r Eu gosto de utilizar esse argumento quando eu tenho d√∫vida sobre o resultado e quero fazer inspe√ß√£o visual para detectar eventuais problemas na separa√ß√£o ou jun√ß√£o. Uma vez que estou satisfeito com o resultado, em geral eu uso o remove=TRUE. Voc√™s tem que decidir se precisam manter as colunas originais ou se a coluna transformada √© o suficiente.\nCompare o argumento values_fill em pivot_wider e fill em complete. Qual √© a diferen√ßa?  A resposta curta √© simples: em pivot_wider, podemos ter aqueles missings \u0026ldquo;impl√≠citos\u0026rdquo; que n√£o apareciam no nosso banco longo e, durante a transforma√ß√£o, eles viram NAs nas colunas. √ì argumento values_fill indica um valor para ser preenchido no lugar de NA.\nEm complete, temos uma situa√ß√£o similar. O que fazer quando for encontrada uma combina√ß√£o de valores no banco longo que √© um \u0026ldquo;missing impl√≠cito\u0026rdquo;? Voc√™ pode especificar um valor padr√£o para preench√™-lo.\nS√£o fun√ß√µes similares, mas uma funciona sem reformatar o banco e a outra durante o processo de reformata√ß√£o. Veja um exemplo abaixo com aquela tibble das a√ß√µes.\nacoes \u0026lt;- tibble(\rano = c(2015, 2015, 2015, 2015, 2016, 2016, 2016),\rqdr = c( 1, 2, 3, 4, 2, 3, 4),\rlucro = c(1.88, 0.59, 0.35, NA, 0.92, 0.17, 2.66)\r)\racoes\r ## # A tibble: 7 x 3\r## ano qdr lucro\r## \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt;\r## 1 2015 1 1.88\r## 2 2015 2 0.59\r## 3 2015 3 0.35\r## 4 2015 4 NA ## 5 2016 2 0.92\r## 6 2016 3 0.17\r## 7 2016 4 2.66\r # Vamos supor que o NA impl√≠cito significa que a empresa teve # lucro = 0 naquele quadrimestre.\r# pivot_wider, values_fill\racoes %\u0026gt;% pivot_wider(\rid_cols = ano,\rnames_from = qdr,\rvalues_from = lucro,\rvalues_fill = 0\r)\r ## # A tibble: 2 x 5\r## ano `1` `2` `3` `4`\r## \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt;\r## 1 2015 1.88 0.59 0.35 NA ## 2 2016 0 0.92 0.17 2.66\r # complete, fill\racoes %\u0026gt;% complete(ano, qdr, fill = list(lucro = 0))\r ## # A tibble: 8 x 3\r## ano qdr lucro\r## \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt;\r## 1 2015 1 1.88\r## 2 2015 2 0.59\r## 3 2015 3 0.35\r## 4 2015 4 0 ## 5 2016 1 0 ## 6 2016 2 0.92\r## 7 2016 3 0.17\r## 8 2016 4 2.66\r Note o resultado. E note tamb√©m que values_fill em pivot_wider √© um pouco mais criterioso na hora de fazer as transforma√ß√µes.\nstringr, forcats e dplyr library(nycflights13)\r   Encontre os v√¥os que:\n  Atrasaram mais de duas horas\n  flights %\u0026gt;% filter(dep_delay \u0026gt; 120)\r ## # A tibble: 9,723 x 19\r## year month day dep_time sched_dep_time dep_delay arr_time sched_arr_time\r## \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;int\u0026gt; \u0026lt;int\u0026gt;\r## 1 2013 1 1 848 1835 853 1001 1950\r## 2 2013 1 1 957 733 144 1056 853\r## 3 2013 1 1 1114 900 134 1447 1222\r## 4 2013 1 1 1540 1338 122 2020 1825\r## 5 2013 1 1 1815 1325 290 2120 1542\r## 6 2013 1 1 1842 1422 260 1958 1535\r## 7 2013 1 1 1856 1645 131 2212 2005\r## 8 2013 1 1 1934 1725 129 2126 1855\r## 9 2013 1 1 1938 1703 155 2109 1823\r## 10 2013 1 1 1942 1705 157 2124 1830\r## # ... with 9,713 more rows, and 11 more variables: arr_delay \u0026lt;dbl\u0026gt;,\r## # carrier \u0026lt;chr\u0026gt;, flight \u0026lt;int\u0026gt;, tailnum \u0026lt;chr\u0026gt;, origin \u0026lt;chr\u0026gt;, dest \u0026lt;chr\u0026gt;,\r## # air_time \u0026lt;dbl\u0026gt;, distance \u0026lt;dbl\u0026gt;, hour \u0026lt;dbl\u0026gt;, minute \u0026lt;dbl\u0026gt;, time_hour \u0026lt;dttm\u0026gt;\r Com destino a Houston (IAH ou HOU)  flights %\u0026gt;% filter(dest %in% c(\u0026quot;IAH\u0026quot;, \u0026quot;HOU\u0026quot;))\r ## # A tibble: 9,313 x 19\r## year month day dep_time sched_dep_time dep_delay arr_time sched_arr_time\r## \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;int\u0026gt; \u0026lt;int\u0026gt;\r## 1 2013 1 1 517 515 2 830 819\r## 2 2013 1 1 533 529 4 850 830\r## 3 2013 1 1 623 627 -4 933 932\r## 4 2013 1 1 728 732 -4 1041 1038\r## 5 2013 1 1 739 739 0 1104 1038\r## 6 2013 1 1 908 908 0 1228 1219\r## 7 2013 1 1 1028 1026 2 1350 1339\r## 8 2013 1 1 1044 1045 -1 1352 1351\r## 9 2013 1 1 1114 900 134 1447 1222\r## 10 2013 1 1 1205 1200 5 1503 1505\r## # ... with 9,303 more rows, and 11 more variables: arr_delay \u0026lt;dbl\u0026gt;,\r## # carrier \u0026lt;chr\u0026gt;, flight \u0026lt;int\u0026gt;, tailnum \u0026lt;chr\u0026gt;, origin \u0026lt;chr\u0026gt;, dest \u0026lt;chr\u0026gt;,\r## # air_time \u0026lt;dbl\u0026gt;, distance \u0026lt;dbl\u0026gt;, hour \u0026lt;dbl\u0026gt;, minute \u0026lt;dbl\u0026gt;, time_hour \u0026lt;dttm\u0026gt;\r Operados pela United, American ou Delta  unique(flights$carrier)\r ## [1] \u0026quot;UA\u0026quot; \u0026quot;AA\u0026quot; \u0026quot;B6\u0026quot; \u0026quot;DL\u0026quot; \u0026quot;EV\u0026quot; \u0026quot;MQ\u0026quot; \u0026quot;US\u0026quot; \u0026quot;WN\u0026quot; \u0026quot;VX\u0026quot; \u0026quot;FL\u0026quot; \u0026quot;AS\u0026quot; \u0026quot;9E\u0026quot; \u0026quot;F9\u0026quot; \u0026quot;HA\u0026quot; \u0026quot;YV\u0026quot;\r## [16] \u0026quot;OO\u0026quot;\r flights %\u0026gt;% filter(carrier %in% c(\u0026quot;UA\u0026quot;, \u0026quot;AA\u0026quot;, \u0026quot;DL\u0026quot;))\r ## # A tibble: 139,504 x 19\r## year month day dep_time sched_dep_time dep_delay arr_time sched_arr_time\r## \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;int\u0026gt; \u0026lt;int\u0026gt;\r## 1 2013 1 1 517 515 2 830 819\r## 2 2013 1 1 533 529 4 850 830\r## 3 2013 1 1 542 540 2 923 850\r## 4 2013 1 1 554 600 -6 812 837\r## 5 2013 1 1 554 558 -4 740 728\r## 6 2013 1 1 558 600 -2 753 745\r## 7 2013 1 1 558 600 -2 924 917\r## 8 2013 1 1 558 600 -2 923 937\r## 9 2013 1 1 559 600 -1 941 910\r## 10 2013 1 1 559 600 -1 854 902\r## # ... with 139,494 more rows, and 11 more variables: arr_delay \u0026lt;dbl\u0026gt;,\r## # carrier \u0026lt;chr\u0026gt;, flight \u0026lt;int\u0026gt;, tailnum \u0026lt;chr\u0026gt;, origin \u0026lt;chr\u0026gt;, dest \u0026lt;chr\u0026gt;,\r## # air_time \u0026lt;dbl\u0026gt;, distance \u0026lt;dbl\u0026gt;, hour \u0026lt;dbl\u0026gt;, minute \u0026lt;dbl\u0026gt;, time_hour \u0026lt;dttm\u0026gt;\r Decolaram entre julho e setembro  flights %\u0026gt;% filter(between(month, 7, 9))\r ## # A tibble: 86,326 x 19\r## year month day dep_time sched_dep_time dep_delay arr_time sched_arr_time\r## \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;int\u0026gt; \u0026lt;int\u0026gt;\r## 1 2013 7 1 1 2029 212 236 2359\r## 2 2013 7 1 2 2359 3 344 344\r## 3 2013 7 1 29 2245 104 151 1\r## 4 2013 7 1 43 2130 193 322 14\r## 5 2013 7 1 44 2150 174 300 100\r## 6 2013 7 1 46 2051 235 304 2358\r## 7 2013 7 1 48 2001 287 308 2305\r## 8 2013 7 1 58 2155 183 335 43\r## 9 2013 7 1 100 2146 194 327 30\r## 10 2013 7 1 100 2245 135 337 135\r## # ... with 86,316 more rows, and 11 more variables: arr_delay \u0026lt;dbl\u0026gt;,\r## # carrier \u0026lt;chr\u0026gt;, flight \u0026lt;int\u0026gt;, tailnum \u0026lt;chr\u0026gt;, origin \u0026lt;chr\u0026gt;, dest \u0026lt;chr\u0026gt;,\r## # air_time \u0026lt;dbl\u0026gt;, distance \u0026lt;dbl\u0026gt;, hour \u0026lt;dbl\u0026gt;, minute \u0026lt;dbl\u0026gt;, time_hour \u0026lt;dttm\u0026gt;\r Chegaram com mais de duas horas de atraso, mas n√£o decolaram com atraso  flights %\u0026gt;% filter(arr_delay \u0026gt; 120, dep_delay \u0026lt;= 0)\r ## # A tibble: 29 x 19\r## year month day dep_time sched_dep_time dep_delay arr_time sched_arr_time\r## \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;int\u0026gt; \u0026lt;int\u0026gt;\r## 1 2013 1 27 1419 1420 -1 1754 1550\r## 2 2013 10 7 1350 1350 0 1736 1526\r## 3 2013 10 7 1357 1359 -2 1858 1654\r## 4 2013 10 16 657 700 -3 1258 1056\r## 5 2013 11 1 658 700 -2 1329 1015\r## 6 2013 3 18 1844 1847 -3 39 2219\r## 7 2013 4 17 1635 1640 -5 2049 1845\r## 8 2013 4 18 558 600 -2 1149 850\r## 9 2013 4 18 655 700 -5 1213 950\r## 10 2013 5 22 1827 1830 -3 2217 2010\r## # ... with 19 more rows, and 11 more variables: arr_delay \u0026lt;dbl\u0026gt;, carrier \u0026lt;chr\u0026gt;,\r## # flight \u0026lt;int\u0026gt;, tailnum \u0026lt;chr\u0026gt;, origin \u0026lt;chr\u0026gt;, dest \u0026lt;chr\u0026gt;, air_time \u0026lt;dbl\u0026gt;,\r## # distance \u0026lt;dbl\u0026gt;, hour \u0026lt;dbl\u0026gt;, minute \u0026lt;dbl\u0026gt;, time_hour \u0026lt;dttm\u0026gt;\r Atrasaram mais de uma hora para decolar, mas recuperaram mais de 30 minutos durante o voo  flights %\u0026gt;% filter(dep_delay \u0026gt; 60, dep_delay - arr_delay \u0026gt;= 30)\r ## # A tibble: 2,046 x 19\r## year month day dep_time sched_dep_time dep_delay arr_time sched_arr_time\r## \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;int\u0026gt; \u0026lt;int\u0026gt;\r## 1 2013 1 1 1716 1545 91 2140 2039\r## 2 2013 1 1 2205 1720 285 46 2040\r## 3 2013 1 1 2326 2130 116 131 18\r## 4 2013 1 3 1503 1221 162 1803 1555\r## 5 2013 1 3 1821 1530 171 2131 1910\r## 6 2013 1 3 1839 1700 99 2056 1950\r## 7 2013 1 3 1850 1745 65 2148 2120\r## 8 2013 1 3 1923 1815 68 2036 1958\r## 9 2013 1 3 1941 1759 102 2246 2139\r## 10 2013 1 3 1950 1845 65 2228 2227\r## # ... with 2,036 more rows, and 11 more variables: arr_delay \u0026lt;dbl\u0026gt;,\r## # carrier \u0026lt;chr\u0026gt;, flight \u0026lt;int\u0026gt;, tailnum \u0026lt;chr\u0026gt;, origin \u0026lt;chr\u0026gt;, dest \u0026lt;chr\u0026gt;,\r## # air_time \u0026lt;dbl\u0026gt;, distance \u0026lt;dbl\u0026gt;, hour \u0026lt;dbl\u0026gt;, minute \u0026lt;dbl\u0026gt;, time_hour \u0026lt;dttm\u0026gt;\r Decolaram entre a meia-noite e 6 da manh√£ (inclusive)  flights %\u0026gt;% filter(between(hour, 0, 5) | (hour == 6 \u0026amp; minute == 0))\r ## # A tibble: 8,970 x 19\r## year month day dep_time sched_dep_time dep_delay arr_time sched_arr_time\r## \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;int\u0026gt; \u0026lt;int\u0026gt;\r## 1 2013 1 1 517 515 2 830 819\r## 2 2013 1 1 533 529 4 850 830\r## 3 2013 1 1 542 540 2 923 850\r## 4 2013 1 1 544 545 -1 1004 1022\r## 5 2013 1 1 554 600 -6 812 837\r## 6 2013 1 1 554 558 -4 740 728\r## 7 2013 1 1 555 600 -5 913 854\r## 8 2013 1 1 557 600 -3 709 723\r## 9 2013 1 1 557 600 -3 838 846\r## 10 2013 1 1 558 600 -2 753 745\r## # ... with 8,960 more rows, and 11 more variables: arr_delay \u0026lt;dbl\u0026gt;,\r## # carrier \u0026lt;chr\u0026gt;, flight \u0026lt;int\u0026gt;, tailnum \u0026lt;chr\u0026gt;, origin \u0026lt;chr\u0026gt;, dest \u0026lt;chr\u0026gt;,\r## # air_time \u0026lt;dbl\u0026gt;, distance \u0026lt;dbl\u0026gt;, hour \u0026lt;dbl\u0026gt;, minute \u0026lt;dbl\u0026gt;, time_hour \u0026lt;dttm\u0026gt;\r Reordene suas colunas para encontrar os voos mais r√°pidos (maior velocidade de voo).  flights %\u0026gt;% select(air_time, distance) %\u0026gt;% mutate(speed = distance/air_time) %\u0026gt;% arrange(desc(speed))\r ## # A tibble: 336,776 x 3\r## air_time distance speed\r## \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt;\r## 1 65 762 11.7 ## 2 93 1008 10.8 ## 3 55 594 10.8 ## 4 70 748 10.7 ## 5 105 1035 9.86\r## 6 170 1598 9.4 ## 7 172 1598 9.29\r## 8 175 1623 9.27\r## 9 173 1598 9.24\r## 10 173 1598 9.24\r## # ... with 336,766 more rows\r Teste v√°rias maneiras diferentes de selecionar as vari√°veis dep_time, dep_delay, arr_time e arr_delay usando as v√°rias helper functions de select.  flights %\u0026gt;% select(dep_time, dep_delay, arr_time, arr_delay)\r ## # A tibble: 336,776 x 4\r## dep_time dep_delay arr_time arr_delay\r## \u0026lt;int\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;int\u0026gt; \u0026lt;dbl\u0026gt;\r## 1 517 2 830 11\r## 2 533 4 850 20\r## 3 542 2 923 33\r## 4 544 -1 1004 -18\r## 5 554 -6 812 -25\r## 6 554 -4 740 12\r## 7 555 -5 913 19\r## 8 557 -3 709 -14\r## 9 557 -3 838 -8\r## 10 558 -2 753 8\r## # ... with 336,766 more rows\r flights %\u0026gt;% select(starts_with(\u0026quot;dep\u0026quot;), starts_with(\u0026quot;arr\u0026quot;))\r ## # A tibble: 336,776 x 4\r## dep_time dep_delay arr_time arr_delay\r## \u0026lt;int\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;int\u0026gt; \u0026lt;dbl\u0026gt;\r## 1 517 2 830 11\r## 2 533 4 850 20\r## 3 542 2 923 33\r## 4 544 -1 1004 -18\r## 5 554 -6 812 -25\r## 6 554 -4 740 12\r## 7 555 -5 913 19\r## 8 557 -3 709 -14\r## 9 557 -3 838 -8\r## 10 558 -2 753 8\r## # ... with 336,766 more rows\r flights %\u0026gt;% select(starts_with(c(\u0026quot;dep\u0026quot;, \u0026quot;arr\u0026quot;)))\r ## # A tibble: 336,776 x 4\r## dep_time dep_delay arr_time arr_delay\r## \u0026lt;int\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;int\u0026gt; \u0026lt;dbl\u0026gt;\r## 1 517 2 830 11\r## 2 533 4 850 20\r## 3 542 2 923 33\r## 4 544 -1 1004 -18\r## 5 554 -6 812 -25\r## 6 554 -4 740 12\r## 7 555 -5 913 19\r## 8 557 -3 709 -14\r## 9 557 -3 838 -8\r## 10 558 -2 753 8\r## # ... with 336,766 more rows\r flights %\u0026gt;% select(matches(\u0026quot;^arr|^dep\u0026quot;))\r ## # A tibble: 336,776 x 4\r## dep_time dep_delay arr_time arr_delay\r## \u0026lt;int\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;int\u0026gt; \u0026lt;dbl\u0026gt;\r## 1 517 2 830 11\r## 2 533 4 850 20\r## 3 542 2 923 33\r## 4 544 -1 1004 -18\r## 5 554 -6 812 -25\r## 6 554 -4 740 12\r## 7 555 -5 913 19\r## 8 557 -3 709 -14\r## 9 557 -3 838 -8\r## 10 558 -2 753 8\r## # ... with 336,766 more rows\r flights %\u0026gt;% select(!starts_with(c(\u0026quot;sched\u0026quot;, \u0026quot;car\u0026quot;)) \u0026amp; contains(c(\u0026quot;dep\u0026quot;, \u0026quot;arr\u0026quot;)))\r ## # A tibble: 336,776 x 4\r## dep_time dep_delay arr_time arr_delay\r## \u0026lt;int\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;int\u0026gt; \u0026lt;dbl\u0026gt;\r## 1 517 2 830 11\r## 2 533 4 850 20\r## 3 542 2 923 33\r## 4 544 -1 1004 -18\r## 5 554 -6 812 -25\r## 6 554 -4 740 12\r## 7 555 -5 913 19\r## 8 557 -3 709 -14\r## 9 557 -3 838 -8\r## 10 558 -2 753 8\r## # ... with 336,766 more rows\r flights %\u0026gt;% select(ends_with(c(\u0026quot;time\u0026quot;, \u0026quot;delay\u0026quot;)) \u0026amp; !starts_with(c(\u0026quot;sched\u0026quot;, \u0026quot;air\u0026quot;)))\r ## # A tibble: 336,776 x 4\r## dep_time arr_time dep_delay arr_delay\r## \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt;\r## 1 517 830 2 11\r## 2 533 850 4 20\r## 3 542 923 2 33\r## 4 544 1004 -1 -18\r## 5 554 812 -6 -25\r## 6 554 740 -4 12\r## 7 555 913 -5 19\r## 8 557 709 -3 -14\r## 9 557 838 -3 -8\r## 10 558 753 -2 8\r## # ... with 336,766 more rows\r As vari√°veis dep_time e sched_dep_time est√£o num formato incorreto (veja ?flights). Converta-as com mutate para um valor em minutos passados desde a meia-noite. Dica: utilize %/% e %%.  flights %\u0026gt;% mutate(\rdep_hour = dep_time %/% 100,\rdep_minute = dep_time %% 100,\rsched_dep_hour = sched_dep_time %/% 100,\rsched_arr_minute = sched_arr_time %% 100\r)\r ## # A tibble: 336,776 x 23\r## year month day dep_time sched_dep_time dep_delay arr_time sched_arr_time\r## \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;int\u0026gt; \u0026lt;int\u0026gt;\r## 1 2013 1 1 517 515 2 830 819\r## 2 2013 1 1 533 529 4 850 830\r## 3 2013 1 1 542 540 2 923 850\r## 4 2013 1 1 544 545 -1 1004 1022\r## 5 2013 1 1 554 600 -6 812 837\r## 6 2013 1 1 554 558 -4 740 728\r## 7 2013 1 1 555 600 -5 913 854\r## 8 2013 1 1 557 600 -3 709 723\r## 9 2013 1 1 557 600 -3 838 846\r## 10 2013 1 1 558 600 -2 753 745\r## # ... with 336,766 more rows, and 15 more variables: arr_delay \u0026lt;dbl\u0026gt;,\r## # carrier \u0026lt;chr\u0026gt;, flight \u0026lt;int\u0026gt;, tailnum \u0026lt;chr\u0026gt;, origin \u0026lt;chr\u0026gt;, dest \u0026lt;chr\u0026gt;,\r## # air_time \u0026lt;dbl\u0026gt;, distance \u0026lt;dbl\u0026gt;, hour \u0026lt;dbl\u0026gt;, minute \u0026lt;dbl\u0026gt;, time_hour \u0026lt;dttm\u0026gt;,\r## # dep_hour \u0026lt;dbl\u0026gt;, dep_minute \u0026lt;dbl\u0026gt;, sched_dep_hour \u0026lt;dbl\u0026gt;,\r## # sched_arr_minute \u0026lt;dbl\u0026gt;\r # H√° uma outra solu√ß√£o com separate!\rflights %\u0026gt;% separate(\rcol = dep_time,\rinto = c(\u0026quot;dep_hour\u0026quot;, \u0026quot;dep_minute\u0026quot;),\rsep = 1,\r# Esse argumento √© importante! Teste com FALSE para ver a diferen√ßa\rconvert = TRUE) %\u0026gt;% separate(\rcol = sched_dep_time,\rinto = c(\u0026quot;sched_dep_hour\u0026quot;, \u0026quot;sched_dep_minute\u0026quot;),\rsep = 1,\rconvert = TRUE)\r ## # A tibble: 336,776 x 21\r## year month day dep_hour dep_minute sched_dep_hour sched_dep_minute\r## \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;int\u0026gt;\r## 1 2013 1 1 5 17 5 15\r## 2 2013 1 1 5 33 5 29\r## 3 2013 1 1 5 42 5 40\r## 4 2013 1 1 5 44 5 45\r## 5 2013 1 1 5 54 6 0\r## 6 2013 1 1 5 54 5 58\r## 7 2013 1 1 5 55 6 0\r## 8 2013 1 1 5 57 6 0\r## 9 2013 1 1 5 57 6 0\r## 10 2013 1 1 5 58 6 0\r## # ... with 336,766 more rows, and 14 more variables: dep_delay \u0026lt;dbl\u0026gt;,\r## # arr_time \u0026lt;int\u0026gt;, sched_arr_time \u0026lt;int\u0026gt;, arr_delay \u0026lt;dbl\u0026gt;, carrier \u0026lt;chr\u0026gt;,\r## # flight \u0026lt;int\u0026gt;, tailnum \u0026lt;chr\u0026gt;, origin \u0026lt;chr\u0026gt;, dest \u0026lt;chr\u0026gt;, air_time \u0026lt;dbl\u0026gt;,\r## # distance \u0026lt;dbl\u0026gt;, hour \u0026lt;dbl\u0026gt;, minute \u0026lt;dbl\u0026gt;, time_hour \u0026lt;dttm\u0026gt;\r Existe uma outra solu√ß√£o poss√≠vel para essa quest√£o usando manipula√ß√£o de strings, com str_sub tamb√©m. Fica como desafio!\nPensando na legibilidade do c√≥digo e na flexibilidade da abordagem, qual das duas solu√ß√µes acima voc√™ implementaria? mutate ou duas separate? Reflita.\nO que o c√≥digo abaixo est√° fazendo? Porque mesmo ap√≥s o c√≥digo abaixo continuam existindo diferen√ßas entre os valores das vari√°veis air_time e travel_time?  flights %\u0026gt;% select(air_time, dep_time, arr_time, dep_delay, arr_delay) %\u0026gt;% mutate(dep_hour = dep_time %/% 100,\rdep_min = dep_time %% 100,\rdep_time2 = dep_hour * 60 + dep_min,\rarr_hour = arr_time %/% 100,\rarr_min = arr_time %% 100,\rarr_time2 = arr_hour * 60 + arr_min,\rtravel_time = arr_time2 - dep_time2) %\u0026gt;% select(-dep_hour, -dep_min, -arr_hour, -arr_min)\r ## # A tibble: 336,776 x 8\r## air_time dep_time arr_time dep_delay arr_delay dep_time2 arr_time2\r## \u0026lt;dbl\u0026gt; \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt;\r## 1 227 517 830 2 11 317 510\r## 2 227 533 850 4 20 333 530\r## 3 160 542 923 2 33 342 563\r## 4 183 544 1004 -1 -18 344 604\r## 5 116 554 812 -6 -25 354 492\r## 6 150 554 740 -4 12 354 460\r## 7 158 555 913 -5 19 355 553\r## 8 53 557 709 -3 -14 357 429\r## 9 140 557 838 -3 -8 357 518\r## 10 138 558 753 -2 8 358 473\r## # ... with 336,766 more rows, and 1 more variable: travel_time \u0026lt;dbl\u0026gt;\r Essa tem uma resposta mais qualitativa. A primeira parte √© parecida com a quest√£o anterior, mas estamos manualmente tentando calcular os tempos de viagem. Acontece que os valores n√£o batem com os tempos de v√¥o identificados no banco. Isso se deve a pelo menos tr√™s quest√µes distintas.\n Uma delas diz respeito ao registro dos tempos, a defini√ß√£o de air_time pode n√£o estar considerando tempos em que o avi√£o est√° manobrando ou em solo ou mesmo podem existir erros de preenchimento. A segunda diz respeito ao fuso hor√°rio distinto entre aeroportos de sa√≠da e chegada, que complica o c√°lculo dos tempos reais, ent√£o nosso c√°lculo est√° muito cru para identificar isso. A √∫ltima quest√£o s√£o os v√¥os longos, que come√ßam em um dia e terminam no dia seguinte, que podem prejudicar nosso m√©todo de c√°lculo. Para corrigir alguns desses problemas, voc√™ precisaria escrever um c√≥digo que minimamente levasse essas quest√µes em considera√ß√£o. Como esse n√£o √© o objetivo do curso, eu deixo para quem quiser tentar. H√° uma solu√ß√£o postada aqui.  Use o stringr para concatenar as seguintes strings em uma frase  x \u0026lt;- \u0026quot;.\u0026quot;\ry \u0026lt;- \u0026quot;feliz\u0026quot;\rw \u0026lt;- \u0026quot;acordei\u0026quot;\rz \u0026lt;- \u0026quot;hoje\u0026quot;\rstr_c(z, w, y, sep = \u0026quot; \u0026quot;) %\u0026gt;% str_c(x, sep = \u0026quot;\u0026quot;) %\u0026gt;% str_to_sentence()\r ## [1] \u0026quot;Hoje acordei feliz.\u0026quot;\r Corrija as inconsist√™ncias nas colunas pa√≠s, primeiro_nome, segundo_nome e crie uma nova coluna nomes contendo as duas anteriores. No final, ordene o banco em ordem alfab√©tica.  df \u0026lt;- tibble::tribble(\r~pais, ~primeiro_nome, ~segundo_nome,\r# -------|----------------|-------------|\r\u0026quot;BRASIL\u0026quot;, \u0026quot;ISABELA\u0026quot;, \u0026quot;MARTINS\u0026quot;,\r\u0026quot;Brasil\u0026quot;, \u0026quot;Eduardo\u0026quot;, \u0026quot;cabellos\u0026quot;,\r\u0026quot;brasil\u0026quot;, \u0026quot;m√°rcia\u0026quot;, \u0026quot;pinto\u0026quot;,\r\u0026quot;bRaSiL\u0026quot;, \u0026quot;rog√©rio\u0026quot;, \u0026quot;Marinho\u0026quot;,\r)\r# Sem dplyr\rdf$pais \u0026lt;- str_to_title(df$pais)\rdf$primeiro_nome \u0026lt;- str_to_title(df$primeiro_nome)\rdf$segundo_nome \u0026lt;- str_to_title(df$segundo_nome)\rdf \u0026lt;- df %\u0026gt;% tidyr::unite(nomes, primeiro_nome, segundo_nome, sep = \u0026quot; \u0026quot;)\rdf[ str_order(df$nomes), ]\r ## # A tibble: 4 x 2\r## pais nomes ## \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; ## 1 Brasil Eduardo Cabellos\r## 2 Brasil Isabela Martins ## 3 Brasil M√°rcia Pinto ## 4 Brasil Rog√©rio Marinho\r # Com dplyr\rdf \u0026lt;- tibble::tribble(\r~pais, ~primeiro_nome, ~segundo_nome,\r# -------|----------------|-------------|\r\u0026quot;BRASIL\u0026quot;, \u0026quot;ISABELA\u0026quot;, \u0026quot;MARTINS\u0026quot;,\r\u0026quot;Brasil\u0026quot;, \u0026quot;Eduardo\u0026quot;, \u0026quot;cabellos\u0026quot;,\r\u0026quot;brasil\u0026quot;, \u0026quot;m√°rcia\u0026quot;, \u0026quot;pinto\u0026quot;,\r\u0026quot;bRaSiL\u0026quot;, \u0026quot;rog√©rio\u0026quot;, \u0026quot;Marinho\u0026quot;,\r)\rdf %\u0026gt;% mutate(pais = str_to_title(pais),\rprimeiro_nome = str_to_title(primeiro_nome),\rsegundo_nome = str_to_title(segundo_nome)) %\u0026gt;% unite(nomes, primeiro_nome, segundo_nome, sep = \u0026quot; \u0026quot;) %\u0026gt;% arrange(str_order(nomes))\r ## # A tibble: 4 x 2\r## pais nomes ## \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; ## 1 Brasil Eduardo Cabellos\r## 2 Brasil Isabela Martins ## 3 Brasil M√°rcia Pinto ## 4 Brasil Rog√©rio Marinho\r Transforme a string c(\u0026quot;Seu nome\u0026quot;, \u0026quot;Seu sobrenome da m√£e\u0026quot;, \u0026quot;Seu sobrenome do pai\u0026quot;) na string \u0026quot;SEU SOBRENOME DO PAI, sua inicial do nome. sua inicial da m√£e.\u0026quot;, como numa cita√ß√£o. Veja o exemplo abaixo:  # Transforme\rc(\u0026quot;Vin√≠cius\u0026quot;, \u0026quot;de Souza\u0026quot;, \u0026quot;Maia\u0026quot;)\r ## [1] \u0026quot;Vin√≠cius\u0026quot; \u0026quot;de Souza\u0026quot; \u0026quot;Maia\u0026quot;\r # Resultado\r\u0026quot;MAIA, V. S.\u0026quot;\r ## [1] \u0026quot;MAIA, V. S.\u0026quot;\r x \u0026lt;- c(\u0026quot;Vin√≠cius\u0026quot;, \u0026quot;de Souza\u0026quot;, \u0026quot;Maia\u0026quot;)\rx[1] \u0026lt;- str_sub(x[1], 1, 1) %\u0026gt;% str_c(\u0026quot;.\u0026quot;)\rx[2] \u0026lt;- str_sub(x[2], 4, 4) %\u0026gt;% str_c(\u0026quot;.\u0026quot;)\rx[3] \u0026lt;- str_to_upper(x[3])\rstr_c(c(x[3], x[1], x[2]), collapse = \u0026quot; \u0026quot;)\r ## [1] \u0026quot;MAIA V. S.\u0026quot;\r DESAFIO: Nos microdados da √°rea de sa√∫de, √© comum que a vari√°vel idade esteja registrada da seguinte forma: \u0026ldquo;150\u0026rdquo;, \u0026ldquo;219\u0026rdquo;, \u0026ldquo;312\u0026rdquo;, \u0026ldquo;471\u0026rdquo;. Esses c√≥digos indicam primeiro qual a unidade de medida da idade e segundo o valor desta unidade, 1 = horas, 2 = dias, 3 = meses, 4 = anos. Proponha um c√≥digo usando stringr para transformar o vetor abaixo em um valor num√©rico.  # N√£o precisa se preocupar com essa parte\rx \u0026lt;- as.character(round(c(\rrunif(25, 100, 124),\rrunif(25, 201, 230),\rrunif(25, 301, 312),\rrunif(25, 401, 499)\r)))\r# Como voc√™ transformaria esse vetor em n√∫mero?\rx\r ## [1] \u0026quot;118\u0026quot; \u0026quot;114\u0026quot; \u0026quot;118\u0026quot; \u0026quot;120\u0026quot; \u0026quot;109\u0026quot; \u0026quot;104\u0026quot; \u0026quot;114\u0026quot; \u0026quot;117\u0026quot; \u0026quot;122\u0026quot; \u0026quot;109\u0026quot; \u0026quot;110\u0026quot; \u0026quot;113\u0026quot;\r## [13] \u0026quot;106\u0026quot; \u0026quot;100\u0026quot; \u0026quot;122\u0026quot; \u0026quot;121\u0026quot; \u0026quot;124\u0026quot; \u0026quot;124\u0026quot; \u0026quot;110\u0026quot; \u0026quot;100\u0026quot; \u0026quot;117\u0026quot; \u0026quot;119\u0026quot; \u0026quot;105\u0026quot; \u0026quot;118\u0026quot;\r## [25] \u0026quot;122\u0026quot; \u0026quot;201\u0026quot; \u0026quot;205\u0026quot; \u0026quot;212\u0026quot; \u0026quot;216\u0026quot; \u0026quot;228\u0026quot; \u0026quot;213\u0026quot; \u0026quot;227\u0026quot; \u0026quot;221\u0026quot; \u0026quot;214\u0026quot; \u0026quot;227\u0026quot; \u0026quot;206\u0026quot;\r## [37] \u0026quot;207\u0026quot; \u0026quot;215\u0026quot; \u0026quot;224\u0026quot; \u0026quot;223\u0026quot; \u0026quot;203\u0026quot; \u0026quot;221\u0026quot; \u0026quot;215\u0026quot; \u0026quot;225\u0026quot; \u0026quot;210\u0026quot; \u0026quot;208\u0026quot; \u0026quot;219\u0026quot; \u0026quot;207\u0026quot;\r## [49] \u0026quot;221\u0026quot; \u0026quot;227\u0026quot; \u0026quot;310\u0026quot; \u0026quot;305\u0026quot; \u0026quot;301\u0026quot; \u0026quot;304\u0026quot; \u0026quot;310\u0026quot; \u0026quot;307\u0026quot; \u0026quot;305\u0026quot; \u0026quot;309\u0026quot; \u0026quot;308\u0026quot; \u0026quot;306\u0026quot;\r## [61] \u0026quot;308\u0026quot; \u0026quot;305\u0026quot; \u0026quot;304\u0026quot; \u0026quot;303\u0026quot; \u0026quot;306\u0026quot; \u0026quot;302\u0026quot; \u0026quot;310\u0026quot; \u0026quot;306\u0026quot; \u0026quot;301\u0026quot; \u0026quot;310\u0026quot; \u0026quot;306\u0026quot; \u0026quot;304\u0026quot;\r## [73] \u0026quot;305\u0026quot; \u0026quot;304\u0026quot; \u0026quot;307\u0026quot; \u0026quot;401\u0026quot; \u0026quot;459\u0026quot; \u0026quot;429\u0026quot; \u0026quot;435\u0026quot; \u0026quot;435\u0026quot; \u0026quot;415\u0026quot; \u0026quot;475\u0026quot; \u0026quot;414\u0026quot; \u0026quot;419\u0026quot;\r## [85] \u0026quot;495\u0026quot; \u0026quot;475\u0026quot; \u0026quot;431\u0026quot; \u0026quot;460\u0026quot; \u0026quot;478\u0026quot; \u0026quot;447\u0026quot; \u0026quot;436\u0026quot; \u0026quot;412\u0026quot; \u0026quot;403\u0026quot; \u0026quot;423\u0026quot; \u0026quot;467\u0026quot; \u0026quot;438\u0026quot;\r## [97] \u0026quot;475\u0026quot; \u0026quot;467\u0026quot; \u0026quot;418\u0026quot; \u0026quot;476\u0026quot;\r # Esse exerc√≠cio √© um pouco mais dif√≠cil mesmo!\rx %\u0026gt;% str_extract(\u0026quot;\\\\d\u0026quot;)\r ## [1] \u0026quot;1\u0026quot; \u0026quot;1\u0026quot; \u0026quot;1\u0026quot; \u0026quot;1\u0026quot; \u0026quot;1\u0026quot; \u0026quot;1\u0026quot; \u0026quot;1\u0026quot; \u0026quot;1\u0026quot; \u0026quot;1\u0026quot; \u0026quot;1\u0026quot; \u0026quot;1\u0026quot; \u0026quot;1\u0026quot; \u0026quot;1\u0026quot; \u0026quot;1\u0026quot; \u0026quot;1\u0026quot; \u0026quot;1\u0026quot; \u0026quot;1\u0026quot; \u0026quot;1\u0026quot;\r## [19] \u0026quot;1\u0026quot; \u0026quot;1\u0026quot; \u0026quot;1\u0026quot; \u0026quot;1\u0026quot; \u0026quot;1\u0026quot; \u0026quot;1\u0026quot; \u0026quot;1\u0026quot; \u0026quot;2\u0026quot; \u0026quot;2\u0026quot; \u0026quot;2\u0026quot; \u0026quot;2\u0026quot; \u0026quot;2\u0026quot; \u0026quot;2\u0026quot; \u0026quot;2\u0026quot; \u0026quot;2\u0026quot; \u0026quot;2\u0026quot; \u0026quot;2\u0026quot; \u0026quot;2\u0026quot;\r## [37] \u0026quot;2\u0026quot; \u0026quot;2\u0026quot; \u0026quot;2\u0026quot; \u0026quot;2\u0026quot; \u0026quot;2\u0026quot; \u0026quot;2\u0026quot; \u0026quot;2\u0026quot; \u0026quot;2\u0026quot; \u0026quot;2\u0026quot; \u0026quot;2\u0026quot; \u0026quot;2\u0026quot; \u0026quot;2\u0026quot; \u0026quot;2\u0026quot; \u0026quot;2\u0026quot; \u0026quot;3\u0026quot; \u0026quot;3\u0026quot; \u0026quot;3\u0026quot; \u0026quot;3\u0026quot;\r## [55] \u0026quot;3\u0026quot; \u0026quot;3\u0026quot; \u0026quot;3\u0026quot; \u0026quot;3\u0026quot; \u0026quot;3\u0026quot; \u0026quot;3\u0026quot; \u0026quot;3\u0026quot; \u0026quot;3\u0026quot; \u0026quot;3\u0026quot; \u0026quot;3\u0026quot; \u0026quot;3\u0026quot; \u0026quot;3\u0026quot; \u0026quot;3\u0026quot; \u0026quot;3\u0026quot; \u0026quot;3\u0026quot; \u0026quot;3\u0026quot; \u0026quot;3\u0026quot; \u0026quot;3\u0026quot;\r## [73] \u0026quot;3\u0026quot; \u0026quot;3\u0026quot; \u0026quot;3\u0026quot; \u0026quot;4\u0026quot; \u0026quot;4\u0026quot; \u0026quot;4\u0026quot; \u0026quot;4\u0026quot; \u0026quot;4\u0026quot; \u0026quot;4\u0026quot; \u0026quot;4\u0026quot; \u0026quot;4\u0026quot; \u0026quot;4\u0026quot; \u0026quot;4\u0026quot; \u0026quot;4\u0026quot; \u0026quot;4\u0026quot; \u0026quot;4\u0026quot; \u0026quot;4\u0026quot; \u0026quot;4\u0026quot;\r## [91] \u0026quot;4\u0026quot; \u0026quot;4\u0026quot; \u0026quot;4\u0026quot; \u0026quot;4\u0026quot; \u0026quot;4\u0026quot; \u0026quot;4\u0026quot; \u0026quot;4\u0026quot; \u0026quot;4\u0026quot; \u0026quot;4\u0026quot; \u0026quot;4\u0026quot;\r tibble(\rtipo_idade = str_sub(x, 1, 1),\ridade = str_sub(x, 2, 3),\ridade_anos =\rif_else(\rstr_detect(tipo_idade, \u0026quot;1\u0026quot;),\ras.numeric(idade) / (24 * 30 * 12),\rif_else(\rstr_detect(tipo_idade, \u0026quot;2\u0026quot;),\ras.numeric(idade) / (30 * 12),\rif_else(\rstr_detect(tipo_idade, \u0026quot;3\u0026quot;),\ras.numeric(idade) / 12,\ras.numeric(idade)\r)\r)\r)\r) %\u0026gt;% print(n = Inf)\r ## # A tibble: 100 x 3\r## tipo_idade idade idade_anos\r## \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt;\r## 1 1 18 0.00208 ## 2 1 14 0.00162 ## 3 1 18 0.00208 ## 4 1 20 0.00231 ## 5 1 09 0.00104 ## 6 1 04 0.000463\r## 7 1 14 0.00162 ## 8 1 17 0.00197 ## 9 1 22 0.00255 ## 10 1 09 0.00104 ## 11 1 10 0.00116 ## 12 1 13 0.00150 ## 13 1 06 0.000694\r## 14 1 00 0 ## 15 1 22 0.00255 ## 16 1 21 0.00243 ## 17 1 24 0.00278 ## 18 1 24 0.00278 ## 19 1 10 0.00116 ## 20 1 00 0 ## 21 1 17 0.00197 ## 22 1 19 0.00220 ## 23 1 05 0.000579\r## 24 1 18 0.00208 ## 25 1 22 0.00255 ## 26 2 01 0.00278 ## 27 2 05 0.0139 ## 28 2 12 0.0333 ## 29 2 16 0.0444 ## 30 2 28 0.0778 ## 31 2 13 0.0361 ## 32 2 27 0.075 ## 33 2 21 0.0583 ## 34 2 14 0.0389 ## 35 2 27 0.075 ## 36 2 06 0.0167 ## 37 2 07 0.0194 ## 38 2 15 0.0417 ## 39 2 24 0.0667 ## 40 2 23 0.0639 ## 41 2 03 0.00833 ## 42 2 21 0.0583 ## 43 2 15 0.0417 ## 44 2 25 0.0694 ## 45 2 10 0.0278 ## 46 2 08 0.0222 ## 47 2 19 0.0528 ## 48 2 07 0.0194 ## 49 2 21 0.0583 ## 50 2 27 0.075 ## 51 3 10 0.833 ## 52 3 05 0.417 ## 53 3 01 0.0833 ## 54 3 04 0.333 ## 55 3 10 0.833 ## 56 3 07 0.583 ## 57 3 05 0.417 ## 58 3 09 0.75 ## 59 3 08 0.667 ## 60 3 06 0.5 ## 61 3 08 0.667 ## 62 3 05 0.417 ## 63 3 04 0.333 ## 64 3 03 0.25 ## 65 3 06 0.5 ## 66 3 02 0.167 ## 67 3 10 0.833 ## 68 3 06 0.5 ## 69 3 01 0.0833 ## 70 3 10 0.833 ## 71 3 06 0.5 ## 72 3 04 0.333 ## 73 3 05 0.417 ## 74 3 04 0.333 ## 75 3 07 0.583 ## 76 4 01 1 ## 77 4 59 59 ## 78 4 29 29 ## 79 4 35 35 ## 80 4 35 35 ## 81 4 15 15 ## 82 4 75 75 ## 83 4 14 14 ## 84 4 19 19 ## 85 4 95 95 ## 86 4 75 75 ## 87 4 31 31 ## 88 4 60 60 ## 89 4 78 78 ## 90 4 47 47 ## 91 4 36 36 ## 92 4 12 12 ## 93 4 03 3 ## 94 4 23 23 ## 95 4 67 67 ## 96 4 38 38 ## 97 4 75 75 ## 98 4 67 67 ## 99 4 18 18 ## 100 4 76 76\r Ao inv√©s de utilizar essas chamadas recursivas de if_else, que s√£o muito ruins de ler, como voc√™ poderia reescrever a condi√ß√£o usando case_when?\nExplore as contagens da vari√°vel rincome em gss_cat, ela ficaria bem representada num gr√°fico? De qual tipo?  gss_cat %\u0026gt;% count(rincome)\r ## # A tibble: 16 x 2\r## rincome n\r## \u0026lt;fct\u0026gt; \u0026lt;int\u0026gt;\r## 1 No answer 183\r## 2 Don't know 267\r## 3 Refused 975\r## 4 $25000 or more 7363\r## 5 $20000 - 24999 1283\r## 6 $15000 - 19999 1048\r## 7 $10000 - 14999 1168\r## 8 $8000 to 9999 340\r## 9 $7000 to 7999 188\r## 10 $6000 to 6999 215\r## 11 $5000 to 5999 227\r## 12 $4000 to 4999 226\r## 13 $3000 to 3999 276\r## 14 $1000 to 2999 395\r## 15 Lt $1000 286\r## 16 Not applicable 7043\r Em geral, contagens de vari√°veis ficam bem em gr√°ficos de barras ou visualiza√ß√µes equivalentes, em que √© poss√≠vel comparar visualmente as contagens das diversas categorias. Mais sobre isso na aula do ggplot2.\nQual a religi√£o mais comum em gss_cat? Qual o partido (partyid) mais popular?  # Religi√£o\rgss_cat %\u0026gt;% count(relig) %\u0026gt;% arrange(desc(n))\r ## # A tibble: 15 x 2\r## relig n\r## \u0026lt;fct\u0026gt; \u0026lt;int\u0026gt;\r## 1 Protestant 10846\r## 2 Catholic 5124\r## 3 None 3523\r## 4 Christian 689\r## 5 Jewish 388\r## 6 Other 224\r## 7 Buddhism 147\r## 8 Inter-nondenominational 109\r## 9 Moslem/islam 104\r## 10 Orthodox-christian 95\r## 11 No answer 93\r## 12 Hinduism 71\r## 13 Other eastern 32\r## 14 Native american 23\r## 15 Don't know 15\r # Partido\rgss_cat %\u0026gt;% count(partyid) %\u0026gt;% arrange(desc(n))\r ## # A tibble: 10 x 2\r## partyid n\r## \u0026lt;fct\u0026gt; \u0026lt;int\u0026gt;\r## 1 Independent 4119\r## 2 Not str democrat 3690\r## 3 Strong democrat 3490\r## 4 Not str republican 3032\r## 5 Ind,near dem 2499\r## 6 Strong republican 2314\r## 7 Ind,near rep 1791\r## 8 Other party 393\r## 9 No answer 154\r## 10 Don't know 1\r A que religi√£o se refere a vari√°vel denom? Voc√™ pode descobrir isso fazendo uma tabela de contagens?  Voc√™ pode chamar count com v√°rias vari√°veis para fazer uma tabula√ß√£o cruzada.\ngss_cat %\u0026gt;% count(relig, denom) %\u0026gt;% print(n = Inf)\r ## # A tibble: 47 x 3\r## relig denom n\r## \u0026lt;fct\u0026gt; \u0026lt;fct\u0026gt; \u0026lt;int\u0026gt;\r## 1 No answer No answer 93\r## 2 Don't know Not applicable 15\r## 3 Inter-nondenominational Not applicable 109\r## 4 Native american Not applicable 23\r## 5 Christian No answer 2\r## 6 Christian Don't know 11\r## 7 Christian No denomination 452\r## 8 Christian Not applicable 224\r## 9 Orthodox-christian Not applicable 95\r## 10 Moslem/islam Not applicable 104\r## 11 Other eastern Not applicable 32\r## 12 Hinduism Not applicable 71\r## 13 Buddhism Not applicable 147\r## 14 Other No denomination 7\r## 15 Other Not applicable 217\r## 16 None Not applicable 3523\r## 17 Jewish Not applicable 388\r## 18 Catholic Not applicable 5124\r## 19 Protestant No answer 22\r## 20 Protestant Don't know 41\r## 21 Protestant No denomination 1224\r## 22 Protestant Other 2534\r## 23 Protestant Episcopal 397\r## 24 Protestant Presbyterian-dk wh 244\r## 25 Protestant Presbyterian, merged 67\r## 26 Protestant Other presbyterian 47\r## 27 Protestant United pres ch in us 110\r## 28 Protestant Presbyterian c in us 104\r## 29 Protestant Lutheran-dk which 267\r## 30 Protestant Evangelical luth 122\r## 31 Protestant Other lutheran 30\r## 32 Protestant Wi evan luth synod 71\r## 33 Protestant Lutheran-mo synod 212\r## 34 Protestant Luth ch in america 71\r## 35 Protestant Am lutheran 146\r## 36 Protestant Methodist-dk which 239\r## 37 Protestant Other methodist 33\r## 38 Protestant United methodist 1067\r## 39 Protestant Afr meth ep zion 32\r## 40 Protestant Afr meth episcopal 77\r## 41 Protestant Baptist-dk which 1457\r## 42 Protestant Other baptists 213\r## 43 Protestant Southern baptist 1536\r## 44 Protestant Nat bapt conv usa 40\r## 45 Protestant Nat bapt conv of am 76\r## 46 Protestant Am bapt ch in usa 130\r## 47 Protestant Am baptist asso 237\r Como voc√™ poderia diminuir o n√∫mero de categorias da vari√°vel rincome do banco gss_cat?  A melhor fun√ß√£o para redu√ß√£o de fatores √© fct_collapse. Veja como ficam a coluna original e a transformada.\ngss_cat2 \u0026lt;- gss_cat %\u0026gt;% # Aqui vou salvar em \u0026quot;rincome2\u0026quot; para a gente poder ver as duas\rmutate(rincome2 = fct_collapse(\rrincome,\r\u0026quot;Non-response\u0026quot; = c(\u0026quot;No answer\u0026quot;, \u0026quot;Don't know\u0026quot;, \u0026quot;Refused\u0026quot;, \u0026quot;Not applicable\u0026quot;),\r\u0026quot;At√© 5k\u0026quot; = c(\u0026quot;$4000 to 4999\u0026quot;, \u0026quot;$3000 to 3999\u0026quot;, \u0026quot;$1000 to 2999\u0026quot;, \u0026quot;Lt $1000\u0026quot;),\r\u0026quot;5k-10k\u0026quot; = c( \u0026quot;$8000 to 9999\u0026quot;, \u0026quot;$7000 to 7999\u0026quot;, \u0026quot;$6000 to 6999\u0026quot;, \u0026quot;$5000 to 5999\u0026quot;),\r\u0026quot;10k-20k\u0026quot; = c(\u0026quot;$15000 - 19999\u0026quot;, \u0026quot;$10000 - 14999\u0026quot;),\r\u0026quot;20k+\u0026quot; = c(\u0026quot;$25000 or more\u0026quot;, \u0026quot;$20000 - 24999\u0026quot;))) %\u0026gt;% select(rincome, rincome2)\r# E veja as contagens\rgss_cat2 %\u0026gt;% count(rincome)\r ## # A tibble: 16 x 2\r## rincome n\r## \u0026lt;fct\u0026gt; \u0026lt;int\u0026gt;\r## 1 No answer 183\r## 2 Don't know 267\r## 3 Refused 975\r## 4 $25000 or more 7363\r## 5 $20000 - 24999 1283\r## 6 $15000 - 19999 1048\r## 7 $10000 - 14999 1168\r## 8 $8000 to 9999 340\r## 9 $7000 to 7999 188\r## 10 $6000 to 6999 215\r## 11 $5000 to 5999 227\r## 12 $4000 to 4999 226\r## 13 $3000 to 3999 276\r## 14 $1000 to 2999 395\r## 15 Lt $1000 286\r## 16 Not applicable 7043\r gss_cat2 %\u0026gt;% count(rincome2)\r ## # A tibble: 5 x 2\r## rincome2 n\r## \u0026lt;fct\u0026gt; \u0026lt;int\u0026gt;\r## 1 Non-response 8468\r## 2 20k+ 8646\r## 3 10k-20k 2216\r## 4 5k-10k 970\r## 5 At√© 5k 1183\r ggplot2  O que tem de errado no c√≥digo abaixo? Por que os pontos n√£o ficaram azuis?  ggplot(data = mpg) + geom_point(mapping = aes(x = displ, y = hwy, color = \u0026quot;blue\u0026quot;))\r Os pontos n√£o ficam azuis porque voc√™ n√£o est√° especificando cores! Dentro da fun√ß√£o aes() voc√™ est√° especificando vari√°veis para serem mapeadas a uma escala de cores. Portanto, o ggplot interpreta \u0026ldquo;blue\u0026rdquo; como uma vari√°vel sem nome que tem o valor \u0026ldquo;blue\u0026rdquo; e mapeia ela para a escala de cores padr√£o, que √© vermelha. Se voc√™ quer controlar apenas a \u0026ldquo;apar√™ncia\u0026rdquo; dos pontos e n√£o est√° preocupada em mapear nenhuma vari√°vel, voc√™ pode passar essa est√©tica fora da fun√ß√£o aes().\nggplot(data = mpg) + geom_point(\rmapping = aes(x = displ, y = hwy), # aqui acabam os mapeamentos est√©ticos\rcolor = \u0026quot;blue\u0026quot;, # altera√ß√£o apenas na apar√™ncia do geom\rsize = 2, # altera√ß√£o apenas na apar√™ncia do geom\rshape = 6 # altera√ß√£o apenas na apar√™ncia do geom\r)  Utilizando o banco mpg, fa√ßa o diagrama de dispers√£o de displ por hwy e mapeie a cor para class, o tamanho para cyl e a forma para manufacturer. Como esses atributos est√©ticos se comportam diferente para vari√°veis categ√≥ricas vs cont√≠nuas?  ggplot(mpg, aes(\rdispl, hwy, color = class, size = cyl,\rshape = manufacturer)) +\rgeom_point()\r ## Warning: The shape palette can deal with a maximum of 6 discrete values because\r## more than 6 becomes difficult to discriminate; you have 15. Consider\r## specifying shapes manually if you must have them.\r ## Warning: Removed 112 rows containing missing values (geom_point).\r Ao cumprir as instru√ß√µes como dadas, logo de cara voc√™ recebe um aviso do ggplot2. A paleta de \u0026ldquo;shapes\u0026rdquo; s√≥ recebe por padr√£o 6 shapes diferentes, porque de acordo com o autor, mais de 6 torna dif√≠cil de distinguir. Mas eu sou teimoso.\nggplot(mpg, aes(\rdispl, hwy, color = class, size = cyl,\rshape = manufacturer)) +\rgeom_point() +\rscale_shape_manual(values = 1:15, guide = \u0026quot;legend\u0026quot;)\r Esse gr√°fico √© mais um exemplo para voc√™s verem como diferentes escalas se comportam. A vari√°vel cyl √© num√©rica e ordenada, ent√£o faz sentido coloc√°-la num mapeamento como size, j√° que visualmente √© poss√≠vel indicar que a grandeza aumenta com o tamanho. Classe √© uma vari√°vel categ√≥rica, ent√£o ela fica melhor em mapeamentos que ressaltam diferen√ßas entre as categorias, como colors ou shapes. O pacote tamb√©m imp√µe algumas restri√ß√µes sobre o que √© poss√≠vel mapear. Por exemplo, ele retorna erro se voc√™ tenta mapear uma vari√°vel discreta para uma escala cont√≠nua.\nggplot(mpg, aes(displ, hwy, color = class)) +\rgeom_point() +\rscale_color_continuous()\r ## Error: Discrete value supplied to continuous scale\r Experimentem tentar mapear diferentes vari√°veis no banco mpg para as diferentes escalas e vejam os resultados. Em alguns casos, √© poss√≠vel, mas o gr√°fico √© pouco informativo, em outros, voc√™ ver√° mensagens de erro.\nUtilizando o diamonds, crie um diagrama de dispers√£o que relacione carat com price. Explore algumas outras vari√°veis utilizando escalas de cor para ver se voc√™ identifica algum padr√£o. Aplique transforma√ß√µes nas vari√°veis que voc√™ considerar justificadas.  Esse exerc√≠cio n√£o tem uma resposta correta. O objetivo era que voc√™s explorassem as transforma√ß√µes estat√≠sticas e as escalas de cores diferentes presentes no ggplot, atrav√©s do argumento trans, ou mesmo fazer outras transforma√ß√µes que interessassem voc√™s nas vari√°veis. Abaixo um exemplo de transforma√ß√£o de Yeo-Johnson, um tipo de transforma√ß√£o BoxCox que aceita valores negativos e uma das escalas de cor do pacote viridis.\nggplot(diamonds, aes(carat, price, color = clarity)) +\rgeom_point() +\rscale_x_continuous(trans = scales::yj_trans(p = 2)) +\rscale_color_viridis_d(option = \u0026quot;magma\u0026quot;)\r Ainda continuando o exemplo anterior, aplique um geom_smooth utilizando v√°rias op√ß√µes de method para as vari√°veis originais ou transformadas.  Segundo a mesma l√≥gica, o objetivo era explorar as op√ß√µes de visualiza√ß√£o de modelos simples atrav√©s do argumento method. Abaixo um exemplo de gam. Uma mudan√ßa que fiz foi usar a vari√°vel cut ao inv√©s de clarity, porque o gr√°fico n√£o-transformado de clarity estava muito polu√≠do.\nggplot(diamonds, aes(carat, price, color = cut)) +\rgeom_point(alpha = 0.1) + # pontos transl√∫cidos para reduzir a polui√ß√£o\rgeom_smooth(method = \u0026quot;gam\u0026quot;, se = FALSE) +\rscale_color_viridis_d(option = \u0026quot;plasma\u0026quot;)\r ## `geom_smooth()` using formula 'y ~ s(x, bs = \u0026quot;cs\u0026quot;)'\r No nosso gr√°fico de barras usando stat(prop) a gente precisou colocar group = 1, porque? Qual √© a diferen√ßa entre esses dois c√≥digos?  ggplot(data = diamonds) + geom_bar(mapping = aes(x = cut, y = after_stat(prop)))\r ggplot(data = diamonds) + geom_bar(mapping = aes(x = cut, fill = color, y = after_stat(prop)))\r Acabei explicando isso na aula, devido a uma pergunta, mas para quem perdeu, trata-se do comportamento padr√£o quando h√° propor√ß√µes: cada barra ter√° sua pr√≥pria propor√ß√£o e todas somar√£o a 100%. O uso de group = 1 indica √† fun√ß√£o que as propor√ß√µes que somam a 100% s√£o o total dos n√≠veis do fator e n√£o cada n√≠vel individualmente.\nggplot(data = diamonds) + geom_bar(mapping = aes(x = cut, y = after_stat(prop), group = 1))\r # No caso em que h√° um \u0026quot;fill\u0026quot;, precisamos normalizar as alturas das barras\rggplot(data = diamonds) +\rgeom_bar(mapping = aes(\rx = cut,\ry = stat(prop),\rfill = clarity\r))\r ggplot(data = diamonds) +\rgeom_bar(mapping = aes(\rx = cut,\ry = stat(count)/sum(stat(count)),\rfill = clarity\r))\r stat_smooth √© muito parecido com geom_smooth, mas h√° uma diferen√ßa sutil. Compare os c√≥digos abaixo.  geom_smooth chama stat_smooth quando voc√™ utiliza a fun√ß√£o para calcular as \u0026ldquo;m√©dias condicionais\u0026rdquo; que correspondem a linha de tend√™ncia desenhada no gr√°fico. √â assim com todos os geoms no pacote. H√° uma conex√£o entre o objeto geom√©trico e uma transforma√ß√£o estat√≠stica. Mesmo que seja a transforma√ß√£o _identity, que mant√©m a vari√°vel exatamente como ela estava no dado. A grande vantagem de construir um gr√°fico com stat_smooth ao inv√©s de geom_smooth √© que voc√™ pode especificar outro objeto geom√©trico que n√£o seja o padr√£o (geom_line + geom_ribbon). √â isso que os gr√°ficos abaixo demonstram.\nggplot(mpg, aes(displ, hwy)) + geom_point() +\rgeom_smooth()\r ## `geom_smooth()` using method = 'loess' and formula 'y ~ x'\r ggplot(mpg, aes(displ, hwy)) + geom_point() +\rstat_smooth(geom = \u0026quot;step\u0026quot;)\r ## `geom_smooth()` using method = 'loess' and formula 'y ~ x'\r ggplot(mpg, aes(displ, hwy)) + geom_point() +\rstat_smooth(geom = \u0026quot;linerange\u0026quot;)\r ## `geom_smooth()` using method = 'loess' and formula 'y ~ x'\r ggplot(mpg, aes(displ, hwy)) + geom_point() +\rstat_smooth(geom = \u0026quot;errorbar\u0026quot;)\r ## `geom_smooth()` using method = 'loess' and formula 'y ~ x'\r ggplot(mpg, aes(displ, hwy)) + geom_point() +\rstat_smooth(geom = \u0026quot;crossbar\u0026quot;)\r ## `geom_smooth()` using method = 'loess' and formula 'y ~ x'\r Usando o mpg e facet_grid, crie um scatterplot que contenha displ no eixo x, hwy no eixo y, class na cor, drv nas facetas-coluna e cyl nas facetas linha.  Esse aqui √© para demonstrar o uso de facet_grid, que permite especificar fatores de classifica√ß√£o diferentes nas linhas e colunas, diferente de facet_wrap mostrado na aula, que s√≥ permite especificar uma dimens√£o.\nggplot(mpg, aes(x = displ, y = hwy, color = class)) +\rgeom_point() +\rfacet_grid(cyl ~ drv)\r Voc√™ acha que os dois gr√°ficos abaixo ficar√£o diferentes um do outro? Porque? Tente responder antes de rodar o c√≥digo.  ggplot(data = mpg, mapping = aes(x = displ, y = hwy)) + geom_point() + geom_smooth()\r ## `geom_smooth()` using method = 'loess' and formula 'y ~ x'\r ggplot() + geom_point(data = mpg, mapping = aes(x = displ, y = hwy)) + geom_smooth(data = mpg, mapping = aes(x = displ, y = hwy))\r ## `geom_smooth()` using method = 'loess' and formula 'y ~ x'\r Mesmo antes de rodar o c√≥digo, o observador astuto notar√° que os mapeamentos locais no segundo gr√°fico s√£o id√™nticos entre si e aos mapeamentos globais, ent√£o os dois gr√°ficos s√£o iguais.\nTente recriar o seguinte gr√°fico  O objetivo dessa era fazer voc√™s fu√ßarem um pouco na ajuda para tentar recriar o mais fielmente poss√≠vel o gr√°fico final. N√£o precisava ter acertado, o objetivo era chegar o mais pr√≥ximo poss√≠vel.\nggplot(mpg, aes(displ, hwy, color = drv)) +\rgeom_point() +\rgeom_smooth(method = lm, se = FALSE) +\rlabs(x = \u0026quot;Rodovia\u0026quot;, y = \u0026quot;Toneladas\u0026quot;, color = \u0026quot;Tra√ß√£o\u0026quot;) +\rscale_color_brewer(palette = \u0026quot;Set1\u0026quot;)\r ## `geom_smooth()` using formula 'y ~ x'\r Transforme o gr√°fico seguir em um gr√°fico de pizza usando coord_polar.  ggplot(diamonds, aes(cut, fill = cut)) +\rgeom_bar()\r Depois de simplesmente especificar coord_polar, em geral o gr√°fico fica meio estranho, n√£o tem aquela cara bonita de pizza. √â preciso corrigir os seguintes problemas:\n A largura das barras deve ser igual a propor√ß√£o das contagens, mas a altura deve ser igual a 1! Portanto, eu inverto as coisas e passo as contagens/propor√ß√µes para \u0026ldquo;x\u0026rdquo; e \u0026ldquo;y\u0026rdquo; fica com o valor fixo = 1.  ggplot(diamonds, aes(\r# calculando as propor√ß√µes do total,\r# tamb√©m funciona com o padr√£o stat(count)\rx = stat(count)/sum(stat(count)),\ry = 1, # altura igual a 1\rfill = cut)) + # cores\rgeom_bar() +\rcoord_polar() + # coordenadas polares\r# opcional: remover aspectos do tema para um visual mais clean\rtheme_void()\r Como desafio, tentem adicionar elementos textuais das propor√ß√µes no gr√°fico. O problema a ser resolvido √© como posicionar o texto num sistema de coordenadas polares. Boa sorte!\nGr√°ficos de pizza s√£o pol√™micos na an√°lise de dados porque nossos olhos n√£o captam bem diferen√ßas entre formatos curvos e complexos, ent√£o a compara√ß√£o entre as categorias fica prejudicada se houverem mais de 2 ou 3. Eu sempre dou prefer√™ncia para barras. H√° um tipo de gr√°fico de pizza melhorzinho chamado \u0026ldquo;donut plot\u0026rdquo;, em que o meio do c√≠rculo √© oco, mas eu ainda prefiro as barras.\npurrr  Utilize uma das fun√ß√µes map_ para:  Nos exemplos abaixo, eu utilizo sempre str() no final para facilitar a visualiza√ß√£o das listas, mas n√£o √© obrigat√≥rio utilizar esse comando.\n1. Calcular a m√©dia de cada coluna em `mtcars`.\r map(mtcars, mean) %\u0026gt;% str()\r ## List of 11\r## $ mpg : num 20.1\r## $ cyl : num 6.19\r## $ disp: num 231\r## $ hp : num 147\r## $ drat: num 3.6\r## $ wt : num 3.22\r## $ qsec: num 17.8\r## $ vs : num 0.438\r## $ am : num 0.406\r## $ gear: num 3.69\r## $ carb: num 2.81\r 2. Determinar o tipo de cada coluna em `flights`.\r flights %\u0026gt;% map(class) %\u0026gt;% str()\r ## List of 19\r## $ year : chr \u0026quot;integer\u0026quot;\r## $ month : chr \u0026quot;integer\u0026quot;\r## $ day : chr \u0026quot;integer\u0026quot;\r## $ dep_time : chr \u0026quot;integer\u0026quot;\r## $ sched_dep_time: chr \u0026quot;integer\u0026quot;\r## $ dep_delay : chr \u0026quot;numeric\u0026quot;\r## $ arr_time : chr \u0026quot;integer\u0026quot;\r## $ sched_arr_time: chr \u0026quot;integer\u0026quot;\r## $ arr_delay : chr \u0026quot;numeric\u0026quot;\r## $ carrier : chr \u0026quot;character\u0026quot;\r## $ flight : chr \u0026quot;integer\u0026quot;\r## $ tailnum : chr \u0026quot;character\u0026quot;\r## $ origin : chr \u0026quot;character\u0026quot;\r## $ dest : chr \u0026quot;character\u0026quot;\r## $ air_time : chr \u0026quot;numeric\u0026quot;\r## $ distance : chr \u0026quot;numeric\u0026quot;\r## $ hour : chr \u0026quot;numeric\u0026quot;\r## $ minute : chr \u0026quot;numeric\u0026quot;\r## $ time_hour : chr [1:2] \u0026quot;POSIXct\u0026quot; \u0026quot;POSIXt\u0026quot;\r 3. Computar o n√∫mero de valores √∫nicos em cada coluna de `iris`.\r flights %\u0026gt;% map(unique) %\u0026gt;% map(length) %\u0026gt;% str()\r ## List of 19\r## $ year : int 1\r## $ month : int 12\r## $ day : int 31\r## $ dep_time : int 1319\r## $ sched_dep_time: int 1021\r## $ dep_delay : int 528\r## $ arr_time : int 1412\r## $ sched_arr_time: int 1163\r## $ arr_delay : int 578\r## $ carrier : int 16\r## $ flight : int 3844\r## $ tailnum : int 4044\r## $ origin : int 3\r## $ dest : int 105\r## $ air_time : int 510\r## $ distance : int 214\r## $ hour : int 20\r## $ minute : int 60\r## $ time_hour : int 6936\r # Sugest√£o do Pedro Gomes\rflights %\u0026gt;% map(n_distinct) %\u0026gt;% str()\r ## List of 19\r## $ year : int 1\r## $ month : int 12\r## $ day : int 31\r## $ dep_time : int 1319\r## $ sched_dep_time: int 1021\r## $ dep_delay : int 528\r## $ arr_time : int 1412\r## $ sched_arr_time: int 1163\r## $ arr_delay : int 578\r## $ carrier : int 16\r## $ flight : int 3844\r## $ tailnum : int 4044\r## $ origin : int 3\r## $ dest : int 105\r## $ air_time : int 510\r## $ distance : int 214\r## $ hour : int 20\r## $ minute : int 60\r## $ time_hour : int 6936\r 4. Gere 10 distribui√ß√µes aleat√≥rias (`rnorm`) com m√©dias -10, 0, 10 e 100.\r x \u0026lt;- rep(100, 40)\rmedias \u0026lt;- rep(c(-10, 0, 10, 100), each = 10)\rmap2(x, medias, ~rnorm(.x, mean = .y)) %\u0026gt;% str()\r ## List of 40\r## $ : num [1:100] -9.96 -9.53 -9.12 -9.64 -10.36 ...\r## $ : num [1:100] -11.71 -10.76 -9.41 -9.22 -10.53 ...\r## $ : num [1:100] -11.33 -9.51 -8.98 -10.91 -9.52 ...\r## $ : num [1:100] -11.4 -10.9 -10.7 -12.1 -9.8 ...\r## $ : num [1:100] -11.06 -10.66 -10.33 -9.13 -9.13 ...\r## $ : num [1:100] -10.22 -9.59 -9.81 -10.71 -10.24 ...\r## $ : num [1:100] -11 -9.14 -10.91 -9.38 -9.63 ...\r## $ : num [1:100] -9.83 -9.61 -11.23 -9.68 -10.47 ...\r## $ : num [1:100] -9.11 -10.03 -10.62 -9.65 -10.2 ...\r## $ : num [1:100] -9.06 -10.41 -10.84 -9.16 -9.41 ...\r## $ : num [1:100] -0.8378 0.1102 0.7519 -0.2477 0.0342 ...\r## $ : num [1:100] 0.607 -0.902 -2.185 -0.397 -1.019 ...\r## $ : num [1:100] -0.452 2.067 1.45 -1.184 0.893 ...\r## $ : num [1:100] -0.604 -0.783 1.767 -0.632 1.322 ...\r## $ : num [1:100] -2.515 0.43 0.694 1.239 1.091 ...\r## $ : num [1:100] -1.462 1.177 -0.376 0.037 0.387 ...\r## $ : num [1:100] -0.0803 -0.0421 2.4765 0.0509 -0.1479 ...\r## $ : num [1:100] 1.118 0.662 -1.439 -1.074 0.493 ...\r## $ : num [1:100] -0.3136 0.4455 -0.947 2.0658 -0.0188 ...\r## $ : num [1:100] 0.193 0.625 2.281 0.297 -0.629 ...\r## $ : num [1:100] 9.29 9.1 9.54 9.99 10.2 ...\r## $ : num [1:100] 7.96 7.32 10.7 9.13 10.3 ...\r## $ : num [1:100] 9.96 10.24 10.31 10.54 11.65 ...\r## $ : num [1:100] 10.88 10.41 8.19 10.37 10.28 ...\r## $ : num [1:100] 11.27 9.74 11.75 11.7 9.31 ...\r## $ : num [1:100] 9.62 11.35 10.78 10.79 9.7 ...\r## $ : num [1:100] 9.04 10.24 11.85 9.82 10.66 ...\r## $ : num [1:100] 10.48 6.97 8.97 9.69 11.03 ...\r## $ : num [1:100] 8.48 10.12 9.09 8.18 10.11 ...\r## $ : num [1:100] 9.97 9.27 10.19 10.93 11.07 ...\r## $ : num [1:100] 100 99.2 99.6 100.3 99.2 ...\r## $ : num [1:100] 99 99.9 100.7 98.7 99.7 ...\r## $ : num [1:100] 99.6 99.2 100.1 100 99.9 ...\r## $ : num [1:100] 100.5 100.4 100.2 98.4 98.9 ...\r## $ : num [1:100] 99.8 99.8 100 99.1 101.1 ...\r## $ : num [1:100] 100.7 100 100.1 98.6 100 ...\r## $ : num [1:100] 99 99.4 100.5 100.1 99.3 ...\r## $ : num [1:100] 99.2 98.6 99.2 100.9 97.4 ...\r## $ : num [1:100] 99.7 99.8 100.9 100.5 99.9 ...\r## $ : num [1:100] 99.5 100.9 98.5 99.7 100 ...\r Como voc√™ pode criar um vetor indicando se cada coluna em um data.frame √© um fator?  # Flights por exemplo\rflights %\u0026gt;% # Lembrem-se que a pergunta pedia para criar um vetor!\rmap_lgl(is.factor)\r ## year month day dep_time sched_dep_time ## FALSE FALSE FALSE FALSE FALSE ## dep_delay arr_time sched_arr_time arr_delay carrier ## FALSE FALSE FALSE FALSE FALSE ## flight tailnum origin dest air_time ## FALSE FALSE FALSE FALSE FALSE ## distance hour minute time_hour ## FALSE FALSE FALSE FALSE\r  Usando as fun√ß√µes predicado keep e discard:\n Selecione todas as colunas caractere no banco flights.    flights %\u0026gt;% keep(is.character)\r ## # A tibble: 336,776 x 4\r## carrier tailnum origin dest ## \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt;\r## 1 UA N14228 EWR IAH ## 2 UA N24211 LGA IAH ## 3 AA N619AA JFK MIA ## 4 B6 N804JB JFK BQN ## 5 DL N668DN LGA ATL ## 6 UA N39463 EWR ORD ## 7 B6 N516JB EWR FLL ## 8 EV N829AS LGA IAD ## 9 B6 N593JB JFK MCO ## 10 AA N3ALAA LGA ORD ## # ... with 336,766 more rows\r 2. Descarte os caracteres em `mpg`.\r mpg %\u0026gt;% discard(is.character)\r ## # A tibble: 234 x 5\r## displ year cyl cty hwy\r## \u0026lt;dbl\u0026gt; \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;int\u0026gt;\r## 1 1.8 1999 4 18 29\r## 2 1.8 1999 4 21 29\r## 3 2 2008 4 20 31\r## 4 2 2008 4 21 30\r## 5 2.8 1999 6 16 26\r## 6 2.8 1999 6 18 26\r## 7 3.1 2008 6 18 27\r## 8 1.8 1999 4 18 26\r## 9 1.8 1999 4 16 25\r## 10 2 2008 4 20 28\r## # ... with 224 more rows\r 3. Selecione os fatores ordenados em `diamonds`.\r diamonds %\u0026gt;% keep(is.ordered)\r ## # A tibble: 53,940 x 3\r## cut color clarity\r## \u0026lt;ord\u0026gt; \u0026lt;ord\u0026gt; \u0026lt;ord\u0026gt; ## 1 Ideal E SI2 ## 2 Premium E SI1 ## 3 Good E VS1 ## 4 Premium I VS2 ## 5 Good J SI2 ## 6 Very Good J VVS2 ## 7 Very Good I VVS1 ## 8 Very Good H SI1 ## 9 Fair E VS2 ## 10 Very Good H VS1 ## # ... with 53,930 more rows\r 4. Descarte as vari√°veis n√£o-num√©ricas em `iris`\r iris %\u0026gt;% discard(negate(is.numeric))\r ## Sepal.Length Sepal.Width Petal.Length Petal.Width\r## 1 5.1 3.5 1.4 0.2\r## 2 4.9 3.0 1.4 0.2\r## 3 4.7 3.2 1.3 0.2\r## 4 4.6 3.1 1.5 0.2\r## 5 5.0 3.6 1.4 0.2\r## 6 5.4 3.9 1.7 0.4\r## 7 4.6 3.4 1.4 0.3\r## 8 5.0 3.4 1.5 0.2\r## 9 4.4 2.9 1.4 0.2\r## 10 4.9 3.1 1.5 0.1\r## 11 5.4 3.7 1.5 0.2\r## 12 4.8 3.4 1.6 0.2\r## 13 4.8 3.0 1.4 0.1\r## 14 4.3 3.0 1.1 0.1\r## 15 5.8 4.0 1.2 0.2\r## 16 5.7 4.4 1.5 0.4\r## 17 5.4 3.9 1.3 0.4\r## 18 5.1 3.5 1.4 0.3\r## 19 5.7 3.8 1.7 0.3\r## 20 5.1 3.8 1.5 0.3\r## 21 5.4 3.4 1.7 0.2\r## 22 5.1 3.7 1.5 0.4\r## 23 4.6 3.6 1.0 0.2\r## 24 5.1 3.3 1.7 0.5\r## 25 4.8 3.4 1.9 0.2\r## 26 5.0 3.0 1.6 0.2\r## 27 5.0 3.4 1.6 0.4\r## 28 5.2 3.5 1.5 0.2\r## 29 5.2 3.4 1.4 0.2\r## 30 4.7 3.2 1.6 0.2\r## 31 4.8 3.1 1.6 0.2\r## 32 5.4 3.4 1.5 0.4\r## 33 5.2 4.1 1.5 0.1\r## 34 5.5 4.2 1.4 0.2\r## 35 4.9 3.1 1.5 0.2\r## 36 5.0 3.2 1.2 0.2\r## 37 5.5 3.5 1.3 0.2\r## 38 4.9 3.6 1.4 0.1\r## 39 4.4 3.0 1.3 0.2\r## 40 5.1 3.4 1.5 0.2\r## 41 5.0 3.5 1.3 0.3\r## 42 4.5 2.3 1.3 0.3\r## 43 4.4 3.2 1.3 0.2\r## 44 5.0 3.5 1.6 0.6\r## 45 5.1 3.8 1.9 0.4\r## 46 4.8 3.0 1.4 0.3\r## 47 5.1 3.8 1.6 0.2\r## 48 4.6 3.2 1.4 0.2\r## 49 5.3 3.7 1.5 0.2\r## 50 5.0 3.3 1.4 0.2\r## 51 7.0 3.2 4.7 1.4\r## 52 6.4 3.2 4.5 1.5\r## 53 6.9 3.1 4.9 1.5\r## 54 5.5 2.3 4.0 1.3\r## 55 6.5 2.8 4.6 1.5\r## 56 5.7 2.8 4.5 1.3\r## 57 6.3 3.3 4.7 1.6\r## 58 4.9 2.4 3.3 1.0\r## 59 6.6 2.9 4.6 1.3\r## 60 5.2 2.7 3.9 1.4\r## 61 5.0 2.0 3.5 1.0\r## 62 5.9 3.0 4.2 1.5\r## 63 6.0 2.2 4.0 1.0\r## 64 6.1 2.9 4.7 1.4\r## 65 5.6 2.9 3.6 1.3\r## 66 6.7 3.1 4.4 1.4\r## 67 5.6 3.0 4.5 1.5\r## 68 5.8 2.7 4.1 1.0\r## 69 6.2 2.2 4.5 1.5\r## 70 5.6 2.5 3.9 1.1\r## 71 5.9 3.2 4.8 1.8\r## 72 6.1 2.8 4.0 1.3\r## 73 6.3 2.5 4.9 1.5\r## 74 6.1 2.8 4.7 1.2\r## 75 6.4 2.9 4.3 1.3\r## 76 6.6 3.0 4.4 1.4\r## 77 6.8 2.8 4.8 1.4\r## 78 6.7 3.0 5.0 1.7\r## 79 6.0 2.9 4.5 1.5\r## 80 5.7 2.6 3.5 1.0\r## 81 5.5 2.4 3.8 1.1\r## 82 5.5 2.4 3.7 1.0\r## 83 5.8 2.7 3.9 1.2\r## 84 6.0 2.7 5.1 1.6\r## 85 5.4 3.0 4.5 1.5\r## 86 6.0 3.4 4.5 1.6\r## 87 6.7 3.1 4.7 1.5\r## 88 6.3 2.3 4.4 1.3\r## 89 5.6 3.0 4.1 1.3\r## 90 5.5 2.5 4.0 1.3\r## 91 5.5 2.6 4.4 1.2\r## 92 6.1 3.0 4.6 1.4\r## 93 5.8 2.6 4.0 1.2\r## 94 5.0 2.3 3.3 1.0\r## 95 5.6 2.7 4.2 1.3\r## 96 5.7 3.0 4.2 1.2\r## 97 5.7 2.9 4.2 1.3\r## 98 6.2 2.9 4.3 1.3\r## 99 5.1 2.5 3.0 1.1\r## 100 5.7 2.8 4.1 1.3\r## 101 6.3 3.3 6.0 2.5\r## 102 5.8 2.7 5.1 1.9\r## 103 7.1 3.0 5.9 2.1\r## 104 6.3 2.9 5.6 1.8\r## 105 6.5 3.0 5.8 2.2\r## 106 7.6 3.0 6.6 2.1\r## 107 4.9 2.5 4.5 1.7\r## 108 7.3 2.9 6.3 1.8\r## 109 6.7 2.5 5.8 1.8\r## 110 7.2 3.6 6.1 2.5\r## 111 6.5 3.2 5.1 2.0\r## 112 6.4 2.7 5.3 1.9\r## 113 6.8 3.0 5.5 2.1\r## 114 5.7 2.5 5.0 2.0\r## 115 5.8 2.8 5.1 2.4\r## 116 6.4 3.2 5.3 2.3\r## 117 6.5 3.0 5.5 1.8\r## 118 7.7 3.8 6.7 2.2\r## 119 7.7 2.6 6.9 2.3\r## 120 6.0 2.2 5.0 1.5\r## 121 6.9 3.2 5.7 2.3\r## 122 5.6 2.8 4.9 2.0\r## 123 7.7 2.8 6.7 2.0\r## 124 6.3 2.7 4.9 1.8\r## 125 6.7 3.3 5.7 2.1\r## 126 7.2 3.2 6.0 1.8\r## 127 6.2 2.8 4.8 1.8\r## 128 6.1 3.0 4.9 1.8\r## 129 6.4 2.8 5.6 2.1\r## 130 7.2 3.0 5.8 1.6\r## 131 7.4 2.8 6.1 1.9\r## 132 7.9 3.8 6.4 2.0\r## 133 6.4 2.8 5.6 2.2\r## 134 6.3 2.8 5.1 1.5\r## 135 6.1 2.6 5.6 1.4\r## 136 7.7 3.0 6.1 2.3\r## 137 6.3 3.4 5.6 2.4\r## 138 6.4 3.1 5.5 1.8\r## 139 6.0 3.0 4.8 1.8\r## 140 6.9 3.1 5.4 2.1\r## 141 6.7 3.1 5.6 2.4\r## 142 6.9 3.1 5.1 2.3\r## 143 5.8 2.7 5.1 1.9\r## 144 6.8 3.2 5.9 2.3\r## 145 6.7 3.3 5.7 2.5\r## 146 6.7 3.0 5.2 2.3\r## 147 6.3 2.5 5.0 1.9\r## 148 6.5 3.0 5.2 2.0\r## 149 6.2 3.4 5.4 2.3\r## 150 5.9 3.0 5.1 1.8\r Imagine que voc√™ tem um diret√≥rio cheio de arquivos .csv que correspondem a um √∫nico banco de dados. Voc√™ tem os caminhos de todos eles num vetor com a forma c(arquivo_1.csv, ..., arquivo_n.csv). Como voc√™ importaria esses arquivos? Tente fazer duas solu√ß√µes diferentes.  # Vamos usar um diret√≥rio tempor√°rio que vamos preencher com v√°rios tibbles\rpasta \u0026lt;- tempdir()\r# Criamos 100 tibbles e guardamos em 100 arquivos csv.\rx \u0026lt;- rep(10, 100)\rarqs \u0026lt;- sprintf(\u0026quot;arquivo%s.csv\u0026quot;, 1:100)\rmap(x, ~tibble(var1 = rnorm(.x), var2 = rnorm(.x))) %\u0026gt;% map2(arqs, ~write_csv(.x, file.path(pasta, .y))) %\u0026gt;% str()\r # Nossos arquivos est√£o salvos no diret√≥rio tempor√°rio:\rdir(pasta)\r ## [1] \u0026quot;arquivo1.csv\u0026quot; \u0026quot;arquivo10.csv\u0026quot; \u0026quot;arquivo100.csv\u0026quot; \u0026quot;arquivo11.csv\u0026quot; ## [5] \u0026quot;arquivo12.csv\u0026quot; \u0026quot;arquivo13.csv\u0026quot; \u0026quot;arquivo14.csv\u0026quot; \u0026quot;arquivo15.csv\u0026quot; ## [9] \u0026quot;arquivo16.csv\u0026quot; \u0026quot;arquivo17.csv\u0026quot; \u0026quot;arquivo18.csv\u0026quot; \u0026quot;arquivo19.csv\u0026quot; ## [13] \u0026quot;arquivo2.csv\u0026quot; \u0026quot;arquivo20.csv\u0026quot; \u0026quot;arquivo21.csv\u0026quot; \u0026quot;arquivo22.csv\u0026quot; ## [17] \u0026quot;arquivo23.csv\u0026quot; \u0026quot;arquivo24.csv\u0026quot; \u0026quot;arquivo25.csv\u0026quot; \u0026quot;arquivo26.csv\u0026quot; ## [21] \u0026quot;arquivo27.csv\u0026quot; \u0026quot;arquivo28.csv\u0026quot; \u0026quot;arquivo29.csv\u0026quot; \u0026quot;arquivo3.csv\u0026quot; ## [25] \u0026quot;arquivo30.csv\u0026quot; \u0026quot;arquivo31.csv\u0026quot; \u0026quot;arquivo32.csv\u0026quot; \u0026quot;arquivo33.csv\u0026quot; ## [29] \u0026quot;arquivo34.csv\u0026quot; \u0026quot;arquivo35.csv\u0026quot; \u0026quot;arquivo36.csv\u0026quot; \u0026quot;arquivo37.csv\u0026quot; ## [33] \u0026quot;arquivo38.csv\u0026quot; \u0026quot;arquivo39.csv\u0026quot; \u0026quot;arquivo4.csv\u0026quot; \u0026quot;arquivo40.csv\u0026quot; ## [37] \u0026quot;arquivo41.csv\u0026quot; \u0026quot;arquivo42.csv\u0026quot; \u0026quot;arquivo43.csv\u0026quot; \u0026quot;arquivo44.csv\u0026quot; ## [41] \u0026quot;arquivo45.csv\u0026quot; \u0026quot;arquivo46.csv\u0026quot; \u0026quot;arquivo47.csv\u0026quot; \u0026quot;arquivo48.csv\u0026quot; ## [45] \u0026quot;arquivo49.csv\u0026quot; \u0026quot;arquivo5.csv\u0026quot; \u0026quot;arquivo50.csv\u0026quot; \u0026quot;arquivo51.csv\u0026quot; ## [49] \u0026quot;arquivo52.csv\u0026quot; \u0026quot;arquivo53.csv\u0026quot; \u0026quot;arquivo54.csv\u0026quot; \u0026quot;arquivo55.csv\u0026quot; ## [53] \u0026quot;arquivo56.csv\u0026quot; \u0026quot;arquivo57.csv\u0026quot; \u0026quot;arquivo58.csv\u0026quot; \u0026quot;arquivo59.csv\u0026quot; ## [57] \u0026quot;arquivo6.csv\u0026quot; \u0026quot;arquivo60.csv\u0026quot; \u0026quot;arquivo61.csv\u0026quot; \u0026quot;arquivo62.csv\u0026quot; ## [61] \u0026quot;arquivo63.csv\u0026quot; \u0026quot;arquivo64.csv\u0026quot; \u0026quot;arquivo65.csv\u0026quot; \u0026quot;arquivo66.csv\u0026quot; ## [65] \u0026quot;arquivo67.csv\u0026quot; \u0026quot;arquivo68.csv\u0026quot; \u0026quot;arquivo69.csv\u0026quot; \u0026quot;arquivo7.csv\u0026quot; ## [69] \u0026quot;arquivo70.csv\u0026quot; \u0026quot;arquivo71.csv\u0026quot; \u0026quot;arquivo72.csv\u0026quot; \u0026quot;arquivo73.csv\u0026quot; ## [73] \u0026quot;arquivo74.csv\u0026quot; \u0026quot;arquivo75.csv\u0026quot; \u0026quot;arquivo76.csv\u0026quot; \u0026quot;arquivo77.csv\u0026quot; ## [77] \u0026quot;arquivo78.csv\u0026quot; \u0026quot;arquivo79.csv\u0026quot; \u0026quot;arquivo8.csv\u0026quot; \u0026quot;arquivo80.csv\u0026quot; ## [81] \u0026quot;arquivo81.csv\u0026quot; \u0026quot;arquivo82.csv\u0026quot; \u0026quot;arquivo83.csv\u0026quot; \u0026quot;arquivo84.csv\u0026quot; ## [85] \u0026quot;arquivo85.csv\u0026quot; \u0026quot;arquivo86.csv\u0026quot; \u0026quot;arquivo87.csv\u0026quot; \u0026quot;arquivo88.csv\u0026quot; ## [89] \u0026quot;arquivo89.csv\u0026quot; \u0026quot;arquivo9.csv\u0026quot; \u0026quot;arquivo90.csv\u0026quot; \u0026quot;arquivo91.csv\u0026quot; ## [93] \u0026quot;arquivo92.csv\u0026quot; \u0026quot;arquivo93.csv\u0026quot; \u0026quot;arquivo94.csv\u0026quot; \u0026quot;arquivo95.csv\u0026quot; ## [97] \u0026quot;arquivo96.csv\u0026quot; \u0026quot;arquivo97.csv\u0026quot; \u0026quot;arquivo98.csv\u0026quot; \u0026quot;arquivo99.csv\u0026quot; ## [101] \u0026quot;filecf810bd36a5\u0026quot; \u0026quot;filecf81149221d\u0026quot; \u0026quot;filecf81164e23\u0026quot; \u0026quot;filecf8161f65f7\u0026quot;\r## [105] \u0026quot;filecf8171030fd\u0026quot; \u0026quot;filecf819e43f49\u0026quot; \u0026quot;filecf81ad26a9f\u0026quot; \u0026quot;filecf81bed9f1\u0026quot; ## [109] \u0026quot;filecf81e7a7e68\u0026quot; \u0026quot;filecf81ef03542\u0026quot; \u0026quot;filecf81fa64a3e\u0026quot; \u0026quot;filecf8239d75ab\u0026quot;\r## [113] \u0026quot;filecf8261936\u0026quot; \u0026quot;filecf826d55378\u0026quot; \u0026quot;filecf8291061a0\u0026quot; \u0026quot;filecf82b985019\u0026quot;\r## [117] \u0026quot;filecf82c00737b\u0026quot; \u0026quot;filecf8339f5\u0026quot; \u0026quot;filecf8341e67d6\u0026quot; \u0026quot;filecf8344158ac\u0026quot;\r## [121] \u0026quot;filecf837a47cc7\u0026quot; \u0026quot;filecf837f15510\u0026quot; \u0026quot;filecf8387a3d29\u0026quot; \u0026quot;filecf83a71232b\u0026quot;\r## [125] \u0026quot;filecf83ac3253a\u0026quot; \u0026quot;filecf83af94598\u0026quot; \u0026quot;filecf83f794f64\u0026quot; \u0026quot;filecf8402156c1\u0026quot;\r## [129] \u0026quot;filecf840c15566\u0026quot; \u0026quot;filecf84163761c\u0026quot; \u0026quot;filecf841d3b53\u0026quot; \u0026quot;filecf844d5642\u0026quot; ## [133] \u0026quot;filecf845e73bac\u0026quot; \u0026quot;filecf8462819d6\u0026quot; \u0026quot;filecf84b8b3144\u0026quot; \u0026quot;filecf84ddc73a0\u0026quot;\r## [137] \u0026quot;filecf84fe515d4\u0026quot; \u0026quot;filecf8500a5a10\u0026quot; \u0026quot;filecf8512766ea\u0026quot; \u0026quot;filecf852fe119b\u0026quot;\r## [141] \u0026quot;filecf8550a39d\u0026quot; \u0026quot;filecf85b14fec\u0026quot; \u0026quot;filecf85e053c83\u0026quot; \u0026quot;filecf85e6a12f4\u0026quot;\r## [145] \u0026quot;filecf8639c6053\u0026quot; \u0026quot;filecf863dc5f3b\u0026quot; \u0026quot;filecf8646e477f\u0026quot; \u0026quot;filecf865645c5d\u0026quot;\r## [149] \u0026quot;filecf868634c0d\u0026quot; \u0026quot;filecf869137c8a\u0026quot; \u0026quot;filecf86a7852d4\u0026quot; \u0026quot;filecf86b5b250\u0026quot; ## [153] \u0026quot;filecf86b9e3bb7\u0026quot; \u0026quot;filecf86d216ac\u0026quot; \u0026quot;filecf86e894a16\u0026quot; \u0026quot;filecf86ea916d3\u0026quot;\r## [157] \u0026quot;filecf86f22266\u0026quot; \u0026quot;filecf86f975377\u0026quot; \u0026quot;filecf8757a72be\u0026quot; \u0026quot;filecf876956e82\u0026quot;\r## [161] \u0026quot;filecf876967b1\u0026quot; \u0026quot;filecf8787a1370\u0026quot; \u0026quot;filecf879037c39\u0026quot; \u0026quot;filecf87964711\u0026quot; ## [165] \u0026quot;filecf87afe7046\u0026quot; \u0026quot;filecf88456ae0\u0026quot; \u0026quot;filecf898344ab\u0026quot;\r # Agora vamos ler todos de volta para uma tibble s√≥.\rarqs \u0026lt;- dir(pasta, pattern = \u0026quot;.csv\u0026quot;, full.names = T)\r # Juntando linhas\rdf \u0026lt;- map_dfr(arqs, read_csv)\rdf\r ## # A tibble: 1,000 x 2\r## var1 var2\r## \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt;\r## 1 0.837 -0.554\r## 2 -1.12 1.08 ## 3 -0.821 1.21 ## 4 0.384 0.465\r## 5 0.885 0.477\r## 6 -0.194 0.517\r## 7 0.710 0.128\r## 8 -1.04 -0.947\r## 9 0.782 1.58 ## 10 0.571 0.990\r## # ... with 990 more rows\r # Juntando colunas\rdf \u0026lt;- map_dfc(arqs, read_csv)\rdf\r ## # A tibble: 10 x 200\r## var1...1 var2...2 var1...3 var2...4 var1...5 var2...6 var1...7 var2...8\r## \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt;\r## 1 0.837 -0.554 -1.35 0.522 1.49 0.648 -0.567 -0.868\r## 2 -1.12 1.08 0.876 2.11 0.0449 0.0737 -0.808 0.177\r## 3 -0.821 1.21 1.77 -1.31 1.51 1.35 0.559 -0.119\r## 4 0.384 0.465 -0.496 1.10 1.13 -0.331 0.427 0.131\r## 5 0.885 0.477 -0.514 -0.573 -0.0704 0.581 0.751 0.629\r## 6 -0.194 0.517 0.362 -1.62 -0.725 -2.37 0.710 -0.293\r## 7 0.710 0.128 1.11 0.144 0.00462 1.66 1.32 -0.414\r## 8 -1.04 -0.947 0.00775 -1.27 0.0365 0.0813 -1.10 0.757\r## 9 0.782 1.58 0.695 -0.375 -0.342 0.341 -0.325 0.834\r## 10 0.571 0.990 -0.475 -0.356 -1.17 -0.827 -0.148 -1.29 ## # ... with 192 more variables: var1...9 \u0026lt;dbl\u0026gt;, var2...10 \u0026lt;dbl\u0026gt;,\r## # var1...11 \u0026lt;dbl\u0026gt;, var2...12 \u0026lt;dbl\u0026gt;, var1...13 \u0026lt;dbl\u0026gt;, var2...14 \u0026lt;dbl\u0026gt;,\r## # var1...15 \u0026lt;dbl\u0026gt;, var2...16 \u0026lt;dbl\u0026gt;, var1...17 \u0026lt;dbl\u0026gt;, var2...18 \u0026lt;dbl\u0026gt;,\r## # var1...19 \u0026lt;dbl\u0026gt;, var2...20 \u0026lt;dbl\u0026gt;, var1...21 \u0026lt;dbl\u0026gt;, var2...22 \u0026lt;dbl\u0026gt;,\r## # var1...23 \u0026lt;dbl\u0026gt;, var2...24 \u0026lt;dbl\u0026gt;, var1...25 \u0026lt;dbl\u0026gt;, var2...26 \u0026lt;dbl\u0026gt;,\r## # var1...27 \u0026lt;dbl\u0026gt;, var2...28 \u0026lt;dbl\u0026gt;, var1...29 \u0026lt;dbl\u0026gt;, var2...30 \u0026lt;dbl\u0026gt;,\r## # var1...31 \u0026lt;dbl\u0026gt;, var2...32 \u0026lt;dbl\u0026gt;, var1...33 \u0026lt;dbl\u0026gt;, var2...34 \u0026lt;dbl\u0026gt;,\r## # var1...35 \u0026lt;dbl\u0026gt;, var2...36 \u0026lt;dbl\u0026gt;, var1...37 \u0026lt;dbl\u0026gt;, var2...38 \u0026lt;dbl\u0026gt;,\r## # var1...39 \u0026lt;dbl\u0026gt;, var2...40 \u0026lt;dbl\u0026gt;, var1...41 \u0026lt;dbl\u0026gt;, var2...42 \u0026lt;dbl\u0026gt;,\r## # var1...43 \u0026lt;dbl\u0026gt;, var2...44 \u0026lt;dbl\u0026gt;, var1...45 \u0026lt;dbl\u0026gt;, var2...46 \u0026lt;dbl\u0026gt;,\r## # var1...47 \u0026lt;dbl\u0026gt;, var2...48 \u0026lt;dbl\u0026gt;, var1...49 \u0026lt;dbl\u0026gt;, var2...50 \u0026lt;dbl\u0026gt;,\r## # var1...51 \u0026lt;dbl\u0026gt;, var2...52 \u0026lt;dbl\u0026gt;, var1...53 \u0026lt;dbl\u0026gt;, var2...54 \u0026lt;dbl\u0026gt;,\r## # var1...55 \u0026lt;dbl\u0026gt;, var2...56 \u0026lt;dbl\u0026gt;, var1...57 \u0026lt;dbl\u0026gt;, var2...58 \u0026lt;dbl\u0026gt;,\r## # var1...59 \u0026lt;dbl\u0026gt;, var2...60 \u0026lt;dbl\u0026gt;, var1...61 \u0026lt;dbl\u0026gt;, var2...62 \u0026lt;dbl\u0026gt;,\r## # var1...63 \u0026lt;dbl\u0026gt;, var2...64 \u0026lt;dbl\u0026gt;, var1...65 \u0026lt;dbl\u0026gt;, var2...66 \u0026lt;dbl\u0026gt;,\r## # var1...67 \u0026lt;dbl\u0026gt;, var2...68 \u0026lt;dbl\u0026gt;, var1...69 \u0026lt;dbl\u0026gt;, var2...70 \u0026lt;dbl\u0026gt;,\r## # var1...71 \u0026lt;dbl\u0026gt;, var2...72 \u0026lt;dbl\u0026gt;, var1...73 \u0026lt;dbl\u0026gt;, var2...74 \u0026lt;dbl\u0026gt;,\r## # var1...75 \u0026lt;dbl\u0026gt;, var2...76 \u0026lt;dbl\u0026gt;, var1...77 \u0026lt;dbl\u0026gt;, var2...78 \u0026lt;dbl\u0026gt;,\r## # var1...79 \u0026lt;dbl\u0026gt;, var2...80 \u0026lt;dbl\u0026gt;, var1...81 \u0026lt;dbl\u0026gt;, var2...82 \u0026lt;dbl\u0026gt;,\r## # var1...83 \u0026lt;dbl\u0026gt;, var2...84 \u0026lt;dbl\u0026gt;, var1...85 \u0026lt;dbl\u0026gt;, var2...86 \u0026lt;dbl\u0026gt;,\r## # var1...87 \u0026lt;dbl\u0026gt;, var2...88 \u0026lt;dbl\u0026gt;, var1...89 \u0026lt;dbl\u0026gt;, var2...90 \u0026lt;dbl\u0026gt;,\r## # var1...91 \u0026lt;dbl\u0026gt;, var2...92 \u0026lt;dbl\u0026gt;, var1...93 \u0026lt;dbl\u0026gt;, var2...94 \u0026lt;dbl\u0026gt;,\r## # var1...95 \u0026lt;dbl\u0026gt;, var2...96 \u0026lt;dbl\u0026gt;, var1...97 \u0026lt;dbl\u0026gt;, var2...98 \u0026lt;dbl\u0026gt;,\r## # var1...99 \u0026lt;dbl\u0026gt;, var2...100 \u0026lt;dbl\u0026gt;, var1...101 \u0026lt;dbl\u0026gt;, var2...102 \u0026lt;dbl\u0026gt;,\r## # var1...103 \u0026lt;dbl\u0026gt;, var2...104 \u0026lt;dbl\u0026gt;, var1...105 \u0026lt;dbl\u0026gt;, var2...106 \u0026lt;dbl\u0026gt;,\r## # var1...107 \u0026lt;dbl\u0026gt;, var2...108 \u0026lt;dbl\u0026gt;, ...\r # Usando reduce\r# linhas\rdf \u0026lt;- map(arqs, read_csv) %\u0026gt;% reduce(bind_rows)\rdf\r ## # A tibble: 1,000 x 2\r## var1 var2\r## \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt;\r## 1 0.837 -0.554\r## 2 -1.12 1.08 ## 3 -0.821 1.21 ## 4 0.384 0.465\r## 5 0.885 0.477\r## 6 -0.194 0.517\r## 7 0.710 0.128\r## 8 -1.04 -0.947\r## 9 0.782 1.58 ## 10 0.571 0.990\r## # ... with 990 more rows\r # colunas\rdf \u0026lt;- map(arqs, read_csv) %\u0026gt;% reduce(bind_cols)\rdf\r ## # A tibble: 10 x 200\r## var1...1 var2...2 var1...3 var2...4 var1...5 var2...6 var1...7 var2...8\r## \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt;\r## 1 0.837 -0.554 -1.35 0.522 1.49 0.648 -0.567 -0.868\r## 2 -1.12 1.08 0.876 2.11 0.0449 0.0737 -0.808 0.177\r## 3 -0.821 1.21 1.77 -1.31 1.51 1.35 0.559 -0.119\r## 4 0.384 0.465 -0.496 1.10 1.13 -0.331 0.427 0.131\r## 5 0.885 0.477 -0.514 -0.573 -0.0704 0.581 0.751 0.629\r## 6 -0.194 0.517 0.362 -1.62 -0.725 -2.37 0.710 -0.293\r## 7 0.710 0.128 1.11 0.144 0.00462 1.66 1.32 -0.414\r## 8 -1.04 -0.947 0.00775 -1.27 0.0365 0.0813 -1.10 0.757\r## 9 0.782 1.58 0.695 -0.375 -0.342 0.341 -0.325 0.834\r## 10 0.571 0.990 -0.475 -0.356 -1.17 -0.827 -0.148 -1.29 ## # ... with 192 more variables: var1...9 \u0026lt;dbl\u0026gt;, var2...10 \u0026lt;dbl\u0026gt;,\r## # var1...11 \u0026lt;dbl\u0026gt;, var2...12 \u0026lt;dbl\u0026gt;, var1...13 \u0026lt;dbl\u0026gt;, var2...14 \u0026lt;dbl\u0026gt;,\r## # var1...15 \u0026lt;dbl\u0026gt;, var2...16 \u0026lt;dbl\u0026gt;, var1...17 \u0026lt;dbl\u0026gt;, var2...18 \u0026lt;dbl\u0026gt;,\r## # var1...19 \u0026lt;dbl\u0026gt;, var2...20 \u0026lt;dbl\u0026gt;, var1...21 \u0026lt;dbl\u0026gt;, var2...22 \u0026lt;dbl\u0026gt;,\r## # var1...23 \u0026lt;dbl\u0026gt;, var2...24 \u0026lt;dbl\u0026gt;, var1...25 \u0026lt;dbl\u0026gt;, var2...26 \u0026lt;dbl\u0026gt;,\r## # var1...27 \u0026lt;dbl\u0026gt;, var2...28 \u0026lt;dbl\u0026gt;, var1...29 \u0026lt;dbl\u0026gt;, var2...30 \u0026lt;dbl\u0026gt;,\r## # var1...31 \u0026lt;dbl\u0026gt;, var2...32 \u0026lt;dbl\u0026gt;, var1...33 \u0026lt;dbl\u0026gt;, var2...34 \u0026lt;dbl\u0026gt;,\r## # var1...35 \u0026lt;dbl\u0026gt;, var2...36 \u0026lt;dbl\u0026gt;, var1...37 \u0026lt;dbl\u0026gt;, var2...38 \u0026lt;dbl\u0026gt;,\r## # var1...39 \u0026lt;dbl\u0026gt;, var2...40 \u0026lt;dbl\u0026gt;, var1...41 \u0026lt;dbl\u0026gt;, var2...42 \u0026lt;dbl\u0026gt;,\r## # var1...43 \u0026lt;dbl\u0026gt;, var2...44 \u0026lt;dbl\u0026gt;, var1...45 \u0026lt;dbl\u0026gt;, var2...46 \u0026lt;dbl\u0026gt;,\r## # var1...47 \u0026lt;dbl\u0026gt;, var2...48 \u0026lt;dbl\u0026gt;, var1...49 \u0026lt;dbl\u0026gt;, var2...50 \u0026lt;dbl\u0026gt;,\r## # var1...51 \u0026lt;dbl\u0026gt;, var2...52 \u0026lt;dbl\u0026gt;, var1...53 \u0026lt;dbl\u0026gt;, var2...54 \u0026lt;dbl\u0026gt;,\r## # var1...55 \u0026lt;dbl\u0026gt;, var2...56 \u0026lt;dbl\u0026gt;, var1...57 \u0026lt;dbl\u0026gt;, var2...58 \u0026lt;dbl\u0026gt;,\r## # var1...59 \u0026lt;dbl\u0026gt;, var2...60 \u0026lt;dbl\u0026gt;, var1...61 \u0026lt;dbl\u0026gt;, var2...62 \u0026lt;dbl\u0026gt;,\r## # var1...63 \u0026lt;dbl\u0026gt;, var2...64 \u0026lt;dbl\u0026gt;, var1...65 \u0026lt;dbl\u0026gt;, var2...66 \u0026lt;dbl\u0026gt;,\r## # var1...67 \u0026lt;dbl\u0026gt;, var2...68 \u0026lt;dbl\u0026gt;, var1...69 \u0026lt;dbl\u0026gt;, var2...70 \u0026lt;dbl\u0026gt;,\r## # var1...71 \u0026lt;dbl\u0026gt;, var2...72 \u0026lt;dbl\u0026gt;, var1...73 \u0026lt;dbl\u0026gt;, var2...74 \u0026lt;dbl\u0026gt;,\r## # var1...75 \u0026lt;dbl\u0026gt;, var2...76 \u0026lt;dbl\u0026gt;, var1...77 \u0026lt;dbl\u0026gt;, var2...78 \u0026lt;dbl\u0026gt;,\r## # var1...79 \u0026lt;dbl\u0026gt;, var2...80 \u0026lt;dbl\u0026gt;, var1...81 \u0026lt;dbl\u0026gt;, var2...82 \u0026lt;dbl\u0026gt;,\r## # var1...83 \u0026lt;dbl\u0026gt;, var2...84 \u0026lt;dbl\u0026gt;, var1...85 \u0026lt;dbl\u0026gt;, var2...86 \u0026lt;dbl\u0026gt;,\r## # var1...87 \u0026lt;dbl\u0026gt;, var2...88 \u0026lt;dbl\u0026gt;, var1...89 \u0026lt;dbl\u0026gt;, var2...90 \u0026lt;dbl\u0026gt;,\r## # var1...91 \u0026lt;dbl\u0026gt;, var2...92 \u0026lt;dbl\u0026gt;, var1...93 \u0026lt;dbl\u0026gt;, var2...94 \u0026lt;dbl\u0026gt;,\r## # var1...95 \u0026lt;dbl\u0026gt;, var2...96 \u0026lt;dbl\u0026gt;, var1...97 \u0026lt;dbl\u0026gt;, var2...98 \u0026lt;dbl\u0026gt;,\r## # var1...99 \u0026lt;dbl\u0026gt;, var2...100 \u0026lt;dbl\u0026gt;, var1...101 \u0026lt;dbl\u0026gt;, var2...102 \u0026lt;dbl\u0026gt;,\r## # var1...103 \u0026lt;dbl\u0026gt;, var2...104 \u0026lt;dbl\u0026gt;, var1...105 \u0026lt;dbl\u0026gt;, var2...106 \u0026lt;dbl\u0026gt;,\r## # var1...107 \u0026lt;dbl\u0026gt;, var2...108 \u0026lt;dbl\u0026gt;, ...\r Escreva um c√≥digo sucinto que implemente v√°rios modelos lineares especificados por voc√™. Salve os resultados numa tibble com colunas-lista. Depois, extraia os resultados com unnest(). Use o exemplo como guia.  mtcars\r ## mpg cyl disp hp drat wt qsec vs am gear carb\r## Mazda RX4 21.0 6 160.0 110 3.90 2.620 16.46 0 1 4 4\r## Mazda RX4 Wag 21.0 6 160.0 110 3.90 2.875 17.02 0 1 4 4\r## Datsun 710 22.8 4 108.0 93 3.85 2.320 18.61 1 1 4 1\r## Hornet 4 Drive 21.4 6 258.0 110 3.08 3.215 19.44 1 0 3 1\r## Hornet Sportabout 18.7 8 360.0 175 3.15 3.440 17.02 0 0 3 2\r## Valiant 18.1 6 225.0 105 2.76 3.460 20.22 1 0 3 1\r## Duster 360 14.3 8 360.0 245 3.21 3.570 15.84 0 0 3 4\r## Merc 240D 24.4 4 146.7 62 3.69 3.190 20.00 1 0 4 2\r## Merc 230 22.8 4 140.8 95 3.92 3.150 22.90 1 0 4 2\r## Merc 280 19.2 6 167.6 123 3.92 3.440 18.30 1 0 4 4\r## Merc 280C 17.8 6 167.6 123 3.92 3.440 18.90 1 0 4 4\r## Merc 450SE 16.4 8 275.8 180 3.07 4.070 17.40 0 0 3 3\r## Merc 450SL 17.3 8 275.8 180 3.07 3.730 17.60 0 0 3 3\r## Merc 450SLC 15.2 8 275.8 180 3.07 3.780 18.00 0 0 3 3\r## Cadillac Fleetwood 10.4 8 472.0 205 2.93 5.250 17.98 0 0 3 4\r## Lincoln Continental 10.4 8 460.0 215 3.00 5.424 17.82 0 0 3 4\r## Chrysler Imperial 14.7 8 440.0 230 3.23 5.345 17.42 0 0 3 4\r## Fiat 128 32.4 4 78.7 66 4.08 2.200 19.47 1 1 4 1\r## Honda Civic 30.4 4 75.7 52 4.93 1.615 18.52 1 1 4 2\r## Toyota Corolla 33.9 4 71.1 65 4.22 1.835 19.90 1 1 4 1\r## Toyota Corona 21.5 4 120.1 97 3.70 2.465 20.01 1 0 3 1\r## Dodge Challenger 15.5 8 318.0 150 2.76 3.520 16.87 0 0 3 2\r## AMC Javelin 15.2 8 304.0 150 3.15 3.435 17.30 0 0 3 2\r## Camaro Z28 13.3 8 350.0 245 3.73 3.840 15.41 0 0 3 4\r## Pontiac Firebird 19.2 8 400.0 175 3.08 3.845 17.05 0 0 3 2\r## Fiat X1-9 27.3 4 79.0 66 4.08 1.935 18.90 1 1 4 1\r## Porsche 914-2 26.0 4 120.3 91 4.43 2.140 16.70 0 1 5 2\r## Lotus Europa 30.4 4 95.1 113 3.77 1.513 16.90 1 1 5 2\r## Ford Pantera L 15.8 8 351.0 264 4.22 3.170 14.50 0 1 5 4\r## Ferrari Dino 19.7 6 145.0 175 3.62 2.770 15.50 0 1 5 6\r## Maserati Bora 15.0 8 301.0 335 3.54 3.570 14.60 0 1 5 8\r## Volvo 142E 21.4 4 121.0 109 4.11 2.780 18.60 1 1 4 2\r modelos \u0026lt;- c(\u0026quot;mpg ~ wt\u0026quot;,\r\u0026quot;mpg ~ wt + cyl\u0026quot;,\r\u0026quot;mpg ~ wt + cyl + drat\u0026quot;,\r\u0026quot;mpg ~ wt + cyl + drat + am\u0026quot;)\r# Estou usando fun√ß√µes do pacote broom, mas voc√™ n√£o era obrigado a apresentar\r# os resultados bonitinho. O objetivo era treinar esse tipo de workflow.\rmodelos_saida \u0026lt;- tibble(\respecificacao = modelos,\rajuste = map(especificacao, lm, data = mtcars),\rcoefs = map(ajuste, broom::tidy),\rstats = map(ajuste, broom::glance),\raums = map(ajuste, broom::augment)\r)\rmodelos_saida %\u0026gt;% select(especificacao, coefs) %\u0026gt;% unnest(coefs) %\u0026gt;% filter(term != \u0026quot;(Intercept)\u0026quot;)  ## # A tibble: 10 x 6\r## especificacao term estimate std.error statistic p.value\r## \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt;\r## 1 mpg ~ wt wt -5.34 0.559 -9.56 1.29e-10\r## 2 mpg ~ wt + cyl wt -3.19 0.757 -4.22 2.22e- 4\r## 3 mpg ~ wt + cyl cyl -1.51 0.415 -3.64 1.06e- 3\r## 4 mpg ~ wt + cyl + drat wt -3.19 0.829 -3.85 6.24e- 4\r## 5 mpg ~ wt + cyl + drat cyl -1.51 0.446 -3.38 2.14e- 3\r## 6 mpg ~ wt + cyl + drat drat -0.0162 1.32 -0.0122 9.90e- 1\r## 7 mpg ~ wt + cyl + drat + am wt -3.13 0.932 -3.36 2.32e- 3\r## 8 mpg ~ wt + cyl + drat + am cyl -1.53 0.465 -3.28 2.88e- 3\r## 9 mpg ~ wt + cyl + drat + am drat -0.130 1.53 -0.0851 9.33e- 1\r## 10 mpg ~ wt + cyl + drat + am am 0.237 1.51 0.157 8.76e- 1\r modelos_saida %\u0026gt;% select(especificacao, stats) %\u0026gt;% unnest(stats)\r ## # A tibble: 4 x 13\r## especificacao r.squared adj.r.squared sigma statistic p.value df logLik\r## \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt;\r## 1 mpg ~ wt 0.753 0.745 3.05 91.4 1.29e-10 1 -80.0\r## 2 mpg ~ wt + cyl 0.830 0.819 2.57 70.9 6.81e-12 2 -74.0\r## 3 mpg ~ wt + cyl ~ 0.830 0.812 2.61 45.6 6.57e-11 3 -74.0\r## 4 mpg ~ wt + cyl ~ 0.830 0.805 2.66 33.0 4.84e-10 4 -74.0\r## # ... with 5 more variables: AIC \u0026lt;dbl\u0026gt;, BIC \u0026lt;dbl\u0026gt;, deviance \u0026lt;dbl\u0026gt;,\r## # df.residual \u0026lt;int\u0026gt;, nobs \u0026lt;int\u0026gt;\r modelos_saida %\u0026gt;% select(especificacao, aums) %\u0026gt;% filter(especificacao == \u0026quot;mpg ~ wt + cyl + drat + am\u0026quot;) %\u0026gt;% unnest(aums)\r ## # A tibble: 32 x 13\r## especificacao .rownames mpg wt cyl drat am .fitted .resid .hat\r## \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt;\r## 1 mpg ~ wt + cyl~ Mazda RX4 21 2.62 6 3.9 1 22.3 -1.35 0.0899\r## 2 mpg ~ wt + cyl~ Mazda RX~ 21 2.88 6 3.9 1 21.6 -0.550 0.0924\r## 3 mpg ~ wt + cyl~ Datsun 7~ 22.8 2.32 4 3.85 1 26.3 -3.55 0.137 ## 4 mpg ~ wt + cyl~ Hornet 4~ 21.4 3.22 6 3.08 0 20.4 1.05 0.113 ## 5 mpg ~ wt + cyl~ Hornet S~ 18.7 3.44 8 3.15 0 16.6 2.11 0.122 ## 6 mpg ~ wt + cyl~ Valiant 18.1 3.46 6 2.76 0 19.6 -1.53 0.207 ## 7 mpg ~ wt + cyl~ Duster 3~ 14.3 3.57 8 3.21 0 16.2 -1.87 0.103 ## 8 mpg ~ wt + cyl~ Merc 240D 24.4 3.19 4 3.69 0 23.4 0.996 0.189 ## 9 mpg ~ wt + cyl~ Merc 230 22.8 3.15 4 3.92 0 23.5 -0.700 0.207 ## 10 mpg ~ wt + cyl~ Merc 280 19.2 3.44 6 3.92 0 19.5 -0.340 0.149 ## # ... with 22 more rows, and 3 more variables: .sigma \u0026lt;dbl\u0026gt;, .cooksd \u0026lt;dbl\u0026gt;,\r## # .std.resid \u0026lt;dbl\u0026gt;\r ","date":1621900800,"expirydate":-62135596800,"kind":"page","lang":"en","lastmod":1621900800,"objectID":"c1c74f268683837301969e7167daf1ed","permalink":"https://laddem.github.io/courses/tidyverse/solucoes/","publishdate":"2021-05-25T00:00:00Z","relpermalink":"/courses/tidyverse/solucoes/","section":"courses","summary":"Solu√ß√µes dos exerc√≠cios","tags":null,"title":"Solu√ß√µes","type":"book"},{"authors":["LADDEM"],"categories":null,"content":"\rCreate your slides in Markdown - click the Slides button to check out the example.\r\r\rSupplementary notes can be added here, including code, math, and images.\n","date":1554595200,"expirydate":-62135596800,"kind":"page","lang":"en","lastmod":1554595200,"objectID":"557dc08fd4b672a0c08e0a8cf0c9ff7d","permalink":"https://laddem.github.io/publication/preprint/","publishdate":"2017-01-01T00:00:00Z","relpermalink":"/publication/preprint/","section":"publication","summary":"Lorem ipsum dolor sit amet, consectetur adipiscing elit. Duis posuere tellus ac convallis placerat. Proin tincidunt magna sed ex sollicitudin condimentum.","tags":["Source Themes"],"title":"An example preprint / working paper","type":"publication"},{"authors":[],"categories":[],"content":"Create slides in Markdown with Wowchemy Wowchemy | Documentation\n Features  Efficiently write slides in Markdown 3-in-1: Create, Present, and Publish your slides Supports speaker notes Mobile friendly slides   Controls  Next: Right Arrow or Space Previous: Left Arrow Start: Home Finish: End Overview: Esc Speaker notes: S Fullscreen: F Zoom: Alt + Click PDF Export: E   Code Highlighting Inline code: variable\nCode block:\nporridge = \u0026quot;blueberry\u0026quot;\rif porridge == \u0026quot;blueberry\u0026quot;:\rprint(\u0026quot;Eating...\u0026quot;)\r  Math In-line math: $x + y = z$\nBlock math:\n$$ f\\left( x \\right) = ;\\frac{{2\\left( {x + 4} \\right)\\left( {x - 4} \\right)}}{{\\left( {x + 4} \\right)\\left( {x + 1} \\right)}} $$\n Fragments Make content appear incrementally\n{{% fragment %}} One {{% /fragment %}}\r{{% fragment %}} **Two** {{% /fragment %}}\r{{% fragment %}} Three {{% /fragment %}}\r Press Space to play!\nOne  Two  Three \n A fragment can accept two optional parameters:\n class: use a custom style (requires definition in custom CSS) weight: sets the order in which a fragment appears   Speaker Notes Add speaker notes to your presentation\n{{% speaker_note %}}\r- Only the speaker can read these notes\r- Press `S` key to view\r{{% /speaker_note %}}\r Press the S key to view the speaker notes!\n Only the speaker can read these notes Press S key to view    Themes  black: Black background, white text, blue links (default) white: White background, black text, blue links league: Gray background, white text, blue links beige: Beige background, dark text, brown links sky: Blue background, thin dark text, blue links    night: Black background, thick white text, orange links serif: Cappuccino background, gray text, brown links simple: White background, black text, blue links solarized: Cream-colored background, dark green text, blue links   Custom Slide Customize the slide style and background\n{{\u0026lt; slide background-image=\u0026quot;/media/boards.jpg\u0026quot; \u0026gt;}}\r{{\u0026lt; slide background-color=\u0026quot;#0000FF\u0026quot; \u0026gt;}}\r{{\u0026lt; slide class=\u0026quot;my-style\u0026quot; \u0026gt;}}\r  Custom CSS Example Let\u0026rsquo;s make headers navy colored.\nCreate assets/css/reveal_custom.css with:\n.reveal section h1,\r.reveal section h2,\r.reveal section h3 {\rcolor: navy;\r}\r  Questions? Ask\nDocumentation\n","date":1549324800,"expirydate":-62135596800,"kind":"page","lang":"en","lastmod":1549324800,"objectID":"0e6de1a61aa83269ff13324f3167c1a9","permalink":"https://laddem.github.io/slides/example/","publishdate":"2019-02-05T00:00:00Z","relpermalink":"/slides/example/","section":"slides","summary":"An introduction to using Wowchemy's Slides feature.","tags":[],"title":"Slides","type":"slides"},{"authors":["LADDEM","Robert Ford"],"categories":null,"content":"\rClick the Cite button above to demo the feature to enable visitors to import publication metadata into their reference management software.\r\r\r\rCreate your slides in Markdown - click the Slides button to check out the example.\r\r\rSupplementary notes can be added here, including code, math, and images.\n","date":1441065600,"expirydate":-62135596800,"kind":"page","lang":"en","lastmod":1441065600,"objectID":"966884cc0d8ac9e31fab966c4534e973","permalink":"https://laddem.github.io/publication/journal-article/","publishdate":"2017-01-01T00:00:00Z","relpermalink":"/publication/journal-article/","section":"publication","summary":"Lorem ipsum dolor sit amet, consectetur adipiscing elit. Duis posuere tellus ac convallis placerat. Proin tincidunt magna sed ex sollicitudin condimentum.","tags":["Source Themes"],"title":"An example journal article","type":"publication"},{"authors":["LADDEM","Robert Ford"],"categories":null,"content":"\rClick the Cite button above to demo the feature to enable visitors to import publication metadata into their reference management software.\r\r\r\rCreate your slides in Markdown - click the Slides button to check out the example.\r\r\rSupplementary notes can be added here, including code, math, and images.\n","date":1372636800,"expirydate":-62135596800,"kind":"page","lang":"en","lastmod":1372636800,"objectID":"69425fb10d4db090cfbd46854715582c","permalink":"https://laddem.github.io/publication/conference-paper/","publishdate":"2017-01-01T00:00:00Z","relpermalink":"/publication/conference-paper/","section":"publication","summary":"Lorem ipsum dolor sit amet, consectetur adipiscing elit. Duis posuere tellus ac convallis placerat. Proin tincidunt magna sed ex sollicitudin condimentum.","tags":["Source Themes"],"title":"An example conference paper","type":"publication"},{"authors":null,"categories":null,"content":"","date":-62135596800,"expirydate":-62135596800,"kind":"page","lang":"en","lastmod":-62135596800,"objectID":"f26b5133c34eec1aa0a09390a36c2ade","permalink":"https://laddem.github.io/admin/config.yml","publishdate":"0001-01-01T00:00:00Z","relpermalink":"/admin/config.yml","section":"","summary":"","tags":null,"title":"","type":"wowchemycms"}]
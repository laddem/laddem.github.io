<!DOCTYPE html><html lang="pt" >

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  
  
  
    <meta name="generator" content="Wowchemy 5.1.0 for Hugo" />
  

  

  
  
  
  
  
    
    
    
  
  

  <meta name="author" content="LADDEM" />

  
  
  
    
  
  <meta name="description" content="O autor dos pacotes do tidyverse core é completamente fascinado por gatos, por isso, tantas referências ao bixo nos nomes dos pacotes. &ldquo;Purr&rdquo; (em inglês) é o som que os gatos fazem quando sentem prazer." />

  
  <link rel="alternate" hreflang="pt" href="https://laddem.github.io/courses/tidyverse/dia4/" />

  







  




  
  
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  

  
  
  
    <meta name="theme-color" content="rgb(251, 191, 183)" />
  

  
  

  
  
  
  
    
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css" integrity="sha256-FMvZuGapsJLjouA6k7Eo2lusoAX9i0ShlWFG6qt7SLc=" crossorigin="anonymous">

    
    

    
    
    
      
    
    
      
      
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/styles/purebasic.min.css" crossorigin="anonymous" title="hl-light" media="print" onload="this.media='all'">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/styles/purebasic.min.css" crossorigin="anonymous" title="hl-dark" media="print" onload="this.media='all'" disabled>
      
    

    
    
    
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/leaflet.min.css" integrity="sha512-1xoFisiGdy9nvho8EgXuXvnpR5GAMSjFwp40gSRE3NwdUdIMIKuPa7bqoUhLD0O/5tPNhteAsE5XyyMi5reQVA==" crossorigin="anonymous" media="print" onload="this.media='all'">
    

    

    
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      
        
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
  

  
  
  
    
      
      <link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=Cutive+Mono&family=Lora:wght@400;700&family=Roboto:wght@400;700&display=swap&display=swap">
      <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Cutive+Mono&family=Lora:wght@400;700&family=Roboto:wght@400;700&display=swap&display=swap" media="print" onload="this.media='all'">
    
  

  
  
  
  
  
  <link rel="stylesheet" href="/css/wowchemy.46f8102c91669d08bf92f59f6531234a.css" />

  



  

  

  




  
  
  

  

  
    <link rel="manifest" href="/index.webmanifest" />
  

  <link rel="icon" type="image/png" href="/media/icon_hua2ec155b4296a9c9791d015323e16eb5_11927_32x32_fill_lanczos_center_2.png" />
  <link rel="apple-touch-icon" type="image/png" href="/media/icon_hua2ec155b4296a9c9791d015323e16eb5_11927_180x180_fill_lanczos_center_2.png" />

  <link rel="canonical" href="https://laddem.github.io/courses/tidyverse/dia4/" />

  
  
  
  
  
  
  
  
    
    
  
  
  <meta property="twitter:card" content="summary" />
  
  <meta property="og:site_name" content="LADDEM" />
  <meta property="og:url" content="https://laddem.github.io/courses/tidyverse/dia4/" />
  <meta property="og:title" content="purrr | LADDEM" />
  <meta property="og:description" content="O autor dos pacotes do tidyverse core é completamente fascinado por gatos, por isso, tantas referências ao bixo nos nomes dos pacotes. &ldquo;Purr&rdquo; (em inglês) é o som que os gatos fazem quando sentem prazer." /><meta property="og:image" content="https://laddem.github.io/media/logo_hu21999b1509efcb95cf9a1f4a62aafaa3_109704_300x300_fit_lanczos_2.png" />
    <meta property="twitter:image" content="https://laddem.github.io/media/logo_hu21999b1509efcb95cf9a1f4a62aafaa3_109704_300x300_fit_lanczos_2.png" /><meta property="og:locale" content="pt" />
  
    
      <meta
        property="article:published_time"
        content="2021-05-23T00:00:00&#43;00:00"
      />
    
    <meta property="article:modified_time" content="2021-05-23T00:00:00&#43;00:00">
  

  



  

  

  





  <title>purrr | LADDEM</title>
</head>


<body id="top" data-spy="scroll" data-offset="70" data-target="#TableOfContents" class="page-wrapper   " data-wc-page-id="8fc2c9a43ba39b58554f36d137f8df4b" >

  
  
  
  
  
  
  
  
  <script src="/js/wowchemy-init.min.f16be01fc8fb2b5885dd67ce942d1185.js"></script>

  


<aside class="search-modal" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between mb-3">
        <div class="col-6">
          <h1>Search</h1>
        </div>
        <div class="col-6 col-search-close">
          <a class="js-search" href="#" aria-label="Close"><i class="fas fa-times-circle text-muted" aria-hidden="true"></i></a>
        </div>
      </div>

      <div id="search-box">
        
        <input name="q" id="search-query" placeholder="Search..." autocapitalize="off"
        autocomplete="off" autocorrect="off" spellcheck="false" type="search" class="form-control"
        aria-label="Search...">
        
      </div>

      
      

      

    </section>
    <section class="section-search-results">

      <div id="search-hits">
        
      </div>

    </section>
  </div>
</aside>



  <div class="page-header">
    











  


<nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id="navbar-main">
  <div class="container-xl">

    
    <div class="d-none d-lg-inline-flex">
      <a class="navbar-brand" href="/"><img src="/media/logo_hu21999b1509efcb95cf9a1f4a62aafaa3_109704_0x70_resize_lanczos_2.png" alt="LADDEM"></a>
    </div>
    

    
    <button type="button" class="navbar-toggler" data-toggle="collapse"
            data-target="#navbar-content" aria-controls="navbar-content" aria-expanded="false" aria-label="Toggle navigation">
    <span><i class="fas fa-bars"></i></span>
    </button>
    

    
    <div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none">
      <a class="navbar-brand" href="/"><img src="/media/logo_hu21999b1509efcb95cf9a1f4a62aafaa3_109704_0x70_resize_lanczos_2.png" alt="LADDEM"></a>
    </div>
    

    
    
    <div class="navbar-collapse main-menu-item collapse justify-content-start" id="navbar-content">

      
      <ul class="navbar-nav d-md-inline-flex">
        

        

        
        
        
          
        

        

        
        
        
        

        
          
            
            
          
          
            
            
            
              
            
            
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#about"><span>Sobre</span></a>
        </li>

        
        

        

        
        
        
          
        

        

        
        
        
        

        
          
            
            
          
          
        

        <li class="nav-item">
          <a class="nav-link  active" href="/courses/"><span>Cursos</span></a>
        </li>

        
        

        

        
        
        
          
        

        

        
        
        
        

        
          
            
            
          
          
            
            
            
              
            
            
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#contact"><span>Contato</span></a>
        </li>

        
        

      

        
      </ul>
    </div>

    <ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2">

      
      

      
      
      <li class="nav-item">
        <a class="nav-link js-search" href="#" aria-label="Search"><i class="fas fa-search" aria-hidden="true"></i></a>
      </li>
      

      
      
      <li class="nav-item dropdown theme-dropdown">
        <a href="#" class="nav-link" data-toggle="dropdown" aria-haspopup="true" aria-label="Display preferences">
          <i class="fas fa-moon" aria-hidden="true"></i>
        </a>
        <div class="dropdown-menu">
          <a href="#" class="dropdown-item js-set-theme-light">
            <span>Light</span>
          </a>
          <a href="#" class="dropdown-item js-set-theme-dark">
            <span>Dark</span>
          </a>
          <a href="#" class="dropdown-item js-set-theme-auto">
            <span>Automatic</span>
          </a>
        </div>
      </li>
      

      
      

    </ul>

  </div>
</nav>


  </div>

  <div class="page-body">
    





<div class="container-fluid docs">
  <div class="row flex-xl-nowrap">
    <div class="col-12 col-md-3 col-xl-2 docs-sidebar">
      <form class="docs-search d-flex align-items-center">
  <button class="btn docs-toggle d-md-none p-0 mr-md-3 w-100" type="button" data-toggle="collapse" data-target="#docs-nav" aria-controls="docs-nav" aria-expanded="false" aria-label="Toggle section navigation">
    <div class="d-flex">
      <span class="d-md-none pl-1 flex-grow-1 text-left overflow-hidden">
        
          Tidyverse
        
      </span>
      <span><i class="fas fa-chevron-down"></i></span>
    </div>
  </button>

  
  <button class="form-control sidebar-search js-search d-none d-md-flex">
    <i class="fas fa-search pr-2"></i>
    <span class="sidebar-search-text">Search...</span>
    <span class="sidebar-search-shortcut">/</span>
  </button>
  
</form>

<nav class="collapse docs-links" id="docs-nav">
  
  
  
  
  
  

  
  
    

    
      

      <ul class="nav docs-sidenav">
        <li><a href="/courses/"><i class="fas fa-arrow-left pr-1"></i>Cursos</a></li>
      </ul>

      
      
        
          
        
      


  
    
    
    
    
      
    
    

    
      <div class="docs-toc-item">
        <a class="docs-toc-link " href="/courses/tidyverse/">Tidyverse</a>
    
      
        <ul class="nav docs-sidenav">
      


  <li class=""><a href="/courses/tidyverse/dia1/">readr, tibble e tidyr</a></li>



  <li class=""><a href="/courses/tidyverse/dia2/">stringr, forcats e dplyr</a></li>



  <li class=""><a href="/courses/tidyverse/dia3/">ggplot2</a></li>



  <li class="active"><a href="/courses/tidyverse/dia4/">purrr</a></li>



  <li class=""><a href="/courses/tidyverse/solucoes/">Soluções</a></li>

      
        </ul>
      
    

    
      </div>
    

    
  
</nav>

    </div>

    
    
    <div class="d-none d-xl-block col-xl-2 docs-toc">
      

      <ul class="nav toc-top">
        <li><a href="#" id="back_to_top" class="docs-toc-title">Contents</a></li>
      </ul>

      <nav id="TableOfContents">
  <ul>
    <li><a href="#iterações">Iterações</a></li>
    <li><a href="#programação-funcional">Programação funcional</a>
      <ul>
        <li><a href="#o-pacote-purrr">o pacote <code>purrr</code></a></li>
      </ul>
    </li>
    <li><a href="#exercícios">Exercícios</a></li>
  </ul>
</nav>

      
    </div>
    

    <main class="col-12 col-md-9 col-xl-8 py-md-3 pl-md-5 docs-content" role="main">

      <article class="article">

        <div class="docs-article-container">
          
            
  <nav class="d-none d-md-flex" aria-label="breadcrumb">
    <ol class="breadcrumb">
      
  
  
  

  <li class="breadcrumb-item">
    <a href="/">
      
        Home
      
    </a>
  </li>


  <li class="breadcrumb-item">
    <a href="/courses/">
      
        Cursos
      
    </a>
  </li>


  <li class="breadcrumb-item">
    <a href="/courses/tidyverse/">
      
        Tidyverse
      
    </a>
  </li>


      <li class="breadcrumb-item active" aria-current="page">
        purrr
      </li>
    </ol>
  </nav>


          

          <h1>purrr</h1>

          <div class="article-style">
            <p>O autor dos pacotes do <code>tidyverse</code> core é completamente fascinado por gatos, por isso, tantas referências ao bixo nos nomes dos pacotes. &ldquo;Purr&rdquo; (em inglês) é o som que os gatos fazem quando sentem prazer. Pra não ficar uma coisa solta no começo da aula, aqui uma foto de gatinho pra vocês:</p>
<p><img src="/courses/tidyverse/dia4_files/amy-cat.jpg" alt="Amy, the cat"></p>
<!-- Inciting incident -->
<p>O assunto da aula de hoje é talvez um pouco mais abstrato do que as aulas anteriores. Vamos falar bastante de funções, loops e programação funcional. São termos que fazem parte do jargão da computação, mas que mesmo usuários veteranos do R como software estatístico para análise de dados podem ter pouca familiaridade. Ao invés de começar definindo o que vamos fazer, vou começar definindo o que não vamos.</p>
<ul>
<li>
<p>Não vamos revisar a fundo o assunto de iterações. Os livros fazem um bom serviço, é um assunto espinhoso e não basta compreender os conceitos, tem que botar a mão na massa pra ter um entendimento não apenas da teoria, mas também para conseguir resolver os muitos problemas que aparecem quando você está construindo iterações com maior nível de complexidade.</p>
</li>
<li>
<p>Não vamos cavar fundo em todos os aspectos da programação funcional ou de todas as funções do purrr. São muitas e temos poucas horas.</p>
</li>
</ul>
<p>Agora o que SIM vamos fazer é revisar muito brevemente a sintaxe de um for loop, ver em que situações a gente o utilizaria e como você pode substituir seus vários for loops por funções no purrr, com exemplos de aplicação quando possível. Se der tempo, vamos entrar um pouco na ideia de utilizar programação funcional para resolver problemas mais genéricos em que precisamos generalizar alguma tarefa.</p>
<pre><code class="language-r"># Primeiro, nossos pacotes!
library(tidyverse) # o purrr já é carregado automaticamente junto com os outros,
</code></pre>
<pre><code>## -- Attaching packages --------------------------------------- tidyverse 1.3.1 --
</code></pre>
<pre><code>## v ggplot2 3.3.3     v purrr   0.3.4
## v tibble  3.1.2     v dplyr   1.0.6
## v tidyr   1.1.3     v stringr 1.4.0
## v readr   1.4.0     v forcats 0.5.1
</code></pre>
<pre><code>## -- Conflicts ------------------------------------------ tidyverse_conflicts() --
## x dplyr::filter() masks stats::filter()
## x dplyr::lag()    masks stats::lag()
</code></pre>
<pre><code class="language-r"># Se quiser carregar apenas o purrr, descomente a linha abaixo
# library(purrr)
</code></pre>
<h2 id="iterações">Iterações</h2>
<p>Do ponto de vista prático, uma iteração é uma repetição uma linha de código de tal forma que apenas uma pequena parte previsível do código muda entre uma repetição e outra. Por exemplo, digamos que você vai calcular uma soma de <code>x</code>.</p>
<pre><code class="language-r">x &lt;- runif(100, 0, 1000)
x
</code></pre>
<pre><code>##   [1] 491.94739 164.27560 524.36914 866.27765 253.36220 225.24543  78.29772
##   [8] 357.58780 994.56048 654.03120 985.70844 497.08489 504.09899 839.73925
##  [15]  43.11656 519.63778 444.61380 156.41443 410.94224 947.47930  63.08629
##  [22] 827.30091 976.69109 424.60607  72.12105 375.64377 960.47816 459.19633
##  [29] 985.86296 540.60045 676.35885 890.76852 503.67907 405.99020 617.66746
##  [36]  12.91273 280.74314  73.19468 355.87083 201.78543 473.34184 529.19013
##  [43] 645.94875 154.77669 467.53343 337.76331 972.64527 752.72512 963.82065
##  [50] 233.92111 750.70806 257.24539  96.32026 314.92369 897.08074 384.30803
##  [57] 989.98028 826.36702 750.48403 838.24807 389.77781  33.33722 384.15943
##  [64] 760.61612  70.63002 635.17624 316.72375 520.49678 948.60908 129.05321
##  [71] 799.52966 263.40103 884.60398  64.07125 302.21134 961.23905  20.15687
##  [78] 967.98915 681.03552 107.79771 519.35700  91.57934 903.85422 386.50733
##  [85] 728.28959 484.12971 328.60899 786.48005 520.10581 745.03521 766.46533
##  [92] 208.22090 848.79566 601.09270 901.81389 659.24274 436.51706 117.33627
##  [99] 756.36146 855.07475
</code></pre>
<p>Esqueça, por um instante, a função <code>sum</code>. O cálculo da soma se dá pela soma de todos os elementos do vetor <code>x</code>. Então, é necessário repetir a operação de soma através da acumulação dos valores. Veja que é tudo totalmente previsível, cada nova repetição simplesmente adiciona mais um valor ao vetor original e esse valor pode ser encontrado na próxima posição de <code>x</code>. Esse é o típico caso de iteração. No R, a melhor prática é inicializar uma variável antes e salvar os resultados da iteração nela.</p>
<pre><code class="language-r"># Inicialização
result &lt;- x[[1]]

# Sequência
for (i in 2:length(x)) {
  # Corpo
  result &lt;- result + x[[i]]
}

# Comparando os dois resultados
result
</code></pre>
<pre><code>## [1] 52186.16
</code></pre>
<pre><code class="language-r">sum(x)
</code></pre>
<pre><code>## [1] 52186.16
</code></pre>
<p>Outro exemplo de mesmo tipo é repetição de uma mesma operação em vários vetores/colunas/variáveis comuns. Por exemplo, se eu tenho um <code>data.frame</code> com três colunas numéricas e eu gostaria de calcular a soma de cada uma.</p>
<pre><code class="language-r"># Data.frame
df &lt;- tibble(x = rnorm(100, 50, 25),
             y = rnorm(100, 100, 25),
             z = rnorm(100, 200, 25))

# Inicialização
result &lt;- vector(mode = &quot;double&quot;, length = length(df))

# Sequência
for (i in seq_along(df)) {
  result[[i]] &lt;- sum(df[[i]])
}

# Resultado
result
</code></pre>
<pre><code>## [1]  4988.478  9590.577 19787.007
</code></pre>
<p>Essa é a minha revisão de 5 minutos de iteração em R usando <code>for</code> loops. Como já é de costume, tem muito mais. Por exemplo, existe um outro tipo de iterador no R básico chamado <code>while</code>, que tem um funcionamento diferente do <code>for</code>. Ao invés de você ter um resultado de tamanho previsível, você pode ter um resultado de tamanho desconhecido. Vou deixar o <code>while</code> para vocês pesquisarem porque o bom e velho <code>for</code> costuma cobrir a maioria dos casos de uso do cientista de dados.</p>
<h2 id="programação-funcional">Programação funcional</h2>
<p>Beleza, agora que já dominamos (ou não) o <code>for</code> loop, encontramos várias situações em que a gente gostaria de realizar a mesma operação várias vezes, mas, o <code>for</code> loop é como uma feijoada: é gostoso, mas é pesado. <code>For</code> loops em geral são &ldquo;verbosos&rdquo;, você precisa escrever bastante para chegar em um determinado resultado e, depois de escrever alguns, você cansa de ter que repetir todos os pedaços dele. E se você pudesse <strong>abstrair</strong> o loop para uma função? Aí você não precisaria escrever toda aquela parafernalha.</p>
<pre><code class="language-r">soma &lt;- function(x) {
  result &lt;- 0
  for (i in 1:length(x)) {
    result &lt;- result + x[[i]]
  }
  result
}

soma(x)
</code></pre>
<pre><code>## [1] 52186.16
</code></pre>
<p>Ao fazer isso, eu ganho duas vantagens:</p>
<ul>
<li>
<p>Manutenção: sempre que eu precisar repetir a operação, eu consigo simplificar muito meu código. Não preciso escrever um for loop para cada soma que eu precisar fazer. Se meus requerimentos mudarem no futuro, eu só preciso mudar um pedaço de código.</p>
</li>
<li>
<p>Leitura: o humano que lê um <code>for</code> loop vai precisar de um minuto para se familiarizar com a operação e entender o que está sendo iterado, calculado, etc. O humano que lê &ldquo;soma&rdquo; sabe que ocorrerá uma soma. Você alinha a <strong>expectativa</strong> com a <strong>execução</strong>.</p>
</li>
</ul>
<p>Outro exemplo.</p>
<pre><code class="language-r">soma_xyz &lt;- function(x) {
  soma_xyz &lt;- vector(mode = &quot;double&quot;, length = nrow(x))
  for (i in seq_along(df$soma_xyz)) {
    soma_xyz[[i]] &lt;- x[[1]][[i]] + x[[2]][[i]] + x[[3]][i]
  }
  soma_xyz
}

df$soma_xyz2 &lt;- soma_xyz(df)
</code></pre>
<pre><code>## Warning: Unknown or uninitialised column: `soma_xyz`.
</code></pre>
<pre><code class="language-r">df
</code></pre>
<pre><code>## # A tibble: 100 x 4
##        x     y     z soma_xyz2
##    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;
##  1  33.7  70.7  196.         0
##  2  82.6 108.   200.         0
##  3  62.1 132.   219.         0
##  4  42.7  90.3  230.         0
##  5  48.7  89.9  201.         0
##  6  98.0  92.1  176.         0
##  7  38.0  83.9  187.         0
##  8  40.4 100.   214.         0
##  9  30.0  90.3  206.         0
## 10  61.7 119.   234.         0
## # ... with 90 more rows
</code></pre>
<p>Outra vantagem de ter na mão uma função, é que eu posso me apropriar das ferramentas de programação funcional do R. São as funções da família <code>apply</code>, que recebem uma lista de objetos e aplicam uma função em cada um. Basicamente, aquela <strong>abstração</strong> do for loop que estavamos buscando.</p>
<p>Vejam como eu posso recriar o exemplo das somas das colunas do <code>data.frame</code> usando a função soma.</p>
<pre><code class="language-r">sapply(df, soma)
</code></pre>
<pre><code>##         x         y         z soma_xyz2 
##  4988.478  9590.577 19787.007     0.000
</code></pre>
<p>Eu sei, o exemplo é muito simples pra ter uma aplicação real. Até porque já vimos como fazer esse tipo de operação com <code>summarize</code> lá atrás. Mas talvez, na hora que você estiver realizando alguma operação de repetição, você se lembre dessa possibilidade e ela lhe seja útil.</p>
<h3 id="o-pacote-purrr">o pacote <code>purrr</code></h3>
<p>Até o momento, nos limitamos a utilizar funções presentes no <code>base</code>, mas o verdadeiro intuito dessa aula é introduzir as facilidade trazidas pelas funções do <code>tidyverse</code>. No pacote <code>purrr</code>, são importadas funções com diversas funcionalidades que facilitam o trabalho com objetos mais complexos, como listas (pense saída de modelo), iterações envolvendo mais de um argumento (pense escrever diversos objetos em diversos arquivos distintos) e assim sucessivamente. Abaixo, segue uma lista das funções do pacote com uma descrição curta.</p>
<ul>
<li>
<p>a família <code>map_()</code>: similar a família <code>apply</code> do R base. Recebe uma lista de objetos de entrada e uma função e devolve uma lista com os resultados.</p>
</li>
<li>
<p><code>map2_()</code>: mesma coisa, só que você pode passar duas listas de objetos e uma função que requer dois argumentos variáveis. <code>pmap()</code> é a generalização, em que você passa <code>p</code> listas e uma função que pede <code>p</code> argumentos.</p>
</li>
<li>
<p><code>imap()</code>: aplica uma função tanto ao vetor, como a seu nome/índice. É meio louco, mas é muito útil para alguns casos de uso.</p>
</li>
<li>
<p><code>modify_()</code>: permite aplicar alterações no objeto estilo o que você faria com uma pipeline de <code>filter %&gt;% mutate</code></p>
</li>
<li>
<p><code>safely()</code>: e suas irmãs <code>possibly()</code> e <code>quietly()</code> ajudam a obter resultados mesmo quando há ocorre um erro na iteração.</p>
</li>
<li>
<p><code>transpose()</code>, <code>flatten_</code>: manipulam e reformatam listas.</p>
</li>
<li>
<p><code>invoke_map()</code>: aplica uma lista de funções a uma (opcional) segunda lista de parâmetros.</p>
</li>
<li>
<p><code>reduce()</code> e `accumulate()``: generalizam as operações de sumarização (pense soma acumulada, média, limite, fatorial)</p>
</li>
<li>
<p><code>pluck()</code>: pesca elementos de uma lista com uma sintaxe linear e bonitinha.</p>
</li>
<li>
<p><a href="https://purrr.tidyverse.org/reference/index.html" target="_blank" rel="noopener">E muito mais coisas</a></p>
</li>
</ul>
<p>No interesse de ir direto ao ponto e não tentar ser exaustivo, vamos ver algumas delas em mais detalhe.</p>
<h4 id="map"><code>map</code></h4>
<p>Essa função é praticamente uma cópia de <code>lapply</code>.</p>
<pre><code class="language-r">df %&gt;% lapply(sum)
</code></pre>
<pre><code>## $x
## [1] 4988.478
## 
## $y
## [1] 9590.577
## 
## $z
## [1] 19787.01
## 
## $soma_xyz2
## [1] 0
</code></pre>
<pre><code class="language-r">df %&gt;% map(sum)
</code></pre>
<pre><code>## $x
## [1] 4988.478
## 
## $y
## [1] 9590.577
## 
## $z
## [1] 19787.01
## 
## $soma_xyz2
## [1] 0
</code></pre>
<p>Embora existam pequenas diferenças técnicas entre elas, a principal vantagem de <code>map</code> é a possibilidade de criar funções anônimas com uma síntaxe enxuta. Pense, por exemplo, em elevar ao quadrado.</p>
<pre><code class="language-r">df %&gt;% lapply(function(x) x ^ 2)
</code></pre>
<pre><code>## $x
##   [1]  1135.039935  6824.338339  3853.949032  1822.976397  2369.548883
##   [6]  9606.996712  1444.694631  1628.312949   897.644355  3807.612385
##  [11]  7574.891240   127.070043  1132.276000  4432.784743  7646.419031
##  [16]  1309.025079  3651.501561  7488.615473    51.734793    50.630453
##  [21]  2945.833211  2358.013592  2677.625720   843.248397  5179.742674
##  [26]  1776.719973  4314.208466  3130.666847  1455.575431   216.146748
##  [31]   683.215193  1948.631502   398.763139  1479.799455  1594.088354
##  [36]  2127.567621     6.133289   732.746773   212.475930  1360.109192
##  [41]   826.712461  6291.744492   392.754178  1358.621301  6088.092206
##  [46]  3412.242242   220.242392  2935.558998  4184.263393  1437.025783
##  [51]  3810.543916  5696.763237   647.179047  5162.353172  3199.626614
##  [56]   807.785180  3318.417801  1829.369079  3993.641092  3360.282600
##  [61]  2074.761139  4563.192834  2465.374395  8385.486392  3028.756860
##  [66]  7319.011219  4159.762015    19.298464  1262.867940   408.970495
##  [71]  7585.051691  2579.902215  3697.158711   670.849494  2260.906644
##  [76]  6561.556216  5404.854177  8937.343659  9169.393199  4323.059706
##  [81]  2428.013566  4179.324046  4962.793929  1311.909015  2712.331511
##  [86] 10604.519455  6961.298788  3432.930917  3363.676195   529.930215
##  [91]   328.300361  5145.493326  5045.569341  4022.161585  2645.845462
##  [96]  1853.217572    19.679053  1233.552597   531.003770  1381.934169
## 
## $y
##   [1]  4995.461 11762.806 17472.272  8156.213  8086.605  8479.373  7042.002
##   [8] 10027.095  8157.040 14079.833  7792.067 10284.578 11484.087 16724.715
##  [15] 12847.731 14687.951 18673.781  4507.667  1850.956 10576.972  7709.835
##  [22]  7491.221 19729.349  6427.672 13123.357  4384.066 11254.454  9313.697
##  [29] 10725.726 15638.396 11064.853  7400.638  4788.539  5354.325 20564.769
##  [36]  6747.659  6398.988 16338.939 12877.637 15778.654 12916.969  8402.047
##  [43] 10926.808  9845.448  5065.721 11464.775  7384.289 11895.144  8785.578
##  [50] 12498.194 10973.367  8940.248  6921.720  4391.277  6362.148  9676.914
##  [57]  1712.409 13034.100  6058.580  4096.711 11446.740  6832.313  6899.154
##  [64]  6678.560 13878.182  6452.759  3688.545  9527.716  3818.881 13693.014
##  [71] 24850.035  5197.111 11737.476 12097.537  5803.448  9126.595 11981.743
##  [78]  4151.894 18699.286 11113.961 10152.260  4954.008  6054.074 10340.098
##  [85] 15382.834  5296.377  8538.121  8258.114  3400.167  8806.285  6069.706
##  [92]  2058.687 15860.594 19593.263  6454.058 13545.803 13653.402  8228.094
##  [99]  5862.746  9980.829
## 
## $z
##   [1] 38418.96 40169.35 47953.31 53119.67 40248.45 30845.48 34825.95 45862.05
##   [9] 42326.08 54907.57 32426.77 45892.28 28336.79 39858.56 30573.49 42142.52
##  [17] 38364.91 43771.45 28267.72 21436.85 43586.93 25844.92 42064.91 58667.56
##  [25] 39715.31 55682.40 40213.77 22004.66 24120.87 41676.28 38752.29 42003.12
##  [33] 33972.27 42136.74 40125.06 45546.89 35539.01 55065.15 36298.29 43663.45
##  [41] 31812.14 27524.21 51208.17 47495.11 34114.46 59344.73 44465.68 53213.78
##  [49] 41681.59 50472.96 27847.27 39527.77 31461.13 24772.97 43353.38 25758.67
##  [57] 32173.50 25821.43 30425.85 42653.11 45867.23 47749.28 28007.11 54964.67
##  [65] 38503.65 33609.55 29614.45 34811.48 41264.62 44037.73 36652.35 24590.48
##  [73] 35549.55 50400.38 31714.83 50949.36 46157.33 34028.73 64631.55 46886.89
##  [81] 34055.40 26242.05 32299.99 45243.89 51949.23 29152.41 48117.66 32713.06
##  [89] 43982.85 27634.58 52154.11 20026.04 45189.00 52544.05 59171.37 51170.54
##  [97] 48899.10 34315.71 36540.82 33508.47
## 
## $soma_xyz2
##   [1] 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
##  [38] 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
##  [75] 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
</code></pre>
<pre><code class="language-r">df %&gt;% map(~ .x ^ 2)
</code></pre>
<pre><code>## $x
##   [1]  1135.039935  6824.338339  3853.949032  1822.976397  2369.548883
##   [6]  9606.996712  1444.694631  1628.312949   897.644355  3807.612385
##  [11]  7574.891240   127.070043  1132.276000  4432.784743  7646.419031
##  [16]  1309.025079  3651.501561  7488.615473    51.734793    50.630453
##  [21]  2945.833211  2358.013592  2677.625720   843.248397  5179.742674
##  [26]  1776.719973  4314.208466  3130.666847  1455.575431   216.146748
##  [31]   683.215193  1948.631502   398.763139  1479.799455  1594.088354
##  [36]  2127.567621     6.133289   732.746773   212.475930  1360.109192
##  [41]   826.712461  6291.744492   392.754178  1358.621301  6088.092206
##  [46]  3412.242242   220.242392  2935.558998  4184.263393  1437.025783
##  [51]  3810.543916  5696.763237   647.179047  5162.353172  3199.626614
##  [56]   807.785180  3318.417801  1829.369079  3993.641092  3360.282600
##  [61]  2074.761139  4563.192834  2465.374395  8385.486392  3028.756860
##  [66]  7319.011219  4159.762015    19.298464  1262.867940   408.970495
##  [71]  7585.051691  2579.902215  3697.158711   670.849494  2260.906644
##  [76]  6561.556216  5404.854177  8937.343659  9169.393199  4323.059706
##  [81]  2428.013566  4179.324046  4962.793929  1311.909015  2712.331511
##  [86] 10604.519455  6961.298788  3432.930917  3363.676195   529.930215
##  [91]   328.300361  5145.493326  5045.569341  4022.161585  2645.845462
##  [96]  1853.217572    19.679053  1233.552597   531.003770  1381.934169
## 
## $y
##   [1]  4995.461 11762.806 17472.272  8156.213  8086.605  8479.373  7042.002
##   [8] 10027.095  8157.040 14079.833  7792.067 10284.578 11484.087 16724.715
##  [15] 12847.731 14687.951 18673.781  4507.667  1850.956 10576.972  7709.835
##  [22]  7491.221 19729.349  6427.672 13123.357  4384.066 11254.454  9313.697
##  [29] 10725.726 15638.396 11064.853  7400.638  4788.539  5354.325 20564.769
##  [36]  6747.659  6398.988 16338.939 12877.637 15778.654 12916.969  8402.047
##  [43] 10926.808  9845.448  5065.721 11464.775  7384.289 11895.144  8785.578
##  [50] 12498.194 10973.367  8940.248  6921.720  4391.277  6362.148  9676.914
##  [57]  1712.409 13034.100  6058.580  4096.711 11446.740  6832.313  6899.154
##  [64]  6678.560 13878.182  6452.759  3688.545  9527.716  3818.881 13693.014
##  [71] 24850.035  5197.111 11737.476 12097.537  5803.448  9126.595 11981.743
##  [78]  4151.894 18699.286 11113.961 10152.260  4954.008  6054.074 10340.098
##  [85] 15382.834  5296.377  8538.121  8258.114  3400.167  8806.285  6069.706
##  [92]  2058.687 15860.594 19593.263  6454.058 13545.803 13653.402  8228.094
##  [99]  5862.746  9980.829
## 
## $z
##   [1] 38418.96 40169.35 47953.31 53119.67 40248.45 30845.48 34825.95 45862.05
##   [9] 42326.08 54907.57 32426.77 45892.28 28336.79 39858.56 30573.49 42142.52
##  [17] 38364.91 43771.45 28267.72 21436.85 43586.93 25844.92 42064.91 58667.56
##  [25] 39715.31 55682.40 40213.77 22004.66 24120.87 41676.28 38752.29 42003.12
##  [33] 33972.27 42136.74 40125.06 45546.89 35539.01 55065.15 36298.29 43663.45
##  [41] 31812.14 27524.21 51208.17 47495.11 34114.46 59344.73 44465.68 53213.78
##  [49] 41681.59 50472.96 27847.27 39527.77 31461.13 24772.97 43353.38 25758.67
##  [57] 32173.50 25821.43 30425.85 42653.11 45867.23 47749.28 28007.11 54964.67
##  [65] 38503.65 33609.55 29614.45 34811.48 41264.62 44037.73 36652.35 24590.48
##  [73] 35549.55 50400.38 31714.83 50949.36 46157.33 34028.73 64631.55 46886.89
##  [81] 34055.40 26242.05 32299.99 45243.89 51949.23 29152.41 48117.66 32713.06
##  [89] 43982.85 27634.58 52154.11 20026.04 45189.00 52544.05 59171.37 51170.54
##  [97] 48899.10 34315.71 36540.82 33508.47
## 
## $soma_xyz2
##   [1] 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
##  [38] 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
##  [75] 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
</code></pre>
<p>Através do uso de fórmulas <code>~</code> é possível especificar funções anônimas simples economizando caracteres e utilizando o autocompletar.</p>
<p>Que tal esta pipeline?</p>
<pre><code class="language-r">library(nycflights13)

# Médias de todas as variáveis numéricas usando where()
flights %&gt;% 
  select(where(is.numeric)) %&gt;% 
  map(mean)
</code></pre>
<pre><code>## $year
## [1] 2013
## 
## $month
## [1] 6.54851
## 
## $day
## [1] 15.71079
## 
## $dep_time
## [1] NA
## 
## $sched_dep_time
## [1] 1344.255
## 
## $dep_delay
## [1] NA
## 
## $arr_time
## [1] NA
## 
## $sched_arr_time
## [1] 1536.38
## 
## $arr_delay
## [1] NA
## 
## $flight
## [1] 1971.924
## 
## $air_time
## [1] NA
## 
## $distance
## [1] 1039.913
## 
## $hour
## [1] 13.18025
## 
## $minute
## [1] 26.2301
</code></pre>
<p>Ou esta</p>
<pre><code class="language-r"># Proporção de missings em todas as variáveis
flights %&gt;% 
  map(is.na) %&gt;% 
  map(mean)
</code></pre>
<pre><code>## $year
## [1] 0
## 
## $month
## [1] 0
## 
## $day
## [1] 0
## 
## $dep_time
## [1] 0.02451184
## 
## $sched_dep_time
## [1] 0
## 
## $dep_delay
## [1] 0.02451184
## 
## $arr_time
## [1] 0.0258718
## 
## $sched_arr_time
## [1] 0
## 
## $arr_delay
## [1] 0.02800081
## 
## $carrier
## [1] 0
## 
## $flight
## [1] 0
## 
## $tailnum
## [1] 0.007458964
## 
## $origin
## [1] 0
## 
## $dest
## [1] 0
## 
## $air_time
## [1] 0.02800081
## 
## $distance
## [1] 0
## 
## $hour
## [1] 0
## 
## $minute
## [1] 0
## 
## $time_hour
## [1] 0
</code></pre>
<pre><code class="language-r"># Contagem de missings em todas as variáveis
flights %&gt;% 
  map(is.na) %&gt;% 
  map(sum)
</code></pre>
<pre><code>## $year
## [1] 0
## 
## $month
## [1] 0
## 
## $day
## [1] 0
## 
## $dep_time
## [1] 8255
## 
## $sched_dep_time
## [1] 0
## 
## $dep_delay
## [1] 8255
## 
## $arr_time
## [1] 8713
## 
## $sched_arr_time
## [1] 0
## 
## $arr_delay
## [1] 9430
## 
## $carrier
## [1] 0
## 
## $flight
## [1] 0
## 
## $tailnum
## [1] 2512
## 
## $origin
## [1] 0
## 
## $dest
## [1] 0
## 
## $air_time
## [1] 9430
## 
## $distance
## [1] 0
## 
## $hour
## [1] 0
## 
## $minute
## [1] 0
## 
## $time_hour
## [1] 0
</code></pre>
<p>A outra grande vantagem do map é ter acesso fácil ao controle do tipo de saída.</p>
<pre><code class="language-r"># Vetor numérico
flights %&gt;% 
  map(is.na) %&gt;% 
  map_dbl(mean)
</code></pre>
<pre><code>##           year          month            day       dep_time sched_dep_time 
##    0.000000000    0.000000000    0.000000000    0.024511842    0.000000000 
##      dep_delay       arr_time sched_arr_time      arr_delay        carrier 
##    0.024511842    0.025871796    0.000000000    0.028000808    0.000000000 
##         flight        tailnum         origin           dest       air_time 
##    0.000000000    0.007458964    0.000000000    0.000000000    0.028000808 
##       distance           hour         minute      time_hour 
##    0.000000000    0.000000000    0.000000000    0.000000000
</code></pre>
<pre><code class="language-r"># Vetor de caracteres
flights %&gt;% 
  map(is.na) %&gt;% 
  map_chr(mean)
</code></pre>
<pre><code>##           year          month            day       dep_time sched_dep_time 
##     &quot;0.000000&quot;     &quot;0.000000&quot;     &quot;0.000000&quot;     &quot;0.024512&quot;     &quot;0.000000&quot; 
##      dep_delay       arr_time sched_arr_time      arr_delay        carrier 
##     &quot;0.024512&quot;     &quot;0.025872&quot;     &quot;0.000000&quot;     &quot;0.028001&quot;     &quot;0.000000&quot; 
##         flight        tailnum         origin           dest       air_time 
##     &quot;0.000000&quot;     &quot;0.007459&quot;     &quot;0.000000&quot;     &quot;0.000000&quot;     &quot;0.028001&quot; 
##       distance           hour         minute      time_hour 
##     &quot;0.000000&quot;     &quot;0.000000&quot;     &quot;0.000000&quot;     &quot;0.000000&quot;
</code></pre>
<p>Um exemplo um pouco mais elaborado: avaliação inicial de variáveis em um modelo. Em geral, é comum rodar um modelo para cada variável numérica para ver como elas se comportam.</p>
<pre><code class="language-r">respvar &lt;- &quot;hwy&quot;
predvars &lt;- names(select(mpg, where(is.numeric), -hwy))

tibble(
  names = predvars,
  fit = map(names, ~lm(paste0(respvar, &quot;~&quot;, .x), data = mpg)),
  summary = map(fit, summary),
  r2 = map_dbl(summary, &quot;r.squared&quot;),
  FStat = map_df(summary, &quot;fstatistic&quot;),
  coefs = map_df(fit, coef),
)
</code></pre>
<pre><code>## # A tibble: 4 x 6
##   names fit    summary      r2 FStat$value $numdf $dendf coefs$`(Interce~ $displ
##   &lt;chr&gt; &lt;list&gt; &lt;list&gt;    &lt;dbl&gt;       &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;            &lt;dbl&gt;  &lt;dbl&gt;
## 1 displ &lt;lm&gt;   &lt;smmry~ 5.87e-1   329.           1    232           35.7    -3.53
## 2 year  &lt;lm&gt;   &lt;smmry~ 4.66e-6     0.00108      1    232           17.7    NA   
## 3 cyl   &lt;lm&gt;   &lt;smmry~ 5.81e-1   321.           1    232           40.0    NA   
## 4 cty   &lt;lm&gt;   &lt;smmry~ 9.14e-1  2459.           1    232            0.892  NA
</code></pre>
<p>Ok, a saída não está muito bonitinha! Mas com um pouco mais de trabalho, programadores melhores que eu fizeram isso:</p>
<pre><code class="language-r">models &lt;- 
  tibble(
    names = predvars,
    fit = map(names, ~lm(paste0(respvar, &quot;~&quot;, .x), data = mpg)),
    tidied = fit %&gt;% map(broom::tidy),
    glanced = fit %&gt;% map(broom::glance),
    augmented = fit %&gt;% map(broom::augment)
  )

models
</code></pre>
<pre><code>## # A tibble: 4 x 5
##   names fit    tidied           glanced           augmented         
##   &lt;chr&gt; &lt;list&gt; &lt;list&gt;           &lt;list&gt;            &lt;list&gt;            
## 1 displ &lt;lm&gt;   &lt;tibble [2 x 5]&gt; &lt;tibble [1 x 12]&gt; &lt;tibble [234 x 8]&gt;
## 2 year  &lt;lm&gt;   &lt;tibble [2 x 5]&gt; &lt;tibble [1 x 12]&gt; &lt;tibble [234 x 8]&gt;
## 3 cyl   &lt;lm&gt;   &lt;tibble [2 x 5]&gt; &lt;tibble [1 x 12]&gt; &lt;tibble [234 x 8]&gt;
## 4 cty   &lt;lm&gt;   &lt;tibble [2 x 5]&gt; &lt;tibble [1 x 12]&gt; &lt;tibble [234 x 8]&gt;
</code></pre>
<p>Grande coisa, Vinícius, o output é ilegível! Calma! Lembram da primeira aula em que eu comentei que havia mais funções no <code>tidyr</code>?</p>
<pre><code class="language-r"># Coeficientes
models %&gt;% 
  select(tidied) %&gt;%
  tidyr::unnest(tidied) %&gt;% 
  filter(term != &quot;(Intercept)&quot;)
</code></pre>
<pre><code>## # A tibble: 4 x 5
##   term  estimate std.error statistic   p.value
##   &lt;chr&gt;    &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
## 1 displ -3.53       0.195   -18.2    2.04e- 46
## 2 year   0.00285    0.0867    0.0329 9.74e-  1
## 3 cyl   -2.82       0.157   -17.9    1.18e- 45
## 4 cty    1.34       0.0270   49.6    1.87e-125
</code></pre>
<pre><code class="language-r"># Estatísticas do modelo
models %&gt;% 
  select(names, glanced) %&gt;% 
  unnest(glanced)
</code></pre>
<pre><code>## # A tibble: 4 x 13
##   names  r.squared adj.r.squared sigma  statistic   p.value    df logLik   AIC
##   &lt;chr&gt;      &lt;dbl&gt;         &lt;dbl&gt; &lt;dbl&gt;      &lt;dbl&gt;     &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;
## 1 displ 0.587            0.585    3.84  329.      2.04e- 46     1  -646. 1297.
## 2 year  0.00000466      -0.00431  5.97    0.00108 9.74e-  1     1  -749. 1504.
## 3 cyl   0.581            0.579    3.87  321.      1.18e- 45     1  -647. 1301.
## 4 cty   0.914            0.913    1.75 2459.      1.87e-125     1  -462.  931.
## # ... with 4 more variables: BIC &lt;dbl&gt;, deviance &lt;dbl&gt;, df.residual &lt;int&gt;,
## #   nobs &lt;int&gt;
</code></pre>
<pre><code class="language-r"># Bancos &quot;aumentados&quot; com valores ajustados, resíduos, distâncias de cook, etc.
models %&gt;% 
  filter(names == &quot;displ&quot;) %&gt;% 
  select(names, augmented) %&gt;% 
  unnest(augmented)
</code></pre>
<pre><code>## # A tibble: 234 x 9
##    names   hwy displ .fitted .resid    .hat .sigma    .cooksd .std.resid
##    &lt;chr&gt; &lt;int&gt; &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;      &lt;dbl&gt;      &lt;dbl&gt;
##  1 displ    29   1.8    29.3 -0.343 0.0115    3.84 0.0000468     -0.0898
##  2 displ    29   1.8    29.3 -0.343 0.0115    3.84 0.0000468     -0.0898
##  3 displ    31   2      28.6  2.36  0.00984   3.84 0.00191        0.619 
##  4 displ    30   2      28.6  1.36  0.00984   3.84 0.000634       0.357 
##  5 displ    26   2.8    25.8  0.188 0.00543   3.84 0.00000660     0.0491
##  6 displ    26   2.8    25.8  0.188 0.00543   3.84 0.00000660     0.0491
##  7 displ    27   3.1    24.8  2.25  0.00463   3.84 0.000802       0.587 
##  8 displ    26   1.8    29.3 -3.34  0.0115    3.84 0.00445       -0.876 
##  9 displ    25   1.8    29.3 -4.34  0.0115    3.83 0.00751       -1.14  
## 10 displ    28   2      28.6 -0.636 0.00984   3.84 0.000138      -0.167 
## # ... with 224 more rows
</code></pre>
<p>Isso aqui é só uma palhinha de modelagem com o <code>tidyverse</code>, mas acho que é uma demonstração muito convincente da aplicabilidade dos exemplos que vimos usando programação funcional.</p>
<p>Outro exemplo mais simples com <code>map2</code>: salvar vários arquivos de uma vez só.</p>
<pre><code class="language-r">df1 &lt;- tibble(x = rnorm(100), y = rnorm(100), z = rnorm(100))
df2 &lt;- tibble(x = rnorm(100), y = rnorm(100), z = rnorm(100))
df3 &lt;- tibble(x = rnorm(100), y = rnorm(100), z = rnorm(100))
df4 &lt;- tibble(x = rnorm(100), y = rnorm(100), z = rnorm(100))

dfs &lt;- list(df1, df2, df3, df4)
dfs
</code></pre>
<pre><code>## [[1]]
## # A tibble: 100 x 3
##         x       y      z
##     &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;
##  1  1.05  -0.431   1.54 
##  2  1.09  -0.0301  1.68 
##  3 -0.431  2.20    0.325
##  4 -2.71   0.828   0.334
##  5  0.681  0.395  -0.787
##  6 -0.543 -0.787   1.23 
##  7  0.502  1.04   -2.00 
##  8 -1.17  -0.319   1.18 
##  9 -0.130  0.718   0.404
## 10  0.163 -0.274  -0.340
## # ... with 90 more rows
## 
## [[2]]
## # A tibble: 100 x 3
##          x       y       z
##      &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
##  1  0.862   1.27    0.0595
##  2  0.295  -0.777  -0.342 
##  3 -0.636   0.632  -0.0888
##  4 -1.28    0.0257 -1.80  
##  5 -0.748  -1.04    1.13  
##  6  0.972   0.794   0.487 
##  7  0.0709  0.199  -0.183 
##  8 -0.594   0.184  -1.03  
##  9 -1.51   -0.946  -1.11  
## 10  1.21   -0.794  -0.0284
## # ... with 90 more rows
## 
## [[3]]
## # A tibble: 100 x 3
##          x       y      z
##      &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;
##  1 -0.201   0.611   1.94 
##  2 -0.0552  1.00   -1.06 
##  3 -1.46    1.56   -0.920
##  4  1.18   -0.310  -1.19 
##  5 -0.0848  1.44    1.95 
##  6  0.557  -0.0562  0.411
##  7  0.151   0.404  -1.23 
##  8 -0.456   0.115   0.648
##  9  0.875   0.736  -2.42 
## 10  0.809   0.612  -0.286
## # ... with 90 more rows
## 
## [[4]]
## # A tibble: 100 x 3
##          x      y      z
##      &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
##  1 -0.963  -0.249 -0.332
##  2 -0.609  -0.437 -0.624
##  3 -0.847  -0.390 -0.139
##  4  0.850   1.17  -0.128
##  5 -0.716   0.493 -0.166
##  6 -0.102   0.347  0.998
##  7  0.585  -0.500 -1.09 
##  8  0.0916 -0.331  0.886
##  9  0.453  -2.65  -0.391
## 10 -1.30    0.792  0.114
## # ... with 90 more rows
</code></pre>
<pre><code class="language-r">paths &lt;- sprintf(&quot;arquivo%s.csv&quot;, 1:4)
paths
</code></pre>
<pre><code>## [1] &quot;arquivo1.csv&quot; &quot;arquivo2.csv&quot; &quot;arquivo3.csv&quot; &quot;arquivo4.csv&quot;
</code></pre>
<pre><code class="language-r">map2(dfs, paths, ~write_csv(x = .x, file = .y))
</code></pre>
<pre><code>## [[1]]
## # A tibble: 100 x 3
##         x       y      z
##     &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;
##  1  1.05  -0.431   1.54 
##  2  1.09  -0.0301  1.68 
##  3 -0.431  2.20    0.325
##  4 -2.71   0.828   0.334
##  5  0.681  0.395  -0.787
##  6 -0.543 -0.787   1.23 
##  7  0.502  1.04   -2.00 
##  8 -1.17  -0.319   1.18 
##  9 -0.130  0.718   0.404
## 10  0.163 -0.274  -0.340
## # ... with 90 more rows
## 
## [[2]]
## # A tibble: 100 x 3
##          x       y       z
##      &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
##  1  0.862   1.27    0.0595
##  2  0.295  -0.777  -0.342 
##  3 -0.636   0.632  -0.0888
##  4 -1.28    0.0257 -1.80  
##  5 -0.748  -1.04    1.13  
##  6  0.972   0.794   0.487 
##  7  0.0709  0.199  -0.183 
##  8 -0.594   0.184  -1.03  
##  9 -1.51   -0.946  -1.11  
## 10  1.21   -0.794  -0.0284
## # ... with 90 more rows
## 
## [[3]]
## # A tibble: 100 x 3
##          x       y      z
##      &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;
##  1 -0.201   0.611   1.94 
##  2 -0.0552  1.00   -1.06 
##  3 -1.46    1.56   -0.920
##  4  1.18   -0.310  -1.19 
##  5 -0.0848  1.44    1.95 
##  6  0.557  -0.0562  0.411
##  7  0.151   0.404  -1.23 
##  8 -0.456   0.115   0.648
##  9  0.875   0.736  -2.42 
## 10  0.809   0.612  -0.286
## # ... with 90 more rows
## 
## [[4]]
## # A tibble: 100 x 3
##          x      y      z
##      &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
##  1 -0.963  -0.249 -0.332
##  2 -0.609  -0.437 -0.624
##  3 -0.847  -0.390 -0.139
##  4  0.850   1.17  -0.128
##  5 -0.716   0.493 -0.166
##  6 -0.102   0.347  0.998
##  7  0.585  -0.500 -1.09 
##  8  0.0916 -0.331  0.886
##  9  0.453  -2.65  -0.391
## 10 -1.30    0.792  0.114
## # ... with 90 more rows
</code></pre>
<p>E se eu quiser ler um banco de dados que está em vários arquivos diferentes? Vamos usar os que acabamos de criar</p>
<pre><code class="language-r"># Bum! Uma linha
paths %&gt;% map_dfr(read_csv, .id = &quot;arquivo&quot;)
</code></pre>
<pre><code>## 
## -- Column specification --------------------------------------------------------
## cols(
##   x = col_double(),
##   y = col_double(),
##   z = col_double()
## )
## 
## 
## -- Column specification --------------------------------------------------------
## cols(
##   x = col_double(),
##   y = col_double(),
##   z = col_double()
## )
## 
## 
## -- Column specification --------------------------------------------------------
## cols(
##   x = col_double(),
##   y = col_double(),
##   z = col_double()
## )
## 
## 
## -- Column specification --------------------------------------------------------
## cols(
##   x = col_double(),
##   y = col_double(),
##   z = col_double()
## )
</code></pre>
<pre><code>## # A tibble: 400 x 4
##    arquivo      x       y      z
##    &lt;chr&gt;    &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;
##  1 1        1.05  -0.431   1.54 
##  2 1        1.09  -0.0301  1.68 
##  3 1       -0.431  2.20    0.325
##  4 1       -2.71   0.828   0.334
##  5 1        0.681  0.395  -0.787
##  6 1       -0.543 -0.787   1.23 
##  7 1        0.502  1.04   -2.00 
##  8 1       -1.17  -0.319   1.18 
##  9 1       -0.130  0.718   0.404
## 10 1        0.163 -0.274  -0.340
## # ... with 390 more rows
</code></pre>
<p>As possibilidades são inúmeras. A regra é a seguinte: viu uma tarefa que precisa ser repetida muitas vezes? Pense com carinho em usar uma função vetorizada através de <code>map_</code>.</p>
<h4 id="predicados">Predicados</h4>
<p>O objetivo de um função predicado é selecionar elementos de uma lista com base em uma função. Em geral, são funções simples que retornam um valor <code>TRUE</code> ou <code>FALSE</code> com base em alguma característica do objeto, como o tipo.</p>
<pre><code class="language-r">l &lt;- list(c(&quot;a&quot;, &quot;b&quot;, &quot;c&quot;), c(1, 2, 3))
l %&gt;% str()
</code></pre>
<pre><code>## List of 2
##  $ : chr [1:3] &quot;a&quot; &quot;b&quot; &quot;c&quot;
##  $ : num [1:3] 1 2 3
</code></pre>
<pre><code class="language-r">l %&gt;% keep(is.numeric) %&gt;% str()
</code></pre>
<pre><code>## List of 1
##  $ : num [1:3] 1 2 3
</code></pre>
<pre><code class="language-r">l %&gt;% keep(is.character) %&gt;% str()
</code></pre>
<pre><code>## List of 1
##  $ : chr [1:3] &quot;a&quot; &quot;b&quot; &quot;c&quot;
</code></pre>
<p>O uso mais frequente que vejo de <code>keep</code> e <code>discard</code> é como uma espécie de atalho para <code>select</code>. Como <code>data.frames</code> são secretamente listas, você pode rapidamente selecionar todas as variáveis do banco que tenham o mesmo tipo.</p>
<pre><code class="language-r">flights %&gt;% keep(is.numeric)
</code></pre>
<pre><code>## # A tibble: 336,776 x 14
##     year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
##  1  2013     1     1      517            515         2      830            819
##  2  2013     1     1      533            529         4      850            830
##  3  2013     1     1      542            540         2      923            850
##  4  2013     1     1      544            545        -1     1004           1022
##  5  2013     1     1      554            600        -6      812            837
##  6  2013     1     1      554            558        -4      740            728
##  7  2013     1     1      555            600        -5      913            854
##  8  2013     1     1      557            600        -3      709            723
##  9  2013     1     1      557            600        -3      838            846
## 10  2013     1     1      558            600        -2      753            745
## # ... with 336,766 more rows, and 6 more variables: arr_delay &lt;dbl&gt;,
## #   flight &lt;int&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;
</code></pre>
<pre><code class="language-r">flights %&gt;% discard(is.character)
</code></pre>
<pre><code>## # A tibble: 336,776 x 15
##     year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
##  1  2013     1     1      517            515         2      830            819
##  2  2013     1     1      533            529         4      850            830
##  3  2013     1     1      542            540         2      923            850
##  4  2013     1     1      544            545        -1     1004           1022
##  5  2013     1     1      554            600        -6      812            837
##  6  2013     1     1      554            558        -4      740            728
##  7  2013     1     1      555            600        -5      913            854
##  8  2013     1     1      557            600        -3      709            723
##  9  2013     1     1      557            600        -3      838            846
## 10  2013     1     1      558            600        -2      753            745
## # ... with 336,766 more rows, and 7 more variables: arr_delay &lt;dbl&gt;,
## #   flight &lt;int&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;,
## #   time_hour &lt;dttm&gt;
</code></pre>
<p>Como outros aspectos do <code>purrr</code>, a grande vantagem aqui é a generalidade. Essas funções funcionam em qualquer lista de objetos e não apenas em <code>data.frames</code>.</p>
<h4 id="lidando-com-a-presença-de-erros">Lidando com a presença de erros</h4>
<p>A próxima dica forte é utilizar os advérbios (chique) <code>safely()</code> e companhia para lidar com erros.</p>
<pre><code class="language-r">x &lt;- list(a = c(1,2,3), b = c(&quot;a&quot;, &quot;b&quot;, &quot;c&quot;), c = c(99, 88, 77))

x %&gt;% map(sum)
</code></pre>
<pre><code>## Error in .Primitive(&quot;sum&quot;)(..., na.rm = na.rm): 'type' inválido (character) do argumento
</code></pre>
<p>Não conseguimos nada! A mensagem de erro nem nos informa onde o problema ocorreu. E agora?</p>
<pre><code class="language-r">x %&gt;% map(safely(sum)) %&gt;% str()
</code></pre>
<pre><code>## List of 3
##  $ a:List of 2
##   ..$ result: num 6
##   ..$ error : NULL
##  $ b:List of 2
##   ..$ result: NULL
##   ..$ error :List of 2
##   .. ..$ message: chr &quot;'type' inválido (character) do argumento&quot;
##   .. ..$ call   : language .Primitive(&quot;sum&quot;)(..., na.rm = na.rm)
##   .. ..- attr(*, &quot;class&quot;)= chr [1:3] &quot;simpleError&quot; &quot;error&quot; &quot;condition&quot;
##  $ c:List of 2
##   ..$ result: num 264
##   ..$ error : NULL
</code></pre>
<pre><code class="language-r">x %&gt;% map(possibly(sum, otherwise = NA_real_)) %&gt;% str()
</code></pre>
<pre><code>## List of 3
##  $ a: num 6
##  $ b: num NA
##  $ c: num 264
</code></pre>
<p>Essas funções permitem alterar a saída de uma função quando ocorrer um erro. <code>quietly</code> é parecido, mas ela captura mais a saída do R, o texto em si.</p>
<pre><code class="language-r">x &lt;- list(1, -1)
x %&gt;% map(quietly(log)) %&gt;% str()
</code></pre>
<pre><code>## List of 2
##  $ :List of 4
##   ..$ result  : num 0
##   ..$ output  : chr &quot;&quot;
##   ..$ warnings: chr(0) 
##   ..$ messages: chr(0) 
##  $ :List of 4
##   ..$ result  : num NaN
##   ..$ output  : chr &quot;&quot;
##   ..$ warnings: chr &quot;NaNs produzidos&quot;
##   ..$ messages: chr(0)
</code></pre>
<h4 id="chamando-listas-de-funções">Chamando listas de funções</h4>
<p>Vamos supor que você tem um vetor de números e você quer aplicar um monte de funções diferentes nele, mas você não quer ter que ficar copiando e colando tudo.</p>
<pre><code class="language-r">numeros &lt;- rnorm(25, 50, 10)
numeros
</code></pre>
<pre><code>##  [1] 53.53214 52.60617 41.46687 37.71131 44.39848 61.03622 55.51804 35.26455
##  [9] 51.17132 68.48495 40.00876 55.18537 47.94060 57.59983 51.50569 56.08475
## [17] 48.02700 54.60516 45.15610 42.23958 38.52907 64.89064 45.15476 62.18004
## [25] 60.25824
</code></pre>
<p>Nessas situações, você gostaria de chamar várias funções no mesmo objeto ou grupo de objetos, mas você não sabe bem como fazer isso&hellip; Então, <code>invoke_map</code> vem ao resgate.</p>
<pre><code class="language-r">funcs &lt;- list(&quot;mean&quot;, &quot;sd&quot;, &quot;IQR&quot;, &quot;sum&quot;, &quot;length&quot;, &quot;range&quot;, &quot;min&quot;, &quot;max&quot;)
args &lt;- list(list(na.rm = T, trim = 0.05),
             list(na.rm=T), 
             list(type = 2),
             list(na.rm = T), 
             list(),
             list(na.rm = T), 
             list(na.rm = T), 
             list(na.rm = T))
funcs %&gt;% str()
</code></pre>
<pre><code>## List of 8
##  $ : chr &quot;mean&quot;
##  $ : chr &quot;sd&quot;
##  $ : chr &quot;IQR&quot;
##  $ : chr &quot;sum&quot;
##  $ : chr &quot;length&quot;
##  $ : chr &quot;range&quot;
##  $ : chr &quot;min&quot;
##  $ : chr &quot;max&quot;
</code></pre>
<pre><code class="language-r">args %&gt;% str()
</code></pre>
<pre><code>## List of 8
##  $ :List of 2
##   ..$ na.rm: logi TRUE
##   ..$ trim : num 0.05
##  $ :List of 1
##   ..$ na.rm: logi TRUE
##  $ :List of 1
##   ..$ type: num 2
##  $ :List of 1
##   ..$ na.rm: logi TRUE
##  $ : list()
##  $ :List of 1
##   ..$ na.rm: logi TRUE
##  $ :List of 1
##   ..$ na.rm: logi TRUE
##  $ :List of 1
##   ..$ na.rm: logi TRUE
</code></pre>
<pre><code class="language-r">invoke_map(funcs, args, x = numeros) %&gt;% glimpse()
</code></pre>
<pre><code>## List of 8
##  $ : num 50.7
##  $ : num 8.98
##  $ : num 11.7
##  $ : num 1271
##  $ : int 25
##  $ : num [1:2] 35.3 68.5
##  $ : num 35.3
##  $ : num 68.5
</code></pre>
<p>Fica mais bonito se você nomear os argumentos, ai o output fica melhorzinho.</p>
<pre><code class="language-r">names(funcs) &lt;- unlist(funcs)

invoke_map(funcs, args, x = numeros) %&gt;% glimpse()
</code></pre>
<pre><code>## List of 8
##  $ mean  : num 50.7
##  $ sd    : num 8.98
##  $ IQR   : num 11.7
##  $ sum   : num 1271
##  $ length: int 25
##  $ range : num [1:2] 35.3 68.5
##  $ min   : num 35.3
##  $ max   : num 68.5
</code></pre>
<p>Claro que esse exemplo aqui talvez não seja útil para vocês, mas espero que quando vocês encontrarem uma situação em que você gostaria de aplicar uma bateria de funções no mesmo objeto ou grupo de objetos, vocês se lembrem dessa possibilidade.</p>
<h4 id="reduce-e-accumulate"><code>reduce</code> e <code>accumulate</code></h4>
<p>Essas duas funções são desenhadas para fazer aplicações recursivas de funções que recebem dois argumentos (operadores matemáticos, <code>_join</code>s, etc. Recursividade em linhas gerais, é você repetir uma operação com o resultado da repetição anterior. Pense em somas ou produtos acumulados, em que o próximo valor é determinado pela aplicação de uma regra sobre o anterior.</p>
<pre><code class="language-r">accumulate(1:10, `+`)
</code></pre>
<pre><code>##  [1]  1  3  6 10 15 21 28 36 45 55
</code></pre>
<pre><code class="language-r">accumulate(1:10, `*`)
</code></pre>
<pre><code>##  [1]       1       2       6      24     120     720    5040   40320  362880
## [10] 3628800
</code></pre>
<p>A principal diferença entre <code>accumulate</code> e <code>reduce</code> é que a primeira guarda os resultados intermediários, enquanto a segunda retorna apenas o último.</p>
<pre><code class="language-r">reduce(1:10, `+`)
</code></pre>
<pre><code>## [1] 55
</code></pre>
<pre><code class="language-r">reduce(1:10, `*`)
</code></pre>
<pre><code>## [1] 3628800
</code></pre>
<p>Uma aplicação bastante prática dessas funções é a produção de um único banco de dados a partir de vários arquivos separados.</p>
<pre><code class="language-r"># Lembra dos nossos arquivos lá em cima?
paths
</code></pre>
<pre><code>## [1] &quot;arquivo1.csv&quot; &quot;arquivo2.csv&quot; &quot;arquivo3.csv&quot; &quot;arquivo4.csv&quot;
</code></pre>
<p>Vamos fingir que não temos acesso a <code>map_dfr</code> e precisamos importar esses objetos e todos compõem um único banco. Imaginaem que tratam-se de dados por ano.</p>
<pre><code class="language-r">dfs &lt;- map(paths, read_csv)
</code></pre>
<pre><code>## 
## -- Column specification --------------------------------------------------------
## cols(
##   x = col_double(),
##   y = col_double(),
##   z = col_double()
## )
## 
## 
## -- Column specification --------------------------------------------------------
## cols(
##   x = col_double(),
##   y = col_double(),
##   z = col_double()
## )
## 
## 
## -- Column specification --------------------------------------------------------
## cols(
##   x = col_double(),
##   y = col_double(),
##   z = col_double()
## )
## 
## 
## -- Column specification --------------------------------------------------------
## cols(
##   x = col_double(),
##   y = col_double(),
##   z = col_double()
## )
</code></pre>
<pre><code class="language-r">glimpse(dfs)
</code></pre>
<pre><code>## List of 4
##  $ : spec_tbl_df [100 x 3] (S3: spec_tbl_df/tbl_df/tbl/data.frame)
##   ..$ x: num [1:100] 1.052 1.092 -0.431 -2.713 0.681 ...
##   ..$ y: num [1:100] -0.4305 -0.0301 2.1991 0.8281 0.395 ...
##   ..$ z: num [1:100] 1.545 1.678 0.325 0.334 -0.787 ...
##   ..- attr(*, &quot;spec&quot;)=
##   .. .. cols(
##   .. ..   x = col_double(),
##   .. ..   y = col_double(),
##   .. ..   z = col_double()
##   .. .. )
##  $ : spec_tbl_df [100 x 3] (S3: spec_tbl_df/tbl_df/tbl/data.frame)
##   ..$ x: num [1:100] 0.862 0.295 -0.636 -1.276 -0.748 ...
##   ..$ y: num [1:100] 1.2742 -0.777 0.6322 0.0257 -1.0419 ...
##   ..$ z: num [1:100] 0.0595 -0.3419 -0.0888 -1.8034 1.1318 ...
##   ..- attr(*, &quot;spec&quot;)=
##   .. .. cols(
##   .. ..   x = col_double(),
##   .. ..   y = col_double(),
##   .. ..   z = col_double()
##   .. .. )
##  $ : spec_tbl_df [100 x 3] (S3: spec_tbl_df/tbl_df/tbl/data.frame)
##   ..$ x: num [1:100] -0.201 -0.0552 -1.4644 1.1752 -0.0848 ...
##   ..$ y: num [1:100] 0.611 1 1.557 -0.31 1.443 ...
##   ..$ z: num [1:100] 1.94 -1.06 -0.92 -1.19 1.95 ...
##   ..- attr(*, &quot;spec&quot;)=
##   .. .. cols(
##   .. ..   x = col_double(),
##   .. ..   y = col_double(),
##   .. ..   z = col_double()
##   .. .. )
##  $ : spec_tbl_df [100 x 3] (S3: spec_tbl_df/tbl_df/tbl/data.frame)
##   ..$ x: num [1:100] -0.963 -0.609 -0.847 0.85 -0.716 ...
##   ..$ y: num [1:100] -0.249 -0.437 -0.39 1.174 0.493 ...
##   ..$ z: num [1:100] -0.332 -0.624 -0.139 -0.128 -0.166 ...
##   ..- attr(*, &quot;spec&quot;)=
##   .. .. cols(
##   .. ..   x = col_double(),
##   .. ..   y = col_double(),
##   .. ..   z = col_double()
##   .. .. )
</code></pre>
<pre><code class="language-r">new_df &lt;- reduce(dfs, bind_rows)
new_df
</code></pre>
<pre><code>## # A tibble: 400 x 3
##         x       y      z
##     &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;
##  1  1.05  -0.431   1.54 
##  2  1.09  -0.0301  1.68 
##  3 -0.431  2.20    0.325
##  4 -2.71   0.828   0.334
##  5  0.681  0.395  -0.787
##  6 -0.543 -0.787   1.23 
##  7  0.502  1.04   -2.00 
##  8 -1.17  -0.319   1.18 
##  9 -0.130  0.718   0.404
## 10  0.163 -0.274  -0.340
## # ... with 390 more rows
</code></pre>
<p>O resultado é o mesmo observado em <code>map_dfr</code>, mas essa abordagem é <strong>genérica</strong>, ou seja, ela se aplica para qualquer grupo de objetos e para qualquer função que recebe dois argumentos e precisa ser repetida de maneira <strong>recursiva</strong>.</p>
<pre><code class="language-r"># Apaga os arquivos pra eles não ficarem ai gastando memória a toa
file.remove(paths)
</code></pre>
<pre><code>## [1] TRUE TRUE TRUE TRUE
</code></pre>
<h4 id="pluck"><code>pluck</code></h4>
<p>Esta função é um atalho para as tesouras duplas do r <code>[[</code>. Seu objeto é facilitar a <strong>leitura</strong> de códigos que pescam elementos profundos de uma lista aninhada.</p>
<pre><code class="language-r">l &lt;- list(
  list(-1, x = 1, y = c(2), z = &quot;a&quot;),
  list(-2, x = 4, y = c(5, 6), z = &quot;b&quot;),
  list(-3, x = 8, y = c(9, 10, 11))
)

glimpse(l)
</code></pre>
<pre><code>## List of 3
##  $ :List of 4
##   ..$  : num -1
##   ..$ x: num 1
##   ..$ y: num 2
##   ..$ z: chr &quot;a&quot;
##  $ :List of 4
##   ..$  : num -2
##   ..$ x: num 4
##   ..$ y: num [1:2] 5 6
##   ..$ z: chr &quot;b&quot;
##  $ :List of 3
##   ..$  : num -3
##   ..$ x: num 8
##   ..$ y: num [1:3] 9 10 11
</code></pre>
<p>Se você chamar <code>map_</code> nessa lista, você pode extrair os elementos delas pelo nome.</p>
<pre><code class="language-r">map_dbl(l, &quot;x&quot;)
</code></pre>
<pre><code>## [1] 1 4 8
</code></pre>
<pre><code class="language-r">map(l, &quot;y&quot;)
</code></pre>
<pre><code>## [[1]]
## [1] 2
## 
## [[2]]
## [1] 5 6
## 
## [[3]]
## [1]  9 10 11
</code></pre>
<pre><code class="language-r">map(l, &quot;z&quot;)
</code></pre>
<pre><code>## [[1]]
## [1] &quot;a&quot;
## 
## [[2]]
## [1] &quot;b&quot;
## 
## [[3]]
## NULL
</code></pre>
<p>Ou pela posição na lista</p>
<pre><code class="language-r">map_dbl(l, 1)
</code></pre>
<pre><code>## [1] -1 -2 -3
</code></pre>
<pre><code class="language-r">map_dbl(l, 2)
</code></pre>
<pre><code>## [1] 1 4 8
</code></pre>
<pre><code class="language-r">map(l, 3)
</code></pre>
<pre><code>## [[1]]
## [1] 2
## 
## [[2]]
## [1] 5 6
## 
## [[3]]
## [1]  9 10 11
</code></pre>
<p>Ou os dois</p>
<pre><code class="language-r">map_dbl(l, list(&quot;x&quot;, 1))
</code></pre>
<pre><code>## [1] 1 4 8
</code></pre>
<pre><code class="language-r">map(l, list(&quot;z&quot;, 1))
</code></pre>
<pre><code>## [[1]]
## [1] &quot;a&quot;
## 
## [[2]]
## [1] &quot;b&quot;
## 
## [[3]]
## NULL
</code></pre>
<pre><code class="language-r">map(l, list(&quot;y&quot;, 3))
</code></pre>
<pre><code>## [[1]]
## NULL
## 
## [[2]]
## NULL
## 
## [[3]]
## [1] 11
</code></pre>
<p>Se um componente não existir, você recebe um erro</p>
<pre><code class="language-r">map_chr(l, &quot;z&quot;)
</code></pre>
<pre><code>## Error: Result 3 must be a single string, not NULL of length 0
</code></pre>
<p>Mas você pode resolver isso passando um valor padrão</p>
<pre><code class="language-r">map_chr(l, &quot;z&quot;, .default = NA_character_)
</code></pre>
<pre><code>## [1] &quot;a&quot; &quot;b&quot; NA
</code></pre>
<p>Tudo isso funciona com base na função <code>pluck</code></p>
<pre><code class="language-r">pluck(l, 1)
</code></pre>
<pre><code>## [[1]]
## [1] -1
## 
## $x
## [1] 1
## 
## $y
## [1] 2
## 
## $z
## [1] &quot;a&quot;
</code></pre>
<pre><code class="language-r">pluck(l, 1, 2)
</code></pre>
<pre><code>## [1] 1
</code></pre>
<pre><code class="language-r">pluck(l, 2, 3)
</code></pre>
<pre><code>## [1] 5 6
</code></pre>
<pre><code class="language-r">pluck(l, 1, &quot;x&quot;)
</code></pre>
<pre><code>## [1] 1
</code></pre>
<pre><code class="language-r">pluck(l, 2, &quot;z&quot;)
</code></pre>
<pre><code>## [1] &quot;b&quot;
</code></pre>
<pre><code class="language-r">pluck(l, 3, &quot;y&quot;)
</code></pre>
<pre><code>## [1]  9 10 11
</code></pre>
<h2 id="exercícios">Exercícios</h2>
<ol>
<li>
<p>Utilize uma das funções <code>map_</code> para:</p>
</li>
<li>
<p>Calcular a média de cada coluna em <code>mtcars</code>.</p>
</li>
<li>
<p>Determinar o tipo de cada coluna em <code>flights</code>.</p>
</li>
<li>
<p>Computar o número de valores únicos em cada coluna de <code>iris</code>.</p>
</li>
<li>
<p>Gere 10 distribuições aleatórias (<code>rnorm</code>) com médias -10, 0, 10 e 100.</p>
</li>
<li>
<p>Como você pode criar um vetor indicando se cada coluna em um <code>data.frame</code> é um fator?</p>
</li>
<li>
<p>Usando as funções predicado <code>keep</code> e <code>discard</code>:</p>
</li>
<li>
<p>Selecione todas as colunas caractere no banco <code>flights</code>.</p>
</li>
<li>
<p>Descarte os caracteres em <code>mpg</code>.</p>
</li>
<li>
<p>Selecione os fatores ordenados em <code>diamonds</code>.</p>
</li>
<li>
<p>Descarte as variáveis não-numéricas em <code>iris</code></p>
</li>
<li>
<p>Imagine que você tem um diretório cheio de arquivos <code>.csv</code> que correspondem a um único banco de dados. Você tem os caminhos de todos eles num vetor com a forma <code>c(arquivo_1.csv, ..., arquivo_n.csv)</code>. Como você importaria esses arquivos? Tente fazer duas soluções diferentes.</p>
</li>
<li>
<p>Escreva um código sucinto que implemente vários modelos lineares especificados por você. Salve os resultados numa <code>tibble</code> com colunas-lista. Depois, extraia os resultados com <code>unnest()</code>. Use o exemplo como guia.</p>
</li>
</ol>
<pre><code class="language-r">mtcars
</code></pre>
<pre><code>##                      mpg cyl  disp  hp drat    wt  qsec vs am gear carb
## Mazda RX4           21.0   6 160.0 110 3.90 2.620 16.46  0  1    4    4
## Mazda RX4 Wag       21.0   6 160.0 110 3.90 2.875 17.02  0  1    4    4
## Datsun 710          22.8   4 108.0  93 3.85 2.320 18.61  1  1    4    1
## Hornet 4 Drive      21.4   6 258.0 110 3.08 3.215 19.44  1  0    3    1
## Hornet Sportabout   18.7   8 360.0 175 3.15 3.440 17.02  0  0    3    2
## Valiant             18.1   6 225.0 105 2.76 3.460 20.22  1  0    3    1
## Duster 360          14.3   8 360.0 245 3.21 3.570 15.84  0  0    3    4
## Merc 240D           24.4   4 146.7  62 3.69 3.190 20.00  1  0    4    2
## Merc 230            22.8   4 140.8  95 3.92 3.150 22.90  1  0    4    2
## Merc 280            19.2   6 167.6 123 3.92 3.440 18.30  1  0    4    4
## Merc 280C           17.8   6 167.6 123 3.92 3.440 18.90  1  0    4    4
## Merc 450SE          16.4   8 275.8 180 3.07 4.070 17.40  0  0    3    3
## Merc 450SL          17.3   8 275.8 180 3.07 3.730 17.60  0  0    3    3
## Merc 450SLC         15.2   8 275.8 180 3.07 3.780 18.00  0  0    3    3
## Cadillac Fleetwood  10.4   8 472.0 205 2.93 5.250 17.98  0  0    3    4
## Lincoln Continental 10.4   8 460.0 215 3.00 5.424 17.82  0  0    3    4
## Chrysler Imperial   14.7   8 440.0 230 3.23 5.345 17.42  0  0    3    4
## Fiat 128            32.4   4  78.7  66 4.08 2.200 19.47  1  1    4    1
## Honda Civic         30.4   4  75.7  52 4.93 1.615 18.52  1  1    4    2
## Toyota Corolla      33.9   4  71.1  65 4.22 1.835 19.90  1  1    4    1
## Toyota Corona       21.5   4 120.1  97 3.70 2.465 20.01  1  0    3    1
## Dodge Challenger    15.5   8 318.0 150 2.76 3.520 16.87  0  0    3    2
## AMC Javelin         15.2   8 304.0 150 3.15 3.435 17.30  0  0    3    2
## Camaro Z28          13.3   8 350.0 245 3.73 3.840 15.41  0  0    3    4
## Pontiac Firebird    19.2   8 400.0 175 3.08 3.845 17.05  0  0    3    2
## Fiat X1-9           27.3   4  79.0  66 4.08 1.935 18.90  1  1    4    1
## Porsche 914-2       26.0   4 120.3  91 4.43 2.140 16.70  0  1    5    2
## Lotus Europa        30.4   4  95.1 113 3.77 1.513 16.90  1  1    5    2
## Ford Pantera L      15.8   8 351.0 264 4.22 3.170 14.50  0  1    5    4
## Ferrari Dino        19.7   6 145.0 175 3.62 2.770 15.50  0  1    5    6
## Maserati Bora       15.0   8 301.0 335 3.54 3.570 14.60  0  1    5    8
## Volvo 142E          21.4   4 121.0 109 4.11 2.780 18.60  1  1    4    2
</code></pre>
<pre><code class="language-r">modelos &lt;- c(&quot;mpg ~ wt&quot;,
             &quot;mpg ~ wt + cyl&quot;,
             &quot;mpg ~ wt + cyl + drat&quot;,
             &quot;mpg ~ wt + cyl + drat + am&quot;)
</code></pre>

          </div>

          



          
          
          <div class="article-widget">
            
<div class="post-nav">
  
  
  
  <div class="post-nav-item">
    <div class="meta-nav">Previous</div>
    <a href="/courses/tidyverse/dia3/" rel="next">ggplot2</a>
  </div>
  
  
  
  <div class="post-nav-item">
    <div class="meta-nav">Next</div>
    <a href="/courses/tidyverse/solucoes/" rel="prev">Soluções</a>
  </div>
  
</div>

          </div>
          
        </div>

        <div class="body-footer">
          <p>Last updated on 23 May 2021</p>

          





          




          


  
  



        </div>

      </article>

      <footer class="site-footer">

  

  

  
  <p class="powered-by">
    © 2021 LADDEM
  </p>
  

  
  






  <p class="powered-by">
    
    
    
      
      
      
      
      
      
      Published with <a href="https://wowchemy.com/?utm_campaign=poweredby" target="_blank" rel="noopener">Wowchemy</a> — the free, <a href="https://github.com/wowchemy/wowchemy-hugo-modules" target="_blank" rel="noopener">open source</a> website builder that empowers creators.
    
  </p>
</footer>


    </main>
  </div>
</div>

  </div>

  <div class="page-footer">
    
    
  </div>

  
<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Cite</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <pre><code class="tex hljs"></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-outline-primary my-1 js-copy-cite" href="#" target="_blank">
          <i class="fas fa-copy"></i> Copy
        </a>
        <a class="btn btn-outline-primary my-1 js-download-cite" href="#" target="_blank">
          <i class="fas fa-download"></i> Download
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>

      

    
    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/instant.page/5.1.0/instantpage.min.js" integrity="sha512-1+qUtKoh9XZW7j+6LhRMAyOrgSQKenQ4mluTR+cvxXjP1Z54RxZuzstR/H9kgPXQsVB8IW7DMDFUJpzLjvhGSQ==" crossorigin="anonymous"></script>

      
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.4/imagesloaded.pkgd.min.js" integrity="sha256-lqvxZrPLtfffUl2G/e7szqSvPBILGbwmsGE1MKlOi0Q=" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.6/isotope.pkgd.min.js" integrity="sha256-CBrpuqrMhXwcLLUd5tvQ4euBHCdh7wGlDfNz8vbu/iI=" crossorigin="anonymous"></script>
      

      
      

      

      
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/highlight.min.js" integrity="sha512-TDKKr+IvoqZnPzc3l35hdjpHD0m+b2EC2SrLEgKDRWpxf2rFCxemkgvJ5kfU48ip+Y+m2XVKyOCD85ybtlZDmw==" crossorigin="anonymous"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/languages/r.min.js"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/languages/python.min.js"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/languages/latex.min.js"></script>
        
      

    

    
    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/leaflet.min.js" integrity="sha512-SeiQaaDh73yrb56sTW/RgVdi/mMqNeM2oBwubFHagc5BkixSpP1fvqF47mKzPGWYSSy4RwbBunrJBQ4Co8fRWA==" crossorigin="anonymous"></script>
    

    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.2.2/anchor.min.js" integrity="sha512-I7w3ZdSFzw5j3jU3ZkNikBNeIrl3i+hEuEdwNmqUJvwNcaBUNcijnP2gd9DtGlgVYDplfjGoD8vTNsID+lCjqg==" crossorigin="anonymous"></script>
    <script>
      anchors.add();
    </script>
    

    
    
    
      
      <script id="search-hit-fuse-template" type="text/x-template">
        <div class="search-hit" id="summary-{{key}}">
          <div class="search-hit-content">
            <div class="search-hit-name">
              <a href="{{relpermalink}}">{{title}}</a>
              <div class="article-metadata search-hit-type">{{type}}</div>
              <p class="search-hit-description">{{snippet}}</p>
            </div>
          </div>
        </div>
      </script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.2.1/fuse.min.js" integrity="sha256-VzgmKYmhsGNNN4Ph1kMW+BjoYJM2jV5i4IlFoeZA9XI=" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script>
      
    

    
    

    
    
    
    

    
    <script src="/js/bootstrap.bundle.min.8b7df62fd2da18ce73e29c13cc0a6198.js"></script>

    
    
      
      
      
      
      
      
      
    

    
    
    
    
    
    
    
    
      
      
    
    
    <script src="/en/js/wowchemy.min.71e713848164e269bc250f377042949d.js"></script>

    
  <script async defer src="https://buttons.github.io/buttons.js"></script>




</body>
</html>

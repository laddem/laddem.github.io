<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>üìä Aprenda a utilizar o tidyverse | LADDEM</title>
    <link>https://laddem.github.io/courses/tidyverse/</link>
      <atom:link href="https://laddem.github.io/courses/tidyverse/index.xml" rel="self" type="application/rss+xml" />
    <description>üìä Aprenda a utilizar o tidyverse</description>
    <generator>Wowchemy (https://wowchemy.com)</generator><language>pt</language><copyright>¬© 2021 LADDEM</copyright><lastBuildDate>Sun, 23 May 2021 00:00:00 +0000</lastBuildDate>
    <image>
      <url>https://laddem.github.io/courses/tidyverse/featured.png</url>
      <title>üìä Aprenda a utilizar o tidyverse</title>
      <link>https://laddem.github.io/courses/tidyverse/</link>
    </image>
    
    <item>
      <title>readr, tibble e tidyr</title>
      <link>https://laddem.github.io/courses/tidyverse/dia1/</link>
      <pubDate>Sun, 23 May 2021 00:00:00 +0000</pubDate>
      <guid>https://laddem.github.io/courses/tidyverse/dia1/</guid>
      <description>&lt;h2 id=&#34;um-modelo-de-ci√™ncia-de-dados&#34;&gt;Um modelo de ci√™ncia de dados&lt;/h2&gt;
&lt;p&gt;Uma forma esquem√°tica, mas √∫til de encarar o processo de an√°lise de dados e de produ√ß√£o de conhecimento a partir de informa√ß√µes secund√°rias √© esta figura:&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://laddem.github.io/courses/tidyverse/dia1_files/data-science-explore.png&#34; alt=&#34;Data Science Framework&#34;&gt;&lt;/p&gt;
&lt;p&gt;Ela acaba sendo um ponto de partida interessante porque contextualiza a maioria dos pacotes que vamos utilizar. O &lt;code&gt;readr&lt;/code&gt; √© uma maneira de facilitar e tornar mais r√°pida a importa√ß√£o de dados em formatos comuns, como o texto delimitado por separadores e o formato colunado com larguras-fixas utilizado pelo IBGE.&lt;/p&gt;
&lt;p&gt;A &lt;code&gt;tibble&lt;/code&gt; √© uma proposta de moderniza√ß√£o para o &lt;code&gt;data.frame&lt;/code&gt;, aproveitando a estrutura flex√≠vel e poderosa, mas mudando certas conven√ß√µes, como a convers√£o de strings para fatores, permitindo a cria√ß√£o de colunas de listas, utiliza√ß√£o de nomes mais complexos para colunas, etc.&lt;/p&gt;
&lt;p&gt;O &lt;code&gt;tidyr&lt;/code&gt; √© uma forma de reformatar (&lt;em&gt;reshape&lt;/em&gt;) bancos de dados que v√™m em formatos que dificultam seu processamento, permitindo que o analista facilmente reconfigure a informa√ß√£o para o formato mais adequado. Ele √© o primeiro pacote que veremos sobre a parte de &amp;ldquo;cozinha&amp;rdquo; dos dados, no qual √© preciso processar o dado bruto para torn√°-lo pass√≠vel de an√°lise.&lt;/p&gt;
&lt;p&gt;O mesmo pode ser dito para os outros pacotes que veremos nos pr√≥ximos dias. Cada um deles foi pensado para resolver um problema ou facilitar uma rotina de trabalho relacionada com um dos passos descritos acima.&lt;/p&gt;
&lt;h3 id=&#34;programa√ß√£o-liter√°ria&#34;&gt;Programa√ß√£o liter√°ria&lt;/h3&gt;
&lt;p&gt;V√°rios dos conceitos que guiam o design do &lt;code&gt;tidyverse&lt;/code&gt; s√£o orientados por uma certa filosofia. Esta filosofia dita que a principal preocupa√ß√£o por tr√°s de um programa n√£o √© que ele funcione. Eventualmente e com um pouco de persist√™ncia, √© quase sempre poss√≠vel chegar a uma solu√ß√£o t√©cnica adequada. A principal quest√£o √© que o programa √© uma ferramenta de comunica√ß√£o com outras pessoas que o ler√£o, seja seus colegas, colaboradores, alunos ou voc√™ mesmo, daqui a 2 anos, quando lembrar que voc√™ j√° escreveu um programa para aquela tarefa. Trago aqui alguns trechos de &lt;em&gt;Literate Programming&lt;/em&gt;, de Donald Knuth (1984), traduzidos livremente por este que vos fala:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Creio que chegou a hora de melhorar significativamente a documenta√ß√£o dos programas, e que podemos atingir este objetivo tratando programas como obras liter√°rias. Por isso o t√≠tulo: &amp;ldquo;Programa√ß√£o Liter√°ria&amp;rdquo;. Abandonemos os velhos h√°bitos de construir programas: ao inv√©s de imaginar que nossa tarefa principal √© instruir um computador sobre o que deve ser feito, concentremo-nos em explicar aos seres humanos o que queremos que o computador fa√ßa. O praticante da programa√ß√£o liter√°ria pode ser visto como um ensa√≠sta, cuja principal preocupa√ß√£o √© com a clareza da exposi√ß√£o e a excel√™ncia no estilo. Tal autor, com um dicion√°rio na m√£o, escolhe os nomes das vari√°veis com cuidado e explica claramente seu significado. Ele ou ela esmera por um programa que √© compreens√≠vel porque seus conceitos foram introduzidos na melhor ordem poss√≠vel para o entendimento humano, utilizando uma mistura de m√©todos formais e informais que se complementam.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Assim, v√°rias das escolhas feitas na constru√ß√£o de &lt;code&gt;tidyverse&lt;/code&gt; procuram refor√ßar essa caracter√≠stica de interpretabilidade dos programas, como a ordem l√≥gica das opera√ß√µes com o pipe (&lt;code&gt;%&amp;gt;%&lt;/code&gt;), fun√ß√µes com nomes mais longos e sem√¢nticos, a utiliza√ß√£o de uma fun√ß√£o espec√≠fica para cada tarefa, ao inv√©s da adapta√ß√£o de fun√ß√µes gen√©ricas para uma grande variedade de tarefas. O prop√≥sito de um c√≥digo escrito como &lt;code&gt;tidyverse&lt;/code&gt; √© que, no limite, a pr√≥pria s√≠ntaxe do c√≥digo funcione como parte da documenta√ß√£o do programa.&lt;/p&gt;
&lt;h3 id=&#34;o-mist√©rio-do-pipe-&#34;&gt;O mist√©rio do pipe: &lt;code&gt;%&amp;gt;%&lt;/code&gt;&lt;/h3&gt;
&lt;p&gt;Usu√°rios de longa data do R j√° podem ter encontrado no mato esse animal estranho e podem ter ficado confusos com seu significado. O pipe √© de origem humilde e nasceu nos sistemas Unix h√° muitas d√©cadas atr√°s. Seu objetivo √© muito simples: e se voc√™ tiver uma sequ√™ncia de computa√ß√µes em que cada uma recebe o resultado daquela feita anteriormente? Claro que voc√™ poderia fazer:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;x &amp;lt;- 1:10
y &amp;lt;- diff(x)
mean(y)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] 1
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Mas n√£o seria interessante pular os objetos intermedi√°rios e ir direto ao ponto? O pipe vem do pacote &lt;code&gt;magrittr&lt;/code&gt;, mas ele v√™m carregado em quase todos os pacotes do tidyverse. Vamos carregar logo o tibble.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;# Para ter acesso ao pipe, basta carregar um pacote do tidyverse, como tibble, dplyr, tidyr, etc.
# Vamos carregar o tibble agora
library(tibble)
x %&amp;gt;% diff() %&amp;gt;% mean()
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] 1
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Vejamos um exemplo mais real, quantos artistas existem no dataset &lt;code&gt;billboard&lt;/code&gt;? Podemos usar &lt;code&gt;unique&lt;/code&gt; e &lt;code&gt;length&lt;/code&gt; para descobrir.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;x &amp;lt;- unique(tidyr::billboard$artist)
length(x)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] 228
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Mas com &lt;code&gt;%&amp;gt;%&lt;/code&gt; fica bem melhor:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;tidyr::billboard %&amp;gt;% .$artist %&amp;gt;% unique() %&amp;gt;% length()
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] 228
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Ok, mas como ele funciona? √â simples, o pipe carrega o objeto a sua esquerda num ponto &lt;code&gt;.&lt;/code&gt; invis√≠vel que √© automaticamente passado como o primeiro argumento da fun√ß√£o √† direita.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;x &amp;lt;- 1:10
mean(x)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] 5.5
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;x %&amp;gt;% mean()
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] 5.5
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;OK, mas e se meu argumento n√£o for o primeiro, ainda posso usar pipe? Pode! √â s√≥ usar explicitamente um ponto no lugar onde voc√™ quer aproveitar o efeito:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;iris %&amp;gt;% boxplot(Sepal.Length ~ Species, data = .)
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;https://laddem.github.io/courses/tidyverse/dia1_files/figure-html/unnamed-chunk-6-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;p&gt;O ponto &lt;code&gt;.&lt;/code&gt; depois de &lt;code&gt;data&lt;/code&gt; indica indica que ali deve ser colocado o &lt;code&gt;iris&lt;/code&gt;. O pipe √© uma pe√ßa chave de muitas fun√ß√µes do &lt;code&gt;tidyverse&lt;/code&gt;, n√£o porque ele seja obrigat√≥rio, mas sim porque ele permite expressar sequ√™ncias de opera√ß√µes numa ordem mais l√≥gica, do tipo: &amp;ldquo;Primeiro fa√ßa a, ent√£o b, ent√£o c, &amp;hellip; &amp;ldquo;, ao contr√°rio da forma como isto √© geralmente feito usando par√™nteses para preced√™ncia.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;# Compare
mean(diff(1:10))
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] 1
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;1:10 %&amp;gt;% diff %&amp;gt;% mean
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] 1
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;E assim fica desmistificado o mist√©rio do pipe! Um √∫ltimo pulo do gato: pelo amor de deus ningu√©m digita &lt;code&gt;Shift + %, &amp;gt;, Shift + %&lt;/code&gt;, basta usar o atalho: &lt;code&gt;Ctrl + Shift + M&lt;/code&gt; que ele p√µe um pipe separado por espa√ßos &lt;code&gt;%&amp;gt;%&lt;/code&gt;.&lt;/p&gt;
&lt;h2 id=&#34;readr&#34;&gt;&lt;code&gt;readr&lt;/code&gt;&lt;/h2&gt;
&lt;p&gt;Usu√°rios do R provavelmente v√£o estar familiarizados com os nossos leitores de arquivos mais comuns: &lt;code&gt;read.table&lt;/code&gt; e &lt;code&gt;read.csv&lt;/code&gt;. Talvez muitos de voc√™s j√° at√© memorizaram alguns dos argumentos mais comuns. N√£o √© o caso aqui de revisitar esta fun√ß√£o, mas o &lt;code&gt;readr&lt;/code&gt; tem muitos paralelos com elas, porque √© pensado como uma nova vers√£o da mesma coisa.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;# Comecemos carregando o readr
library(readr)
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;debaixo-do-cap√¥&#34;&gt;Debaixo do cap√¥&lt;/h3&gt;
&lt;p&gt;O readr, como as fun√ß√µes de leitura do &lt;code&gt;base&lt;/code&gt; √© uma cole√ß√£o de &lt;em&gt;parsers&lt;/em&gt;, que transformam texto em objetos R com o tipo desejado.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;parse_number(c(&amp;quot;1&amp;quot;, &amp;quot;20&amp;quot;, &amp;quot;38&amp;quot;))
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1]  1 20 38
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;parse_character(c(&amp;quot;banana&amp;quot;, &amp;quot;ma√ß√£&amp;quot;, &amp;quot;p√™ra&amp;quot;))
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] &amp;quot;banana&amp;quot;     &amp;quot;ma&amp;lt;e7&amp;gt;&amp;lt;e3&amp;gt;&amp;quot; &amp;quot;p&amp;lt;ea&amp;gt;ra&amp;quot;
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;# Note os acentos e caracteres especiais
parse_character(c(&amp;quot;banana&amp;quot;, &amp;quot;ma√ß√£&amp;quot;, &amp;quot;p√™ra&amp;quot;), 
                locale = locale(encoding = &amp;quot;Windows-1252&amp;quot;))
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] &amp;quot;banana&amp;quot; &amp;quot;ma√ß√£&amp;quot;   &amp;quot;p√™ra&amp;quot;
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;parse_logical(c(&amp;quot;true&amp;quot;, &amp;quot;false&amp;quot;, &amp;quot;true&amp;quot;))
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1]  TRUE FALSE  TRUE
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Em geral, a gente n√£o precisa descer tanto o n√≠vel, a gente vai trabalhar mesmo √© com os leitores de dados &amp;ldquo;retangulares&amp;rdquo;. Como os do &lt;code&gt;base&lt;/code&gt;, eles s√£o &lt;code&gt;read_csv&lt;/code&gt;, &lt;code&gt;read_table&lt;/code&gt;, etc. Vamos trabalhar com bancos de dados que j√° v√™m no pacote, para facilitar o processo.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;# Lista os datasets que vem no pacote
readr_example()
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] &amp;quot;challenge.csv&amp;quot;     &amp;quot;epa78.txt&amp;quot;         &amp;quot;example.log&amp;quot;      
## [4] &amp;quot;fwf-sample.txt&amp;quot;    &amp;quot;massey-rating.txt&amp;quot; &amp;quot;mtcars.csv&amp;quot;       
## [7] &amp;quot;mtcars.csv.bz2&amp;quot;    &amp;quot;mtcars.csv.zip&amp;quot;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Uma coisa que gosto de fazer √© olhar como o arquivo est√° organizado antes de tentar abr√≠-lo. Muitos de voc√™s podem fazer isso com &lt;code&gt;readLines&lt;/code&gt;. Ela ganhou sua vers√£o no pacote com &lt;code&gt;read_lines&lt;/code&gt;.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;# Vamos tentar abrir massey-rating.txt
read_lines(readr_example(&amp;quot;massey-rating.txt&amp;quot;), n_max = 10)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##  [1] &amp;quot;UCC PAY LAZ KPK  RT   COF BIH DII ENG ACU Rank Team            Conf&amp;quot; 
##  [2] &amp;quot;  1   1   1   1   1     1   1   1   1   1    1 Ohio St          B10 &amp;quot;
##  [3] &amp;quot;  2   2   2   2   2     2   2   2   4   2    2 Oregon           P12 &amp;quot;
##  [4] &amp;quot;  3   4   3   4   3     4   3   4   2   3    3 Alabama          SEC &amp;quot;
##  [5] &amp;quot;  4   3   4   3   4     3   5   3   3   4    4 TCU              B12 &amp;quot;
##  [6] &amp;quot;  6   6   6   5   5     7   6   5   6  11    5 Michigan St      B10 &amp;quot;
##  [7] &amp;quot;  7   7   7   6   7     6  11   8   7   8    6 Georgia          SEC &amp;quot;
##  [8] &amp;quot;  5   5   5   7   6     8   4   6   5   5    7 Florida St       ACC &amp;quot;
##  [9] &amp;quot;  8   8   9   9  10     5   7   7  10   7    8 Baylor           B12 &amp;quot;
## [10] &amp;quot;  9  11   8  13  11    11  12   9  14   9    9 Georgia Tech     ACC &amp;quot;
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;# Identificando o separador, escolho a fun√ß√£o adequada
read_table(readr_example(&amp;quot;massey-rating.txt&amp;quot;))
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## 
## -- Column specification --------------------------------------------------------
## cols(
##   UCC = col_double(),
##   PAY = col_double(),
##   LAZ = col_double(),
##   KPK = col_double(),
##   RT = col_double(),
##   COF = col_double(),
##   BIH = col_double(),
##   DII = col_double(),
##   ENG = col_double(),
##   ACU = col_double(),
##   Rank = col_double(),
##   Team = col_character(),
##   Conf = col_character()
## )
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 10 x 13
##      UCC   PAY   LAZ   KPK    RT   COF   BIH   DII   ENG   ACU  Rank Team  Conf 
##    &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt; &amp;lt;chr&amp;gt; &amp;lt;chr&amp;gt;
##  1     1     1     1     1     1     1     1     1     1     1     1 Ohio~ B10  
##  2     2     2     2     2     2     2     2     2     4     2     2 Oreg~ P12  
##  3     3     4     3     4     3     4     3     4     2     3     3 Alab~ SEC  
##  4     4     3     4     3     4     3     5     3     3     4     4 TCU   B12  
##  5     6     6     6     5     5     7     6     5     6    11     5 Mich~ B10  
##  6     7     7     7     6     7     6    11     8     7     8     6 Geor~ SEC  
##  7     5     5     5     7     6     8     4     6     5     5     7 Flor~ ACC  
##  8     8     8     9     9    10     5     7     7    10     7     8 Bayl~ B12  
##  9     9    11     8    13    11    11    12     9    14     9     9 Geor~ ACC  
## 10    13    10    13    11     8     9    10    11     9    10    10 Miss~ SEC
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Como identifiquei que as colunas estavam separadas por espa√ßos, utilizei &lt;code&gt;read_table&lt;/code&gt; cujo delimitador √© o espa√ßo &lt;code&gt;&amp;quot; &amp;quot;&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;A segunda feature mais interessante do readr, √© uma interface para selecionar os tipos de colunas que ser√£o importadas. Vejamos o seguinte exemplo.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;# Vamos abrir mtcars.csv
read_lines(readr_example(&amp;quot;mtcars.csv&amp;quot;), n_max = 10)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##  [1] &amp;quot;\&amp;quot;mpg\&amp;quot;,\&amp;quot;cyl\&amp;quot;,\&amp;quot;disp\&amp;quot;,\&amp;quot;hp\&amp;quot;,\&amp;quot;drat\&amp;quot;,\&amp;quot;wt\&amp;quot;,\&amp;quot;qsec\&amp;quot;,\&amp;quot;vs\&amp;quot;,\&amp;quot;am\&amp;quot;,\&amp;quot;gear\&amp;quot;,\&amp;quot;carb\&amp;quot;&amp;quot;
##  [2] &amp;quot;21,6,160,110,3.9,2.62,16.46,0,1,4,4&amp;quot;                                                     
##  [3] &amp;quot;21,6,160,110,3.9,2.875,17.02,0,1,4,4&amp;quot;                                                    
##  [4] &amp;quot;22.8,4,108,93,3.85,2.32,18.61,1,1,4,1&amp;quot;                                                   
##  [5] &amp;quot;21.4,6,258,110,3.08,3.215,19.44,1,0,3,1&amp;quot;                                                 
##  [6] &amp;quot;18.7,8,360,175,3.15,3.44,17.02,0,0,3,2&amp;quot;                                                  
##  [7] &amp;quot;18.1,6,225,105,2.76,3.46,20.22,1,0,3,1&amp;quot;                                                  
##  [8] &amp;quot;14.3,8,360,245,3.21,3.57,15.84,0,0,3,4&amp;quot;                                                  
##  [9] &amp;quot;24.4,4,146.7,62,3.69,3.19,20,1,0,4,2&amp;quot;                                                    
## [10] &amp;quot;22.8,4,140.8,95,3.92,3.15,22.9,1,0,4,2&amp;quot;
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;# Identificamos o separador de colunas, selecionamos a fun√ß√£o adequada
read_csv(readr_example(&amp;quot;mtcars.csv&amp;quot;))
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## 
## -- Column specification --------------------------------------------------------
## cols(
##   mpg = col_double(),
##   cyl = col_double(),
##   disp = col_double(),
##   hp = col_double(),
##   drat = col_double(),
##   wt = col_double(),
##   qsec = col_double(),
##   vs = col_double(),
##   am = col_double(),
##   gear = col_double(),
##   carb = col_double()
## )
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 32 x 11
##      mpg   cyl  disp    hp  drat    wt  qsec    vs    am  gear  carb
##    &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt;
##  1  21       6  160    110  3.9   2.62  16.5     0     1     4     4
##  2  21       6  160    110  3.9   2.88  17.0     0     1     4     4
##  3  22.8     4  108     93  3.85  2.32  18.6     1     1     4     1
##  4  21.4     6  258    110  3.08  3.22  19.4     1     0     3     1
##  5  18.7     8  360    175  3.15  3.44  17.0     0     0     3     2
##  6  18.1     6  225    105  2.76  3.46  20.2     1     0     3     1
##  7  14.3     8  360    245  3.21  3.57  15.8     0     0     3     4
##  8  24.4     4  147.    62  3.69  3.19  20       1     0     4     2
##  9  22.8     4  141.    95  3.92  3.15  22.9     1     0     4     2
## 10  19.2     6  168.   123  3.92  3.44  18.3     1     0     4     4
## # ... with 22 more rows
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;O console nos mostra que a leitura do banco foi completada, mas tamb√©m mostra &lt;code&gt;Column Specification&lt;/code&gt;. Isto indica qual o tipo de dado que foi identificado automaticamente numa an√°lise feita pela fun√ß√£o  &lt;code&gt;guess_parser&lt;/code&gt;. Em diversos casos, n√≥s podemos querer identificar manualmente as colunas. Vejamos um exemplo:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;# Vamos identificar as colunas com spec
spec_csv(readr_example(&amp;quot;mtcars.csv&amp;quot;))
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## 
## -- Column specification --------------------------------------------------------
## cols(
##   mpg = col_double(),
##   cyl = col_double(),
##   disp = col_double(),
##   hp = col_double(),
##   drat = col_double(),
##   wt = col_double(),
##   qsec = col_double(),
##   vs = col_double(),
##   am = col_double(),
##   gear = col_double(),
##   carb = col_double()
## )
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## cols(
##   mpg = col_double(),
##   cyl = col_double(),
##   disp = col_double(),
##   hp = col_double(),
##   drat = col_double(),
##   wt = col_double(),
##   qsec = col_double(),
##   vs = col_double(),
##   am = col_double(),
##   gear = col_double(),
##   carb = col_double()
## )
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;# Copia e cola, modifica as colunas que queremos alterar

spec_cols &amp;lt;- cols(
  mpg = col_double(),
  cyl = col_factor(), # N de cilindros do autom√≥vel
  disp = col_double(),
  hp = col_double(),
  drat = col_double(),
  wt = col_double(),
  qsec = col_double(),
  vs = col_double(),
  am = col_factor(c(&amp;quot;0&amp;quot;, &amp;quot;1&amp;quot;)), # Transmiss√£o autom√°tica ou manual
  gear = col_double(),
  carb = col_double()
)

df &amp;lt;- read_csv(readr_example(&amp;quot;mtcars.csv&amp;quot;), col_types = spec_cols)
df
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 32 x 11
##      mpg cyl    disp    hp  drat    wt  qsec    vs am     gear  carb
##    &amp;lt;dbl&amp;gt; &amp;lt;fct&amp;gt; &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt; &amp;lt;fct&amp;gt; &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt;
##  1  21   6      160    110  3.9   2.62  16.5     0 1         4     4
##  2  21   6      160    110  3.9   2.88  17.0     0 1         4     4
##  3  22.8 4      108     93  3.85  2.32  18.6     1 1         4     1
##  4  21.4 6      258    110  3.08  3.22  19.4     1 0         3     1
##  5  18.7 8      360    175  3.15  3.44  17.0     0 0         3     2
##  6  18.1 6      225    105  2.76  3.46  20.2     1 0         3     1
##  7  14.3 8      360    245  3.21  3.57  15.8     0 0         3     4
##  8  24.4 4      147.    62  3.69  3.19  20       1 0         4     2
##  9  22.8 4      141.    95  3.92  3.15  22.9     1 0         4     2
## 10  19.2 6      168.   123  3.92  3.44  18.3     1 0         4     4
## # ... with 22 more rows
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;# Para importar apenas colunas selecionadas, utilize &#39;cols_only()&#39;
spec_cols2 &amp;lt;- cols_only(
  mpg = col_double(),
  cyl = col_factor(), # N de cilindros do autom√≥vel
  am = col_factor(c(&amp;quot;0&amp;quot;, &amp;quot;1&amp;quot;)), # Transmiss√£o autom√°tica ou manual
  gear = col_double(),
  carb = col_double()
)

df2 &amp;lt;- read_csv(readr_example(&amp;quot;mtcars.csv&amp;quot;), col_types = spec_cols2)
df2
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 32 x 5
##      mpg cyl   am     gear  carb
##    &amp;lt;dbl&amp;gt; &amp;lt;fct&amp;gt; &amp;lt;fct&amp;gt; &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt;
##  1  21   6     1         4     4
##  2  21   6     1         4     4
##  3  22.8 4     1         4     1
##  4  21.4 6     0         3     1
##  5  18.7 8     0         3     2
##  6  18.1 6     0         3     1
##  7  14.3 8     0         3     4
##  8  24.4 4     0         4     2
##  9  22.8 4     0         4     2
## 10  19.2 6     0         4     4
## # ... with 22 more rows
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;# Para indicar os tipos de colunas de um jeito mais sucinto, utilize uma string:

df &amp;lt;- read_csv(readr_example(&amp;quot;mtcars.csv&amp;quot;), col_types = &amp;quot;dfddddddfdd&amp;quot;)

# S√≥ cuidado pra n√£o perder a conta dos ds!
df
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 32 x 11
##      mpg cyl    disp    hp  drat    wt  qsec    vs am     gear  carb
##    &amp;lt;dbl&amp;gt; &amp;lt;fct&amp;gt; &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt; &amp;lt;fct&amp;gt; &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt;
##  1  21   6      160    110  3.9   2.62  16.5     0 1         4     4
##  2  21   6      160    110  3.9   2.88  17.0     0 1         4     4
##  3  22.8 4      108     93  3.85  2.32  18.6     1 1         4     1
##  4  21.4 6      258    110  3.08  3.22  19.4     1 0         3     1
##  5  18.7 8      360    175  3.15  3.44  17.0     0 0         3     2
##  6  18.1 6      225    105  2.76  3.46  20.2     1 0         3     1
##  7  14.3 8      360    245  3.21  3.57  15.8     0 0         3     4
##  8  24.4 4      147.    62  3.69  3.19  20       1 0         4     2
##  9  22.8 4      141.    95  3.92  3.15  22.9     1 0         4     2
## 10  19.2 6      168.   123  3.92  3.44  18.3     1 0         4     4
## # ... with 22 more rows
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Voc√™ tamb√©m pode querer definir caracter√≠sticas de localiza√ß√£o, como a codifica√ß√£o de caracteres, os separadores de decimal e de milhar e etc. A melhor forma de fazer isso √© definir um &lt;code&gt;locale&lt;/code&gt;.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;meu_locale &amp;lt;- locale(encoding = &amp;quot;UTF-8&amp;quot;, decimal_mark = &amp;quot;,&amp;quot;, grouping_mark = &amp;quot;.&amp;quot;)
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;A√≠ √© s√≥ passar isso pra uma das fun√ß√µes do pacote sob o argumento &lt;code&gt;locale&lt;/code&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;read_csv(readr_example(&amp;quot;mtcars.csv&amp;quot;), locale = meu_locale)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## 
## -- Column specification --------------------------------------------------------
## cols(
##   mpg = col_number(),
##   cyl = col_double(),
##   disp = col_number(),
##   hp = col_double(),
##   drat = col_number(),
##   wt = col_number(),
##   qsec = col_number(),
##   vs = col_double(),
##   am = col_double(),
##   gear = col_double(),
##   carb = col_double()
## )
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 32 x 11
##      mpg   cyl  disp    hp  drat    wt  qsec    vs    am  gear  carb
##    &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt;
##  1    21     6   160   110    39   262  1646     0     1     4     4
##  2    21     6   160   110    39  2875  1702     0     1     4     4
##  3   228     4   108    93   385   232  1861     1     1     4     1
##  4   214     6   258   110   308  3215  1944     1     0     3     1
##  5   187     8   360   175   315   344  1702     0     0     3     2
##  6   181     6   225   105   276   346  2022     1     0     3     1
##  7   143     8   360   245   321   357  1584     0     0     3     4
##  8   244     4  1467    62   369   319    20     1     0     4     2
##  9   228     4  1408    95   392   315   229     1     0     4     2
## 10   192     6  1676   123   392   344   183     1     0     4     4
## # ... with 22 more rows
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Existe ainda a possibilidade de ler dados colunados com largura-fixa. &lt;code&gt;readr&lt;/code&gt; implementa quatro fun√ß√µes diferentes para ajudar na constru√ß√£o do dicion√°rio:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;# Nossos dados
x &amp;lt;- readr_example(&amp;quot;fwf-sample.txt&amp;quot;)
read_lines(x, n_max = 10)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] &amp;quot;John Smith          WA        418-Y11-4111&amp;quot;
## [2] &amp;quot;Mary Hartford       CA        319-Z19-4341&amp;quot;
## [3] &amp;quot;Evan Nolan          IL        219-532-c301&amp;quot;
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;# separados por espa√ßo

dic1 &amp;lt;- fwf_empty(x)
dic1
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## $begin
## [1]  0  5 20 30
## 
## $end
## [1]  4 13 22 NA
## 
## $skip
## [1] 0
## 
## $col_names
## [1] &amp;quot;X1&amp;quot; &amp;quot;X2&amp;quot; &amp;quot;X3&amp;quot; &amp;quot;X4&amp;quot;
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;df &amp;lt;- read_fwf(file = x, col_positions = dic1)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## 
## -- Column specification --------------------------------------------------------
## cols(
##   X1 = col_character(),
##   X2 = col_character(),
##   X3 = col_character(),
##   X4 = col_character()
## )
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;df
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 3 x 4
##   X1    X2       X3    X4          
##   &amp;lt;chr&amp;gt; &amp;lt;chr&amp;gt;    &amp;lt;chr&amp;gt; &amp;lt;chr&amp;gt;       
## 1 John  Smith    WA    418-Y11-4111
## 2 Mary  Hartford CA    319-Z19-4341
## 3 Evan  Nolan    IL    219-532-c301
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;# indicando a largura da coluna
larguras &amp;lt;- c(20, 10, 12)

dic2 &amp;lt;- fwf_widths(larguras)
dic2
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 3 x 3
##   begin   end col_names
##   &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt; &amp;lt;chr&amp;gt;    
## 1     0    20 X1       
## 2    20    30 X2       
## 3    30    42 X3
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;df &amp;lt;- read_fwf(file = x, col_positions = dic2)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## 
## -- Column specification --------------------------------------------------------
## cols(
##   X1 = col_character(),
##   X2 = col_character(),
##   X3 = col_character()
## )
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;df
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 3 x 3
##   X1            X2    X3          
##   &amp;lt;chr&amp;gt;         &amp;lt;chr&amp;gt; &amp;lt;chr&amp;gt;       
## 1 John Smith    WA    418-Y11-4111
## 2 Mary Hartford CA    319-Z19-4341
## 3 Evan Nolan    IL    219-532-c301
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;# indicando onde cada coluna come√ßa e termina
comeca &amp;lt;- c(1, 21, 30)
termina &amp;lt;- c(20, 29, 42)

dic3 &amp;lt;- fwf_positions(comeca, termina)
dic3
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 3 x 3
##   begin   end col_names
##   &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt; &amp;lt;chr&amp;gt;    
## 1     0    20 X1       
## 2    20    29 X2       
## 3    29    42 X3
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;df &amp;lt;- read_fwf(file = x, col_positions = dic3)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## 
## -- Column specification --------------------------------------------------------
## cols(
##   X1 = col_character(),
##   X2 = col_character(),
##   X3 = col_character()
## )
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;df
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 3 x 3
##   X1            X2    X3          
##   &amp;lt;chr&amp;gt;         &amp;lt;chr&amp;gt; &amp;lt;chr&amp;gt;       
## 1 John Smith    WA    418-Y11-4111
## 2 Mary Hartford CA    319-Z19-4341
## 3 Evan Nolan    IL    219-532-c301
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;# indicando pares nome-valor
dic4 &amp;lt;- fwf_cols(
  nome = c(1, 20),
  uf = c(21, 29),
  numero = c(30, 42))
dic4
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 3 x 3
##   begin   end col_names
##   &amp;lt;int&amp;gt; &amp;lt;int&amp;gt; &amp;lt;chr&amp;gt;    
## 1     0    20 nome     
## 2    20    29 uf       
## 3    29    42 numero
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;df &amp;lt;- read_fwf(file = x, col_positions = dic4)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## 
## -- Column specification --------------------------------------------------------
## cols(
##   nome = col_character(),
##   uf = col_character(),
##   numero = col_character()
## )
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;df
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 3 x 3
##   nome          uf    numero      
##   &amp;lt;chr&amp;gt;         &amp;lt;chr&amp;gt; &amp;lt;chr&amp;gt;       
## 1 John Smith    WA    418-Y11-4111
## 2 Mary Hartford CA    319-Z19-4341
## 3 Evan Nolan    IL    219-532-c301
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Especificar dicion√°rios para arquivos colunados √© um p√©-no-saco, por sorte, existem pacotes que j√° fizeram parte desse trabalho por n√≥s. O &lt;code&gt;readr&lt;/code&gt; n√£o melhora muita o servi√ßo manual de constru√ß√£o de dicion√°rios, o que ele oferece √© um ganho de performance tremendo. &lt;code&gt;read_fwf&lt;/code&gt; √© centenas de vezes mais r√°pido que o base &lt;code&gt;read.fwf&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Em termos do que o pacote faz, √© basicamente isso. A √∫nica coisa que falta mencionar √© que ele importa os dados como &lt;code&gt;tibbles&lt;/code&gt; ao inv√©s do &lt;code&gt;data.frame&lt;/code&gt; padr√£o, mas isso j√° √© um √≥timo gancho pra nossa pr√≥xima parte.&lt;/p&gt;
&lt;h2 id=&#34;tibbles&#34;&gt;&lt;code&gt;tibbles&lt;/code&gt;&lt;/h2&gt;
&lt;p&gt;Tibbles s√£o basicamente data.frames com um m√©todo mais bonitinho de &lt;code&gt;print&lt;/code&gt;. Elas automaticamente se ajustam a largura da sua tela, omitindo as colunas que estouram, e por padr√£o imprimem s√≥ as 10 primeiras observa√ß√µes. Outras caracter√≠sticas que pessoalmente gosto, √© que elas informam o tipo de vari√°vel junto com o nome, arrendondam digitos significativos, destacam n√∫meros grandes, negativos, NAs e etc.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;df &amp;lt;- read_csv(readr_example(&amp;quot;mtcars.csv&amp;quot;), col_types = cols()) # omitir a especifica√ß√£o
df
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 32 x 11
##      mpg   cyl  disp    hp  drat    wt  qsec    vs    am  gear  carb
##    &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt;
##  1  21       6  160    110  3.9   2.62  16.5     0     1     4     4
##  2  21       6  160    110  3.9   2.88  17.0     0     1     4     4
##  3  22.8     4  108     93  3.85  2.32  18.6     1     1     4     1
##  4  21.4     6  258    110  3.08  3.22  19.4     1     0     3     1
##  5  18.7     8  360    175  3.15  3.44  17.0     0     0     3     2
##  6  18.1     6  225    105  2.76  3.46  20.2     1     0     3     1
##  7  14.3     8  360    245  3.21  3.57  15.8     0     0     3     4
##  8  24.4     4  147.    62  3.69  3.19  20       1     0     4     2
##  9  22.8     4  141.    95  3.92  3.15  22.9     1     0     4     2
## 10  19.2     6  168.   123  3.92  3.44  18.3     1     0     4     4
## # ... with 22 more rows
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Do ponto de vista pr√°tico, elas funcionam exatamente igual a data.frames, tudo que voc√™ pode fazer com um data.frame, voc√™ faz com tibbles. O que elas trazem de novidade √©:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Elas nunca mudam o tipo de dado inputado.&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;df1 &amp;lt;- data.frame(x = list(1:5, 1:10, 1:20))
df1
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##    x.1.5 x.1.10 x.1.20
## 1      1      1      1
## 2      2      2      2
## 3      3      3      3
## 4      4      4      4
## 5      5      5      5
## 6      1      6      6
## 7      2      7      7
## 8      3      8      8
## 9      4      9      9
## 10     5     10     10
## 11     1      1     11
## 12     2      2     12
## 13     3      3     13
## 14     4      4     14
## 15     5      5     15
## 16     1      6     16
## 17     2      7     17
## 18     3      8     18
## 19     4      9     19
## 20     5     10     20
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;df2 &amp;lt;- tibble(x = list(1:5, 1:10, 1:20))
df2
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 3 x 1
##   x         
##   &amp;lt;list&amp;gt;    
## 1 &amp;lt;int [5]&amp;gt; 
## 2 &amp;lt;int [10]&amp;gt;
## 3 &amp;lt;int [20]&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;ul&gt;
&lt;li&gt;Elas nunca ajustam os nomes das vari√°veis&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;names(data.frame(`nome hipster` = 1))
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] &amp;quot;nome.hipster&amp;quot;
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;names(tibble(`nome hipster` = 1))
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] &amp;quot;nome hipster&amp;quot;
&lt;/code&gt;&lt;/pre&gt;
&lt;ul&gt;
&lt;li&gt;Ela avalia cada argumento de forma &amp;ldquo;pregui√ßosa&amp;rdquo; e sequencial&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;# erro
data.frame(x = 1:5, y = x ^ 2)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## Error in x^2: argumento n√£o-num√©rico para operador bin√°rio
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;# funciona
tibble(x = 1:5, y = x ^ 2)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 5 x 2
##       x     y
##   &amp;lt;int&amp;gt; &amp;lt;dbl&amp;gt;
## 1     1     1
## 2     2     4
## 3     3     9
## 4     4    16
## 5     5    25
&lt;/code&gt;&lt;/pre&gt;
&lt;ul&gt;
&lt;li&gt;Ela nunca utiliza row.names&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;head(data.frame(state.x77))
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##            Population Income Illiteracy Life.Exp Murder HS.Grad Frost   Area
## Alabama          3615   3624        2.1    69.05   15.1    41.3    20  50708
## Alaska            365   6315        1.5    69.31   11.3    66.7   152 566432
## Arizona          2212   4530        1.8    70.55    7.8    58.1    15 113417
## Arkansas         2110   3378        1.9    70.66   10.1    39.9    65  51945
## California      21198   5114        1.1    71.71   10.3    62.6    20 156361
## Colorado         2541   4884        0.7    72.06    6.8    63.9   166 103766
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;as_tibble(state.x77)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 50 x 8
##    Population Income Illiteracy `Life Exp` Murder `HS Grad` Frost   Area
##         &amp;lt;dbl&amp;gt;  &amp;lt;dbl&amp;gt;      &amp;lt;dbl&amp;gt;      &amp;lt;dbl&amp;gt;  &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt;  &amp;lt;dbl&amp;gt;
##  1       3615   3624        2.1       69.0   15.1      41.3    20  50708
##  2        365   6315        1.5       69.3   11.3      66.7   152 566432
##  3       2212   4530        1.8       70.6    7.8      58.1    15 113417
##  4       2110   3378        1.9       70.7   10.1      39.9    65  51945
##  5      21198   5114        1.1       71.7   10.3      62.6    20 156361
##  6       2541   4884        0.7       72.1    6.8      63.9   166 103766
##  7       3100   5348        1.1       72.5    3.1      56     139   4862
##  8        579   4809        0.9       70.1    6.2      54.6   103   1982
##  9       8277   4815        1.3       70.7   10.7      52.6    11  54090
## 10       4931   4091        2         68.5   13.9      40.6    60  58073
## # ... with 40 more rows
&lt;/code&gt;&lt;/pre&gt;
&lt;ul&gt;
&lt;li&gt;Ela muda a &amp;ldquo;regra da reciclagem&amp;rdquo;: apenas s√£o aceitos vetores unit√°rios ou vetores de tamanho igual aos demais&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;data.frame(x = 1:10, y = 1:5)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##     x y
## 1   1 1
## 2   2 2
## 3   3 3
## 4   4 4
## 5   5 5
## 6   6 1
## 7   7 2
## 8   8 3
## 9   9 4
## 10 10 5
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;# erro
tibble(x = 1:10, y = 1:5)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## Error: Tibble columns must have compatible sizes.
## * Size 10: Existing data.
## * Size 5: Column `y`.
## i Only values of size one are recycled.
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;tibble(x = 1:10, y = 1)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 10 x 2
##        x     y
##    &amp;lt;int&amp;gt; &amp;lt;dbl&amp;gt;
##  1     1     1
##  2     2     1
##  3     3     1
##  4     4     1
##  5     5     1
##  6     6     1
##  7     7     1
##  8     8     1
##  9     9     1
## 10    10     1
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;tibble(x = 1:10, y = c(1:5, 1:5))
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 10 x 2
##        x     y
##    &amp;lt;int&amp;gt; &amp;lt;int&amp;gt;
##  1     1     1
##  2     2     2
##  3     3     3
##  4     4     4
##  5     5     5
##  6     6     1
##  7     7     2
##  8     8     3
##  9     9     4
## 10    10     5
&lt;/code&gt;&lt;/pre&gt;
&lt;ul&gt;
&lt;li&gt;Tibbles s√£o estritas com rela√ß√£o as opera√ß√µes de subsetting com &lt;code&gt;[&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;df1 &amp;lt;- data.frame(x = 1:3, y = 3:1)
class(df1[,1:2])
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] &amp;quot;data.frame&amp;quot;
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;class(df1[,1])
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] &amp;quot;integer&amp;quot;
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;df2 &amp;lt;- tibble(x = 1:3, y = 3:1)
class(df2[, 1:2])
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] &amp;quot;tbl_df&amp;quot;     &amp;quot;tbl&amp;quot;        &amp;quot;data.frame&amp;quot;
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;class(df2[, 1])
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] &amp;quot;tbl_df&amp;quot;     &amp;quot;tbl&amp;quot;        &amp;quot;data.frame&amp;quot;
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;# Se quiser extrair s√≥ uma coluna, utilize &#39;[[&#39; ou &#39;$&#39;
class(df2[[1]])
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] &amp;quot;integer&amp;quot;
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;class(df2$x)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] &amp;quot;integer&amp;quot;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Elas tamb√©m n√£o aceitam &amp;lsquo;partial matching&amp;rsquo; de nomes de vari√°veis.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;df &amp;lt;- data.frame(nome_de_cavalo = 1)
df$nome
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] 1
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;df2 &amp;lt;- tibble(nome_de_cavalo = 1)
df2$nome
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## Warning: Unknown or uninitialised column: `nome`.
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## NULL
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;tidyr&#34;&gt;&lt;code&gt;tidyr&lt;/code&gt;&lt;/h2&gt;
&lt;p&gt;Ok, nossos dados est√£o no R, mas, muitas vezes, n√£o est√£o no formato adequado. De maneira geral, analistas de dados v√£o dar prefer√™ncia a um formato parecido com este:&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://laddem.github.io/courses/tidyverse/dia1_files/tidy-1.png&#34; alt=&#34;Tidy Data&#34;&gt;&lt;/p&gt;
&lt;p&gt;Isto tem uma raz√£o de ser que deve tornar-se √≥bvia quando tentarmos realizar as opera√ß√µes de transforma√ß√£o de vari√°veis, visualiza√ß√£o, modelos, etc. Por√©m, muitas vezes outras considera√ß√µes s√£o feitas na hora registrar os dados, armazen√°-los, apresent√°-los ao p√∫blico, por isso, frequentemente nossos dados n√£o est√£o no formato tidy e precisam ser reformatados. Essa √© uma das principais tarefas do &lt;code&gt;tidyr&lt;/code&gt; e √© nela que vamos nos concentrar.&lt;/p&gt;
&lt;p&gt;Atente que reformata√ß√£o, como muitos outros aspectos da an√°lise de dados, n√£o √© receita de bolo. Muitas vezes o formato desejado n√£o √© √≥bvio, muito menos os passos necess√°rios para chegar l√°. Por√©m, vou apresentar as ferramentas e alguns exemplos simples que cobrem muitos dos nossos casos de uso.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;library(tidyr)
who
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 7,240 x 60
##    country  iso2  iso3   year new_sp_m014 new_sp_m1524 new_sp_m2534 new_sp_m3544
##    &amp;lt;chr&amp;gt;    &amp;lt;chr&amp;gt; &amp;lt;chr&amp;gt; &amp;lt;int&amp;gt;       &amp;lt;int&amp;gt;        &amp;lt;int&amp;gt;        &amp;lt;int&amp;gt;        &amp;lt;int&amp;gt;
##  1 Afghani~ AF    AFG    1980          NA           NA           NA           NA
##  2 Afghani~ AF    AFG    1981          NA           NA           NA           NA
##  3 Afghani~ AF    AFG    1982          NA           NA           NA           NA
##  4 Afghani~ AF    AFG    1983          NA           NA           NA           NA
##  5 Afghani~ AF    AFG    1984          NA           NA           NA           NA
##  6 Afghani~ AF    AFG    1985          NA           NA           NA           NA
##  7 Afghani~ AF    AFG    1986          NA           NA           NA           NA
##  8 Afghani~ AF    AFG    1987          NA           NA           NA           NA
##  9 Afghani~ AF    AFG    1988          NA           NA           NA           NA
## 10 Afghani~ AF    AFG    1989          NA           NA           NA           NA
## # ... with 7,230 more rows, and 52 more variables: new_sp_m4554 &amp;lt;int&amp;gt;,
## #   new_sp_m5564 &amp;lt;int&amp;gt;, new_sp_m65 &amp;lt;int&amp;gt;, new_sp_f014 &amp;lt;int&amp;gt;,
## #   new_sp_f1524 &amp;lt;int&amp;gt;, new_sp_f2534 &amp;lt;int&amp;gt;, new_sp_f3544 &amp;lt;int&amp;gt;,
## #   new_sp_f4554 &amp;lt;int&amp;gt;, new_sp_f5564 &amp;lt;int&amp;gt;, new_sp_f65 &amp;lt;int&amp;gt;,
## #   new_sn_m014 &amp;lt;int&amp;gt;, new_sn_m1524 &amp;lt;int&amp;gt;, new_sn_m2534 &amp;lt;int&amp;gt;,
## #   new_sn_m3544 &amp;lt;int&amp;gt;, new_sn_m4554 &amp;lt;int&amp;gt;, new_sn_m5564 &amp;lt;int&amp;gt;,
## #   new_sn_m65 &amp;lt;int&amp;gt;, new_sn_f014 &amp;lt;int&amp;gt;, new_sn_f1524 &amp;lt;int&amp;gt;,
## #   new_sn_f2534 &amp;lt;int&amp;gt;, new_sn_f3544 &amp;lt;int&amp;gt;, new_sn_f4554 &amp;lt;int&amp;gt;,
## #   new_sn_f5564 &amp;lt;int&amp;gt;, new_sn_f65 &amp;lt;int&amp;gt;, new_ep_m014 &amp;lt;int&amp;gt;,
## #   new_ep_m1524 &amp;lt;int&amp;gt;, new_ep_m2534 &amp;lt;int&amp;gt;, new_ep_m3544 &amp;lt;int&amp;gt;,
## #   new_ep_m4554 &amp;lt;int&amp;gt;, new_ep_m5564 &amp;lt;int&amp;gt;, new_ep_m65 &amp;lt;int&amp;gt;,
## #   new_ep_f014 &amp;lt;int&amp;gt;, new_ep_f1524 &amp;lt;int&amp;gt;, new_ep_f2534 &amp;lt;int&amp;gt;,
## #   new_ep_f3544 &amp;lt;int&amp;gt;, new_ep_f4554 &amp;lt;int&amp;gt;, new_ep_f5564 &amp;lt;int&amp;gt;,
## #   new_ep_f65 &amp;lt;int&amp;gt;, newrel_m014 &amp;lt;int&amp;gt;, newrel_m1524 &amp;lt;int&amp;gt;,
## #   newrel_m2534 &amp;lt;int&amp;gt;, newrel_m3544 &amp;lt;int&amp;gt;, newrel_m4554 &amp;lt;int&amp;gt;,
## #   newrel_m5564 &amp;lt;int&amp;gt;, newrel_m65 &amp;lt;int&amp;gt;, newrel_f014 &amp;lt;int&amp;gt;,
## #   newrel_f1524 &amp;lt;int&amp;gt;, newrel_f2534 &amp;lt;int&amp;gt;, newrel_f3544 &amp;lt;int&amp;gt;,
## #   newrel_f4554 &amp;lt;int&amp;gt;, newrel_f5564 &amp;lt;int&amp;gt;, newrel_f65 &amp;lt;int&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Esse √© um banco de dados dif√≠cil de analisar, ele tem 60 colunas, indicando o n√∫mero de casos de tuberculose em diversos est√°gios da doen√ßa, por pa√≠s e ano. O problema √© que ao inv√©s de termos algo como:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;tribble(
  ~pais, ~ano, ~tipo, ~idade, ~casos,
  &amp;quot;brasil&amp;quot;, 1980, &amp;quot;extrapulmonar&amp;quot;, &amp;quot;15-24&amp;quot;, 10,
  &amp;quot;brasil&amp;quot;, 1990, &amp;quot;relapso&amp;quot;, &amp;quot;15-24&amp;quot;, 10
)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 2 x 5
##   pais     ano tipo          idade casos
##   &amp;lt;chr&amp;gt;  &amp;lt;dbl&amp;gt; &amp;lt;chr&amp;gt;         &amp;lt;chr&amp;gt; &amp;lt;dbl&amp;gt;
## 1 brasil  1980 extrapulmonar 15-24    10
## 2 brasil  1990 relapso       15-24    10
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;As informa√ß√µes de tipo de tuberculose e idade dos pacientes est√£o espalhadas pelas colunas. Pra encurtar a hist√≥ria, precisamos &amp;ldquo;tombar&amp;rdquo; esse banco para que essas colunas se tornem um novo conjunto de vari√°veis. Vamos passo a passo.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;# Primeiro, vamos excluir as colunas iso2 e iso3, porque elas s√£o a mesma informa√ß√£o redundante
who$iso2 &amp;lt;- NULL
who$iso3 &amp;lt;- NULL

who1 &amp;lt;- pivot_longer(who,
                     cols = c(new_sp_m014:newrel_f65),
                     names_to = &amp;quot;tipo_tb&amp;quot;,
                     values_to = &amp;quot;casos&amp;quot;,
                     values_drop_na = TRUE)
who1
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 76,046 x 4
##    country      year tipo_tb      casos
##    &amp;lt;chr&amp;gt;       &amp;lt;int&amp;gt; &amp;lt;chr&amp;gt;        &amp;lt;int&amp;gt;
##  1 Afghanistan  1997 new_sp_m014      0
##  2 Afghanistan  1997 new_sp_m1524    10
##  3 Afghanistan  1997 new_sp_m2534     6
##  4 Afghanistan  1997 new_sp_m3544     3
##  5 Afghanistan  1997 new_sp_m4554     5
##  6 Afghanistan  1997 new_sp_m5564     2
##  7 Afghanistan  1997 new_sp_m65       0
##  8 Afghanistan  1997 new_sp_f014      5
##  9 Afghanistan  1997 new_sp_f1524    38
## 10 Afghanistan  1997 new_sp_f2534    36
## # ... with 76,036 more rows
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Nosso primeiro passo √© transformar todas as colunas de novos casos em um par de colunas:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;cols&lt;/code&gt; indica quais colunas ser√£o tombadas e quais ser√£o mantidas.&lt;/li&gt;
&lt;li&gt;Uma coluna &lt;code&gt;names_to&lt;/code&gt; recebe as categorias da vari√°vel.&lt;/li&gt;
&lt;li&gt;Uma coluna &lt;code&gt;values_to&lt;/code&gt; recebe os valores das c√©lulas.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;values_drop_na&lt;/code&gt; √© uma op√ß√£o para eliminar c√©lulas vazias.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Essa primeira transforma√ß√£o j√° nos d√° um banco de dados um pouco mais amig√°vel, por√©m, ainda temos vari√°veis &amp;ldquo;presas&amp;rdquo; na coluna &lt;code&gt;tipo_tb&lt;/code&gt;. Vamos tentar solt√°-las.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;# primeiro, corrigir uma pequena inconsistencia:
unique(who1$tipo_tb)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##  [1] &amp;quot;new_sp_m014&amp;quot;  &amp;quot;new_sp_m1524&amp;quot; &amp;quot;new_sp_m2534&amp;quot; &amp;quot;new_sp_m3544&amp;quot; &amp;quot;new_sp_m4554&amp;quot;
##  [6] &amp;quot;new_sp_m5564&amp;quot; &amp;quot;new_sp_m65&amp;quot;   &amp;quot;new_sp_f014&amp;quot;  &amp;quot;new_sp_f1524&amp;quot; &amp;quot;new_sp_f2534&amp;quot;
## [11] &amp;quot;new_sp_f3544&amp;quot; &amp;quot;new_sp_f4554&amp;quot; &amp;quot;new_sp_f5564&amp;quot; &amp;quot;new_sp_f65&amp;quot;   &amp;quot;new_sn_m014&amp;quot; 
## [16] &amp;quot;new_sn_m1524&amp;quot; &amp;quot;new_sn_m2534&amp;quot; &amp;quot;new_sn_m3544&amp;quot; &amp;quot;new_sn_m4554&amp;quot; &amp;quot;new_sn_m5564&amp;quot;
## [21] &amp;quot;new_sn_m65&amp;quot;   &amp;quot;new_ep_m014&amp;quot;  &amp;quot;new_ep_m1524&amp;quot; &amp;quot;new_ep_m2534&amp;quot; &amp;quot;new_ep_m3544&amp;quot;
## [26] &amp;quot;new_ep_m4554&amp;quot; &amp;quot;new_ep_m5564&amp;quot; &amp;quot;new_ep_m65&amp;quot;   &amp;quot;new_sn_f014&amp;quot;  &amp;quot;newrel_m014&amp;quot; 
## [31] &amp;quot;newrel_f014&amp;quot;  &amp;quot;new_sn_f1524&amp;quot; &amp;quot;new_sn_f2534&amp;quot; &amp;quot;new_sn_f3544&amp;quot; &amp;quot;new_sn_f4554&amp;quot;
## [36] &amp;quot;new_sn_f5564&amp;quot; &amp;quot;new_sn_f65&amp;quot;   &amp;quot;new_ep_f014&amp;quot;  &amp;quot;new_ep_f1524&amp;quot; &amp;quot;new_ep_f2534&amp;quot;
## [41] &amp;quot;new_ep_f3544&amp;quot; &amp;quot;new_ep_f4554&amp;quot; &amp;quot;new_ep_f5564&amp;quot; &amp;quot;new_ep_f65&amp;quot;   &amp;quot;newrel_m1524&amp;quot;
## [46] &amp;quot;newrel_m2534&amp;quot; &amp;quot;newrel_m3544&amp;quot; &amp;quot;newrel_m4554&amp;quot; &amp;quot;newrel_m5564&amp;quot; &amp;quot;newrel_m65&amp;quot;  
## [51] &amp;quot;newrel_f1524&amp;quot; &amp;quot;newrel_f2534&amp;quot; &amp;quot;newrel_f3544&amp;quot; &amp;quot;newrel_f4554&amp;quot; &amp;quot;newrel_f5564&amp;quot;
## [56] &amp;quot;newrel_f65&amp;quot;
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;# Notem que newrel deveria ser new_rel
# Alguns de voc√™s devem conhecer &#39;gsub&#39;
who1$tipo_tb &amp;lt;- gsub(&amp;quot;newrel&amp;quot;, &amp;quot;new_rel&amp;quot;, who1$tipo_tb)

# Agora, podemos usar outra fun√ß√£o chave do tidyr, &#39;separate&#39;
who2 &amp;lt;- who1 %&amp;gt;%  separate(col = tipo_tb,
                           into = c(NA, &amp;quot;tipo_tb&amp;quot;, &amp;quot;sexo_idade&amp;quot;),
                           sep = &amp;quot;_&amp;quot;)
who2
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 76,046 x 5
##    country      year tipo_tb sexo_idade casos
##    &amp;lt;chr&amp;gt;       &amp;lt;int&amp;gt; &amp;lt;chr&amp;gt;   &amp;lt;chr&amp;gt;      &amp;lt;int&amp;gt;
##  1 Afghanistan  1997 sp      m014           0
##  2 Afghanistan  1997 sp      m1524         10
##  3 Afghanistan  1997 sp      m2534          6
##  4 Afghanistan  1997 sp      m3544          3
##  5 Afghanistan  1997 sp      m4554          5
##  6 Afghanistan  1997 sp      m5564          2
##  7 Afghanistan  1997 sp      m65            0
##  8 Afghanistan  1997 sp      f014           5
##  9 Afghanistan  1997 sp      f1524         38
## 10 Afghanistan  1997 sp      f2534         36
## # ... with 76,036 more rows
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;# E outra passagem de separate para separar a idade do sexo
who3 &amp;lt;- who2 %&amp;gt;% separate(col = sexo_idade,
                          into = c(&amp;quot;sexo&amp;quot;, &amp;quot;idade&amp;quot;),
                          sep = 1)
who3
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 76,046 x 6
##    country      year tipo_tb sexo  idade casos
##    &amp;lt;chr&amp;gt;       &amp;lt;int&amp;gt; &amp;lt;chr&amp;gt;   &amp;lt;chr&amp;gt; &amp;lt;chr&amp;gt; &amp;lt;int&amp;gt;
##  1 Afghanistan  1997 sp      m     014       0
##  2 Afghanistan  1997 sp      m     1524     10
##  3 Afghanistan  1997 sp      m     2534      6
##  4 Afghanistan  1997 sp      m     3544      3
##  5 Afghanistan  1997 sp      m     4554      5
##  6 Afghanistan  1997 sp      m     5564      2
##  7 Afghanistan  1997 sp      m     65        0
##  8 Afghanistan  1997 sp      f     014       5
##  9 Afghanistan  1997 sp      f     1524     38
## 10 Afghanistan  1997 sp      f     2534     36
## # ... with 76,036 more rows
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Bem melhor, n√£o acham? Estamos agora com um banco de dados muito mais adequado para uma an√°lise de dados em R. Cada linha √© uma observa√ß√£o, cada coluna √© uma informa√ß√£o sobre ela.&lt;/p&gt;
&lt;p&gt;Alguns de voc√™s podem ter reparado que fizemos um caminho em que nosso banco de dados passou de ter muitas colunas para muitas linhas (ficou mais &amp;ldquo;longo&amp;rdquo;) e depois precisamos separar algumas das colunas que criamos em outras (o que fizemos com separate). Podemos facilmente imaginar situa√ß√µes em que queremos fazer o caminho inverso: transformar um banco do formato longo para o formato com mais colunas e unir colunas separadas em uma nova. Vamos ver um exemplo.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;# Exemplo adaptado de https://en.wikipedia.org/wiki/List_of_countries_and_dependencies_by_population
populacao &amp;lt;- tribble(
  ~Rank, ~Country, ~Population,	~&#39;% of world&#39;, ~Day, ~Month, ~Year, ~Source,
  1L,         &amp;quot;China&amp;quot;,    1411778724, &amp;quot;17.9%&amp;quot;,  &amp;quot;1&amp;quot;, &amp;quot;Nov&amp;quot;, &amp;quot;2020&amp;quot;,       &amp;quot;Seventh Census on 2020&amp;quot;,
  2L,         &amp;quot;India&amp;quot;,    1377123716, &amp;quot;17.5%&amp;quot;, &amp;quot;19&amp;quot;, &amp;quot;May&amp;quot;, &amp;quot;2021&amp;quot;, &amp;quot;National population clock[3]&amp;quot;,
  3L, &amp;quot;United States&amp;quot;,     331695937, &amp;quot;4.22%&amp;quot;, &amp;quot;19&amp;quot;, &amp;quot;May&amp;quot;, &amp;quot;2021&amp;quot;, &amp;quot;National population clock[4]&amp;quot;,
  4L,     &amp;quot;Indonesia&amp;quot;,     271350000, &amp;quot;3.45%&amp;quot;, &amp;quot;31&amp;quot;, &amp;quot;Dec&amp;quot;, &amp;quot;2020&amp;quot;,  &amp;quot;National annual estimate[5]&amp;quot;,
  5L,      &amp;quot;Pakistan&amp;quot;,     225200000, &amp;quot;2.86%&amp;quot;,  &amp;quot;1&amp;quot;, &amp;quot;Jul&amp;quot;, &amp;quot;2021&amp;quot;,             &amp;quot;UN projection[2]&amp;quot;,
  6L,        &amp;quot;Brazil&amp;quot;,     213154869, &amp;quot;2.71%&amp;quot;, &amp;quot;19&amp;quot;, &amp;quot;May&amp;quot;, &amp;quot;2021&amp;quot;, &amp;quot;National population clock[6]&amp;quot;,
  7L,       &amp;quot;Nigeria&amp;quot;,     211401000, &amp;quot;2.69%&amp;quot;,  &amp;quot;1&amp;quot;, &amp;quot;Jul&amp;quot;, &amp;quot;2021&amp;quot;,             &amp;quot;UN projection[2]&amp;quot;,
  8L,    &amp;quot;Bangladesh&amp;quot;,     170689832, &amp;quot;2.17%&amp;quot;, &amp;quot;19&amp;quot;, &amp;quot;May&amp;quot;, &amp;quot;2021&amp;quot;, &amp;quot;National population clock[7]&amp;quot;,
  9L,        &amp;quot;Russia&amp;quot;,     146171015, &amp;quot;1.86%&amp;quot;,  &amp;quot;1&amp;quot;, &amp;quot;Jan&amp;quot;, &amp;quot;2021&amp;quot;,  &amp;quot;National annual estimate[8]&amp;quot;,
  10L,       &amp;quot;Mexico&amp;quot;,     126014024, &amp;quot;1.60%&amp;quot;,  &amp;quot;2&amp;quot;, &amp;quot;Mar&amp;quot;, &amp;quot;2020&amp;quot;,        &amp;quot;2020 census result[9]&amp;quot;
)
populacao
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 10 x 8
##     Rank Country     Population `% of world` Day   Month Year  Source           
##    &amp;lt;int&amp;gt; &amp;lt;chr&amp;gt;            &amp;lt;dbl&amp;gt; &amp;lt;chr&amp;gt;        &amp;lt;chr&amp;gt; &amp;lt;chr&amp;gt; &amp;lt;chr&amp;gt; &amp;lt;chr&amp;gt;            
##  1     1 China       1411778724 17.9%        1     Nov   2020  Seventh Census o~
##  2     2 India       1377123716 17.5%        19    May   2021  National populat~
##  3     3 United Sta~  331695937 4.22%        19    May   2021  National populat~
##  4     4 Indonesia    271350000 3.45%        31    Dec   2020  National annual ~
##  5     5 Pakistan     225200000 2.86%        1     Jul   2021  UN projection[2] 
##  6     6 Brazil       213154869 2.71%        19    May   2021  National populat~
##  7     7 Nigeria      211401000 2.69%        1     Jul   2021  UN projection[2] 
##  8     8 Bangladesh   170689832 2.17%        19    May   2021  National populat~
##  9     9 Russia       146171015 1.86%        1     Jan   2021  National annual ~
## 10    10 Mexico       126014024 1.60%        2     Mar   2020  2020 census resu~
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Imagine que, por qualquer motivo, voc√™ prefira trabalhar com uma vari√°vel &amp;ldquo;Data&amp;rdquo; ao inv√©s de dia, m√™s e ano. Podemos usar &lt;code&gt;unite&lt;/code&gt;:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;populacao2 &amp;lt;- populacao %&amp;gt;% unite(col = Data, Day, Month, Year, sep = &amp;quot; &amp;quot;)
populacao2
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 10 x 6
##     Rank Country      Population `% of world` Data       Source                 
##    &amp;lt;int&amp;gt; &amp;lt;chr&amp;gt;             &amp;lt;dbl&amp;gt; &amp;lt;chr&amp;gt;        &amp;lt;chr&amp;gt;      &amp;lt;chr&amp;gt;                  
##  1     1 China        1411778724 17.9%        1 Nov 2020 Seventh Census on 2020 
##  2     2 India        1377123716 17.5%        19 May 20~ National population cl~
##  3     3 United Stat~  331695937 4.22%        19 May 20~ National population cl~
##  4     4 Indonesia     271350000 3.45%        31 Dec 20~ National annual estima~
##  5     5 Pakistan      225200000 2.86%        1 Jul 2021 UN projection[2]       
##  6     6 Brazil        213154869 2.71%        19 May 20~ National population cl~
##  7     7 Nigeria       211401000 2.69%        1 Jul 2021 UN projection[2]       
##  8     8 Bangladesh    170689832 2.17%        19 May 20~ National population cl~
##  9     9 Russia        146171015 1.86%        1 Jan 2021 National annual estima~
## 10    10 Mexico        126014024 1.60%        2 Mar 2020 2020 census result[9]
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;O outro problema que precisamos resolver frequentemente, √© separar um par de vari√°veis em diversas colunas, fazendo o caminho inverso que fizemos no caso do dataset da OMS.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;us_rent_income
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 104 x 5
##    GEOID NAME       variable estimate   moe
##    &amp;lt;chr&amp;gt; &amp;lt;chr&amp;gt;      &amp;lt;chr&amp;gt;       &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt;
##  1 01    Alabama    income      24476   136
##  2 01    Alabama    rent          747     3
##  3 02    Alaska     income      32940   508
##  4 02    Alaska     rent         1200    13
##  5 04    Arizona    income      27517   148
##  6 04    Arizona    rent          972     4
##  7 05    Arkansas   income      23789   165
##  8 05    Arkansas   rent          709     5
##  9 06    California income      29454   109
## 10 06    California rent         1358     3
## # ... with 94 more rows
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;No exemplo acima, queremos separar em colunas os valores das vari√°veis de renda e valor do aluguel. Esse tipo de opera√ß√£o tem um certo grau de abstra√ß√£o que me deu bastante dor de cabe√ßa para entender inicialmente, ent√£o vamos olhar com carinho para o que queremos ter depois da transforma√ß√£o.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;us_rent_income2 &amp;lt;- tribble(
  ~GEOID, ~NAME, ~income_estimate, ~rent_estimate, ~income_moe, ~rent_moe,
  &amp;quot;01&amp;quot;, &amp;quot;Alabama&amp;quot;, 24476,  747, 136, 3,
  &amp;quot;02&amp;quot;, &amp;quot;Alaska&amp;quot;, 32940, 1200, 508, 13
)
us_rent_income2
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 2 x 6
##   GEOID NAME    income_estimate rent_estimate income_moe rent_moe
##   &amp;lt;chr&amp;gt; &amp;lt;chr&amp;gt;             &amp;lt;dbl&amp;gt;         &amp;lt;dbl&amp;gt;      &amp;lt;dbl&amp;gt;    &amp;lt;dbl&amp;gt;
## 1 01    Alabama           24476           747        136        3
## 2 02    Alaska            32940          1200        508       13
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;O banco que queremos tem uma cara assim. Ele tem mais colunas novas e menos linhas, j√° que eu tinha no formato tidy uma vari√°vel chamada &amp;ldquo;variable&amp;rdquo; que guardava os valores renda e aluguel e duas colunas que guardavam os valores da estimativa e do moe. Agora, eu vou ter 4 colunas, duas para as estimativas de renda e aluguel e duas para os moes das mesmas vari√°veis. Como especificar isso para o banco todo? Usando &lt;code&gt;pivot_wider&lt;/code&gt;.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;us_rent_income %&amp;gt;% pivot_wider(names_from = variable, values_from = c(estimate, moe))
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 52 x 6
##    GEOID NAME                 estimate_income estimate_rent moe_income moe_rent
##    &amp;lt;chr&amp;gt; &amp;lt;chr&amp;gt;                          &amp;lt;dbl&amp;gt;         &amp;lt;dbl&amp;gt;      &amp;lt;dbl&amp;gt;    &amp;lt;dbl&amp;gt;
##  1 01    Alabama                        24476           747        136        3
##  2 02    Alaska                         32940          1200        508       13
##  3 04    Arizona                        27517           972        148        4
##  4 05    Arkansas                       23789           709        165        5
##  5 06    California                     29454          1358        109        3
##  6 08    Colorado                       32401          1125        109        5
##  7 09    Connecticut                    35326          1123        195        5
##  8 10    Delaware                       31560          1076        247       10
##  9 11    District of Columbia           43198          1424        681       17
## 10 12    Florida                        25952          1077         70        3
## # ... with 42 more rows
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;As fun√ß√µes &lt;code&gt;pivot_&lt;/code&gt; tem diversos outros argumentos e cobrem diversos casos de uso. Vejam este exemplo da documenta√ß√£o de &lt;code&gt;pivot_longer&lt;/code&gt;:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;anscombe
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##    x1 x2 x3 x4    y1   y2    y3    y4
## 1  10 10 10  8  8.04 9.14  7.46  6.58
## 2   8  8  8  8  6.95 8.14  6.77  5.76
## 3  13 13 13  8  7.58 8.74 12.74  7.71
## 4   9  9  9  8  8.81 8.77  7.11  8.84
## 5  11 11 11  8  8.33 9.26  7.81  8.47
## 6  14 14 14  8  9.96 8.10  8.84  7.04
## 7   6  6  6  8  7.24 6.13  6.08  5.25
## 8   4  4  4 19  4.26 3.10  5.39 12.50
## 9  12 12 12  8 10.84 9.13  8.15  5.56
## 10  7  7  7  8  4.82 7.26  6.42  7.91
## 11  5  5  5  8  5.68 4.74  5.73  6.89
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Podemos transformar esse banco de dados rapidamente usando um dos argumentos de &lt;code&gt;pivot_longer&lt;/code&gt;, chamado &lt;code&gt;names_pattern&lt;/code&gt;.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;anscombe %&amp;gt;% pivot_longer(everything(),
                          names_to = c(&amp;quot;.value&amp;quot;, &amp;quot;set&amp;quot;),
                          names_pattern = &amp;quot;(.)(.)&amp;quot;)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 44 x 3
##    set       x     y
##    &amp;lt;chr&amp;gt; &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt;
##  1 1        10  8.04
##  2 2        10  9.14
##  3 3        10  7.46
##  4 4         8  6.58
##  5 1         8  6.95
##  6 2         8  8.14
##  7 3         8  6.77
##  8 4         8  5.76
##  9 1        13  7.58
## 10 2        13  8.74
## # ... with 34 more rows
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Esse exemplo √© interessante, porque ele se aproveita de uma &amp;ldquo;regular expression&amp;rdquo;, tema da parte do nosso curso em que falaremos sobre manipula√ß√£o de strings com o &lt;code&gt;stringr&lt;/code&gt;. Resumidas as contas, as colunas se chamam &amp;ldquo;x1, x2, x3 &amp;hellip;&amp;rdquo; e a string &amp;ldquo;(.)(.)&amp;rdquo; indica que h√° dois &amp;ldquo;grupos&amp;rdquo; formados por um caractere cada. A string &amp;ldquo;.value&amp;rdquo; que vai no argumento de cima √© um atalho da fun√ß√£o para dizer &amp;ldquo;pegue o valor de todas as c√©lulas das vari√°veis selecionadas&amp;rdquo;, aqui, todas. Ou seja, ele indica para a fun√ß√£o que o primeiro caractere &amp;ldquo;x&amp;rdquo; ou &amp;ldquo;y&amp;rdquo; definir√° uma nova vari√°vel e armazenar√° os valores das celulas, enquanto o segundo grupo &amp;ldquo;1&amp;rdquo;, &amp;ldquo;2&amp;rdquo;, &amp;ldquo;3&amp;rdquo; ou &amp;ldquo;4&amp;rdquo; formar√° uma segunda vari√°vel chamada &amp;ldquo;set&amp;rdquo; que cont√©m apenas os nomes das colunas. Deu um n√≥ na cabe√ßa?&lt;/p&gt;
&lt;p&gt;Uma √∫ltima preocupa√ß√£o ao utilizar a reformata√ß√£o de dados √© o que ocorre com os valores &lt;code&gt;NA&lt;/code&gt;. Vejamos este exemplo:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;acoes &amp;lt;- tibble(
  ano   = c(2015, 2015, 2015, 2015, 2016, 2016, 2016),
  qdr   = c(   1,    2,    3,    4,    2,    3,    4),
  lucro = c(1.88, 0.59, 0.35,   NA, 0.92, 0.17, 2.66)
)
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Existem dois tipos de valor nulo, &lt;strong&gt;expl√≠cito&lt;/strong&gt; se diz de um valor nulo como aquele NA que aparece na vari√°vel lucro. &lt;strong&gt;Impl√≠cito&lt;/strong&gt; √© o valor que ocorre no primeiro quadrimestre de 2016, onde sequer foi adicionada uma linha no banco de dados. Os valores impl√≠citos s√£o muito sacanas, porque eles n√£o s√£o imediatamente vis√≠veis.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;acoes %&amp;gt;% 
  pivot_wider(names_from = ano, values_from = lucro)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 4 x 3
##     qdr `2015` `2016`
##   &amp;lt;dbl&amp;gt;  &amp;lt;dbl&amp;gt;  &amp;lt;dbl&amp;gt;
## 1     1   1.88  NA   
## 2     2   0.59   0.92
## 3     3   0.35   0.17
## 4     4  NA      2.66
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Ao transformar o banco, o valor impl√≠cito ficou expl√≠cito. Caso voc√™ n√£o esteja interessado neste valor, voc√™ pode passar o &lt;code&gt;values_drop_na&lt;/code&gt; durante a transforma√ß√£o de volta ao formato original.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;acoes %&amp;gt;% 
  pivot_wider(names_from = ano, values_from = lucro) %&amp;gt;% 
  pivot_longer(c(`2015`, `2016`),
               names_to = &amp;quot;ano&amp;quot;,
               values_to = &amp;quot;lucro&amp;quot;,
               values_drop_na = TRUE)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 6 x 3
##     qdr ano   lucro
##   &amp;lt;dbl&amp;gt; &amp;lt;chr&amp;gt; &amp;lt;dbl&amp;gt;
## 1     1 2015   1.88
## 2     2 2015   0.59
## 3     2 2016   0.92
## 4     3 2015   0.35
## 5     3 2016   0.17
## 6     4 2016   2.66
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Que faz os valores missing desaparecerem do resultado.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;complete&lt;/code&gt; pode ser usada pra tornar valores impl√≠citos, expl√≠citos! A fun√ß√£o toma todas as colunas pedidas e verifica todas as combina√ß√µes poss√≠veis de valores, preenchendo as lacunas com &lt;code&gt;NA&lt;/code&gt;. Cuidado ao utilizar complete com valores num√©ricos ou conjuntos de colunas com muitas combina√ß√µes poss√≠veis, pois o n√∫mero de combina√ß√µes pode ser infinitamente grande e travar sua sess√£o!&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;acoes %&amp;gt;% complete(ano, qdr)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 8 x 3
##     ano   qdr lucro
##   &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt;
## 1  2015     1  1.88
## 2  2015     2  0.59
## 3  2015     3  0.35
## 4  2015     4 NA   
## 5  2016     1 NA   
## 6  2016     2  0.92
## 7  2016     3  0.17
## 8  2016     4  2.66
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Pra encerrar, &lt;code&gt;fill&lt;/code&gt; serve para aqueles casos em que um valor missing indica que a √∫ltima observa√ß√£o deve ser repetida. Pesquisadores brasileiros das antigas podem lembrar-se do Censo de 1991, em que o IBGE registrava os arquivos de dom√≠cilio e pessoas com esse sistema. Em ingl√™s, isso se chama LOCF, ou &amp;ldquo;last observation carried forward&amp;rdquo;.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;treatment &amp;lt;- tribble(
  ~ person,           ~ treatment, ~response,
  &amp;quot;Derrick Whitmore&amp;quot;, 1,           7,
  NA,                 2,           10,
  NA,                 3,           9,
  &amp;quot;Katherine Burke&amp;quot;,  1,           4
)
treatment
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 4 x 3
##   person           treatment response
##   &amp;lt;chr&amp;gt;                &amp;lt;dbl&amp;gt;    &amp;lt;dbl&amp;gt;
## 1 Derrick Whitmore         1        7
## 2 &amp;lt;NA&amp;gt;                     2       10
## 3 &amp;lt;NA&amp;gt;                     3        9
## 4 Katherine Burke          1        4
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;treatment %&amp;gt;% fill(person)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 4 x 3
##   person           treatment response
##   &amp;lt;chr&amp;gt;                &amp;lt;dbl&amp;gt;    &amp;lt;dbl&amp;gt;
## 1 Derrick Whitmore         1        7
## 2 Derrick Whitmore         2       10
## 3 Derrick Whitmore         3        9
## 4 Katherine Burke          1        4
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;code&gt;tidyr&lt;/code&gt; tem tamb√©m outras funcionalidades relevantes para modelagem estat√≠stica, mas acho que isso sai um pouco do escopo do curso. Quem sabe a gente n√£o faz um curso posterior s√≥ sobre modelagem no tidyverse?&lt;/p&gt;
&lt;h2 id=&#34;revis√£o&#34;&gt;Revis√£o&lt;/h2&gt;
&lt;h3 id=&#34;readr-1&#34;&gt;&lt;code&gt;readr&lt;/code&gt;&lt;/h3&gt;
&lt;p&gt;O pacote &lt;code&gt;readr&lt;/code&gt; apresenta uma fam√≠lia de fun√ß√µes para substituir as fun√ß√µes do &lt;code&gt;base&lt;/code&gt; relacionadas a importa√ß√£o de arquivos em formato texto, seja delimitado ou largura-fixa. S√£o elas,&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;read_delim&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;read_csv&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;read_csv2&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;read_tsv&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;read_table&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;read_fwf&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;E assim sucessivamente. Durante o processo de importa√ß√£o, voc√™ pode querer especificar o tipo de coluna com &lt;code&gt;cols&lt;/code&gt; ou &lt;code&gt;cols_only&lt;/code&gt;, usando o argumento &lt;code&gt;col_types&lt;/code&gt;. Ou use uma string do tipo &amp;ldquo;ddcdiDT&amp;rdquo; em que cada letra √© um tipo de vari√°vel.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;col_integer&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;col_double&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;col_factor&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;col_character&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Etc. Voc√™ tamb√©m pode querer definir caracter√≠sticas de localiza√ß√£o, como a codifica√ß√£o de caracteres, os separadores de decimal e de milhar e etc. A melhor forma de fazer isso √© definir um &lt;code&gt;locale&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Ah, e voc√™ sempre pode salvar com &lt;code&gt;write_&lt;/code&gt;, inclusive salvando/lendo compactado para &lt;code&gt;bzip&lt;/code&gt;, &lt;code&gt;gzip&lt;/code&gt; ou &lt;code&gt;xzip&lt;/code&gt;.&lt;/p&gt;
&lt;h3 id=&#34;tibble&#34;&gt;&lt;code&gt;tibble&lt;/code&gt;&lt;/h3&gt;
&lt;p&gt;Tibbles s√£o uma vers√£o do data.frame com algumas regrinhas novas. Vou apenas repet√≠-las aqui de forma resumida.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;tibbles tem um m√©todo print mais bonito e amig√°vel, especialmente para bancos com muitas observa√ß√µes e vari√°veis.&lt;/li&gt;
&lt;li&gt;elas s√£o estritas com opera√ß√µes de subsetting com &lt;code&gt;[&lt;/code&gt; e &lt;code&gt;$&lt;/code&gt;.&lt;/li&gt;
&lt;li&gt;elas n√£o aceita a reciclagem de argumento de tamanho diferente de 1.&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;tidyr-1&#34;&gt;&lt;code&gt;tidyr&lt;/code&gt;&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;tidyr&lt;/code&gt; √© um pacote de reformata√ß√£o de bancos, criando novas linhas e colunas a partir da reorganiza√ß√£o das vari√°veis e valores existentes. Suas principais opera√ß√µes s√£o:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;pivot_longer&lt;/code&gt; para converter colunas em linhas&lt;/li&gt;
&lt;li&gt;&lt;code&gt;pivot_wider&lt;/code&gt; para converter linhas em colunas&lt;/li&gt;
&lt;li&gt;&lt;code&gt;separate&lt;/code&gt; para separar uma coluna em v√°rias com base em caracteres&lt;/li&gt;
&lt;li&gt;&lt;code&gt;unite&lt;/code&gt; para unir diversas colunas em uma com base em caracteres&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Ufa. Acabou n√©? Posso ir dormir j√°? Claro, s√≥ fazer uns exerc√≠cios!&lt;/p&gt;
&lt;h2 id=&#34;exerc√≠cios&#34;&gt;Exerc√≠cios&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;Como voc√™ importaria o banco &amp;ldquo;epa78.csv&amp;rdquo;&lt;/li&gt;
&lt;/ol&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;file &amp;lt;- readr_example(&amp;quot;epa78.txt&amp;quot;)
&lt;/code&gt;&lt;/pre&gt;
&lt;ol start=&#34;2&#34;&gt;
&lt;li&gt;Importe o banco &amp;ldquo;challenge.csv&amp;rdquo; e resolva os problemas com o tipo da coluna.&lt;/li&gt;
&lt;/ol&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;file &amp;lt;- readr_example(&amp;quot;challenge.csv&amp;quot;)
&lt;/code&gt;&lt;/pre&gt;
&lt;ol start=&#34;3&#34;&gt;
&lt;li&gt;Com o banco sala_aula dado a seguir, transforme-o para que ele contenha as vari√°veis nome, avalia√ß√£o e nota.&lt;/li&gt;
&lt;/ol&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;sala_aula &amp;lt;- tribble(
 ~name,    ~teste1,  ~teste2,  ~prova1,
 &amp;quot;Billy&amp;quot;,  &amp;quot;&amp;lt;NA&amp;gt;&amp;quot;,   &amp;quot;D&amp;quot;   ,   &amp;quot;C&amp;quot;,
 &amp;quot;Suzy&amp;quot;,   &amp;quot;F&amp;quot;,      &amp;quot;&amp;lt;NA&amp;gt;&amp;quot;,   &amp;quot;&amp;lt;NA&amp;gt;&amp;quot;,
 &amp;quot;Lionel&amp;quot;, &amp;quot;B&amp;quot;,      &amp;quot;C&amp;quot;   ,   &amp;quot;B&amp;quot;,
 &amp;quot;Jenny&amp;quot;,  &amp;quot;A&amp;quot;,      &amp;quot;A&amp;quot;   ,   &amp;quot;B&amp;quot;
)
&lt;/code&gt;&lt;/pre&gt;
&lt;ol start=&#34;4&#34;&gt;
&lt;li&gt;Transforme o banco &lt;code&gt;relig_income&lt;/code&gt; para que ele contenha as colunas religi√£o, renda e frequ√™ncia.&lt;/li&gt;
&lt;/ol&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;relig_income
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 18 x 11
##    religion `&amp;lt;$10k` `$10-20k` `$20-30k` `$30-40k` `$40-50k` `$50-75k` `$75-100k`
##    &amp;lt;chr&amp;gt;      &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;      &amp;lt;dbl&amp;gt;
##  1 Agnostic      27        34        60        81        76       137        122
##  2 Atheist       12        27        37        52        35        70         73
##  3 Buddhist      27        21        30        34        33        58         62
##  4 Catholic     418       617       732       670       638      1116        949
##  5 Don‚Äôt k~      15        14        15        11        10        35         21
##  6 Evangel~     575       869      1064       982       881      1486        949
##  7 Hindu          1         9         7         9        11        34         47
##  8 Histori~     228       244       236       238       197       223        131
##  9 Jehovah~      20        27        24        24        21        30         15
## 10 Jewish        19        19        25        25        30        95         69
## 11 Mainlin~     289       495       619       655       651      1107        939
## 12 Mormon        29        40        48        51        56       112         85
## 13 Muslim         6         7         9        10         9        23         16
## 14 Orthodox      13        17        23        32        32        47         38
## 15 Other C~       9         7        11        13        13        14         18
## 16 Other F~      20        33        40        46        49        63         46
## 17 Other W~       5         2         3         4         2         7          3
## 18 Unaffil~     217       299       374       365       341       528        407
## # ... with 3 more variables: $100-150k &amp;lt;dbl&amp;gt;, &amp;gt;150k &amp;lt;dbl&amp;gt;,
## #   Don&#39;t know/refused &amp;lt;dbl&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;ol start=&#34;5&#34;&gt;
&lt;li&gt;Transforme o banco &lt;code&gt;billboard&lt;/code&gt; para que ele contenha apenas uma coluna &amp;ldquo;semana&amp;rdquo; e uma coluna com a posi√ß√£o da m√∫sica no ranking.&lt;/li&gt;
&lt;/ol&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;# Dica, voc√™ pode selecionar v√°rias colunas usando o atalho wk1:wk76
billboard 
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 317 x 79
##    artist   track   date.entered   wk1   wk2   wk3   wk4   wk5   wk6   wk7   wk8
##    &amp;lt;chr&amp;gt;    &amp;lt;chr&amp;gt;   &amp;lt;date&amp;gt;       &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt;
##  1 2 Pac    Baby D~ 2000-02-26      87    82    72    77    87    94    99    NA
##  2 2Ge+her  The Ha~ 2000-09-02      91    87    92    NA    NA    NA    NA    NA
##  3 3 Doors~ Krypto~ 2000-04-08      81    70    68    67    66    57    54    53
##  4 3 Doors~ Loser   2000-10-21      76    76    72    69    67    65    55    59
##  5 504 Boyz Wobble~ 2000-04-15      57    34    25    17    17    31    36    49
##  6 98^0     Give M~ 2000-08-19      51    39    34    26    26    19     2     2
##  7 A*Teens  Dancin~ 2000-07-08      97    97    96    95   100    NA    NA    NA
##  8 Aaliyah  I Don&#39;~ 2000-01-29      84    62    51    41    38    35    35    38
##  9 Aaliyah  Try Ag~ 2000-03-18      59    53    38    28    21    18    16    14
## 10 Adams, ~ Open M~ 2000-08-26      76    76    74    69    68    67    61    58
## # ... with 307 more rows, and 68 more variables: wk9 &amp;lt;dbl&amp;gt;, wk10 &amp;lt;dbl&amp;gt;,
## #   wk11 &amp;lt;dbl&amp;gt;, wk12 &amp;lt;dbl&amp;gt;, wk13 &amp;lt;dbl&amp;gt;, wk14 &amp;lt;dbl&amp;gt;, wk15 &amp;lt;dbl&amp;gt;, wk16 &amp;lt;dbl&amp;gt;,
## #   wk17 &amp;lt;dbl&amp;gt;, wk18 &amp;lt;dbl&amp;gt;, wk19 &amp;lt;dbl&amp;gt;, wk20 &amp;lt;dbl&amp;gt;, wk21 &amp;lt;dbl&amp;gt;, wk22 &amp;lt;dbl&amp;gt;,
## #   wk23 &amp;lt;dbl&amp;gt;, wk24 &amp;lt;dbl&amp;gt;, wk25 &amp;lt;dbl&amp;gt;, wk26 &amp;lt;dbl&amp;gt;, wk27 &amp;lt;dbl&amp;gt;, wk28 &amp;lt;dbl&amp;gt;,
## #   wk29 &amp;lt;dbl&amp;gt;, wk30 &amp;lt;dbl&amp;gt;, wk31 &amp;lt;dbl&amp;gt;, wk32 &amp;lt;dbl&amp;gt;, wk33 &amp;lt;dbl&amp;gt;, wk34 &amp;lt;dbl&amp;gt;,
## #   wk35 &amp;lt;dbl&amp;gt;, wk36 &amp;lt;dbl&amp;gt;, wk37 &amp;lt;dbl&amp;gt;, wk38 &amp;lt;dbl&amp;gt;, wk39 &amp;lt;dbl&amp;gt;, wk40 &amp;lt;dbl&amp;gt;,
## #   wk41 &amp;lt;dbl&amp;gt;, wk42 &amp;lt;dbl&amp;gt;, wk43 &amp;lt;dbl&amp;gt;, wk44 &amp;lt;dbl&amp;gt;, wk45 &amp;lt;dbl&amp;gt;, wk46 &amp;lt;dbl&amp;gt;,
## #   wk47 &amp;lt;dbl&amp;gt;, wk48 &amp;lt;dbl&amp;gt;, wk49 &amp;lt;dbl&amp;gt;, wk50 &amp;lt;dbl&amp;gt;, wk51 &amp;lt;dbl&amp;gt;, wk52 &amp;lt;dbl&amp;gt;,
## #   wk53 &amp;lt;dbl&amp;gt;, wk54 &amp;lt;dbl&amp;gt;, wk55 &amp;lt;dbl&amp;gt;, wk56 &amp;lt;dbl&amp;gt;, wk57 &amp;lt;dbl&amp;gt;, wk58 &amp;lt;dbl&amp;gt;,
## #   wk59 &amp;lt;dbl&amp;gt;, wk60 &amp;lt;dbl&amp;gt;, wk61 &amp;lt;dbl&amp;gt;, wk62 &amp;lt;dbl&amp;gt;, wk63 &amp;lt;dbl&amp;gt;, wk64 &amp;lt;dbl&amp;gt;,
## #   wk65 &amp;lt;dbl&amp;gt;, wk66 &amp;lt;lgl&amp;gt;, wk67 &amp;lt;lgl&amp;gt;, wk68 &amp;lt;lgl&amp;gt;, wk69 &amp;lt;lgl&amp;gt;, wk70 &amp;lt;lgl&amp;gt;,
## #   wk71 &amp;lt;lgl&amp;gt;, wk72 &amp;lt;lgl&amp;gt;, wk73 &amp;lt;lgl&amp;gt;, wk74 &amp;lt;lgl&amp;gt;, wk75 &amp;lt;lgl&amp;gt;, wk76 &amp;lt;lgl&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;ol start=&#34;6&#34;&gt;
&lt;li&gt;
&lt;p&gt;Experimente fazer o caminho inverso dos exerc√≠cios 3 a 5, devolvendo os datasets ao seu formato original. O que voc√™ observou?&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;O que os argumentos &lt;code&gt;extra&lt;/code&gt; e &lt;code&gt;fill&lt;/code&gt; em separate fazem? Utilize o exemplo a seguir como guia.&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;tibble(x = c(&amp;quot;a,b,c&amp;quot;, &amp;quot;d,e,f,g&amp;quot;, &amp;quot;h,i,j&amp;quot;)) %&amp;gt;% 
  separate(x, c(&amp;quot;um&amp;quot;, &amp;quot;dois&amp;quot;, &amp;quot;tres&amp;quot;))
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## Warning: Expected 3 pieces. Additional pieces discarded in 1 rows [2].
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 3 x 3
##   um    dois  tres 
##   &amp;lt;chr&amp;gt; &amp;lt;chr&amp;gt; &amp;lt;chr&amp;gt;
## 1 a     b     c    
## 2 d     e     f    
## 3 h     i     j
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;tibble(x = c(&amp;quot;a,b,c&amp;quot;, &amp;quot;d,e&amp;quot;, &amp;quot;f,g,i&amp;quot;)) %&amp;gt;% 
  separate(x, c(&amp;quot;um&amp;quot;, &amp;quot;dois&amp;quot;, &amp;quot;tres&amp;quot;))
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## Warning: Expected 3 pieces. Missing pieces filled with `NA` in 1 rows [2].
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 3 x 3
##   um    dois  tres 
##   &amp;lt;chr&amp;gt; &amp;lt;chr&amp;gt; &amp;lt;chr&amp;gt;
## 1 a     b     c    
## 2 d     e     &amp;lt;NA&amp;gt; 
## 3 f     g     i
&lt;/code&gt;&lt;/pre&gt;
&lt;ol start=&#34;8&#34;&gt;
&lt;li&gt;
&lt;p&gt;Tanto &lt;code&gt;unite&lt;/code&gt; como &lt;code&gt;separate&lt;/code&gt; possuem um argumento &lt;code&gt;remove&lt;/code&gt;. Pra que ele serve e quando voc√™ o utilizaria no valor &lt;code&gt;FALSE&lt;/code&gt;?&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Compare o argumento &lt;code&gt;values_fill&lt;/code&gt; em &lt;code&gt;pivot_wider&lt;/code&gt; e &lt;code&gt;fill&lt;/code&gt; em &lt;code&gt;complete&lt;/code&gt;. Qual √© a diferen√ßa?&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;agradecimentos&#34;&gt;Agradecimentos&lt;/h2&gt;
&lt;p&gt;Esse material √© uma adapta√ß√£o livre das vinhetas dos pacotes &lt;code&gt;tidyr&lt;/code&gt;, &lt;code&gt;readr&lt;/code&gt; e &lt;code&gt;tibble&lt;/code&gt; e do cap√≠tulo Tidy Data do &lt;a href=&#34;https://r4ds.had.co.nz/tidy-data.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;R for Data Science&lt;/a&gt;, de Wickham &amp;amp; Grolemund.&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>stringr, forcats e dplyr</title>
      <link>https://laddem.github.io/courses/tidyverse/dia2/</link>
      <pubDate>Sun, 23 May 2021 00:00:00 +0000</pubDate>
      <guid>https://laddem.github.io/courses/tidyverse/dia2/</guid>
      <description>&lt;script src=&#34;https://laddem.github.io/rmarkdown-libs/htmlwidgets/htmlwidgets.js&#34;&gt;&lt;/script&gt;
&lt;link href=&#34;https://laddem.github.io/rmarkdown-libs/str_view/str_view.css&#34; rel=&#34;stylesheet&#34; /&gt;
&lt;script src=&#34;https://laddem.github.io/rmarkdown-libs/str_view-binding/str_view.js&#34;&gt;&lt;/script&gt;
&lt;script src=&#34;https://laddem.github.io/rmarkdown-libs/htmlwidgets/htmlwidgets.js&#34;&gt;&lt;/script&gt;
&lt;link href=&#34;https://laddem.github.io/rmarkdown-libs/str_view/str_view.css&#34; rel=&#34;stylesheet&#34; /&gt;
&lt;script src=&#34;https://laddem.github.io/rmarkdown-libs/str_view-binding/str_view.js&#34;&gt;&lt;/script&gt;
&lt;script src=&#34;https://laddem.github.io/rmarkdown-libs/htmlwidgets/htmlwidgets.js&#34;&gt;&lt;/script&gt;
&lt;link href=&#34;https://laddem.github.io/rmarkdown-libs/str_view/str_view.css&#34; rel=&#34;stylesheet&#34; /&gt;
&lt;script src=&#34;https://laddem.github.io/rmarkdown-libs/str_view-binding/str_view.js&#34;&gt;&lt;/script&gt;
&lt;script src=&#34;https://laddem.github.io/rmarkdown-libs/htmlwidgets/htmlwidgets.js&#34;&gt;&lt;/script&gt;
&lt;link href=&#34;https://laddem.github.io/rmarkdown-libs/str_view/str_view.css&#34; rel=&#34;stylesheet&#34; /&gt;
&lt;script src=&#34;https://laddem.github.io/rmarkdown-libs/str_view-binding/str_view.js&#34;&gt;&lt;/script&gt;
&lt;script src=&#34;https://laddem.github.io/rmarkdown-libs/htmlwidgets/htmlwidgets.js&#34;&gt;&lt;/script&gt;
&lt;link href=&#34;https://laddem.github.io/rmarkdown-libs/str_view/str_view.css&#34; rel=&#34;stylesheet&#34; /&gt;
&lt;script src=&#34;https://laddem.github.io/rmarkdown-libs/str_view-binding/str_view.js&#34;&gt;&lt;/script&gt;
&lt;script src=&#34;https://laddem.github.io/rmarkdown-libs/htmlwidgets/htmlwidgets.js&#34;&gt;&lt;/script&gt;
&lt;link href=&#34;https://laddem.github.io/rmarkdown-libs/str_view/str_view.css&#34; rel=&#34;stylesheet&#34; /&gt;
&lt;script src=&#34;https://laddem.github.io/rmarkdown-libs/str_view-binding/str_view.js&#34;&gt;&lt;/script&gt;
&lt;script src=&#34;https://laddem.github.io/rmarkdown-libs/htmlwidgets/htmlwidgets.js&#34;&gt;&lt;/script&gt;
&lt;link href=&#34;https://laddem.github.io/rmarkdown-libs/str_view/str_view.css&#34; rel=&#34;stylesheet&#34; /&gt;
&lt;script src=&#34;https://laddem.github.io/rmarkdown-libs/str_view-binding/str_view.js&#34;&gt;&lt;/script&gt;
&lt;script src=&#34;https://laddem.github.io/rmarkdown-libs/htmlwidgets/htmlwidgets.js&#34;&gt;&lt;/script&gt;
&lt;link href=&#34;https://laddem.github.io/rmarkdown-libs/str_view/str_view.css&#34; rel=&#34;stylesheet&#34; /&gt;
&lt;script src=&#34;https://laddem.github.io/rmarkdown-libs/str_view-binding/str_view.js&#34;&gt;&lt;/script&gt;
&lt;script src=&#34;https://laddem.github.io/rmarkdown-libs/htmlwidgets/htmlwidgets.js&#34;&gt;&lt;/script&gt;
&lt;link href=&#34;https://laddem.github.io/rmarkdown-libs/str_view/str_view.css&#34; rel=&#34;stylesheet&#34; /&gt;
&lt;script src=&#34;https://laddem.github.io/rmarkdown-libs/str_view-binding/str_view.js&#34;&gt;&lt;/script&gt;
&lt;script src=&#34;https://laddem.github.io/rmarkdown-libs/htmlwidgets/htmlwidgets.js&#34;&gt;&lt;/script&gt;
&lt;link href=&#34;https://laddem.github.io/rmarkdown-libs/str_view/str_view.css&#34; rel=&#34;stylesheet&#34; /&gt;
&lt;script src=&#34;https://laddem.github.io/rmarkdown-libs/str_view-binding/str_view.js&#34;&gt;&lt;/script&gt;
&lt;script src=&#34;https://laddem.github.io/rmarkdown-libs/htmlwidgets/htmlwidgets.js&#34;&gt;&lt;/script&gt;
&lt;link href=&#34;https://laddem.github.io/rmarkdown-libs/str_view/str_view.css&#34; rel=&#34;stylesheet&#34; /&gt;
&lt;script src=&#34;https://laddem.github.io/rmarkdown-libs/str_view-binding/str_view.js&#34;&gt;&lt;/script&gt;
&lt;script src=&#34;https://laddem.github.io/rmarkdown-libs/htmlwidgets/htmlwidgets.js&#34;&gt;&lt;/script&gt;
&lt;link href=&#34;https://laddem.github.io/rmarkdown-libs/str_view/str_view.css&#34; rel=&#34;stylesheet&#34; /&gt;
&lt;script src=&#34;https://laddem.github.io/rmarkdown-libs/str_view-binding/str_view.js&#34;&gt;&lt;/script&gt;
&lt;script src=&#34;https://laddem.github.io/rmarkdown-libs/htmlwidgets/htmlwidgets.js&#34;&gt;&lt;/script&gt;
&lt;link href=&#34;https://laddem.github.io/rmarkdown-libs/str_view/str_view.css&#34; rel=&#34;stylesheet&#34; /&gt;
&lt;script src=&#34;https://laddem.github.io/rmarkdown-libs/str_view-binding/str_view.js&#34;&gt;&lt;/script&gt;
&lt;script src=&#34;https://laddem.github.io/rmarkdown-libs/htmlwidgets/htmlwidgets.js&#34;&gt;&lt;/script&gt;
&lt;link href=&#34;https://laddem.github.io/rmarkdown-libs/str_view/str_view.css&#34; rel=&#34;stylesheet&#34; /&gt;
&lt;script src=&#34;https://laddem.github.io/rmarkdown-libs/str_view-binding/str_view.js&#34;&gt;&lt;/script&gt;
&lt;script src=&#34;https://laddem.github.io/rmarkdown-libs/htmlwidgets/htmlwidgets.js&#34;&gt;&lt;/script&gt;
&lt;link href=&#34;https://laddem.github.io/rmarkdown-libs/str_view/str_view.css&#34; rel=&#34;stylesheet&#34; /&gt;
&lt;script src=&#34;https://laddem.github.io/rmarkdown-libs/str_view-binding/str_view.js&#34;&gt;&lt;/script&gt;
&lt;script src=&#34;https://laddem.github.io/rmarkdown-libs/htmlwidgets/htmlwidgets.js&#34;&gt;&lt;/script&gt;
&lt;link href=&#34;https://laddem.github.io/rmarkdown-libs/str_view/str_view.css&#34; rel=&#34;stylesheet&#34; /&gt;
&lt;script src=&#34;https://laddem.github.io/rmarkdown-libs/str_view-binding/str_view.js&#34;&gt;&lt;/script&gt;
&lt;script src=&#34;https://laddem.github.io/rmarkdown-libs/htmlwidgets/htmlwidgets.js&#34;&gt;&lt;/script&gt;
&lt;link href=&#34;https://laddem.github.io/rmarkdown-libs/str_view/str_view.css&#34; rel=&#34;stylesheet&#34; /&gt;
&lt;script src=&#34;https://laddem.github.io/rmarkdown-libs/str_view-binding/str_view.js&#34;&gt;&lt;/script&gt;
&lt;script src=&#34;https://laddem.github.io/rmarkdown-libs/htmlwidgets/htmlwidgets.js&#34;&gt;&lt;/script&gt;
&lt;link href=&#34;https://laddem.github.io/rmarkdown-libs/str_view/str_view.css&#34; rel=&#34;stylesheet&#34; /&gt;
&lt;script src=&#34;https://laddem.github.io/rmarkdown-libs/str_view-binding/str_view.js&#34;&gt;&lt;/script&gt;
&lt;script src=&#34;https://laddem.github.io/rmarkdown-libs/htmlwidgets/htmlwidgets.js&#34;&gt;&lt;/script&gt;
&lt;link href=&#34;https://laddem.github.io/rmarkdown-libs/str_view/str_view.css&#34; rel=&#34;stylesheet&#34; /&gt;
&lt;script src=&#34;https://laddem.github.io/rmarkdown-libs/str_view-binding/str_view.js&#34;&gt;&lt;/script&gt;
&lt;script src=&#34;https://laddem.github.io/rmarkdown-libs/htmlwidgets/htmlwidgets.js&#34;&gt;&lt;/script&gt;
&lt;link href=&#34;https://laddem.github.io/rmarkdown-libs/str_view/str_view.css&#34; rel=&#34;stylesheet&#34; /&gt;
&lt;script src=&#34;https://laddem.github.io/rmarkdown-libs/str_view-binding/str_view.js&#34;&gt;&lt;/script&gt;
&lt;script src=&#34;https://laddem.github.io/rmarkdown-libs/htmlwidgets/htmlwidgets.js&#34;&gt;&lt;/script&gt;
&lt;link href=&#34;https://laddem.github.io/rmarkdown-libs/str_view/str_view.css&#34; rel=&#34;stylesheet&#34; /&gt;
&lt;script src=&#34;https://laddem.github.io/rmarkdown-libs/str_view-binding/str_view.js&#34;&gt;&lt;/script&gt;
&lt;script src=&#34;https://laddem.github.io/rmarkdown-libs/htmlwidgets/htmlwidgets.js&#34;&gt;&lt;/script&gt;
&lt;link href=&#34;https://laddem.github.io/rmarkdown-libs/str_view/str_view.css&#34; rel=&#34;stylesheet&#34; /&gt;
&lt;script src=&#34;https://laddem.github.io/rmarkdown-libs/str_view-binding/str_view.js&#34;&gt;&lt;/script&gt;
&lt;script src=&#34;https://laddem.github.io/rmarkdown-libs/htmlwidgets/htmlwidgets.js&#34;&gt;&lt;/script&gt;
&lt;link href=&#34;https://laddem.github.io/rmarkdown-libs/str_view/str_view.css&#34; rel=&#34;stylesheet&#34; /&gt;
&lt;script src=&#34;https://laddem.github.io/rmarkdown-libs/str_view-binding/str_view.js&#34;&gt;&lt;/script&gt;
&lt;script src=&#34;https://laddem.github.io/rmarkdown-libs/htmlwidgets/htmlwidgets.js&#34;&gt;&lt;/script&gt;
&lt;link href=&#34;https://laddem.github.io/rmarkdown-libs/str_view/str_view.css&#34; rel=&#34;stylesheet&#34; /&gt;
&lt;script src=&#34;https://laddem.github.io/rmarkdown-libs/str_view-binding/str_view.js&#34;&gt;&lt;/script&gt;
&lt;script src=&#34;https://laddem.github.io/rmarkdown-libs/htmlwidgets/htmlwidgets.js&#34;&gt;&lt;/script&gt;
&lt;link href=&#34;https://laddem.github.io/rmarkdown-libs/str_view/str_view.css&#34; rel=&#34;stylesheet&#34; /&gt;
&lt;script src=&#34;https://laddem.github.io/rmarkdown-libs/str_view-binding/str_view.js&#34;&gt;&lt;/script&gt;
&lt;script src=&#34;https://laddem.github.io/rmarkdown-libs/htmlwidgets/htmlwidgets.js&#34;&gt;&lt;/script&gt;
&lt;link href=&#34;https://laddem.github.io/rmarkdown-libs/str_view/str_view.css&#34; rel=&#34;stylesheet&#34; /&gt;
&lt;script src=&#34;https://laddem.github.io/rmarkdown-libs/str_view-binding/str_view.js&#34;&gt;&lt;/script&gt;
&lt;script src=&#34;https://laddem.github.io/rmarkdown-libs/htmlwidgets/htmlwidgets.js&#34;&gt;&lt;/script&gt;
&lt;link href=&#34;https://laddem.github.io/rmarkdown-libs/str_view/str_view.css&#34; rel=&#34;stylesheet&#34; /&gt;
&lt;script src=&#34;https://laddem.github.io/rmarkdown-libs/str_view-binding/str_view.js&#34;&gt;&lt;/script&gt;
&lt;script src=&#34;https://laddem.github.io/rmarkdown-libs/htmlwidgets/htmlwidgets.js&#34;&gt;&lt;/script&gt;
&lt;link href=&#34;https://laddem.github.io/rmarkdown-libs/str_view/str_view.css&#34; rel=&#34;stylesheet&#34; /&gt;
&lt;script src=&#34;https://laddem.github.io/rmarkdown-libs/str_view-binding/str_view.js&#34;&gt;&lt;/script&gt;
&lt;script src=&#34;https://laddem.github.io/rmarkdown-libs/htmlwidgets/htmlwidgets.js&#34;&gt;&lt;/script&gt;
&lt;link href=&#34;https://laddem.github.io/rmarkdown-libs/str_view/str_view.css&#34; rel=&#34;stylesheet&#34; /&gt;
&lt;script src=&#34;https://laddem.github.io/rmarkdown-libs/str_view-binding/str_view.js&#34;&gt;&lt;/script&gt;
&lt;script src=&#34;https://laddem.github.io/rmarkdown-libs/htmlwidgets/htmlwidgets.js&#34;&gt;&lt;/script&gt;
&lt;link href=&#34;https://laddem.github.io/rmarkdown-libs/str_view/str_view.css&#34; rel=&#34;stylesheet&#34; /&gt;
&lt;script src=&#34;https://laddem.github.io/rmarkdown-libs/str_view-binding/str_view.js&#34;&gt;&lt;/script&gt;
&lt;script src=&#34;https://laddem.github.io/rmarkdown-libs/htmlwidgets/htmlwidgets.js&#34;&gt;&lt;/script&gt;
&lt;link href=&#34;https://laddem.github.io/rmarkdown-libs/str_view/str_view.css&#34; rel=&#34;stylesheet&#34; /&gt;
&lt;script src=&#34;https://laddem.github.io/rmarkdown-libs/str_view-binding/str_view.js&#34;&gt;&lt;/script&gt;
&lt;script src=&#34;https://laddem.github.io/rmarkdown-libs/htmlwidgets/htmlwidgets.js&#34;&gt;&lt;/script&gt;
&lt;link href=&#34;https://laddem.github.io/rmarkdown-libs/str_view/str_view.css&#34; rel=&#34;stylesheet&#34; /&gt;
&lt;script src=&#34;https://laddem.github.io/rmarkdown-libs/str_view-binding/str_view.js&#34;&gt;&lt;/script&gt;
&lt;h2 id=&#34;opera√ß√µes-em-vari√°veis-e-bancos-de-dados&#34;&gt;Opera√ß√µes em vari√°veis e bancos de dados&lt;/h2&gt;
&lt;p&gt;Hoje vamos apresentar dois pacotes com finalidades mais espec√≠ficas para trabalhar com vari√°veis de tipo caractere e fator e um pacote super importante para as opera√ß√µes com bancos de dados.&lt;/p&gt;
&lt;p&gt;O pacote &lt;code&gt;stringr&lt;/code&gt; √© uma s√©rie de adapta√ß√µes da biblioteca &lt;code&gt;stringi&lt;/code&gt; e serve para a manipula√ß√£o de vari√°veis texto, incluindo fun√ß√µes para detec√ß√£o, modifica√ß√£o, substitui√ß√£o, remo√ß√£o de texto em vari√°veis caractere. Para dominar esse assunto, √© necess√°rio compreender o conceito de ‚Äúregex,‚Äù ou ‚Äúexpress√£o regular,‚Äù que foge um pouco do escopo do curso, mas que ser√° introduzido brevemente.&lt;/p&gt;
&lt;p&gt;O pacote &lt;code&gt;forcats&lt;/code&gt; cont√©m uma s√©rie de fun√ß√µes para trabalhar com o tipo &lt;code&gt;factor&lt;/code&gt;. S√£o fun√ß√µes que facilitam opera√ß√µes envolvendo esse tipo de vari√°vel, como contagens, troca dos nomes das categorias, agrupamento de categorias, recodifica√ß√£o, plotagem, etc.&lt;/p&gt;
&lt;p&gt;O pacote &lt;code&gt;dplyr&lt;/code&gt; √© um dos pilares do &lt;code&gt;tidyverse&lt;/code&gt; e ele tem dois pap√©is principais: opera√ß√µes de manipula√ß√£o de banco de dados simples e opera√ß√µes de bancos de dados relacionais. No primeiro tipo s√£o inclu√≠das as opera√ß√µes de cria√ß√£o e modifica√ß√£o de vari√°veis, medidas resumo globais e por grupos, sele√ß√£o de vari√°veis, mudan√ßa da ordem das linhas e colunas, etc. No segundo tipo, s√£o as opera√ß√µes de tipo &lt;code&gt;_join&lt;/code&gt;, em que uma vari√°vel chave √© utilizada para combinar registros de dois bancos de dados distintos.&lt;/p&gt;
&lt;p&gt;Os pacotes &lt;code&gt;stringr&lt;/code&gt; e &lt;code&gt;forcats&lt;/code&gt; s√£o mais diretos, mas o &lt;code&gt;dplyr&lt;/code&gt; pode representar um certo n√≠vel de abstra√ß√£o que pode incomodar usu√°rios de longa data do R, portanto, vamos nos esfor√ßar para demonstrar as vantagens de mudar seu workflow para incluir as fun√ß√µes desse pacote atrav√©s de compara√ß√µes com o R base.&lt;/p&gt;
&lt;h2 id=&#34;dplyr&#34;&gt;&lt;code&gt;dplyr&lt;/code&gt;&lt;/h2&gt;
&lt;h3 id=&#34;dplyr-para-manipula√ß√£o-de-dados&#34;&gt;&lt;code&gt;dplyr&lt;/code&gt; para manipula√ß√£o de dados&lt;/h3&gt;
&lt;p&gt;Talvez o pacote mais utilizado de todo o tidyverse, &lt;code&gt;dplyr&lt;/code&gt; √© um pacote de manipula√ß√£o de bancos de dados inspirado pela linguagem SQL. A ideia √© concatenar opera√ß√µes de &lt;strong&gt;sele√ß√£o de vari√°veis&lt;/strong&gt;, &lt;strong&gt;filtragem de observa√ß√£o&lt;/strong&gt;, &lt;strong&gt;arranjo e ordenamento&lt;/strong&gt;, &lt;strong&gt;deriva√ß√£o de vari√°veis&lt;/strong&gt;, &lt;strong&gt;computa√ß√£o de medidas resumo&lt;/strong&gt; para o banco todo ou para &lt;strong&gt;grupos&lt;/strong&gt;. As fun√ß√µes b√°sicas e mais utilizadas s√£o, portanto:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;select&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;filter&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;arrange&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;mutate&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;summarize&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;group_by&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Para praticar, vamos usar o dataset &lt;code&gt;flights&lt;/code&gt;, que cont√©m informa√ß√µes sobre os v√¥os sa√≠dos de Nova Iorque em 2013.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;library(nycflights13)
library(dplyr)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## 
## Attaching package: &#39;dplyr&#39;

## The following objects are masked from &#39;package:stats&#39;:
## 
##     filter, lag

## The following objects are masked from &#39;package:base&#39;:
## 
##     intersect, setdiff, setequal, union
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;flights
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 336,776 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
##    &amp;lt;int&amp;gt; &amp;lt;int&amp;gt; &amp;lt;int&amp;gt;    &amp;lt;int&amp;gt;          &amp;lt;int&amp;gt;     &amp;lt;dbl&amp;gt;    &amp;lt;int&amp;gt;          &amp;lt;int&amp;gt;
##  1  2013     1     1      517            515         2      830            819
##  2  2013     1     1      533            529         4      850            830
##  3  2013     1     1      542            540         2      923            850
##  4  2013     1     1      544            545        -1     1004           1022
##  5  2013     1     1      554            600        -6      812            837
##  6  2013     1     1      554            558        -4      740            728
##  7  2013     1     1      555            600        -5      913            854
##  8  2013     1     1      557            600        -3      709            723
##  9  2013     1     1      557            600        -3      838            846
## 10  2013     1     1      558            600        -2      753            745
## # ... with 336,766 more rows, and 11 more variables: arr_delay &amp;lt;dbl&amp;gt;,
## #   carrier &amp;lt;chr&amp;gt;, flight &amp;lt;int&amp;gt;, tailnum &amp;lt;chr&amp;gt;, origin &amp;lt;chr&amp;gt;, dest &amp;lt;chr&amp;gt;,
## #   air_time &amp;lt;dbl&amp;gt;, distance &amp;lt;dbl&amp;gt;, hour &amp;lt;dbl&amp;gt;, minute &amp;lt;dbl&amp;gt;, time_hour &amp;lt;dttm&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;glimpse(flights)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## Rows: 336,776
## Columns: 19
## $ year           &amp;lt;int&amp;gt; 2013, 2013, 2013, 2013, 2013, 2013, 2013, 2013, 2013, 2~
## $ month          &amp;lt;int&amp;gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1~
## $ day            &amp;lt;int&amp;gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1~
## $ dep_time       &amp;lt;int&amp;gt; 517, 533, 542, 544, 554, 554, 555, 557, 557, 558, 558, ~
## $ sched_dep_time &amp;lt;int&amp;gt; 515, 529, 540, 545, 600, 558, 600, 600, 600, 600, 600, ~
## $ dep_delay      &amp;lt;dbl&amp;gt; 2, 4, 2, -1, -6, -4, -5, -3, -3, -2, -2, -2, -2, -2, -1~
## $ arr_time       &amp;lt;int&amp;gt; 830, 850, 923, 1004, 812, 740, 913, 709, 838, 753, 849,~
## $ sched_arr_time &amp;lt;int&amp;gt; 819, 830, 850, 1022, 837, 728, 854, 723, 846, 745, 851,~
## $ arr_delay      &amp;lt;dbl&amp;gt; 11, 20, 33, -18, -25, 12, 19, -14, -8, 8, -2, -3, 7, -1~
## $ carrier        &amp;lt;chr&amp;gt; &amp;quot;UA&amp;quot;, &amp;quot;UA&amp;quot;, &amp;quot;AA&amp;quot;, &amp;quot;B6&amp;quot;, &amp;quot;DL&amp;quot;, &amp;quot;UA&amp;quot;, &amp;quot;B6&amp;quot;, &amp;quot;EV&amp;quot;, &amp;quot;B6&amp;quot;, &amp;quot;~
## $ flight         &amp;lt;int&amp;gt; 1545, 1714, 1141, 725, 461, 1696, 507, 5708, 79, 301, 4~
## $ tailnum        &amp;lt;chr&amp;gt; &amp;quot;N14228&amp;quot;, &amp;quot;N24211&amp;quot;, &amp;quot;N619AA&amp;quot;, &amp;quot;N804JB&amp;quot;, &amp;quot;N668DN&amp;quot;, &amp;quot;N394~
## $ origin         &amp;lt;chr&amp;gt; &amp;quot;EWR&amp;quot;, &amp;quot;LGA&amp;quot;, &amp;quot;JFK&amp;quot;, &amp;quot;JFK&amp;quot;, &amp;quot;LGA&amp;quot;, &amp;quot;EWR&amp;quot;, &amp;quot;EWR&amp;quot;, &amp;quot;LGA&amp;quot;,~
## $ dest           &amp;lt;chr&amp;gt; &amp;quot;IAH&amp;quot;, &amp;quot;IAH&amp;quot;, &amp;quot;MIA&amp;quot;, &amp;quot;BQN&amp;quot;, &amp;quot;ATL&amp;quot;, &amp;quot;ORD&amp;quot;, &amp;quot;FLL&amp;quot;, &amp;quot;IAD&amp;quot;,~
## $ air_time       &amp;lt;dbl&amp;gt; 227, 227, 160, 183, 116, 150, 158, 53, 140, 138, 149, 1~
## $ distance       &amp;lt;dbl&amp;gt; 1400, 1416, 1089, 1576, 762, 719, 1065, 229, 944, 733, ~
## $ hour           &amp;lt;dbl&amp;gt; 5, 5, 5, 5, 6, 5, 6, 6, 6, 6, 6, 6, 6, 6, 6, 5, 6, 6, 6~
## $ minute         &amp;lt;dbl&amp;gt; 15, 29, 40, 45, 0, 58, 0, 0, 0, 0, 0, 0, 0, 0, 0, 59, 0~
## $ time_hour      &amp;lt;dttm&amp;gt; 2013-01-01 05:00:00, 2013-01-01 05:00:00, 2013-01-01 0~
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Podemos filtrar nossas linhas: &lt;code&gt;filter&lt;/code&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;# Voos de primeiro de janeiro
flights %&amp;gt;% filter(month == 1, day == 1)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 842 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
##    &amp;lt;int&amp;gt; &amp;lt;int&amp;gt; &amp;lt;int&amp;gt;    &amp;lt;int&amp;gt;          &amp;lt;int&amp;gt;     &amp;lt;dbl&amp;gt;    &amp;lt;int&amp;gt;          &amp;lt;int&amp;gt;
##  1  2013     1     1      517            515         2      830            819
##  2  2013     1     1      533            529         4      850            830
##  3  2013     1     1      542            540         2      923            850
##  4  2013     1     1      544            545        -1     1004           1022
##  5  2013     1     1      554            600        -6      812            837
##  6  2013     1     1      554            558        -4      740            728
##  7  2013     1     1      555            600        -5      913            854
##  8  2013     1     1      557            600        -3      709            723
##  9  2013     1     1      557            600        -3      838            846
## 10  2013     1     1      558            600        -2      753            745
## # ... with 832 more rows, and 11 more variables: arr_delay &amp;lt;dbl&amp;gt;,
## #   carrier &amp;lt;chr&amp;gt;, flight &amp;lt;int&amp;gt;, tailnum &amp;lt;chr&amp;gt;, origin &amp;lt;chr&amp;gt;, dest &amp;lt;chr&amp;gt;,
## #   air_time &amp;lt;dbl&amp;gt;, distance &amp;lt;dbl&amp;gt;, hour &amp;lt;dbl&amp;gt;, minute &amp;lt;dbl&amp;gt;, time_hour &amp;lt;dttm&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;# Voos a partir de junho
flights %&amp;gt;% filter(month &amp;gt; 6)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 170,618 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
##    &amp;lt;int&amp;gt; &amp;lt;int&amp;gt; &amp;lt;int&amp;gt;    &amp;lt;int&amp;gt;          &amp;lt;int&amp;gt;     &amp;lt;dbl&amp;gt;    &amp;lt;int&amp;gt;          &amp;lt;int&amp;gt;
##  1  2013    10     1      447            500       -13      614            648
##  2  2013    10     1      522            517         5      735            757
##  3  2013    10     1      536            545        -9      809            855
##  4  2013    10     1      539            545        -6      801            827
##  5  2013    10     1      539            545        -6      917            933
##  6  2013    10     1      544            550        -6      912            932
##  7  2013    10     1      549            600       -11      653            716
##  8  2013    10     1      550            600       -10      648            700
##  9  2013    10     1      550            600       -10      649            659
## 10  2013    10     1      551            600        -9      727            730
## # ... with 170,608 more rows, and 11 more variables: arr_delay &amp;lt;dbl&amp;gt;,
## #   carrier &amp;lt;chr&amp;gt;, flight &amp;lt;int&amp;gt;, tailnum &amp;lt;chr&amp;gt;, origin &amp;lt;chr&amp;gt;, dest &amp;lt;chr&amp;gt;,
## #   air_time &amp;lt;dbl&amp;gt;, distance &amp;lt;dbl&amp;gt;, hour &amp;lt;dbl&amp;gt;, minute &amp;lt;dbl&amp;gt;, time_hour &amp;lt;dttm&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;# Voos sa√≠dos do aeroporto JFK
flights %&amp;gt;% filter(origin == &amp;quot;JFK&amp;quot;)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 111,279 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
##    &amp;lt;int&amp;gt; &amp;lt;int&amp;gt; &amp;lt;int&amp;gt;    &amp;lt;int&amp;gt;          &amp;lt;int&amp;gt;     &amp;lt;dbl&amp;gt;    &amp;lt;int&amp;gt;          &amp;lt;int&amp;gt;
##  1  2013     1     1      542            540         2      923            850
##  2  2013     1     1      544            545        -1     1004           1022
##  3  2013     1     1      557            600        -3      838            846
##  4  2013     1     1      558            600        -2      849            851
##  5  2013     1     1      558            600        -2      853            856
##  6  2013     1     1      558            600        -2      924            917
##  7  2013     1     1      559            559         0      702            706
##  8  2013     1     1      606            610        -4      837            845
##  9  2013     1     1      611            600        11      945            931
## 10  2013     1     1      613            610         3      925            921
## # ... with 111,269 more rows, and 11 more variables: arr_delay &amp;lt;dbl&amp;gt;,
## #   carrier &amp;lt;chr&amp;gt;, flight &amp;lt;int&amp;gt;, tailnum &amp;lt;chr&amp;gt;, origin &amp;lt;chr&amp;gt;, dest &amp;lt;chr&amp;gt;,
## #   air_time &amp;lt;dbl&amp;gt;, distance &amp;lt;dbl&amp;gt;, hour &amp;lt;dbl&amp;gt;, minute &amp;lt;dbl&amp;gt;, time_hour &amp;lt;dttm&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;# Voos com destino ao aeroporto de Albuquerque
flights %&amp;gt;% filter(dest == &amp;quot;ABQ&amp;quot;)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 254 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
##    &amp;lt;int&amp;gt; &amp;lt;int&amp;gt; &amp;lt;int&amp;gt;    &amp;lt;int&amp;gt;          &amp;lt;int&amp;gt;     &amp;lt;dbl&amp;gt;    &amp;lt;int&amp;gt;          &amp;lt;int&amp;gt;
##  1  2013    10     1     1955           2001        -6     2213           2248
##  2  2013    10     2     2010           2001         9     2230           2248
##  3  2013    10     3     1955           2001        -6     2232           2248
##  4  2013    10     4     2017           2001        16     2304           2248
##  5  2013    10     5     1959           1959         0     2226           2246
##  6  2013    10     6     1959           2001        -2     2234           2248
##  7  2013    10     7     2002           2001         1     2233           2248
##  8  2013    10     8     1957           2001        -4     2216           2248
##  9  2013    10     9     1957           2001        -4     2220           2248
## 10  2013    10    10     2011           2001        10     2235           2248
## # ... with 244 more rows, and 11 more variables: arr_delay &amp;lt;dbl&amp;gt;,
## #   carrier &amp;lt;chr&amp;gt;, flight &amp;lt;int&amp;gt;, tailnum &amp;lt;chr&amp;gt;, origin &amp;lt;chr&amp;gt;, dest &amp;lt;chr&amp;gt;,
## #   air_time &amp;lt;dbl&amp;gt;, distance &amp;lt;dbl&amp;gt;, hour &amp;lt;dbl&amp;gt;, minute &amp;lt;dbl&amp;gt;, time_hour &amp;lt;dttm&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;# Voos com atraso de at√© 10 minutos
flights %&amp;gt;% filter(dep_delay &amp;lt;= 10)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 245,687 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
##    &amp;lt;int&amp;gt; &amp;lt;int&amp;gt; &amp;lt;int&amp;gt;    &amp;lt;int&amp;gt;          &amp;lt;int&amp;gt;     &amp;lt;dbl&amp;gt;    &amp;lt;int&amp;gt;          &amp;lt;int&amp;gt;
##  1  2013     1     1      517            515         2      830            819
##  2  2013     1     1      533            529         4      850            830
##  3  2013     1     1      542            540         2      923            850
##  4  2013     1     1      544            545        -1     1004           1022
##  5  2013     1     1      554            600        -6      812            837
##  6  2013     1     1      554            558        -4      740            728
##  7  2013     1     1      555            600        -5      913            854
##  8  2013     1     1      557            600        -3      709            723
##  9  2013     1     1      557            600        -3      838            846
## 10  2013     1     1      558            600        -2      753            745
## # ... with 245,677 more rows, and 11 more variables: arr_delay &amp;lt;dbl&amp;gt;,
## #   carrier &amp;lt;chr&amp;gt;, flight &amp;lt;int&amp;gt;, tailnum &amp;lt;chr&amp;gt;, origin &amp;lt;chr&amp;gt;, dest &amp;lt;chr&amp;gt;,
## #   air_time &amp;lt;dbl&amp;gt;, distance &amp;lt;dbl&amp;gt;, hour &amp;lt;dbl&amp;gt;, minute &amp;lt;dbl&amp;gt;, time_hour &amp;lt;dttm&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;# Voos com atraso de cerca de 10 minutos
flights %&amp;gt;% filter(near(dep_delay, 10, tol = 2))
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 8,677 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
##    &amp;lt;int&amp;gt; &amp;lt;int&amp;gt; &amp;lt;int&amp;gt;    &amp;lt;int&amp;gt;          &amp;lt;int&amp;gt;     &amp;lt;dbl&amp;gt;    &amp;lt;int&amp;gt;          &amp;lt;int&amp;gt;
##  1  2013     1     1      611            600        11      945            931
##  2  2013     1     1      709            700         9      852            832
##  3  2013     1     1      826            817         9     1145           1158
##  4  2013     1     1      851            840        11     1215           1206
##  5  2013     1     1     1011           1001        10     1133           1128
##  6  2013     1     1     1208           1158        10     1540           1502
##  7  2013     1     1     1240           1229        11     1451           1428
##  8  2013     1     1     1310           1300        10     1559           1554
##  9  2013     1     1     1330           1321         9     1613           1536
## 10  2013     1     1     1511           1500        11     1753           1742
## # ... with 8,667 more rows, and 11 more variables: arr_delay &amp;lt;dbl&amp;gt;,
## #   carrier &amp;lt;chr&amp;gt;, flight &amp;lt;int&amp;gt;, tailnum &amp;lt;chr&amp;gt;, origin &amp;lt;chr&amp;gt;, dest &amp;lt;chr&amp;gt;,
## #   air_time &amp;lt;dbl&amp;gt;, distance &amp;lt;dbl&amp;gt;, hour &amp;lt;dbl&amp;gt;, minute &amp;lt;dbl&amp;gt;, time_hour &amp;lt;dttm&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;# Voos que ocorreram entre abril e maio
flights %&amp;gt;% filter(between(month, 4, 5))
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 57,126 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
##    &amp;lt;int&amp;gt; &amp;lt;int&amp;gt; &amp;lt;int&amp;gt;    &amp;lt;int&amp;gt;          &amp;lt;int&amp;gt;     &amp;lt;dbl&amp;gt;    &amp;lt;int&amp;gt;          &amp;lt;int&amp;gt;
##  1  2013     4     1      454            500        -6      636            640
##  2  2013     4     1      509            515        -6      743            814
##  3  2013     4     1      526            530        -4      812            827
##  4  2013     4     1      534            540        -6      833            850
##  5  2013     4     1      542            545        -3      914            920
##  6  2013     4     1      543            545        -2      921            927
##  7  2013     4     1      551            600        -9      748            659
##  8  2013     4     1      552            600        -8      641            701
##  9  2013     4     1      553            600        -7      725            735
## 10  2013     4     1      554            600        -6      752            805
## # ... with 57,116 more rows, and 11 more variables: arr_delay &amp;lt;dbl&amp;gt;,
## #   carrier &amp;lt;chr&amp;gt;, flight &amp;lt;int&amp;gt;, tailnum &amp;lt;chr&amp;gt;, origin &amp;lt;chr&amp;gt;, dest &amp;lt;chr&amp;gt;,
## #   air_time &amp;lt;dbl&amp;gt;, distance &amp;lt;dbl&amp;gt;, hour &amp;lt;dbl&amp;gt;, minute &amp;lt;dbl&amp;gt;, time_hour &amp;lt;dttm&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Podemos combinar v√°rias condi√ß√µes usando operadores l√≥gicos&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;# Voos at√© 15 de abril ou at√© 15 de maio
flights %&amp;gt;% filter(
  between(month, 4, 5), # mesmo que usar &amp;amp;
  between(day, 1, 15)
)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 28,176 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
##    &amp;lt;int&amp;gt; &amp;lt;int&amp;gt; &amp;lt;int&amp;gt;    &amp;lt;int&amp;gt;          &amp;lt;int&amp;gt;     &amp;lt;dbl&amp;gt;    &amp;lt;int&amp;gt;          &amp;lt;int&amp;gt;
##  1  2013     4     1      454            500        -6      636            640
##  2  2013     4     1      509            515        -6      743            814
##  3  2013     4     1      526            530        -4      812            827
##  4  2013     4     1      534            540        -6      833            850
##  5  2013     4     1      542            545        -3      914            920
##  6  2013     4     1      543            545        -2      921            927
##  7  2013     4     1      551            600        -9      748            659
##  8  2013     4     1      552            600        -8      641            701
##  9  2013     4     1      553            600        -7      725            735
## 10  2013     4     1      554            600        -6      752            805
## # ... with 28,166 more rows, and 11 more variables: arr_delay &amp;lt;dbl&amp;gt;,
## #   carrier &amp;lt;chr&amp;gt;, flight &amp;lt;int&amp;gt;, tailnum &amp;lt;chr&amp;gt;, origin &amp;lt;chr&amp;gt;, dest &amp;lt;chr&amp;gt;,
## #   air_time &amp;lt;dbl&amp;gt;, distance &amp;lt;dbl&amp;gt;, hour &amp;lt;dbl&amp;gt;, minute &amp;lt;dbl&amp;gt;, time_hour &amp;lt;dttm&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;# Voos entre 15 de abril e 15 de maio
flights %&amp;gt;% filter(
  month == 4 &amp;amp; between(day, 15, 30) | # OU
  month == 5 &amp;amp; between(day, 1, 15)
)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 29,101 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
##    &amp;lt;int&amp;gt; &amp;lt;int&amp;gt; &amp;lt;int&amp;gt;    &amp;lt;int&amp;gt;          &amp;lt;int&amp;gt;     &amp;lt;dbl&amp;gt;    &amp;lt;int&amp;gt;          &amp;lt;int&amp;gt;
##  1  2013     4    15        2           2359         3      341            339
##  2  2013     4    15      453            500        -7      639            640
##  3  2013     4    15      511            515        -4      741            802
##  4  2013     4    15      527            530        -3      806            813
##  5  2013     4    15      527            529        -2      750            743
##  6  2013     4    15      537            540        -3      846            840
##  7  2013     4    15      542            545        -3      931            927
##  8  2013     4    15      551            600        -9      728            758
##  9  2013     4    15      552            600        -8      835            850
## 10  2013     4    15      552            600        -8      648            701
## # ... with 29,091 more rows, and 11 more variables: arr_delay &amp;lt;dbl&amp;gt;,
## #   carrier &amp;lt;chr&amp;gt;, flight &amp;lt;int&amp;gt;, tailnum &amp;lt;chr&amp;gt;, origin &amp;lt;chr&amp;gt;, dest &amp;lt;chr&amp;gt;,
## #   air_time &amp;lt;dbl&amp;gt;, distance &amp;lt;dbl&amp;gt;, hour &amp;lt;dbl&amp;gt;, minute &amp;lt;dbl&amp;gt;, time_hour &amp;lt;dttm&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;# Voos em todas os primeiros 7 dias de cada m√™s, exceto em janeiro e dezembro
flights %&amp;gt;% filter(
  between(day, 1, 7),
  !month %in% c(1, 12)
)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 64,365 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
##    &amp;lt;int&amp;gt; &amp;lt;int&amp;gt; &amp;lt;int&amp;gt;    &amp;lt;int&amp;gt;          &amp;lt;int&amp;gt;     &amp;lt;dbl&amp;gt;    &amp;lt;int&amp;gt;          &amp;lt;int&amp;gt;
##  1  2013    10     1      447            500       -13      614            648
##  2  2013    10     1      522            517         5      735            757
##  3  2013    10     1      536            545        -9      809            855
##  4  2013    10     1      539            545        -6      801            827
##  5  2013    10     1      539            545        -6      917            933
##  6  2013    10     1      544            550        -6      912            932
##  7  2013    10     1      549            600       -11      653            716
##  8  2013    10     1      550            600       -10      648            700
##  9  2013    10     1      550            600       -10      649            659
## 10  2013    10     1      551            600        -9      727            730
## # ... with 64,355 more rows, and 11 more variables: arr_delay &amp;lt;dbl&amp;gt;,
## #   carrier &amp;lt;chr&amp;gt;, flight &amp;lt;int&amp;gt;, tailnum &amp;lt;chr&amp;gt;, origin &amp;lt;chr&amp;gt;, dest &amp;lt;chr&amp;gt;,
## #   air_time &amp;lt;dbl&amp;gt;, distance &amp;lt;dbl&amp;gt;, hour &amp;lt;dbl&amp;gt;, minute &amp;lt;dbl&amp;gt;, time_hour &amp;lt;dttm&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;# Voos saidos de JFK, excluindo aqueles para os quais n√£o tem informa√ß√µes de hor√°rio de sa√≠da
flights %&amp;gt;% filter(
  origin == &amp;quot;JFK&amp;quot;, !is.na(dep_time)
)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 109,416 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
##    &amp;lt;int&amp;gt; &amp;lt;int&amp;gt; &amp;lt;int&amp;gt;    &amp;lt;int&amp;gt;          &amp;lt;int&amp;gt;     &amp;lt;dbl&amp;gt;    &amp;lt;int&amp;gt;          &amp;lt;int&amp;gt;
##  1  2013     1     1      542            540         2      923            850
##  2  2013     1     1      544            545        -1     1004           1022
##  3  2013     1     1      557            600        -3      838            846
##  4  2013     1     1      558            600        -2      849            851
##  5  2013     1     1      558            600        -2      853            856
##  6  2013     1     1      558            600        -2      924            917
##  7  2013     1     1      559            559         0      702            706
##  8  2013     1     1      606            610        -4      837            845
##  9  2013     1     1      611            600        11      945            931
## 10  2013     1     1      613            610         3      925            921
## # ... with 109,406 more rows, and 11 more variables: arr_delay &amp;lt;dbl&amp;gt;,
## #   carrier &amp;lt;chr&amp;gt;, flight &amp;lt;int&amp;gt;, tailnum &amp;lt;chr&amp;gt;, origin &amp;lt;chr&amp;gt;, dest &amp;lt;chr&amp;gt;,
## #   air_time &amp;lt;dbl&amp;gt;, distance &amp;lt;dbl&amp;gt;, hour &amp;lt;dbl&amp;gt;, minute &amp;lt;dbl&amp;gt;, time_hour &amp;lt;dttm&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;# Voos com mais de 30 minutos de atraso em janeiro ou dezembro
flights %&amp;gt;% filter(
  dep_delay &amp;gt; 30, xor(month == 1, month == 12)
)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 8,221 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
##    &amp;lt;int&amp;gt; &amp;lt;int&amp;gt; &amp;lt;int&amp;gt;    &amp;lt;int&amp;gt;          &amp;lt;int&amp;gt;     &amp;lt;dbl&amp;gt;    &amp;lt;int&amp;gt;          &amp;lt;int&amp;gt;
##  1  2013     1     1      732            645        47     1011            941
##  2  2013     1     1      749            710        39      939            850
##  3  2013     1     1      811            630       101     1047            830
##  4  2013     1     1      826            715        71     1136           1045
##  5  2013     1     1      848           1835       853     1001           1950
##  6  2013     1     1      903            820        43     1045            955
##  7  2013     1     1      909            810        59     1331           1315
##  8  2013     1     1      953            921        32     1320           1241
##  9  2013     1     1      957            733       144     1056            853
## 10  2013     1     1     1025            951        34     1258           1302
## # ... with 8,211 more rows, and 11 more variables: arr_delay &amp;lt;dbl&amp;gt;,
## #   carrier &amp;lt;chr&amp;gt;, flight &amp;lt;int&amp;gt;, tailnum &amp;lt;chr&amp;gt;, origin &amp;lt;chr&amp;gt;, dest &amp;lt;chr&amp;gt;,
## #   air_time &amp;lt;dbl&amp;gt;, distance &amp;lt;dbl&amp;gt;, hour &amp;lt;dbl&amp;gt;, minute &amp;lt;dbl&amp;gt;, time_hour &amp;lt;dttm&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;E assim sucessivamente.&lt;/p&gt;
&lt;p&gt;Da mesma forma, temos &lt;code&gt;select&lt;/code&gt; para selecionar as vari√°veis do banco. As duas grandes novidades s√£o que voc√™ n√£o precisa utilizar aspas na sele√ß√£o de vari√°veis e que &lt;code&gt;select&lt;/code&gt; introduz v√°rias &lt;code&gt;helper functions&lt;/code&gt; para facilitar a sele√ß√£o de vari√°veis parecidas.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;# Selecionar as colunas ano, mes, dia, horario de saida e horario de chegada
flights %&amp;gt;% select(year, month, day, dep_time, arr_time)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 336,776 x 5
##     year month   day dep_time arr_time
##    &amp;lt;int&amp;gt; &amp;lt;int&amp;gt; &amp;lt;int&amp;gt;    &amp;lt;int&amp;gt;    &amp;lt;int&amp;gt;
##  1  2013     1     1      517      830
##  2  2013     1     1      533      850
##  3  2013     1     1      542      923
##  4  2013     1     1      544     1004
##  5  2013     1     1      554      812
##  6  2013     1     1      554      740
##  7  2013     1     1      555      913
##  8  2013     1     1      557      709
##  9  2013     1     1      557      838
## 10  2013     1     1      558      753
## # ... with 336,766 more rows
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;# Utilizando helpers
flights %&amp;gt;% select(year:dep_time, arr_time)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 336,776 x 5
##     year month   day dep_time arr_time
##    &amp;lt;int&amp;gt; &amp;lt;int&amp;gt; &amp;lt;int&amp;gt;    &amp;lt;int&amp;gt;    &amp;lt;int&amp;gt;
##  1  2013     1     1      517      830
##  2  2013     1     1      533      850
##  3  2013     1     1      542      923
##  4  2013     1     1      544     1004
##  5  2013     1     1      554      812
##  6  2013     1     1      554      740
##  7  2013     1     1      555      913
##  8  2013     1     1      557      709
##  9  2013     1     1      557      838
## 10  2013     1     1      558      753
## # ... with 336,766 more rows
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;# Mais helpers
flights %&amp;gt;% select(year:day, starts_with(&amp;quot;dep&amp;quot;), starts_with(&amp;quot;arr&amp;quot;))
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 336,776 x 7
##     year month   day dep_time dep_delay arr_time arr_delay
##    &amp;lt;int&amp;gt; &amp;lt;int&amp;gt; &amp;lt;int&amp;gt;    &amp;lt;int&amp;gt;     &amp;lt;dbl&amp;gt;    &amp;lt;int&amp;gt;     &amp;lt;dbl&amp;gt;
##  1  2013     1     1      517         2      830        11
##  2  2013     1     1      533         4      850        20
##  3  2013     1     1      542         2      923        33
##  4  2013     1     1      544        -1     1004       -18
##  5  2013     1     1      554        -6      812       -25
##  6  2013     1     1      554        -4      740        12
##  7  2013     1     1      555        -5      913        19
##  8  2013     1     1      557        -3      709       -14
##  9  2013     1     1      557        -3      838        -8
## 10  2013     1     1      558        -2      753         8
## # ... with 336,766 more rows
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;flights %&amp;gt;% select(year:day, ends_with(&amp;quot;time&amp;quot;))
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 336,776 x 8
##     year month   day dep_time sched_dep_time arr_time sched_arr_time air_time
##    &amp;lt;int&amp;gt; &amp;lt;int&amp;gt; &amp;lt;int&amp;gt;    &amp;lt;int&amp;gt;          &amp;lt;int&amp;gt;    &amp;lt;int&amp;gt;          &amp;lt;int&amp;gt;    &amp;lt;dbl&amp;gt;
##  1  2013     1     1      517            515      830            819      227
##  2  2013     1     1      533            529      850            830      227
##  3  2013     1     1      542            540      923            850      160
##  4  2013     1     1      544            545     1004           1022      183
##  5  2013     1     1      554            600      812            837      116
##  6  2013     1     1      554            558      740            728      150
##  7  2013     1     1      555            600      913            854      158
##  8  2013     1     1      557            600      709            723       53
##  9  2013     1     1      557            600      838            846      140
## 10  2013     1     1      558            600      753            745      138
## # ... with 336,766 more rows
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;flights %&amp;gt;% select(year:day, c(ends_with(&amp;quot;time&amp;quot;)) &amp;amp; !contains(&amp;quot;sched&amp;quot;))
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 336,776 x 6
##     year month   day dep_time arr_time air_time
##    &amp;lt;int&amp;gt; &amp;lt;int&amp;gt; &amp;lt;int&amp;gt;    &amp;lt;int&amp;gt;    &amp;lt;int&amp;gt;    &amp;lt;dbl&amp;gt;
##  1  2013     1     1      517      830      227
##  2  2013     1     1      533      850      227
##  3  2013     1     1      542      923      160
##  4  2013     1     1      544     1004      183
##  5  2013     1     1      554      812      116
##  6  2013     1     1      554      740      150
##  7  2013     1     1      555      913      158
##  8  2013     1     1      557      709       53
##  9  2013     1     1      557      838      140
## 10  2013     1     1      558      753      138
## # ... with 336,766 more rows
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;# Voc√™ pode mudar o nome das colunas durante um call para select
flights %&amp;gt;% select(ano = year, mes = month, dia = day)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 336,776 x 3
##      ano   mes   dia
##    &amp;lt;int&amp;gt; &amp;lt;int&amp;gt; &amp;lt;int&amp;gt;
##  1  2013     1     1
##  2  2013     1     1
##  3  2013     1     1
##  4  2013     1     1
##  5  2013     1     1
##  6  2013     1     1
##  7  2013     1     1
##  8  2013     1     1
##  9  2013     1     1
## 10  2013     1     1
## # ... with 336,766 more rows
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;# Ou voc√™ pode usar rename para mudar os nomes sem selecionar vari√°veis
flights %&amp;gt;% rename(ano = year, mes = month, dia = day)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 336,776 x 19
##      ano   mes   dia dep_time sched_dep_time dep_delay arr_time sched_arr_time
##    &amp;lt;int&amp;gt; &amp;lt;int&amp;gt; &amp;lt;int&amp;gt;    &amp;lt;int&amp;gt;          &amp;lt;int&amp;gt;     &amp;lt;dbl&amp;gt;    &amp;lt;int&amp;gt;          &amp;lt;int&amp;gt;
##  1  2013     1     1      517            515         2      830            819
##  2  2013     1     1      533            529         4      850            830
##  3  2013     1     1      542            540         2      923            850
##  4  2013     1     1      544            545        -1     1004           1022
##  5  2013     1     1      554            600        -6      812            837
##  6  2013     1     1      554            558        -4      740            728
##  7  2013     1     1      555            600        -5      913            854
##  8  2013     1     1      557            600        -3      709            723
##  9  2013     1     1      557            600        -3      838            846
## 10  2013     1     1      558            600        -2      753            745
## # ... with 336,766 more rows, and 11 more variables: arr_delay &amp;lt;dbl&amp;gt;,
## #   carrier &amp;lt;chr&amp;gt;, flight &amp;lt;int&amp;gt;, tailnum &amp;lt;chr&amp;gt;, origin &amp;lt;chr&amp;gt;, dest &amp;lt;chr&amp;gt;,
## #   air_time &amp;lt;dbl&amp;gt;, distance &amp;lt;dbl&amp;gt;, hour &amp;lt;dbl&amp;gt;, minute &amp;lt;dbl&amp;gt;, time_hour &amp;lt;dttm&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;S√£o realmente muitas possibilidades, vejam a documenta√ß√£o e os exemplos em &lt;code&gt;?select&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Utilizando &lt;code&gt;arrange&lt;/code&gt; podemos facilmente organizar nosso banco a partir de vari√°veis de interesse:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;# Selecionar algumas vari√°veis e ver organizar de acordar com os mais adiantados
flights %&amp;gt;% 
  select(year:day,matches(&amp;quot;^dep|^arr&amp;quot;)) %&amp;gt;% 
  arrange(dep_delay, arr_delay)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 336,776 x 7
##     year month   day dep_time dep_delay arr_time arr_delay
##    &amp;lt;int&amp;gt; &amp;lt;int&amp;gt; &amp;lt;int&amp;gt;    &amp;lt;int&amp;gt;     &amp;lt;dbl&amp;gt;    &amp;lt;int&amp;gt;     &amp;lt;dbl&amp;gt;
##  1  2013    12     7     2040       -43       40        48
##  2  2013     2     3     2022       -33     2240       -58
##  3  2013    11    10     1408       -32     1549       -10
##  4  2013     1    11     1900       -30     2233       -10
##  5  2013     1    29     1703       -27     1947       -10
##  6  2013     8     9      729       -26     1002         7
##  7  2013     3    30     2030       -25     2213       -37
##  8  2013    10    23     1907       -25     2143         0
##  9  2013     5     5      934       -24     1225       -44
## 10  2013     9    18     1631       -24     1812       -33
## # ... with 336,766 more rows
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;# Ou os mais atrasados
flights %&amp;gt;% 
  select(year:day,matches(&amp;quot;^dep|^arr&amp;quot;)) %&amp;gt;% 
  arrange(-dep_delay, -arr_delay)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 336,776 x 7
##     year month   day dep_time dep_delay arr_time arr_delay
##    &amp;lt;int&amp;gt; &amp;lt;int&amp;gt; &amp;lt;int&amp;gt;    &amp;lt;int&amp;gt;     &amp;lt;dbl&amp;gt;    &amp;lt;int&amp;gt;     &amp;lt;dbl&amp;gt;
##  1  2013     1     9      641      1301     1242      1272
##  2  2013     6    15     1432      1137     1607      1127
##  3  2013     1    10     1121      1126     1239      1109
##  4  2013     9    20     1139      1014     1457      1007
##  5  2013     7    22      845      1005     1044       989
##  6  2013     4    10     1100       960     1342       931
##  7  2013     3    17     2321       911      135       915
##  8  2013     6    27      959       899     1236       850
##  9  2013     7    22     2257       898      121       895
## 10  2013    12     5      756       896     1058       878
## # ... with 336,766 more rows
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;√â basicamente isso, voc√™ pode especificar uma ou muitas colunas para organizar, decidir se a ordem √© ascendente ou descendente e pronto.&lt;/p&gt;
&lt;p&gt;Utilizando &lt;code&gt;mutate&lt;/code&gt;, voc√™ cria vari√°veis derivadas das originais. Como &lt;code&gt;tibble&lt;/code&gt;, essa fun√ß√£o avalia seus argumentos de maneira pregui√ßosa e sequencial, o que permite voc√™ criar vari√°veis derivadas umas das outras muito facilmente.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;flights %&amp;gt;% 
  select(sched_dep_time, dep_time, sched_arr_time, arr_time) %&amp;gt;% 
  mutate(atraso_decolagem = dep_time - sched_dep_time,
         atraso_pouso = arr_time - sched_arr_time,
         atraso_dec_horas = atraso_decolagem / 60,
         atraso_pouso_horas = atraso_pouso / 60)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 336,776 x 8
##    sched_dep_time dep_time sched_arr_time arr_time atraso_decolagem atraso_pouso
##             &amp;lt;int&amp;gt;    &amp;lt;int&amp;gt;          &amp;lt;int&amp;gt;    &amp;lt;int&amp;gt;            &amp;lt;int&amp;gt;        &amp;lt;int&amp;gt;
##  1            515      517            819      830                2           11
##  2            529      533            830      850                4           20
##  3            540      542            850      923                2           73
##  4            545      544           1022     1004               -1          -18
##  5            600      554            837      812              -46          -25
##  6            558      554            728      740               -4           12
##  7            600      555            854      913              -45           59
##  8            600      557            723      709              -43          -14
##  9            600      557            846      838              -43           -8
## 10            600      558            745      753              -42            8
## # ... with 336,766 more rows, and 2 more variables: atraso_dec_horas &amp;lt;dbl&amp;gt;,
## #   atraso_pouso_horas &amp;lt;dbl&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;# Transmute √© um atalho para quando voc√™ quer apenas as vari√°veis resultado e n√£o est√° interessado nas intermedi√°rias.
flights %&amp;gt;% 
  transmute(atraso_decolagem = dep_time - sched_dep_time,
            atraso_pouso = arr_time - sched_arr_time,
            atraso_dec_horas = atraso_decolagem / 60,
            atraso_pouso_horas = atraso_pouso / 60)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 336,776 x 4
##    atraso_decolagem atraso_pouso atraso_dec_horas atraso_pouso_horas
##               &amp;lt;int&amp;gt;        &amp;lt;int&amp;gt;            &amp;lt;dbl&amp;gt;              &amp;lt;dbl&amp;gt;
##  1                2           11           0.0333              0.183
##  2                4           20           0.0667              0.333
##  3                2           73           0.0333              1.22 
##  4               -1          -18          -0.0167             -0.3  
##  5              -46          -25          -0.767              -0.417
##  6               -4           12          -0.0667              0.2  
##  7              -45           59          -0.75                0.983
##  8              -43          -14          -0.717              -0.233
##  9              -43           -8          -0.717              -0.133
## 10              -42            8          -0.7                 0.133
## # ... with 336,766 more rows
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Usando o pipe, √© fazer diversas opera√ß√µes de transforma√ß√£o de vari√°veis simult√¢neamente em um √∫nico call sem a necessidade de repetir o nome do objeto e &lt;code&gt;$&lt;/code&gt; a cada refer√™ncia. &lt;code&gt;mutate&lt;/code&gt; √© uma fun√ß√£o extremamente flex√≠vel, voc√™ pode chamar qualquer fun√ß√£o que retorne um vetor de tamanho 1 ou de tamanho do n√∫mero de linhas do banco l√° dentro para criar uma vari√°vel.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;desabafo &amp;lt;- function(x) {
  y &amp;lt;- floor(x / 60)
  
  dplyr::case_when(
    # Condi√ß√µes ~ Resultados
    y &amp;lt; 0       ~ &amp;quot;Opa, vou chegar cedo!&amp;quot;,
    y &amp;lt; 1       ~ &amp;quot;Atraso de menos de 1 hora √© toler√°vel&amp;quot;,
    y &amp;gt;= 1      ~ paste0(&amp;quot;Atraso de mais de &amp;quot;, y, &amp;quot; horas √© f***.&amp;quot;),
    TRUE        ~ &amp;quot;Ahn?&amp;quot; # Condi√ß√£o guarda-chuva
  )
  
}

flights %&amp;gt;% 
  select(dep_delay) %&amp;gt;% 
  mutate(desabafo = desabafo(dep_delay)) %&amp;gt;% 
  sample_n(10)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 10 x 2
##    dep_delay desabafo                             
##        &amp;lt;dbl&amp;gt; &amp;lt;chr&amp;gt;                                
##  1        -5 Opa, vou chegar cedo!                
##  2        23 Atraso de menos de 1 hora √© toler√°vel
##  3        -4 Opa, vou chegar cedo!                
##  4        -3 Opa, vou chegar cedo!                
##  5        -8 Opa, vou chegar cedo!                
##  6        -3 Opa, vou chegar cedo!                
##  7        -5 Opa, vou chegar cedo!                
##  8        22 Atraso de menos de 1 hora √© toler√°vel
##  9        23 Atraso de menos de 1 hora √© toler√°vel
## 10        -2 Opa, vou chegar cedo!
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Utilizando &lt;code&gt;summarize&lt;/code&gt; voc√™ tira medidas resumo das suas colunas de interesse:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;flights %&amp;gt;% 
  summarize(atraso_decolagem_medio = mean(dep_delay, na.rm = T),
            atraso_decolagem_desvpad = sd(dep_delay, na.rm = T),
            atraso_pouso_medio = mean(arr_delay, na.rm = T),
            atraso_pouso_desvpad = sd(arr_delay, na.rm = T),
            n_voos = n())
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 1 x 5
##   atraso_decolagem_~ atraso_decolagem_~ atraso_pouso_me~ atraso_pouso_de~ n_voos
##                &amp;lt;dbl&amp;gt;              &amp;lt;dbl&amp;gt;            &amp;lt;dbl&amp;gt;            &amp;lt;dbl&amp;gt;  &amp;lt;int&amp;gt;
## 1               12.6               40.2             6.90             44.6 336776
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Parece uma bobagem, mas quando voc√™ junta isso com a √∫ltima fun√ß√£o, &lt;code&gt;group_by&lt;/code&gt;, √© poss√≠vel obter diversas estat√≠sticas de interesse muito rapidamente e para v√°rios dom√≠nios:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;# Por m√™s
flights %&amp;gt;% 
  group_by(month) %&amp;gt;% 
  summarize(atraso_decolagem_medio = mean(dep_delay, na.rm = T),
            atraso_decolagem_desvpad = sd(dep_delay, na.rm = T),
            atraso_pouso_medio = mean(arr_delay, na.rm = T),
            atraso_pouso_desvpad = sd(arr_delay, na.rm = T),
            n_voos = n())
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 12 x 6
##    month atraso_decolagem_~ atraso_decolagem_~ atraso_pouso_me~ atraso_pouso_de~
##    &amp;lt;int&amp;gt;              &amp;lt;dbl&amp;gt;              &amp;lt;dbl&amp;gt;            &amp;lt;dbl&amp;gt;            &amp;lt;dbl&amp;gt;
##  1     1              10.0                36.4            6.13              40.4
##  2     2              10.8                36.3            5.61              39.5
##  3     3              13.2                40.1            5.81              44.1
##  4     4              13.9                43.0           11.2               47.5
##  5     5              13.0                39.4            3.52              44.2
##  6     6              20.8                51.5           16.5               56.1
##  7     7              21.7                51.6           16.7               57.1
##  8     8              12.6                37.7            6.04              42.6
##  9     9               6.72               35.6           -4.02              39.7
## 10    10               6.24               29.7           -0.167             32.6
## 11    11               5.44               27.6            0.461             31.4
## 12    12              16.6                41.9           14.9               46.1
## # ... with 1 more variable: n_voos &amp;lt;int&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;# Por m√™s e aeroporto de origem
flights %&amp;gt;% 
  group_by(month, origin) %&amp;gt;% 
  summarize(atraso_decolagem_medio = mean(dep_delay, na.rm = T),
            atraso_decolagem_desvpad = sd(dep_delay, na.rm = T),
            atraso_pouso_medio = mean(arr_delay, na.rm = T),
            atraso_pouso_desvpad = sd(arr_delay, na.rm = T),
            n_voos = n())
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## `summarise()` has grouped output by &#39;month&#39;. You can override using the `.groups` argument.

## # A tibble: 36 x 7
## # Groups:   month [12]
##    month origin atraso_decolagem_medio atraso_decolagem_desvp~ atraso_pouso_med~
##    &amp;lt;int&amp;gt; &amp;lt;chr&amp;gt;                   &amp;lt;dbl&amp;gt;                   &amp;lt;dbl&amp;gt;             &amp;lt;dbl&amp;gt;
##  1     1 EWR                     14.9                     40.8             12.8 
##  2     1 JFK                      8.62                    36.0              1.37
##  3     1 LGA                      5.64                    29.7              3.38
##  4     2 EWR                     13.1                     37.2              8.78
##  5     2 JFK                     11.8                     37.4              4.39
##  6     2 LGA                      6.96                    33.4              3.15
##  7     3 EWR                     18.1                     44.1             10.6 
##  8     3 JFK                     10.7                     35.3              2.58
##  9     3 LGA                     10.2                     39.7              3.74
## 10     4 EWR                     17.4                     43.9             14.1 
## # ... with 26 more rows, and 2 more variables: atraso_pouso_desvpad &amp;lt;dbl&amp;gt;,
## #   n_voos &amp;lt;int&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Uma vez que voc√™ se familiariza com a gram√°tica do &lt;code&gt;dplyr&lt;/code&gt;, o processo de an√°lise explorat√≥ria se torna bastante trivial e at√© certo ponto, prazeiroso. Mas o que eu realmente gosto √© que ele tamb√©m se torna visualmente √≥bvio para o leitor, com cada chamado podendo ser lido como uma declara√ß√£o:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Utilizando o banco de dados flights, agrupe as observa√ß√µes por m√™s e aeroporto de origem, ent√£o, calcule as m√©dias e desvios padr√£o dos atrasos no pouso e na decolagem e o n√∫mero de v√¥os para cada grupo.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Voc√™ tamb√©m pode rapidamente introduzir ou retirar passos em cada chamado deste utilizando o pipe, por exemplo:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;flights %&amp;gt;% 
  group_by(month, origin) %&amp;gt;% 
  summarize(atraso_decolagem_medio = mean(dep_delay, na.rm = T),
            atraso_decolagem_desvpad = sd(dep_delay, na.rm = T),
            atraso_pouso_medio = mean(arr_delay, na.rm = T),
            atraso_pouso_desvpad = sd(arr_delay, na.rm = T),
            n_voos = n()) %&amp;gt;% 
  arrange(-atraso_decolagem_medio)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## `summarise()` has grouped output by &#39;month&#39;. You can override using the `.groups` argument.

## # A tibble: 36 x 7
## # Groups:   month [12]
##    month origin atraso_decolagem_medio atraso_decolagem_desvp~ atraso_pouso_med~
##    &amp;lt;int&amp;gt; &amp;lt;chr&amp;gt;                   &amp;lt;dbl&amp;gt;                   &amp;lt;dbl&amp;gt;             &amp;lt;dbl&amp;gt;
##  1     7 JFK                      23.8                    53.3             20.2 
##  2     6 EWR                      22.5                    50.8             16.9 
##  3     7 EWR                      22.0                    49.5             15.5 
##  4    12 EWR                      21.0                    45.7             19.6 
##  5     6 JFK                      20.5                    50.2             17.6 
##  6     6 LGA                      19.3                    53.6             14.8 
##  7     7 LGA                      19.0                    52.0             14.2 
##  8     3 EWR                      18.1                    44.1             10.6 
##  9     4 EWR                      17.4                    43.9             14.1 
## 10     5 EWR                      15.4                    39.0              5.38
## # ... with 26 more rows, and 2 more variables: atraso_pouso_desvpad &amp;lt;dbl&amp;gt;,
## #   n_voos &amp;lt;int&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;E a leitura fica:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Utilizando o banco de dados flights, agrupe as observa√ß√µes por m√™s e aeroporto de origem, ent√£o, calcule as m√©dias e desvios padr√£o dos atrasos no pouso e na decolagem e o n√∫mero de v√¥os para cada grupo, ent√£o, ordene os resultados pelo maior atraso.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;De quebra, voc√™ ainda leva para casa um dado no formato ‚Äútabela,‚Äù f√°cil de exportar para outros softwares para embelezamento e publica√ß√£o. Veja:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;resumo &amp;lt;- 
  flights %&amp;gt;% 
  group_by(month, origin) %&amp;gt;% 
  summarize(atraso_decolagem_medio = mean(dep_delay, na.rm = T),
            atraso_decolagem_desvpad = sd(dep_delay, na.rm = T),
            atraso_pouso_medio = mean(arr_delay, na.rm = T),
            atraso_pouso_desvpad = sd(arr_delay, na.rm = T),
            n_voos = n()) %&amp;gt;% 
  arrange(-atraso_decolagem_medio)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## `summarise()` has grouped output by &#39;month&#39;. You can override using the `.groups` argument.
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;print(resumo, n = Inf)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 36 x 7
## # Groups:   month [12]
##    month origin atraso_decolagem_medio atraso_decolagem_desvp~ atraso_pouso_med~
##    &amp;lt;int&amp;gt; &amp;lt;chr&amp;gt;                   &amp;lt;dbl&amp;gt;                   &amp;lt;dbl&amp;gt;             &amp;lt;dbl&amp;gt;
##  1     7 JFK                     23.8                     53.3            20.2  
##  2     6 EWR                     22.5                     50.8            16.9  
##  3     7 EWR                     22.0                     49.5            15.5  
##  4    12 EWR                     21.0                     45.7            19.6  
##  5     6 JFK                     20.5                     50.2            17.6  
##  6     6 LGA                     19.3                     53.6            14.8  
##  7     7 LGA                     19.0                     52.0            14.2  
##  8     3 EWR                     18.1                     44.1            10.6  
##  9     4 EWR                     17.4                     43.9            14.1  
## 10     5 EWR                     15.4                     39.0             5.38 
## 11     1 EWR                     14.9                     40.8            12.8  
## 12    12 JFK                     14.8                     39.1            12.7  
## 13    12 LGA                     13.6                     39.8            12.0  
## 14     8 EWR                     13.5                     37.6             6.71 
## 15     2 EWR                     13.1                     37.2             8.78 
## 16     8 JFK                     12.9                     36.3             5.91 
## 17     5 JFK                     12.5                     38.5             2.12 
## 18     4 JFK                     12.2                     41.2             7.01 
## 19     2 JFK                     11.8                     37.4             4.39 
## 20     4 LGA                     11.5                     43.4            12.0  
## 21     8 LGA                     11.2                     39.2             5.41 
## 22     3 JFK                     10.7                     35.3             2.58 
## 23     5 LGA                     10.6                     40.6             2.80 
## 24     3 LGA                     10.2                     39.7             3.74 
## 25    10 EWR                      8.64                    32.7             2.60 
## 26     1 JFK                      8.62                    36.0             1.37 
## 27     9 EWR                      7.29                    35.0            -4.73 
## 28     2 LGA                      6.96                    33.4             3.15 
## 29    11 EWR                      6.72                    28.8             0.672
## 30     9 JFK                      6.64                    32.5            -4.46 
## 31     9 LGA                      6.21                    39.0            -2.83 
## 32     1 LGA                      5.64                    29.7             3.38 
## 33    10 LGA                      5.31                    30.1             0.186
## 34    11 LGA                      4.77                    26.6             1.55 
## 35    11 JFK                      4.68                    27.1            -0.873
## 36    10 JFK                      4.59                    25.2            -3.59 
## # ... with 2 more variables: atraso_pouso_desvpad &amp;lt;dbl&amp;gt;, n_voos &amp;lt;int&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Lembrem-se que √© necess√°rio atribuir &lt;code&gt;&amp;lt;-&lt;/code&gt; os resultados das opera√ß√µes para que elas sejam salvas. Em geral, meu workflow √© assim:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;# Come√ßo com o banco
flights
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 336,776 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
##    &amp;lt;int&amp;gt; &amp;lt;int&amp;gt; &amp;lt;int&amp;gt;    &amp;lt;int&amp;gt;          &amp;lt;int&amp;gt;     &amp;lt;dbl&amp;gt;    &amp;lt;int&amp;gt;          &amp;lt;int&amp;gt;
##  1  2013     1     1      517            515         2      830            819
##  2  2013     1     1      533            529         4      850            830
##  3  2013     1     1      542            540         2      923            850
##  4  2013     1     1      544            545        -1     1004           1022
##  5  2013     1     1      554            600        -6      812            837
##  6  2013     1     1      554            558        -4      740            728
##  7  2013     1     1      555            600        -5      913            854
##  8  2013     1     1      557            600        -3      709            723
##  9  2013     1     1      557            600        -3      838            846
## 10  2013     1     1      558            600        -2      753            745
## # ... with 336,766 more rows, and 11 more variables: arr_delay &amp;lt;dbl&amp;gt;,
## #   carrier &amp;lt;chr&amp;gt;, flight &amp;lt;int&amp;gt;, tailnum &amp;lt;chr&amp;gt;, origin &amp;lt;chr&amp;gt;, dest &amp;lt;chr&amp;gt;,
## #   air_time &amp;lt;dbl&amp;gt;, distance &amp;lt;dbl&amp;gt;, hour &amp;lt;dbl&amp;gt;, minute &amp;lt;dbl&amp;gt;, time_hour &amp;lt;dttm&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;# Seleciono algumas vari√°veis
flights %&amp;gt;% 
  select(month, dep_delay, arr_delay)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 336,776 x 3
##    month dep_delay arr_delay
##    &amp;lt;int&amp;gt;     &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;
##  1     1         2        11
##  2     1         4        20
##  3     1         2        33
##  4     1        -1       -18
##  5     1        -6       -25
##  6     1        -4        12
##  7     1        -5        19
##  8     1        -3       -14
##  9     1        -3        -8
## 10     1        -2         8
## # ... with 336,766 more rows
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;# Recorto algumas observa√ß√µes
flights %&amp;gt;% 
  select(month, dep_delay, arr_delay) %&amp;gt;% 
  filter(between(month, 1, 6))
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 166,158 x 3
##    month dep_delay arr_delay
##    &amp;lt;int&amp;gt;     &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;
##  1     1         2        11
##  2     1         4        20
##  3     1         2        33
##  4     1        -1       -18
##  5     1        -6       -25
##  6     1        -4        12
##  7     1        -5        19
##  8     1        -3       -14
##  9     1        -3        -8
## 10     1        -2         8
## # ... with 166,148 more rows
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;# Escolho os dominios e calculo as medidas resumo
flights %&amp;gt;% 
  select(month, dep_delay, arr_delay) %&amp;gt;% 
  filter(between(month, 1, 6)) %&amp;gt;% 
  group_by(month) %&amp;gt;% 
  summarise(atraso_dec_medio = mean(dep_delay, na.rm = T),
            atraso_pou_medio = mean(arr_delay, na.rm = T))
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 6 x 3
##   month atraso_dec_medio atraso_pou_medio
##   &amp;lt;int&amp;gt;            &amp;lt;dbl&amp;gt;            &amp;lt;dbl&amp;gt;
## 1     1             10.0             6.13
## 2     2             10.8             5.61
## 3     3             13.2             5.81
## 4     4             13.9            11.2 
## 5     5             13.0             3.52
## 6     6             20.8            16.5
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;# Acho bom organizar pelos atrasos maiores
flights %&amp;gt;% 
  select(month, dep_delay, arr_delay) %&amp;gt;% 
  filter(between(month, 1, 6)) %&amp;gt;% 
  group_by(month) %&amp;gt;% 
  summarise(atraso_dec_medio = mean(dep_delay, na.rm = T),
            atraso_pou_medio = mean(arr_delay, na.rm = T)) %&amp;gt;% 
  arrange(-atraso_dec_medio, -atraso_pou_medio)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 6 x 3
##   month atraso_dec_medio atraso_pou_medio
##   &amp;lt;int&amp;gt;            &amp;lt;dbl&amp;gt;            &amp;lt;dbl&amp;gt;
## 1     6             20.8            16.5 
## 2     4             13.9            11.2 
## 3     3             13.2             5.81
## 4     5             13.0             3.52
## 5     2             10.8             5.61
## 6     1             10.0             6.13
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;# Estou satisfeito, salvo meu resultado em outro objeto
atrasos &amp;lt;- 
  flights %&amp;gt;% 
  select(month, dep_delay, arr_delay) %&amp;gt;% 
  filter(between(month, 1, 6)) %&amp;gt;% 
  group_by(month) %&amp;gt;% 
  summarise(atraso_dec_medio = mean(dep_delay, na.rm = T),
            atraso_pou_medio = mean(arr_delay, na.rm = T)) %&amp;gt;% 
  arrange(-atraso_dec_medio, -atraso_pou_medio)

atrasos
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 6 x 3
##   month atraso_dec_medio atraso_pou_medio
##   &amp;lt;int&amp;gt;            &amp;lt;dbl&amp;gt;            &amp;lt;dbl&amp;gt;
## 1     6             20.8            16.5 
## 2     4             13.9            11.2 
## 3     3             13.2             5.81
## 4     5             13.0             3.52
## 5     2             10.8             5.61
## 6     1             10.0             6.13
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Desta forma, consigo construir interativamente meus c√°lculos, verificando a cada passo se estou obtendo o resultado esperado. Visto de outra perspectiva, se encontro um c√≥digo programado desta forma que n√£o funciona, posso ir apagando cada &lt;code&gt;%&amp;gt;%&lt;/code&gt; para identificar onde o problema ocorreu.&lt;/p&gt;
&lt;p&gt;Espero que tenha ficado claro que o assunto n√£o se encerra por aqui. Existem diversas outras fun√ß√µes √∫teis no pacote, como &lt;code&gt;count&lt;/code&gt;, &lt;code&gt;if_else&lt;/code&gt;, &lt;code&gt;case_when&lt;/code&gt;, &lt;code&gt;top_n&lt;/code&gt;, &lt;code&gt;bind_rows&lt;/code&gt;, &lt;code&gt;bind_cols&lt;/code&gt;, as novas fun√ß√µes &lt;code&gt;across&lt;/code&gt; e &lt;code&gt;c_across&lt;/code&gt; e muitas, muitas outras. Nos livros voc√™s encontram v√°rios outros exemplos e fun√ß√µes para facilitar o processo de an√°lise de dados, mas nossa expectativa √© que essa apresenta√ß√£o seja um ponto de partida para voc√™s se aprofundarem no seu pr√≥prio ritmo.&lt;/p&gt;
&lt;h3 id=&#34;dplyr-para-bancos-de-dados-relacionais&#34;&gt;&lt;code&gt;dplyr&lt;/code&gt; para bancos de dados relacionais&lt;/h3&gt;
&lt;p&gt;Nesta se√ß√£o, o nosso problema n√£o √© mais a an√°lise de dados presentes em um banco, mas o problema de relacionar informa√ß√µes sobre uma mesma unidade de an√°lise que est√£o presentes em v√°rios bancos de dados distintos.&lt;/p&gt;
&lt;p&gt;O banco &lt;code&gt;nycflights13&lt;/code&gt; cont√©m v√°rias tabelas que se relacionam, e elas funcionam como um excelente exemplo de banco de dados relacionais.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://laddem.github.io/courses/tidyverse/dia2_files/relational-nycflights.png&#34; alt=&#34;Banco de dados relacional&#34;&gt;&lt;/p&gt;
&lt;p&gt;Note que al√©m do banco de dados dos v√¥os, temos informa√ß√µes sobre clima, avi√µes e companhias a√©reas. Para n√≥s, pode ser relevante reunir informa√ß√µes de diferentes fontes em um mesmo banco de dados, algo que √© poss√≠vel atrav√©s de &lt;code&gt;joins&lt;/code&gt;. Por uma quest√£o de tempo, n√£o vamos entrar muito a fundo no assunto, mas vamos introduzir dois conceitos chave e partir pros exemplos.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;chaves&lt;/code&gt; s√£o as vari√°veis que identificam cada observa√ß√£o em um banco de dados de forma √∫nica. Uma chave √© dita ‚Äúprim√°ria‚Äù quando identifica uma observa√ß√£o na sua pr√≥pria tabela e ‚Äúexterna‚Äù quando ela identifica uma observa√ß√£o em outra tabela. Assim, qualquer opera√ß√£o de join √© uma forma de relacionar uma chave &lt;strong&gt;prim√°ria&lt;/strong&gt; e uma chave &lt;strong&gt;externa&lt;/strong&gt;. Essa jun√ß√£o de chaves √© uma &lt;strong&gt;rela√ß√£o&lt;/strong&gt;, e as rela√ß√µes podem ser &lt;strong&gt;1 para 1&lt;/strong&gt;, &lt;strong&gt;1 para muitos&lt;/strong&gt; ou &lt;strong&gt;muitos para 1&lt;/strong&gt;.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;joins&lt;/code&gt; s√£o tipos de opera√ß√£o no qual se opta por priorizar um grupo de observa√ß√µes em detrimento de outras. Podemos v√™-los didaticamente a partir de duas figuras:&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img src=&#34;https://laddem.github.io/courses/tidyverse/dia2_files/join-venn.png&#34; alt=&#34;Joins como diagrama de Venn&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://laddem.github.io/courses/tidyverse/dia2_files/join-outer.png&#34; alt=&#34;Join como ‚Äúpontos‚Äù&#34;&gt;&lt;/p&gt;
&lt;p&gt;A primeira figura √© interessante porque nos d√° uma ideia de quais observa√ß√µes ser√£o mantidas e quais ser√£o descartadas, podemos imagin√°-la como uma abstra√ß√£o da nossa escolha.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Quero todas as informa√ß√µes sobre os v√¥os e os aeroportos, e as duas s√£o igualmente importantes (inner_join, x = flights, y = airports).&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;Quero todas as observa√ß√µes do banco v√¥os e as informa√ß√µes dispon√≠veis sobre a aeronave (left_join, x = flights, y = planes).&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;Quero todas as informa√ß√µes tanto sobre os v√¥os quanto sobre o clima em cada dia (full_join, x = flights, y = weather).&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;Quero as informa√ß√µes dos v√¥os realizados pelas companhias a√©reas - minha prioridade s√£o as cias. √°reas (right_join, x = flights, y = carriers).&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;A segunda figura √© interessante porque elas mostra a mec√¢nica de um &lt;code&gt;join&lt;/code&gt;: cada observa√ß√£o tem a sua chave marcada com a observa√ß√£o correspondente no outro banco. Se as chaves s√£o iguais, a opera√ß√£o √© realizada, se as chaves n√£o s√£o iguais, a opera√ß√£o n√£o √© realizada. Dependendo do tipo de &lt;code&gt;join&lt;/code&gt;, uma, as duas ou nenhuma das observa√ß√µes √© descartada do banco resultante.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Antes de come√ßar a trabalhar com bancos relacionais, √© uma boa ideia dar uma explorada nas chaves, vendo suas contagens, se h√° erros de digita√ß√£o, etc. Por uma quest√£o de tempo, vamos pular essa fase.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Se as nossas chaves forem perfeitinhas, e inclusive tiverem o mesmo nome nas duas tabelas, basta invocar o tipo de join desejado.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;# Vamos dar uma enxugada no flights para poder ver o efeito dos joins com maior facilidade.
flights2 &amp;lt;- flights %&amp;gt;% 
  select(year:day, hour, origin, dest, tailnum, carrier)

flights2
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 336,776 x 8
##     year month   day  hour origin dest  tailnum carrier
##    &amp;lt;int&amp;gt; &amp;lt;int&amp;gt; &amp;lt;int&amp;gt; &amp;lt;dbl&amp;gt; &amp;lt;chr&amp;gt;  &amp;lt;chr&amp;gt; &amp;lt;chr&amp;gt;   &amp;lt;chr&amp;gt;  
##  1  2013     1     1     5 EWR    IAH   N14228  UA     
##  2  2013     1     1     5 LGA    IAH   N24211  UA     
##  3  2013     1     1     5 JFK    MIA   N619AA  AA     
##  4  2013     1     1     5 JFK    BQN   N804JB  B6     
##  5  2013     1     1     6 LGA    ATL   N668DN  DL     
##  6  2013     1     1     5 EWR    ORD   N39463  UA     
##  7  2013     1     1     6 EWR    FLL   N516JB  B6     
##  8  2013     1     1     6 LGA    IAD   N829AS  EV     
##  9  2013     1     1     6 JFK    MCO   N593JB  B6     
## 10  2013     1     1     6 LGA    ORD   N3ALAA  AA     
## # ... with 336,766 more rows
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;# Chaves perfeitas, mesmo nome nos dois bancos = natural join
flights2 %&amp;gt;% left_join(weather) # Moleza
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## Joining, by = c(&amp;quot;year&amp;quot;, &amp;quot;month&amp;quot;, &amp;quot;day&amp;quot;, &amp;quot;hour&amp;quot;, &amp;quot;origin&amp;quot;)

## # A tibble: 336,776 x 18
##     year month   day  hour origin dest  tailnum carrier  temp  dewp humid
##    &amp;lt;int&amp;gt; &amp;lt;int&amp;gt; &amp;lt;int&amp;gt; &amp;lt;dbl&amp;gt; &amp;lt;chr&amp;gt;  &amp;lt;chr&amp;gt; &amp;lt;chr&amp;gt;   &amp;lt;chr&amp;gt;   &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt;
##  1  2013     1     1     5 EWR    IAH   N14228  UA       39.0  28.0  64.4
##  2  2013     1     1     5 LGA    IAH   N24211  UA       39.9  25.0  54.8
##  3  2013     1     1     5 JFK    MIA   N619AA  AA       39.0  27.0  61.6
##  4  2013     1     1     5 JFK    BQN   N804JB  B6       39.0  27.0  61.6
##  5  2013     1     1     6 LGA    ATL   N668DN  DL       39.9  25.0  54.8
##  6  2013     1     1     5 EWR    ORD   N39463  UA       39.0  28.0  64.4
##  7  2013     1     1     6 EWR    FLL   N516JB  B6       37.9  28.0  67.2
##  8  2013     1     1     6 LGA    IAD   N829AS  EV       39.9  25.0  54.8
##  9  2013     1     1     6 JFK    MCO   N593JB  B6       37.9  27.0  64.3
## 10  2013     1     1     6 LGA    ORD   N3ALAA  AA       39.9  25.0  54.8
## # ... with 336,766 more rows, and 7 more variables: wind_dir &amp;lt;dbl&amp;gt;,
## #   wind_speed &amp;lt;dbl&amp;gt;, wind_gust &amp;lt;dbl&amp;gt;, precip &amp;lt;dbl&amp;gt;, pressure &amp;lt;dbl&amp;gt;,
## #   visib &amp;lt;dbl&amp;gt;, time_hour &amp;lt;dttm&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;flights2 %&amp;gt;% left_join(airlines) # Moleza
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## Joining, by = &amp;quot;carrier&amp;quot;

## # A tibble: 336,776 x 9
##     year month   day  hour origin dest  tailnum carrier name                    
##    &amp;lt;int&amp;gt; &amp;lt;int&amp;gt; &amp;lt;int&amp;gt; &amp;lt;dbl&amp;gt; &amp;lt;chr&amp;gt;  &amp;lt;chr&amp;gt; &amp;lt;chr&amp;gt;   &amp;lt;chr&amp;gt;   &amp;lt;chr&amp;gt;                   
##  1  2013     1     1     5 EWR    IAH   N14228  UA      United Air Lines Inc.   
##  2  2013     1     1     5 LGA    IAH   N24211  UA      United Air Lines Inc.   
##  3  2013     1     1     5 JFK    MIA   N619AA  AA      American Airlines Inc.  
##  4  2013     1     1     5 JFK    BQN   N804JB  B6      JetBlue Airways         
##  5  2013     1     1     6 LGA    ATL   N668DN  DL      Delta Air Lines Inc.    
##  6  2013     1     1     5 EWR    ORD   N39463  UA      United Air Lines Inc.   
##  7  2013     1     1     6 EWR    FLL   N516JB  B6      JetBlue Airways         
##  8  2013     1     1     6 LGA    IAD   N829AS  EV      ExpressJet Airlines Inc.
##  9  2013     1     1     6 JFK    MCO   N593JB  B6      JetBlue Airways         
## 10  2013     1     1     6 LGA    ORD   N3ALAA  AA      American Airlines Inc.  
## # ... with 336,766 more rows
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;# Chaves perfeitas, mas h√° vari√°veis nos dois bancos com o mesmo nome e que n√£o s√£o chaves
# √â necess√°rio especificar qual a chave
flights2 %&amp;gt;% left_join(planes, by = &amp;quot;tailnum&amp;quot;)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 336,776 x 16
##    year.x month   day  hour origin dest  tailnum carrier year.y type            
##     &amp;lt;int&amp;gt; &amp;lt;int&amp;gt; &amp;lt;int&amp;gt; &amp;lt;dbl&amp;gt; &amp;lt;chr&amp;gt;  &amp;lt;chr&amp;gt; &amp;lt;chr&amp;gt;   &amp;lt;chr&amp;gt;    &amp;lt;int&amp;gt; &amp;lt;chr&amp;gt;           
##  1   2013     1     1     5 EWR    IAH   N14228  UA        1999 Fixed wing mult~
##  2   2013     1     1     5 LGA    IAH   N24211  UA        1998 Fixed wing mult~
##  3   2013     1     1     5 JFK    MIA   N619AA  AA        1990 Fixed wing mult~
##  4   2013     1     1     5 JFK    BQN   N804JB  B6        2012 Fixed wing mult~
##  5   2013     1     1     6 LGA    ATL   N668DN  DL        1991 Fixed wing mult~
##  6   2013     1     1     5 EWR    ORD   N39463  UA        2012 Fixed wing mult~
##  7   2013     1     1     6 EWR    FLL   N516JB  B6        2000 Fixed wing mult~
##  8   2013     1     1     6 LGA    IAD   N829AS  EV        1998 Fixed wing mult~
##  9   2013     1     1     6 JFK    MCO   N593JB  B6        2004 Fixed wing mult~
## 10   2013     1     1     6 LGA    ORD   N3ALAA  AA          NA &amp;lt;NA&amp;gt;            
## # ... with 336,766 more rows, and 6 more variables: manufacturer &amp;lt;chr&amp;gt;,
## #   model &amp;lt;chr&amp;gt;, engines &amp;lt;int&amp;gt;, seats &amp;lt;int&amp;gt;, speed &amp;lt;int&amp;gt;, engine &amp;lt;chr&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Veja que tanto &lt;code&gt;flights2&lt;/code&gt; quanto &lt;code&gt;planes&lt;/code&gt; tem uma vari√°vel chamada &lt;code&gt;year&lt;/code&gt;, mas elas significados diferentes. Em &lt;code&gt;flights2&lt;/code&gt; √© o ano do v√¥o, enquanto em &lt;code&gt;planes&lt;/code&gt; √© o ano em que a aeronave entra em servi√ßo. Na hora que fazemos o join, uma recebe o sufixo ‚Äúx‚Äù e a outra ‚Äúy‚Äù para a indicar a diferen√ßa. Voc√™ pode especificar o sufixo desejado para evitar confus√£o:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;flights2 %&amp;gt;% left_join(planes, by = &amp;quot;tailnum&amp;quot;, suffix = c(&amp;quot;_flight&amp;quot;, &amp;quot;_entered_service&amp;quot;))
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 336,776 x 16
##    year_flight month   day  hour origin dest  tailnum carrier year_entered_serv~
##          &amp;lt;int&amp;gt; &amp;lt;int&amp;gt; &amp;lt;int&amp;gt; &amp;lt;dbl&amp;gt; &amp;lt;chr&amp;gt;  &amp;lt;chr&amp;gt; &amp;lt;chr&amp;gt;   &amp;lt;chr&amp;gt;                &amp;lt;int&amp;gt;
##  1        2013     1     1     5 EWR    IAH   N14228  UA                    1999
##  2        2013     1     1     5 LGA    IAH   N24211  UA                    1998
##  3        2013     1     1     5 JFK    MIA   N619AA  AA                    1990
##  4        2013     1     1     5 JFK    BQN   N804JB  B6                    2012
##  5        2013     1     1     6 LGA    ATL   N668DN  DL                    1991
##  6        2013     1     1     5 EWR    ORD   N39463  UA                    2012
##  7        2013     1     1     6 EWR    FLL   N516JB  B6                    2000
##  8        2013     1     1     6 LGA    IAD   N829AS  EV                    1998
##  9        2013     1     1     6 JFK    MCO   N593JB  B6                    2004
## 10        2013     1     1     6 LGA    ORD   N3ALAA  AA                      NA
## # ... with 336,766 more rows, and 7 more variables: type &amp;lt;chr&amp;gt;,
## #   manufacturer &amp;lt;chr&amp;gt;, model &amp;lt;chr&amp;gt;, engines &amp;lt;int&amp;gt;, seats &amp;lt;int&amp;gt;, speed &amp;lt;int&amp;gt;,
## #   engine &amp;lt;chr&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Um aviso: cuidado com os produtos cartesianos. N√£o h√° um bom exemplo aqui no caso do &lt;code&gt;flights&lt;/code&gt; porque o banco j√° est√° limpinho, mas se voc√™ especificar chaves com uma rela√ß√£o ‚Äúmuitos para muitos,‚Äù ele vai registrar no banco novo uma linha para cada combina√ß√£o poss√≠vel de vari√°veis. Em bancos maiores, isso geralmente estoura sua mem√≥ria e trava o R. Veja este pequeno exemplo de brinquedo.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;x &amp;lt;- tribble(
  ~key, ~val_x,
     1, &amp;quot;x1&amp;quot;,
     2, &amp;quot;x2&amp;quot;,
     2, &amp;quot;x3&amp;quot;,
     3, &amp;quot;x4&amp;quot;
)
y &amp;lt;- tribble(
  ~key, ~val_y,
     1, &amp;quot;y1&amp;quot;,
     2, &amp;quot;y2&amp;quot;,
     2, &amp;quot;y3&amp;quot;,
     3, &amp;quot;y4&amp;quot;
)
left_join(x, y, by = &amp;quot;key&amp;quot;)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 6 x 3
##     key val_x val_y
##   &amp;lt;dbl&amp;gt; &amp;lt;chr&amp;gt; &amp;lt;chr&amp;gt;
## 1     1 x1    y1   
## 2     2 x2    y2   
## 3     2 x2    y3   
## 4     2 x3    y2   
## 5     2 x3    y3   
## 6     3 x4    y4
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Veja que no resultado foi criada uma linha para cada combina√ß√£o de val_x e val_y que tem a mesma chave repetida. Podem at√© existir situa√ß√µes em que isso seja o que voc√™ quer mesmo, mas na minha experi√™ncia at√© o momento isso √© problema com as chaves duplicadas e √© sinal de que h√° algo errado.&lt;/p&gt;
&lt;p&gt;Mas pera√≠, se voc√™ falou que tem 4 tipos de join, porque s√≥ d√° exemplo de &lt;code&gt;left_join&lt;/code&gt;?&lt;/p&gt;
&lt;p&gt;Na pr√°tica, opera√ß√µes relacionais s√£o feitas de forma intencional: escolhemos bancos de dados de acordo com o valor que atribu√≠mos a informa√ß√£o presente nele e pin√ßamos informa√ß√µes relacionadas de outros lugares para adicionar aquilo que √© nosso foco. Por isso, na maioria dos casos, o &lt;code&gt;left_join&lt;/code&gt; √© o mais usual, porque &lt;strong&gt;preserva todas as informa√ß√µes do meu banco x e adiciona apenas as informa√ß√µes do banco y que combinaram com sucesso&lt;/strong&gt;. Isso garante que eu n√£o vou perder nenhuma informa√ß√£o do meu banco principal.&lt;/p&gt;
&lt;p&gt;Pra encerrar essa parte, mais exemplos de &lt;code&gt;joins&lt;/code&gt;.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;# Minhas chaves tem nomes diferentes, ent√£o uso um vetor do tipo c(&amp;quot;chave_x&amp;quot; = &amp;quot;chave_y&amp;quot;)
flights2 %&amp;gt;% 
  left_join(airports, c(&amp;quot;dest&amp;quot; = &amp;quot;faa&amp;quot;))
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 336,776 x 15
##     year month   day  hour origin dest  tailnum carrier name     lat   lon   alt
##    &amp;lt;int&amp;gt; &amp;lt;int&amp;gt; &amp;lt;int&amp;gt; &amp;lt;dbl&amp;gt; &amp;lt;chr&amp;gt;  &amp;lt;chr&amp;gt; &amp;lt;chr&amp;gt;   &amp;lt;chr&amp;gt;   &amp;lt;chr&amp;gt;  &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt;
##  1  2013     1     1     5 EWR    IAH   N14228  UA      Georg~  30.0 -95.3    97
##  2  2013     1     1     5 LGA    IAH   N24211  UA      Georg~  30.0 -95.3    97
##  3  2013     1     1     5 JFK    MIA   N619AA  AA      Miami~  25.8 -80.3     8
##  4  2013     1     1     5 JFK    BQN   N804JB  B6      &amp;lt;NA&amp;gt;    NA    NA      NA
##  5  2013     1     1     6 LGA    ATL   N668DN  DL      Harts~  33.6 -84.4  1026
##  6  2013     1     1     5 EWR    ORD   N39463  UA      Chica~  42.0 -87.9   668
##  7  2013     1     1     6 EWR    FLL   N516JB  B6      Fort ~  26.1 -80.2     9
##  8  2013     1     1     6 LGA    IAD   N829AS  EV      Washi~  38.9 -77.5   313
##  9  2013     1     1     6 JFK    MCO   N593JB  B6      Orlan~  28.4 -81.3    96
## 10  2013     1     1     6 LGA    ORD   N3ALAA  AA      Chica~  42.0 -87.9   668
## # ... with 336,766 more rows, and 3 more variables: tz &amp;lt;dbl&amp;gt;, dst &amp;lt;chr&amp;gt;,
## #   tzone &amp;lt;chr&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;# Mesma coisa, s√≥ que agora juntando as informa√ß√µes da origem ao inv√©s do destino
flights2 %&amp;gt;% 
  left_join(airports, c(&amp;quot;origin&amp;quot; = &amp;quot;faa&amp;quot;))
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 336,776 x 15
##     year month   day  hour origin dest  tailnum carrier name     lat   lon   alt
##    &amp;lt;int&amp;gt; &amp;lt;int&amp;gt; &amp;lt;int&amp;gt; &amp;lt;dbl&amp;gt; &amp;lt;chr&amp;gt;  &amp;lt;chr&amp;gt; &amp;lt;chr&amp;gt;   &amp;lt;chr&amp;gt;   &amp;lt;chr&amp;gt;  &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt;
##  1  2013     1     1     5 EWR    IAH   N14228  UA      Newar~  40.7 -74.2    18
##  2  2013     1     1     5 LGA    IAH   N24211  UA      La Gu~  40.8 -73.9    22
##  3  2013     1     1     5 JFK    MIA   N619AA  AA      John ~  40.6 -73.8    13
##  4  2013     1     1     5 JFK    BQN   N804JB  B6      John ~  40.6 -73.8    13
##  5  2013     1     1     6 LGA    ATL   N668DN  DL      La Gu~  40.8 -73.9    22
##  6  2013     1     1     5 EWR    ORD   N39463  UA      Newar~  40.7 -74.2    18
##  7  2013     1     1     6 EWR    FLL   N516JB  B6      Newar~  40.7 -74.2    18
##  8  2013     1     1     6 LGA    IAD   N829AS  EV      La Gu~  40.8 -73.9    22
##  9  2013     1     1     6 JFK    MCO   N593JB  B6      John ~  40.6 -73.8    13
## 10  2013     1     1     6 LGA    ORD   N3ALAA  AA      La Gu~  40.8 -73.9    22
## # ... with 336,766 more rows, and 3 more variables: tz &amp;lt;dbl&amp;gt;, dst &amp;lt;chr&amp;gt;,
## #   tzone &amp;lt;chr&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;O assunto, obviamente, n√£o p√°ra por a√≠. Nos livros voc√™s encontrar√£o mais exemplos e fun√ß√µes, como √© o caso do &lt;code&gt;semi_join&lt;/code&gt; e do &lt;code&gt;anti_join&lt;/code&gt; e das opera√ß√µes ‚Äúset,‚Äù &lt;code&gt;intersect&lt;/code&gt;, &lt;code&gt;union&lt;/code&gt; e &lt;code&gt;setdiff&lt;/code&gt;, mas isso fica pra voc√™s explorarem por conta pr√≥pria e virem tirar as d√∫vidas depois!&lt;/p&gt;
&lt;h2 id=&#34;stringr&#34;&gt;&lt;code&gt;stringr&lt;/code&gt;&lt;/h2&gt;
&lt;p&gt;&lt;code&gt;stringr&lt;/code&gt; cont√©m uma fam√≠lia de fun√ß√µes, todas come√ßadas em &lt;code&gt;str_&lt;/code&gt;, cuja principal preocupa√ß√£o √© a &lt;strong&gt;consist√™ncia&lt;/strong&gt;. As fun√ß√µes do &lt;code&gt;base&lt;/code&gt; para strings s√£o muito √∫teis, por√©m, seus argumentos est√£o numa ordem um pouco estranha, algumas fun√ß√µes s√£o vetorizadas e outras n√£o. Quando voc√™ se acostuma, at√© que n√£o √© t√£o ruim, mas voltando para o assunto discutido ontem de tornar o seu c√≥digo mais leg√≠vel, √© interessante ter a simplicidade oferecida.&lt;/p&gt;
&lt;h3 id=&#34;basic√£o-da-string&#34;&gt;Basic√£o da string&lt;/h3&gt;
&lt;p&gt;Como este curso j√° √© pra praticantes de R, vou pular algumas coisas muito b√°sicas de string, vamos ao que interessa.&lt;/p&gt;
&lt;p&gt;Determinados caracteres tem um significado especial dentro das strings. Quem j√° tentou copiar e colar um caminho de arquivo do Windows pro R sabe disso. Ent√£o, nesses casos, √© precisar ‚Äúescapar‚Äù caracteres. Por exemplo, se voc√™ quiser escrever aspas, voc√™ usar a contrabarra &lt;code&gt;\&lt;/code&gt; para ‚Äúescapar‚Äù um caractere.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;aspa_simples &amp;lt;- &#39;\&#39;&#39; # ou &amp;quot;&#39;&amp;quot;
aspa_dupla &amp;lt;- &amp;quot;\&amp;quot;&amp;quot; # ou &#39;&amp;quot;&#39;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;A regra do escape √© simples, ent√£o se voc√™ quiser colocar uma contrabarra &lt;code&gt;\&lt;/code&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;x &amp;lt;- c(&amp;quot;\\&amp;quot;, &amp;quot;\&amp;quot;&amp;quot;)
x
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] &amp;quot;\\&amp;quot; &amp;quot;\&amp;quot;&amp;quot;
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;writeLines(x)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## \
## &amp;quot;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Outros caracteres especiais √∫teis: &lt;code&gt;&amp;quot;\n&amp;quot;&lt;/code&gt; para pular uma linha, &lt;code&gt;\t&lt;/code&gt; para Tab. Voc√™ pode ver os outros na ajuda das aspas &lt;code&gt;&amp;quot;&lt;/code&gt;, basta digitar no console &lt;code&gt;?&amp;quot;&#39;&amp;quot;&lt;/code&gt; ou &lt;code&gt;?&#39;&amp;quot;&#39;&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Outra coisa que d√° pra fazer, se voc√™ precisar incluir um caractere distinto, √© usar unicode:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;x &amp;lt;- &amp;quot;\u00b5&amp;quot;
x
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] &amp;quot;¬µ&amp;quot;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Ok, mas e o pacote &lt;code&gt;stringr&lt;/code&gt;? Bem, ele tem o intuito de facilitar e dar consist√™ncia, ent√£o, todas as fun√ß√µes do pacote come√ßam com as iniciais &lt;code&gt;str_&lt;/code&gt; justamente para serem utilizadas com o &lt;strong&gt;autocompletar&lt;/strong&gt; do RStudio, que pode ser acessada com os atalhos &lt;code&gt;Ctrl + Espa√ßo&lt;/code&gt; ou &lt;code&gt;Tab&lt;/code&gt;. Vamos ver agora alguns exemplos de fun√ß√µes do pacote.&lt;/p&gt;
&lt;p&gt;Comprimento da string em caracteres:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;library(stringr)

# No RStudio, basta digitar &#39;str_&#39; e apertar Tab ou Ctrl + Espa√ßo
x &amp;lt;- &amp;quot;Ministro Sinistro&amp;quot;
str_length(x)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] 17
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;x &amp;lt;- c(&amp;quot;Ministro Sinistro&amp;quot;, &amp;quot;Abelha Gulosa&amp;quot;, &amp;quot;p&amp;quot;)
str_length(x)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] 17 13  1
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Concatena√ß√£o de strings:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;str_c(&amp;quot;x&amp;quot;, &amp;quot;y&amp;quot;, &amp;quot;z&amp;quot;)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] &amp;quot;xyz&amp;quot;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Use o argumento &lt;code&gt;sep&lt;/code&gt; para definir caracteres que aparecer√£o entre as strings originais:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;str_c(&amp;quot;x&amp;quot;, &amp;quot;y&amp;quot;, &amp;quot;z&amp;quot;, sep = &amp;quot; + &amp;quot;)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] &amp;quot;x + y + z&amp;quot;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Voc√™ pode trabalhar com strings que cont√©m &lt;code&gt;NA&lt;/code&gt;s:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;x &amp;lt;- c(&amp;quot;abc&amp;quot;, NA)
str_c(&amp;quot;|-&amp;quot;, x, &amp;quot;-|&amp;quot;)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] &amp;quot;|-abc-|&amp;quot; NA
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;str_c(&amp;quot;|-&amp;quot;, str_replace_na(x), &amp;quot;-|&amp;quot;)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] &amp;quot;|-abc-|&amp;quot; &amp;quot;|-NA-|&amp;quot;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;code&gt;str_c&lt;/code&gt; √© uma fun√ß√£o vetorizada e automaticamente recicla seus argumentos pra ter o tamanho do maior:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;# Eu na gradua√ß√£o
str_c(&amp;quot;Profe, me d√° mais &amp;quot;, c(&amp;quot;1&amp;quot;, &amp;quot;2&amp;quot;, &amp;quot;3&amp;quot;), &amp;quot; semanas pra entregar, por favor!&amp;quot;)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] &amp;quot;Profe, me d√° mais 1 semanas pra entregar, por favor!&amp;quot;
## [2] &amp;quot;Profe, me d√° mais 2 semanas pra entregar, por favor!&amp;quot;
## [3] &amp;quot;Profe, me d√° mais 3 semanas pra entregar, por favor!&amp;quot;
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;# Eu de manh√£
str_c(&amp;quot;S√≥ mais &amp;quot;, c(&amp;quot;5&amp;quot;, &amp;quot;10&amp;quot;, &amp;quot;20&amp;quot;, &amp;quot;30&amp;quot;), &amp;quot; minutinhos e eu acordo!&amp;quot;)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] &amp;quot;S√≥ mais 5 minutinhos e eu acordo!&amp;quot;  &amp;quot;S√≥ mais 10 minutinhos e eu acordo!&amp;quot;
## [3] &amp;quot;S√≥ mais 20 minutinhos e eu acordo!&amp;quot; &amp;quot;S√≥ mais 30 minutinhos e eu acordo!&amp;quot;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Se algum dos objetos passados para &lt;code&gt;str_c&lt;/code&gt; tiver tamanho 0, ele √© descartado. √ötil para usar com testes l√≥gicos.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;nome &amp;lt;- &amp;quot;Vinicius&amp;quot;
sobrenome &amp;lt;- &amp;quot;Maia&amp;quot;
tem_nome_do_meio &amp;lt;- FALSE

str_c(
  &amp;quot;Meu nome √© &amp;quot;, nome, &amp;quot; &amp;quot;,
  # isso aqui retorna um vetor tamanho 0
  if (tem_nome_do_meio) &amp;quot; de Souza&amp;quot;, 
  sobrenome,
  &amp;quot;.&amp;quot;
)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] &amp;quot;Meu nome √© Vinicius Maia.&amp;quot;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Conhecedores de &lt;code&gt;paste&lt;/code&gt; reconhecer√£o o argumento &lt;code&gt;collapse&lt;/code&gt;, que serve para transformar vetores de strings em uma √∫nica string.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;str_c(c(&amp;quot;Nat√°lia&amp;quot;, &amp;quot;Martins&amp;quot;, &amp;quot;Arruda&amp;quot;), collapse = &amp;quot; &amp;quot;)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] &amp;quot;Nat√°lia Martins Arruda&amp;quot;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;De forma similar, conhecedores de &lt;code&gt;substring&lt;/code&gt; dever√£o imediatamente reconhecer essa:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;x &amp;lt;- c(&amp;quot;Ma√ß√£&amp;quot;, &amp;quot;Banana&amp;quot;, &amp;quot;Abacaxi&amp;quot;)
str_sub(x, 1, 3)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] &amp;quot;Ma√ß&amp;quot; &amp;quot;Ban&amp;quot; &amp;quot;Aba&amp;quot;
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;str_sub(x, -3, -1)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] &amp;quot;a√ß√£&amp;quot; &amp;quot;ana&amp;quot; &amp;quot;axi&amp;quot;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;code&gt;str_sub&lt;/code&gt; n√£o vai dar erro se a string for muito curta:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;str_sub(&amp;quot;a&amp;quot;, 1, 5)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] &amp;quot;a&amp;quot;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;D√° pra usar a forma &lt;code&gt;str_sub(x) &amp;lt;-&lt;/code&gt; para modificar partes de strings&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;str_sub(x, 1, 1) &amp;lt;- str_to_lower(str_sub(x, 1, 1))
x
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] &amp;quot;ma√ß√£&amp;quot;    &amp;quot;banana&amp;quot;  &amp;quot;abacaxi&amp;quot;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Note o uso de &lt;code&gt;str_to_lower&lt;/code&gt; para mudar para min√∫sculas. O contr√°rio √© &lt;code&gt;str_to_upper&lt;/code&gt;, tamb√©m h√° uma para t√≠tulos, &lt;code&gt;str_to_title&lt;/code&gt;, e para a primeira letra de uma frase, &lt;code&gt;str_to_sentence&lt;/code&gt;.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;x &amp;lt;- &amp;quot;Ministro Sinistro&amp;quot;

str_to_lower(x)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] &amp;quot;ministro sinistro&amp;quot;
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;str_to_upper(x)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] &amp;quot;MINISTRO SINISTRO&amp;quot;
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;str_to_sentence(x)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] &amp;quot;Ministro sinistro&amp;quot;
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;str_to_title(x)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] &amp;quot;Ministro Sinistro&amp;quot;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Como vimos no &lt;code&gt;readr&lt;/code&gt;, algumas quest√µes relacionadas a strings dependem da l√≠ngua, ou, na linguagem do pacote, s√£o ‚Äúlocale dependent.‚Äù Por isso nas fun√ß√µes onde isso √© relevante, o argumento se chama &lt;code&gt;locale&lt;/code&gt;. Isso n√£o √© super relevante para quem trabalha com o ingl√™s ou as l√≠nguas do oeste europeu, considerando que a maioria das l√≠nguas tem ra√≠zes similares, mas pode ser muito importante para outros idiomas. Vejamos este exemplo com a mudan√ßa da ordem das strings.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;x &amp;lt;- c(&amp;quot;abacaxi&amp;quot;, &amp;quot;escarola&amp;quot;, &amp;quot;banana&amp;quot;)

str_sort(x, locale = &amp;quot;en&amp;quot;)  # Ingl√™s
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] &amp;quot;abacaxi&amp;quot;  &amp;quot;banana&amp;quot;   &amp;quot;escarola&amp;quot;
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;str_sort(x, locale = &amp;quot;haw&amp;quot;) # Havaiano
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] &amp;quot;abacaxi&amp;quot;  &amp;quot;escarola&amp;quot; &amp;quot;banana&amp;quot;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;√â justamente para esses casos que &lt;code&gt;str_sort&lt;/code&gt; e &lt;code&gt;str_order&lt;/code&gt; oferecem a alternativa de voc√™ especificar o &lt;code&gt;locale&lt;/code&gt;.&lt;/p&gt;
&lt;h3 id=&#34;trabalhando-com-padr√µes-e-express√µes-regulares&#34;&gt;Trabalhando com padr√µes e ‚Äúexpress√µes regulares‚Äù&lt;/h3&gt;
&lt;p&gt;Express√µes regulares s√£o quase uma linguagem de programa√ß√£o em si, aqui, vamos dar uma passada muito r√°pida e ver alguns exemplos simples. S√£o uma ferramenta muito √∫til, mas talvez n√£o do interesse de todos.&lt;/p&gt;
&lt;p&gt;Basicamente, a ideia √© fazer uma pesquisa na string, em busca de um padr√£o espec√≠fico. Pode ser uma palavra, um espa√ßo em branco, uma quebra de linha. Pode ficar muito complexo ou ser bem b√°sico. O nosso objetivo aqui √© que todos tenham a capacidade de trabalhar com padr√µes simples para corrigir inconsist√™ncias em bancos de dados, como no exemplo da aula anterior das colunas do dataset da OMS.&lt;/p&gt;
&lt;p&gt;Para visualizar padr√µes, vamos usar duas &lt;code&gt;helper functions&lt;/code&gt;, &lt;code&gt;str_view&lt;/code&gt; e &lt;code&gt;str_view_all&lt;/code&gt;.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;x &amp;lt;- c(&amp;quot;mam√£o&amp;quot;, &amp;quot;banana&amp;quot;, &amp;quot;ananas&amp;quot;)
str_view(x, &amp;quot;an&amp;quot;)
&lt;/code&gt;&lt;/pre&gt;
&lt;div id=&#34;htmlwidget-1&#34; style=&#34;width:960px;height:100%;&#34; class=&#34;str_view html-widget&#34;&gt;&lt;/div&gt;
&lt;script type=&#34;application/json&#34; data-for=&#34;htmlwidget-1&#34;&gt;{&#34;x&#34;:{&#34;html&#34;:&#34;&lt;ul&gt;\n  &lt;li&gt;mam√£o&lt;\/li&gt;\n  &lt;li&gt;b&lt;span class=&#39;match&#39;&gt;an&lt;\/span&gt;ana&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;an&lt;\/span&gt;anas&lt;\/li&gt;\n&lt;\/ul&gt;&#34;},&#34;evals&#34;:[],&#34;jsHooks&#34;:[]}&lt;/script&gt;
&lt;p&gt;O resultado sai na aba ‚ÄúViewer‚Äù do seu RStudio.&lt;/p&gt;
&lt;p&gt;O primeiro padr√£o que podemos usar √© o &lt;code&gt;.&lt;/code&gt;, que identifica qualquer caractere. As vezes na documenta√ß√£o esse tipo de padr√£o gen√©rico √© chamado de ‚Äúwildcard.‚Äù&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;str_view(x, &amp;quot;.a.&amp;quot;)
&lt;/code&gt;&lt;/pre&gt;
&lt;div id=&#34;htmlwidget-2&#34; style=&#34;width:960px;height:100%;&#34; class=&#34;str_view html-widget&#34;&gt;&lt;/div&gt;
&lt;script type=&#34;application/json&#34; data-for=&#34;htmlwidget-2&#34;&gt;{&#34;x&#34;:{&#34;html&#34;:&#34;&lt;ul&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;mam&lt;\/span&gt;√£o&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;ban&lt;\/span&gt;ana&lt;\/li&gt;\n  &lt;li&gt;a&lt;span class=&#39;match&#39;&gt;nan&lt;\/span&gt;as&lt;\/li&gt;\n&lt;\/ul&gt;&#34;},&#34;evals&#34;:[],&#34;jsHooks&#34;:[]}&lt;/script&gt;
&lt;p&gt;A forma de ler essa opera√ß√£o √©: ‚ÄúIdentifique qualquer conjunto de caracteres que tenha uma letra a no meio deles.‚Äù&lt;/p&gt;
&lt;p&gt;Se voc√™ quiser identificar um &lt;code&gt;.&lt;/code&gt; numa string, voc√™ precisa usar o escape &lt;code&gt;\&lt;/code&gt;. Por√©m, a barra tamb√©m √© um escape! Ent√£o, ao escrever express√µes regulares, precisamos usar &lt;code&gt;\\&lt;/code&gt;. Veja:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;dot &amp;lt;- &amp;quot;.&amp;quot;
cat(dot)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## .
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;# erro
dot &amp;lt;- &amp;quot;\.&amp;quot;
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## Error: &#39;\.&#39;  √© uma seq√º√™ncia de escape n√£o reconhecida na cadeia de caracteres come√ßando com &amp;quot;&amp;quot;\.&amp;quot;
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;# agora sim
dot &amp;lt;- &amp;quot;\\.&amp;quot;
cat(dot)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## \.
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Agora em um exemplo:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;x &amp;lt;- c(&amp;quot;Praia.&amp;quot;, &amp;quot;Agora.&amp;quot;, &amp;quot;Ou.&amp;quot;, &amp;quot;Me.&amp;quot;, &amp;quot;Rebelo.&amp;quot;)
str_view(x, &amp;quot;a\\.&amp;quot;)
&lt;/code&gt;&lt;/pre&gt;
&lt;div id=&#34;htmlwidget-3&#34; style=&#34;width:960px;height:100%;&#34; class=&#34;str_view html-widget&#34;&gt;&lt;/div&gt;
&lt;script type=&#34;application/json&#34; data-for=&#34;htmlwidget-3&#34;&gt;{&#34;x&#34;:{&#34;html&#34;:&#34;&lt;ul&gt;\n  &lt;li&gt;Prai&lt;span class=&#39;match&#39;&gt;a.&lt;\/span&gt;&lt;\/li&gt;\n  &lt;li&gt;Agor&lt;span class=&#39;match&#39;&gt;a.&lt;\/span&gt;&lt;\/li&gt;\n  &lt;li&gt;Ou.&lt;\/li&gt;\n  &lt;li&gt;Me.&lt;\/li&gt;\n  &lt;li&gt;Rebelo.&lt;\/li&gt;\n&lt;\/ul&gt;&#34;},&#34;evals&#34;:[],&#34;jsHooks&#34;:[]}&lt;/script&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;str_view(x, &amp;quot;u\\.&amp;quot;)
&lt;/code&gt;&lt;/pre&gt;
&lt;div id=&#34;htmlwidget-4&#34; style=&#34;width:960px;height:100%;&#34; class=&#34;str_view html-widget&#34;&gt;&lt;/div&gt;
&lt;script type=&#34;application/json&#34; data-for=&#34;htmlwidget-4&#34;&gt;{&#34;x&#34;:{&#34;html&#34;:&#34;&lt;ul&gt;\n  &lt;li&gt;Praia.&lt;\/li&gt;\n  &lt;li&gt;Agora.&lt;\/li&gt;\n  &lt;li&gt;O&lt;span class=&#39;match&#39;&gt;u.&lt;\/span&gt;&lt;\/li&gt;\n  &lt;li&gt;Me.&lt;\/li&gt;\n  &lt;li&gt;Rebelo.&lt;\/li&gt;\n&lt;\/ul&gt;&#34;},&#34;evals&#34;:[],&#34;jsHooks&#34;:[]}&lt;/script&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;str_view(x, &amp;quot;o\\.&amp;quot;)
&lt;/code&gt;&lt;/pre&gt;
&lt;div id=&#34;htmlwidget-5&#34; style=&#34;width:960px;height:100%;&#34; class=&#34;str_view html-widget&#34;&gt;&lt;/div&gt;
&lt;script type=&#34;application/json&#34; data-for=&#34;htmlwidget-5&#34;&gt;{&#34;x&#34;:{&#34;html&#34;:&#34;&lt;ul&gt;\n  &lt;li&gt;Praia.&lt;\/li&gt;\n  &lt;li&gt;Agora.&lt;\/li&gt;\n  &lt;li&gt;Ou.&lt;\/li&gt;\n  &lt;li&gt;Me.&lt;\/li&gt;\n  &lt;li&gt;Rebel&lt;span class=&#39;match&#39;&gt;o.&lt;\/span&gt;&lt;\/li&gt;\n&lt;\/ul&gt;&#34;},&#34;evals&#34;:[],&#34;jsHooks&#34;:[]}&lt;/script&gt;
&lt;p&gt;T√°, mas se a contrabarra √© utilizada para denotar uma express√£o regular tipo o &lt;code&gt;.&lt;/code&gt;, como eu fa√ßo para pesquisar uma contrabarra?&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;x &amp;lt;- &amp;quot;Jake Peralta √© o melhor detetive\\g√™nio&amp;quot;
cat(x)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## Jake Peralta √© o melhor detetive\g√™nio
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;A solu√ß√£o √© escapar o escape do escape, sacou?&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;str_view(x, &amp;quot;\\\\&amp;quot;)
&lt;/code&gt;&lt;/pre&gt;
&lt;div id=&#34;htmlwidget-6&#34; style=&#34;width:960px;height:100%;&#34; class=&#34;str_view html-widget&#34;&gt;&lt;/div&gt;
&lt;script type=&#34;application/json&#34; data-for=&#34;htmlwidget-6&#34;&gt;{&#34;x&#34;:{&#34;html&#34;:&#34;&lt;ul&gt;\n  &lt;li&gt;Jake Peralta √© o melhor detetive&lt;span class=&#39;match&#39;&gt;\\&lt;\/span&gt;g√™nio&lt;\/li&gt;\n&lt;\/ul&gt;&#34;},&#34;evals&#34;:[],&#34;jsHooks&#34;:[]}&lt;/script&gt;
&lt;p&gt;√â enrolado mesmo‚Ä¶&lt;/p&gt;
&lt;p&gt;Para n√£o estender muito o assunto, vamos ver v√°rios exemplos de caracteres especiais a ser usados em express√µes regulares.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;^&lt;/code&gt; encontra o in√≠cio de uma string&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;x &amp;lt;- c(&amp;quot;ma√ß√£&amp;quot;, &amp;quot;banana&amp;quot;, &amp;quot;mam√£o&amp;quot;)

str_view(x, &amp;quot;^m&amp;quot;)
&lt;/code&gt;&lt;/pre&gt;
&lt;div id=&#34;htmlwidget-7&#34; style=&#34;width:960px;height:100%;&#34; class=&#34;str_view html-widget&#34;&gt;&lt;/div&gt;
&lt;script type=&#34;application/json&#34; data-for=&#34;htmlwidget-7&#34;&gt;{&#34;x&#34;:{&#34;html&#34;:&#34;&lt;ul&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;m&lt;\/span&gt;a√ß√£&lt;\/li&gt;\n  &lt;li&gt;banana&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;m&lt;\/span&gt;am√£o&lt;\/li&gt;\n&lt;\/ul&gt;&#34;},&#34;evals&#34;:[],&#34;jsHooks&#34;:[]}&lt;/script&gt;
&lt;p&gt;&lt;code&gt;$&lt;/code&gt; encontra o final&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;str_view(x, &amp;quot;a$&amp;quot;)
&lt;/code&gt;&lt;/pre&gt;
&lt;div id=&#34;htmlwidget-8&#34; style=&#34;width:960px;height:100%;&#34; class=&#34;str_view html-widget&#34;&gt;&lt;/div&gt;
&lt;script type=&#34;application/json&#34; data-for=&#34;htmlwidget-8&#34;&gt;{&#34;x&#34;:{&#34;html&#34;:&#34;&lt;ul&gt;\n  &lt;li&gt;ma√ß√£&lt;\/li&gt;\n  &lt;li&gt;banan&lt;span class=&#39;match&#39;&gt;a&lt;\/span&gt;&lt;\/li&gt;\n  &lt;li&gt;mam√£o&lt;\/li&gt;\n&lt;\/ul&gt;&#34;},&#34;evals&#34;:[],&#34;jsHooks&#34;:[]}&lt;/script&gt;
&lt;p&gt;Para for√ßar a express√£o a achar apenas a palavra completa, use os dois&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;x &amp;lt;- c(&amp;quot;vitamina de banana&amp;quot;, &amp;quot;sundae de banana&amp;quot;, &amp;quot;banana&amp;quot;)
str_view(x, &amp;quot;banana&amp;quot;)
&lt;/code&gt;&lt;/pre&gt;
&lt;div id=&#34;htmlwidget-9&#34; style=&#34;width:960px;height:100%;&#34; class=&#34;str_view html-widget&#34;&gt;&lt;/div&gt;
&lt;script type=&#34;application/json&#34; data-for=&#34;htmlwidget-9&#34;&gt;{&#34;x&#34;:{&#34;html&#34;:&#34;&lt;ul&gt;\n  &lt;li&gt;vitamina de &lt;span class=&#39;match&#39;&gt;banana&lt;\/span&gt;&lt;\/li&gt;\n  &lt;li&gt;sundae de &lt;span class=&#39;match&#39;&gt;banana&lt;\/span&gt;&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;banana&lt;\/span&gt;&lt;\/li&gt;\n&lt;\/ul&gt;&#34;},&#34;evals&#34;:[],&#34;jsHooks&#34;:[]}&lt;/script&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;str_view(x, &amp;quot;^banana$&amp;quot;)
&lt;/code&gt;&lt;/pre&gt;
&lt;div id=&#34;htmlwidget-10&#34; style=&#34;width:960px;height:100%;&#34; class=&#34;str_view html-widget&#34;&gt;&lt;/div&gt;
&lt;script type=&#34;application/json&#34; data-for=&#34;htmlwidget-10&#34;&gt;{&#34;x&#34;:{&#34;html&#34;:&#34;&lt;ul&gt;\n  &lt;li&gt;vitamina de banana&lt;\/li&gt;\n  &lt;li&gt;sundae de banana&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;banana&lt;\/span&gt;&lt;\/li&gt;\n&lt;\/ul&gt;&#34;},&#34;evals&#34;:[],&#34;jsHooks&#34;:[]}&lt;/script&gt;
&lt;p&gt;Use &lt;code&gt;classes&lt;/code&gt; de caracteres para encontrar gen√©ricos&lt;/p&gt;
&lt;p&gt;Qualquer digito:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;x &amp;lt;- &amp;quot;15 de Maio de 2021.&amp;quot;
str_view(x, &amp;quot;\\d&amp;quot;)
&lt;/code&gt;&lt;/pre&gt;
&lt;div id=&#34;htmlwidget-11&#34; style=&#34;width:960px;height:100%;&#34; class=&#34;str_view html-widget&#34;&gt;&lt;/div&gt;
&lt;script type=&#34;application/json&#34; data-for=&#34;htmlwidget-11&#34;&gt;{&#34;x&#34;:{&#34;html&#34;:&#34;&lt;ul&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;1&lt;\/span&gt;5 de Maio de 2021.&lt;\/li&gt;\n&lt;\/ul&gt;&#34;},&#34;evals&#34;:[],&#34;jsHooks&#34;:[]}&lt;/script&gt;
&lt;p&gt;Qualquer espa√ßo em branco:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;str_view(x, &amp;quot;\\s&amp;quot;)
&lt;/code&gt;&lt;/pre&gt;
&lt;div id=&#34;htmlwidget-12&#34; style=&#34;width:960px;height:100%;&#34; class=&#34;str_view html-widget&#34;&gt;&lt;/div&gt;
&lt;script type=&#34;application/json&#34; data-for=&#34;htmlwidget-12&#34;&gt;{&#34;x&#34;:{&#34;html&#34;:&#34;&lt;ul&gt;\n  &lt;li&gt;15&lt;span class=&#39;match&#39;&gt; &lt;\/span&gt;de Maio de 2021.&lt;\/li&gt;\n&lt;\/ul&gt;&#34;},&#34;evals&#34;:[],&#34;jsHooks&#34;:[]}&lt;/script&gt;
&lt;p&gt;Qualquer caractere de um grupo: &lt;code&gt;[abc]&lt;/code&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;str_view(x, &amp;quot;[M]&amp;quot;)
&lt;/code&gt;&lt;/pre&gt;
&lt;div id=&#34;htmlwidget-13&#34; style=&#34;width:960px;height:100%;&#34; class=&#34;str_view html-widget&#34;&gt;&lt;/div&gt;
&lt;script type=&#34;application/json&#34; data-for=&#34;htmlwidget-13&#34;&gt;{&#34;x&#34;:{&#34;html&#34;:&#34;&lt;ul&gt;\n  &lt;li&gt;15 de &lt;span class=&#39;match&#39;&gt;M&lt;\/span&gt;aio de 2021.&lt;\/li&gt;\n&lt;\/ul&gt;&#34;},&#34;evals&#34;:[],&#34;jsHooks&#34;:[]}&lt;/script&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;str_view(x, &amp;quot;[eM]&amp;quot;)
&lt;/code&gt;&lt;/pre&gt;
&lt;div id=&#34;htmlwidget-14&#34; style=&#34;width:960px;height:100%;&#34; class=&#34;str_view html-widget&#34;&gt;&lt;/div&gt;
&lt;script type=&#34;application/json&#34; data-for=&#34;htmlwidget-14&#34;&gt;{&#34;x&#34;:{&#34;html&#34;:&#34;&lt;ul&gt;\n  &lt;li&gt;15 d&lt;span class=&#39;match&#39;&gt;e&lt;\/span&gt; Maio de 2021.&lt;\/li&gt;\n&lt;\/ul&gt;&#34;},&#34;evals&#34;:[],&#34;jsHooks&#34;:[]}&lt;/script&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;str_view(x, &amp;quot;[deM]&amp;quot;)
&lt;/code&gt;&lt;/pre&gt;
&lt;div id=&#34;htmlwidget-15&#34; style=&#34;width:960px;height:100%;&#34; class=&#34;str_view html-widget&#34;&gt;&lt;/div&gt;
&lt;script type=&#34;application/json&#34; data-for=&#34;htmlwidget-15&#34;&gt;{&#34;x&#34;:{&#34;html&#34;:&#34;&lt;ul&gt;\n  &lt;li&gt;15 &lt;span class=&#39;match&#39;&gt;d&lt;\/span&gt;e Maio de 2021.&lt;\/li&gt;\n&lt;\/ul&gt;&#34;},&#34;evals&#34;:[],&#34;jsHooks&#34;:[]}&lt;/script&gt;
&lt;p&gt;Qualquer caractere menos esses: &lt;code&gt;[^abc]&lt;/code&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;str_view(x, &amp;quot;[^15]&amp;quot;)
&lt;/code&gt;&lt;/pre&gt;
&lt;div id=&#34;htmlwidget-16&#34; style=&#34;width:960px;height:100%;&#34; class=&#34;str_view html-widget&#34;&gt;&lt;/div&gt;
&lt;script type=&#34;application/json&#34; data-for=&#34;htmlwidget-16&#34;&gt;{&#34;x&#34;:{&#34;html&#34;:&#34;&lt;ul&gt;\n  &lt;li&gt;15&lt;span class=&#39;match&#39;&gt; &lt;\/span&gt;de Maio de 2021.&lt;\/li&gt;\n&lt;\/ul&gt;&#34;},&#34;evals&#34;:[],&#34;jsHooks&#34;:[]}&lt;/script&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;str_view(x, &amp;quot;[^15 de]&amp;quot;)
&lt;/code&gt;&lt;/pre&gt;
&lt;div id=&#34;htmlwidget-17&#34; style=&#34;width:960px;height:100%;&#34; class=&#34;str_view html-widget&#34;&gt;&lt;/div&gt;
&lt;script type=&#34;application/json&#34; data-for=&#34;htmlwidget-17&#34;&gt;{&#34;x&#34;:{&#34;html&#34;:&#34;&lt;ul&gt;\n  &lt;li&gt;15 de &lt;span class=&#39;match&#39;&gt;M&lt;\/span&gt;aio de 2021.&lt;\/li&gt;\n&lt;\/ul&gt;&#34;},&#34;evals&#34;:[],&#34;jsHooks&#34;:[]}&lt;/script&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;str_view(x, &amp;quot;[^15 de Maio de ]&amp;quot;)
&lt;/code&gt;&lt;/pre&gt;
&lt;div id=&#34;htmlwidget-18&#34; style=&#34;width:960px;height:100%;&#34; class=&#34;str_view html-widget&#34;&gt;&lt;/div&gt;
&lt;script type=&#34;application/json&#34; data-for=&#34;htmlwidget-18&#34;&gt;{&#34;x&#34;:{&#34;html&#34;:&#34;&lt;ul&gt;\n  &lt;li&gt;15 de Maio de &lt;span class=&#39;match&#39;&gt;2&lt;\/span&gt;021.&lt;\/li&gt;\n&lt;\/ul&gt;&#34;},&#34;evals&#34;:[],&#34;jsHooks&#34;:[]}&lt;/script&gt;
&lt;p&gt;Usar uma classe pra evitar digitar 5 milh√µes de contrabarras&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;str_view(x, &amp;quot;[.]&amp;quot;)
&lt;/code&gt;&lt;/pre&gt;
&lt;div id=&#34;htmlwidget-19&#34; style=&#34;width:960px;height:100%;&#34; class=&#34;str_view html-widget&#34;&gt;&lt;/div&gt;
&lt;script type=&#34;application/json&#34; data-for=&#34;htmlwidget-19&#34;&gt;{&#34;x&#34;:{&#34;html&#34;:&#34;&lt;ul&gt;\n  &lt;li&gt;15 de Maio de 2021&lt;span class=&#39;match&#39;&gt;.&lt;\/span&gt;&lt;\/li&gt;\n&lt;\/ul&gt;&#34;},&#34;evals&#34;:[],&#34;jsHooks&#34;:[]}&lt;/script&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;str_view(&amp;quot;a*c&amp;quot;, &amp;quot;[*]&amp;quot;)
&lt;/code&gt;&lt;/pre&gt;
&lt;div id=&#34;htmlwidget-20&#34; style=&#34;width:960px;height:100%;&#34; class=&#34;str_view html-widget&#34;&gt;&lt;/div&gt;
&lt;script type=&#34;application/json&#34; data-for=&#34;htmlwidget-20&#34;&gt;{&#34;x&#34;:{&#34;html&#34;:&#34;&lt;ul&gt;\n  &lt;li&gt;a&lt;span class=&#39;match&#39;&gt;*&lt;\/span&gt;c&lt;\/li&gt;\n&lt;\/ul&gt;&#34;},&#34;evals&#34;:[],&#34;jsHooks&#34;:[]}&lt;/script&gt;
&lt;p&gt;Voc√™ pode misturar strings com classes tamb√©m&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;x &amp;lt;- c(&amp;quot;15 de Maio de 2021.&amp;quot;, &amp;quot;16 de Maio de 2021.&amp;quot;)
str_view(x, &amp;quot;1[56] de Maio&amp;quot;)
&lt;/code&gt;&lt;/pre&gt;
&lt;div id=&#34;htmlwidget-21&#34; style=&#34;width:960px;height:100%;&#34; class=&#34;str_view html-widget&#34;&gt;&lt;/div&gt;
&lt;script type=&#34;application/json&#34; data-for=&#34;htmlwidget-21&#34;&gt;{&#34;x&#34;:{&#34;html&#34;:&#34;&lt;ul&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;15 de Maio&lt;\/span&gt; de 2021.&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;16 de Maio&lt;\/span&gt; de 2021.&lt;\/li&gt;\n&lt;\/ul&gt;&#34;},&#34;evals&#34;:[],&#34;jsHooks&#34;:[]}&lt;/script&gt;
&lt;p&gt;Infelizmente, alguns caracteres tem significado especial dentro das classes, e voc√™ tem que usar contrabarras para fugir deles: &lt;code&gt;]&lt;/code&gt; &lt;code&gt;\&lt;/code&gt; &lt;code&gt;^&lt;/code&gt; e &lt;code&gt;-&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Voc√™ pode lidar com repeti√ß√µes&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;x &amp;lt;- c(&amp;quot;Mariele&amp;quot;, &amp;quot;Marielle&amp;quot;, &amp;quot;Mariellle&amp;quot;, &amp;quot;Marie&amp;quot;)
str_view(x, &amp;quot;Mariell?e&amp;quot;) # l aparece 0 ou 1 vez
&lt;/code&gt;&lt;/pre&gt;
&lt;div id=&#34;htmlwidget-22&#34; style=&#34;width:960px;height:100%;&#34; class=&#34;str_view html-widget&#34;&gt;&lt;/div&gt;
&lt;script type=&#34;application/json&#34; data-for=&#34;htmlwidget-22&#34;&gt;{&#34;x&#34;:{&#34;html&#34;:&#34;&lt;ul&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;Mariele&lt;\/span&gt;&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;Marielle&lt;\/span&gt;&lt;\/li&gt;\n  &lt;li&gt;Mariellle&lt;\/li&gt;\n  &lt;li&gt;Marie&lt;\/li&gt;\n&lt;\/ul&gt;&#34;},&#34;evals&#34;:[],&#34;jsHooks&#34;:[]}&lt;/script&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;str_view(x, &amp;quot;Mariel+e&amp;quot;) # l aparece 1 ou + vezes
&lt;/code&gt;&lt;/pre&gt;
&lt;div id=&#34;htmlwidget-23&#34; style=&#34;width:960px;height:100%;&#34; class=&#34;str_view html-widget&#34;&gt;&lt;/div&gt;
&lt;script type=&#34;application/json&#34; data-for=&#34;htmlwidget-23&#34;&gt;{&#34;x&#34;:{&#34;html&#34;:&#34;&lt;ul&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;Mariele&lt;\/span&gt;&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;Marielle&lt;\/span&gt;&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;Mariellle&lt;\/span&gt;&lt;\/li&gt;\n  &lt;li&gt;Marie&lt;\/li&gt;\n&lt;\/ul&gt;&#34;},&#34;evals&#34;:[],&#34;jsHooks&#34;:[]}&lt;/script&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;str_view(x, &amp;quot;Mariel*&amp;quot;) # l aparece 0 ou + vezes
&lt;/code&gt;&lt;/pre&gt;
&lt;div id=&#34;htmlwidget-24&#34; style=&#34;width:960px;height:100%;&#34; class=&#34;str_view html-widget&#34;&gt;&lt;/div&gt;
&lt;script type=&#34;application/json&#34; data-for=&#34;htmlwidget-24&#34;&gt;{&#34;x&#34;:{&#34;html&#34;:&#34;&lt;ul&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;Mariel&lt;\/span&gt;e&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;Mariell&lt;\/span&gt;e&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;Marielll&lt;\/span&gt;e&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;Marie&lt;\/span&gt;&lt;\/li&gt;\n&lt;\/ul&gt;&#34;},&#34;evals&#34;:[],&#34;jsHooks&#34;:[]}&lt;/script&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;str_view(x, &amp;quot;Mariel{0}&amp;quot;) # l aparece exatamente 0 vezes
&lt;/code&gt;&lt;/pre&gt;
&lt;div id=&#34;htmlwidget-25&#34; style=&#34;width:960px;height:100%;&#34; class=&#34;str_view html-widget&#34;&gt;&lt;/div&gt;
&lt;script type=&#34;application/json&#34; data-for=&#34;htmlwidget-25&#34;&gt;{&#34;x&#34;:{&#34;html&#34;:&#34;&lt;ul&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;Marie&lt;\/span&gt;le&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;Marie&lt;\/span&gt;lle&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;Marie&lt;\/span&gt;llle&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;Marie&lt;\/span&gt;&lt;\/li&gt;\n&lt;\/ul&gt;&#34;},&#34;evals&#34;:[],&#34;jsHooks&#34;:[]}&lt;/script&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;str_view(x, &amp;quot;Mariel{1}&amp;quot;) # l aparece exatamente 1 vez
&lt;/code&gt;&lt;/pre&gt;
&lt;div id=&#34;htmlwidget-26&#34; style=&#34;width:960px;height:100%;&#34; class=&#34;str_view html-widget&#34;&gt;&lt;/div&gt;
&lt;script type=&#34;application/json&#34; data-for=&#34;htmlwidget-26&#34;&gt;{&#34;x&#34;:{&#34;html&#34;:&#34;&lt;ul&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;Mariel&lt;\/span&gt;e&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;Mariel&lt;\/span&gt;le&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;Mariel&lt;\/span&gt;lle&lt;\/li&gt;\n  &lt;li&gt;Marie&lt;\/li&gt;\n&lt;\/ul&gt;&#34;},&#34;evals&#34;:[],&#34;jsHooks&#34;:[]}&lt;/script&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;str_view(x, &amp;quot;Mariel{2}&amp;quot;) # l aparece exatamente 2 vezes
&lt;/code&gt;&lt;/pre&gt;
&lt;div id=&#34;htmlwidget-27&#34; style=&#34;width:960px;height:100%;&#34; class=&#34;str_view html-widget&#34;&gt;&lt;/div&gt;
&lt;script type=&#34;application/json&#34; data-for=&#34;htmlwidget-27&#34;&gt;{&#34;x&#34;:{&#34;html&#34;:&#34;&lt;ul&gt;\n  &lt;li&gt;Mariele&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;Mariell&lt;\/span&gt;e&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;Mariell&lt;\/span&gt;le&lt;\/li&gt;\n  &lt;li&gt;Marie&lt;\/li&gt;\n&lt;\/ul&gt;&#34;},&#34;evals&#34;:[],&#34;jsHooks&#34;:[]}&lt;/script&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;str_view(x, &amp;quot;Mariel{3}&amp;quot;) # l aparece exatamente 3 vezes
&lt;/code&gt;&lt;/pre&gt;
&lt;div id=&#34;htmlwidget-28&#34; style=&#34;width:960px;height:100%;&#34; class=&#34;str_view html-widget&#34;&gt;&lt;/div&gt;
&lt;script type=&#34;application/json&#34; data-for=&#34;htmlwidget-28&#34;&gt;{&#34;x&#34;:{&#34;html&#34;:&#34;&lt;ul&gt;\n  &lt;li&gt;Mariele&lt;\/li&gt;\n  &lt;li&gt;Marielle&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;Marielll&lt;\/span&gt;e&lt;\/li&gt;\n  &lt;li&gt;Marie&lt;\/li&gt;\n&lt;\/ul&gt;&#34;},&#34;evals&#34;:[],&#34;jsHooks&#34;:[]}&lt;/script&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;str_view(x, &amp;quot;Mariel{1,}&amp;quot;) # l aparece exatamente 1 vez ou mais
&lt;/code&gt;&lt;/pre&gt;
&lt;div id=&#34;htmlwidget-29&#34; style=&#34;width:960px;height:100%;&#34; class=&#34;str_view html-widget&#34;&gt;&lt;/div&gt;
&lt;script type=&#34;application/json&#34; data-for=&#34;htmlwidget-29&#34;&gt;{&#34;x&#34;:{&#34;html&#34;:&#34;&lt;ul&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;Mariel&lt;\/span&gt;e&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;Mariell&lt;\/span&gt;e&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;Marielll&lt;\/span&gt;e&lt;\/li&gt;\n  &lt;li&gt;Marie&lt;\/li&gt;\n&lt;\/ul&gt;&#34;},&#34;evals&#34;:[],&#34;jsHooks&#34;:[]}&lt;/script&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;str_view(x, &amp;quot;Mariel{2,}&amp;quot;) # l aparece exatamente 2 vezes ou mais
&lt;/code&gt;&lt;/pre&gt;
&lt;div id=&#34;htmlwidget-30&#34; style=&#34;width:960px;height:100%;&#34; class=&#34;str_view html-widget&#34;&gt;&lt;/div&gt;
&lt;script type=&#34;application/json&#34; data-for=&#34;htmlwidget-30&#34;&gt;{&#34;x&#34;:{&#34;html&#34;:&#34;&lt;ul&gt;\n  &lt;li&gt;Mariele&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;Mariell&lt;\/span&gt;e&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;Marielll&lt;\/span&gt;e&lt;\/li&gt;\n  &lt;li&gt;Marie&lt;\/li&gt;\n&lt;\/ul&gt;&#34;},&#34;evals&#34;:[],&#34;jsHooks&#34;:[]}&lt;/script&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;str_view(x, &amp;quot;Mariel{1,2}&amp;quot;) # l aparece de 1 a 2 vezes
&lt;/code&gt;&lt;/pre&gt;
&lt;div id=&#34;htmlwidget-31&#34; style=&#34;width:960px;height:100%;&#34; class=&#34;str_view html-widget&#34;&gt;&lt;/div&gt;
&lt;script type=&#34;application/json&#34; data-for=&#34;htmlwidget-31&#34;&gt;{&#34;x&#34;:{&#34;html&#34;:&#34;&lt;ul&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;Mariel&lt;\/span&gt;e&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;Mariell&lt;\/span&gt;e&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;Mariell&lt;\/span&gt;le&lt;\/li&gt;\n  &lt;li&gt;Marie&lt;\/li&gt;\n&lt;\/ul&gt;&#34;},&#34;evals&#34;:[],&#34;jsHooks&#34;:[]}&lt;/script&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;str_view(x, &amp;quot;Mariel{2,3}&amp;quot;) # l aparece de 2 a 3 vezes
&lt;/code&gt;&lt;/pre&gt;
&lt;div id=&#34;htmlwidget-32&#34; style=&#34;width:960px;height:100%;&#34; class=&#34;str_view html-widget&#34;&gt;&lt;/div&gt;
&lt;script type=&#34;application/json&#34; data-for=&#34;htmlwidget-32&#34;&gt;{&#34;x&#34;:{&#34;html&#34;:&#34;&lt;ul&gt;\n  &lt;li&gt;Mariele&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;Mariell&lt;\/span&gt;e&lt;\/li&gt;\n  &lt;li&gt;&lt;span class=&#39;match&#39;&gt;Marielll&lt;\/span&gt;e&lt;\/li&gt;\n  &lt;li&gt;Marie&lt;\/li&gt;\n&lt;\/ul&gt;&#34;},&#34;evals&#34;:[],&#34;jsHooks&#34;:[]}&lt;/script&gt;
&lt;p&gt;Esse assunto √© enorme, e ainda estamos s√≥ na superf√≠cie. H√° grupos, lookarounds, e muitos outros detalhes envolvendo express√µes regulares, e voc√™s podem consultar os livros de refer√™ncia para mergulhar mais fundo. Mas vamos parar por aqui para nos concentrar no que interessa.&lt;/p&gt;
&lt;p&gt;Em geral, temos um banco de dados com strings problem√°ticas, tipo erros de digita√ß√£o, inconsist√™ncias etc. O primeiro passo, em geral, √© detectar os problemas.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;x &amp;lt;- c(&amp;quot;S√£o Paulo&amp;quot;, &amp;quot;SAO PAULO&amp;quot;, &amp;quot;Sao Paulo&amp;quot;, &amp;quot;sp&amp;quot;, &amp;quot;SP&amp;quot;, &amp;quot;Sp&amp;quot;)
str_detect(x, &amp;quot;√£&amp;quot;)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1]  TRUE FALSE FALSE FALSE FALSE FALSE
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;str_detect(x, &amp;quot;[Ss][Pp]&amp;quot;)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] FALSE FALSE FALSE  TRUE  TRUE  TRUE
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;str_detect(x, &amp;quot;[Ss][Aa][Oo]&amp;quot;)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] FALSE  TRUE  TRUE FALSE FALSE FALSE
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Voc√™ pode se utilizar do fato da resposta ser um vetor l√≥gico para descobrir quantos problemas voc√™ tem&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;# Contagens
str_detect(x, &amp;quot;√£&amp;quot;) %&amp;gt;% sum()
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] 1
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;str_detect(x, &amp;quot;[Ss][Pp]&amp;quot;) %&amp;gt;% sum()
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] 3
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;str_detect(x, &amp;quot;[Ss][Aa][Oo]&amp;quot;) %&amp;gt;% sum()
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] 2
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;# Propor√ß√µes
str_detect(x, &amp;quot;√£&amp;quot;) %&amp;gt;% mean()
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] 0.1666667
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;str_detect(x, &amp;quot;[Ss][Pp]&amp;quot;) %&amp;gt;% mean()
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] 0.5
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;str_detect(x, &amp;quot;[Ss][Aa][Oo]&amp;quot;) %&amp;gt;% mean()
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] 0.3333333
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Depois de detectar seus problemas, voc√™ pode querer extrair uma parte dos seus casos: use &lt;code&gt;str_subset&lt;/code&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;str_subset(x, &amp;quot;[Ss][Pp]&amp;quot;)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] &amp;quot;sp&amp;quot; &amp;quot;SP&amp;quot; &amp;quot;Sp&amp;quot;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Em geral, no entanto, voc√™ vai estar trabalhando num data frame. Ent√£o use &lt;code&gt;dplyr::filter&lt;/code&gt; e &lt;code&gt;str_detect&lt;/code&gt;.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;df &amp;lt;- tibble::tibble(
  nome = c(&amp;quot;Marcos&amp;quot;, &amp;quot;rog√©rio&amp;quot;, &amp;quot;cebolinha&amp;quot;, &amp;quot;Bei√ßola&amp;quot;, &amp;quot;nadir&amp;quot;, &amp;quot;Monica&amp;quot;),
  uf = x,
  dtnsc = c(&amp;quot;15 de Maio de 1980&amp;quot;, &amp;quot;1 de Jan de 2001&amp;quot;, &amp;quot;6 de Ago de 1993&amp;quot;, 
            &amp;quot;20 de Abril de 1964&amp;quot;, &amp;quot;24 de Nov de 1975&amp;quot;, &amp;quot;14 de Dezembro de 1997&amp;quot;)
)
df %&amp;gt;% dplyr::filter(str_detect(uf, &amp;quot;[Ss][Pp]&amp;quot;))
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 3 x 3
##   nome    uf    dtnsc                 
##   &amp;lt;chr&amp;gt;   &amp;lt;chr&amp;gt; &amp;lt;chr&amp;gt;                 
## 1 Bei√ßola sp    20 de Abril de 1964   
## 2 nadir   SP    24 de Nov de 1975     
## 3 Monica  Sp    14 de Dezembro de 1997
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Voc√™ pode contar quantos matches voc√™ tem &lt;code&gt;str_count&lt;/code&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;str_count(x, &amp;quot;o&amp;quot;)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] 2 0 2 0 0 0
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;str_count(x, &amp;quot;[Oo]&amp;quot;)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] 2 2 2 0 0 0
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;# e usar num data frame
df %&amp;gt;% dplyr::mutate(vogais = str_count(uf, &amp;quot;[aeiou]&amp;quot;),
                     consoantes = str_count(uf, &amp;quot;[^aeiou]&amp;quot;))
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 6 x 5
##   nome      uf        dtnsc                  vogais consoantes
##   &amp;lt;chr&amp;gt;     &amp;lt;chr&amp;gt;     &amp;lt;chr&amp;gt;                   &amp;lt;int&amp;gt;      &amp;lt;int&amp;gt;
## 1 Marcos    S√£o Paulo 15 de Maio de 1980          4          5
## 2 rog√©rio   SAO PAULO 1 de Jan de 2001            0          9
## 3 cebolinha Sao Paulo 6 de Ago de 1993            5          4
## 4 Bei√ßola   sp        20 de Abril de 1964         0          2
## 5 nadir     SP        24 de Nov de 1975           0          2
## 6 Monica    Sp        14 de Dezembro de 1997      0          2
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Voc√™ pode extrair &lt;code&gt;str_extract&lt;/code&gt; as informa√ß√µes que voc√™ quer&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;str_extract(df$dtnsc, &amp;quot;\\d+&amp;quot;)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] &amp;quot;15&amp;quot; &amp;quot;1&amp;quot;  &amp;quot;6&amp;quot;  &amp;quot;20&amp;quot; &amp;quot;24&amp;quot; &amp;quot;14&amp;quot;
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;str_extract(df$dtnsc, &amp;quot;\\d+$&amp;quot;)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] &amp;quot;1980&amp;quot; &amp;quot;2001&amp;quot; &amp;quot;1993&amp;quot; &amp;quot;1964&amp;quot; &amp;quot;1975&amp;quot; &amp;quot;1997&amp;quot;
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;str_extract(df$dtnsc, &amp;quot;\\D+&amp;quot;)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] &amp;quot; de Maio de &amp;quot;     &amp;quot; de Jan de &amp;quot;      &amp;quot; de Ago de &amp;quot;      &amp;quot; de Abril de &amp;quot;   
## [5] &amp;quot; de Nov de &amp;quot;      &amp;quot; de Dezembro de &amp;quot;
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;# Na tibble
df %&amp;gt;% dplyr::mutate(
  dia = str_extract(dtnsc, &amp;quot;\\d+&amp;quot;),
  mes = str_extract(df$dtnsc, &amp;quot;\\D+&amp;quot;),
  ano = str_extract(dtnsc, &amp;quot;\\d+$&amp;quot;))
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 6 x 6
##   nome      uf        dtnsc                  dia   mes                ano  
##   &amp;lt;chr&amp;gt;     &amp;lt;chr&amp;gt;     &amp;lt;chr&amp;gt;                  &amp;lt;chr&amp;gt; &amp;lt;chr&amp;gt;              &amp;lt;chr&amp;gt;
## 1 Marcos    S√£o Paulo 15 de Maio de 1980     15    &amp;quot; de Maio de &amp;quot;     1980 
## 2 rog√©rio   SAO PAULO 1 de Jan de 2001       1     &amp;quot; de Jan de &amp;quot;      2001 
## 3 cebolinha Sao Paulo 6 de Ago de 1993       6     &amp;quot; de Ago de &amp;quot;      1993 
## 4 Bei√ßola   sp        20 de Abril de 1964    20    &amp;quot; de Abril de &amp;quot;    1964 
## 5 nadir     SP        24 de Nov de 1975      24    &amp;quot; de Nov de &amp;quot;      1975 
## 6 Monica    Sp        14 de Dezembro de 1997 14    &amp;quot; de Dezembro de &amp;quot; 1997
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;# Melhor ainda
df %&amp;gt;% tidyr::extract(
  dtnsc, c(&amp;quot;dia&amp;quot;, &amp;quot;mes&amp;quot;, &amp;quot;ano&amp;quot;), 
  regex = &amp;quot;(\\d+) de (\\D+) de (\\d+$)&amp;quot;
)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 6 x 5
##   nome      uf        dia   mes      ano  
##   &amp;lt;chr&amp;gt;     &amp;lt;chr&amp;gt;     &amp;lt;chr&amp;gt; &amp;lt;chr&amp;gt;    &amp;lt;chr&amp;gt;
## 1 Marcos    S√£o Paulo 15    Maio     1980 
## 2 rog√©rio   SAO PAULO 1     Jan      2001 
## 3 cebolinha Sao Paulo 6     Ago      1993 
## 4 Bei√ßola   sp        20    Abril    1964 
## 5 nadir     SP        24    Nov      1975 
## 6 Monica    Sp        14    Dezembro 1997
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Similar a ideia de extra√ß√£o, podemos substituir com &lt;code&gt;str_replace&lt;/code&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;str_replace(x, &amp;quot;[Ss][Pp]&amp;quot;, &amp;quot;S√£o Paulo&amp;quot;)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] &amp;quot;S√£o Paulo&amp;quot; &amp;quot;SAO PAULO&amp;quot; &amp;quot;Sao Paulo&amp;quot; &amp;quot;S√£o Paulo&amp;quot; &amp;quot;S√£o Paulo&amp;quot; &amp;quot;S√£o Paulo&amp;quot;
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;str_replace(x, &amp;quot;SAO PAULO&amp;quot;, &amp;quot;S√£o Paulo&amp;quot;)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] &amp;quot;S√£o Paulo&amp;quot; &amp;quot;S√£o Paulo&amp;quot; &amp;quot;Sao Paulo&amp;quot; &amp;quot;sp&amp;quot;        &amp;quot;SP&amp;quot;        &amp;quot;Sp&amp;quot;
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;str_replace(x, &amp;quot;a&amp;quot;, &amp;quot;√£&amp;quot;)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] &amp;quot;S√£o P√£ulo&amp;quot; &amp;quot;SAO PAULO&amp;quot; &amp;quot;S√£o Paulo&amp;quot; &amp;quot;sp&amp;quot;        &amp;quot;SP&amp;quot;        &amp;quot;Sp&amp;quot;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Tanto &lt;code&gt;str_extract&lt;/code&gt; quanto &lt;code&gt;str_replace&lt;/code&gt; substituem apenas a primeira marca, se voc√™ quiser substituir todas, utilize &lt;code&gt;str_..._all&lt;/code&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;str_extract_all(x, &amp;quot;a&amp;quot;, simplify = TRUE)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##      [,1] [,2]
## [1,] &amp;quot;a&amp;quot;  &amp;quot;&amp;quot;  
## [2,] &amp;quot;&amp;quot;   &amp;quot;&amp;quot;  
## [3,] &amp;quot;a&amp;quot;  &amp;quot;a&amp;quot; 
## [4,] &amp;quot;&amp;quot;   &amp;quot;&amp;quot;  
## [5,] &amp;quot;&amp;quot;   &amp;quot;&amp;quot;  
## [6,] &amp;quot;&amp;quot;   &amp;quot;&amp;quot;
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;str_replace_all(x, &amp;quot;a&amp;quot;, &amp;quot;√£&amp;quot;)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] &amp;quot;S√£o P√£ulo&amp;quot; &amp;quot;SAO PAULO&amp;quot; &amp;quot;S√£o P√£ulo&amp;quot; &amp;quot;sp&amp;quot;        &amp;quot;SP&amp;quot;        &amp;quot;Sp&amp;quot;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;O assunto n√£o acaba, mas vamos parar por aqui. Novamente, recomendo consultarem os materiais para quem quiser ir mais a fundo nisso. √â bem capaz de no andar da carruagem aparecerem outros exemplos nos quais a manipula√ß√£o de strings pode ser importante.&lt;/p&gt;
&lt;h2 id=&#34;forcats&#34;&gt;&lt;code&gt;forcats&lt;/code&gt;&lt;/h2&gt;
&lt;p&gt;Esse √© um pacotinho muito que facilita bastante a vida de quem trabalha com vari√°vel categ√≥rica, ou, no R, os &lt;code&gt;factor&lt;/code&gt;s. Ele consiste em uma s√©rie de ‚Äúhelper functions‚Äù baseadas em fun√ß√µes do &lt;code&gt;base&lt;/code&gt; e do &lt;code&gt;stats&lt;/code&gt; que trabalham com os componentes de um &lt;code&gt;factor&lt;/code&gt;, ou seja, seus &lt;code&gt;levels&lt;/code&gt; e seus &lt;code&gt;values&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Imagino que todos aqui est√£o familiarizados com fatores e com a sua cria√ß√£o, ent√£o vamos direto ao que interessa. Educa√ß√£o √© um vetor de caracteres que vem com os n√≠veis educacionais de um popula√ß√£o.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;educacao &amp;lt;- c(&amp;quot;Superior&amp;quot;, &amp;quot;Fundamental&amp;quot;, &amp;quot;M√©dio&amp;quot;, &amp;quot;Superior&amp;quot;, &amp;quot;Fundamental&amp;quot;, &amp;quot;M√©dio&amp;quot;,
              &amp;quot;Superior&amp;quot;, &amp;quot;Fundamental&amp;quot;, &amp;quot;M√©dio&amp;quot;, &amp;quot;Superior&amp;quot;, &amp;quot;Fundamental&amp;quot;, &amp;quot;M√©dio&amp;quot;)

x &amp;lt;- factor(educacao, levels = c(&amp;quot;Fundamental&amp;quot;, &amp;quot;M√©dio&amp;quot;, &amp;quot;Superior&amp;quot;))
x
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##  [1] Superior    Fundamental M√©dio       Superior    Fundamental M√©dio      
##  [7] Superior    Fundamental M√©dio       Superior    Fundamental M√©dio      
## Levels: Fundamental M√©dio Superior
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;levels(x)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] &amp;quot;Fundamental&amp;quot; &amp;quot;M√©dio&amp;quot;       &amp;quot;Superior&amp;quot;
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;relevel(x, &amp;quot;Superior&amp;quot;)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##  [1] Superior    Fundamental M√©dio       Superior    Fundamental M√©dio      
##  [7] Superior    Fundamental M√©dio       Superior    Fundamental M√©dio      
## Levels: Superior Fundamental M√©dio
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Em geral, diversas tarefas envolvendo fatores no &lt;code&gt;base&lt;/code&gt; n√£o s√£o muito simples. Por exemplo, se eu quiser modificar os nomes dos n√≠veis de um fator depois dele j√° estar criado, modificar a ordem dos n√≠veis, ou agrupar diversos n√≠veis em um s√≥. &lt;code&gt;forcats&lt;/code&gt; vem justamente oferecer solu√ß√µes nesse sentido. Normalmente, estamos trabalhando com bancos de dados, e n√£o com um vetor solit√°rio, por isso, vamos usar o &lt;code&gt;gss_cat&lt;/code&gt;, uma amostra do General Social Survey aplicado pelo NORC e pela Universidade de Chicago, que vem no pacote forcats.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;library(forcats)
gss_cat
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 21,483 x 9
##     year marital     age race  rincome    partyid     relig     denom    tvhours
##    &amp;lt;int&amp;gt; &amp;lt;fct&amp;gt;     &amp;lt;int&amp;gt; &amp;lt;fct&amp;gt; &amp;lt;fct&amp;gt;      &amp;lt;fct&amp;gt;       &amp;lt;fct&amp;gt;     &amp;lt;fct&amp;gt;      &amp;lt;int&amp;gt;
##  1  2000 Never ma~    26 White $8000 to ~ Ind,near r~ Protesta~ Souther~      12
##  2  2000 Divorced     48 White $8000 to ~ Not str re~ Protesta~ Baptist~      NA
##  3  2000 Widowed      67 White Not appli~ Independent Protesta~ No deno~       2
##  4  2000 Never ma~    39 White Not appli~ Ind,near r~ Orthodox~ Not app~       4
##  5  2000 Divorced     25 White Not appli~ Not str de~ None      Not app~       1
##  6  2000 Married      25 White $20000 - ~ Strong dem~ Protesta~ Souther~      NA
##  7  2000 Never ma~    36 White $25000 or~ Not str re~ Christian Not app~       3
##  8  2000 Divorced     44 White $7000 to ~ Ind,near d~ Protesta~ Luthera~      NA
##  9  2000 Married      44 White $25000 or~ Not str de~ Protesta~ Other          0
## 10  2000 Married      47 White $25000 or~ Strong rep~ Protesta~ Souther~       3
## # ... with 21,473 more rows
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Contagens&lt;/p&gt;
&lt;p&gt;Uma das primeiras coisas que interessa ao lidar com fatores, √© obter suas contagens, o que √© algo muito simples utilizando a gram√°tica do dplyr.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;# Fun√ß√£o count
gss_cat %&amp;gt;% 
  count(race)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 3 x 2
##   race      n
##   &amp;lt;fct&amp;gt; &amp;lt;int&amp;gt;
## 1 Other  1959
## 2 Black  3129
## 3 White 16395
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;# Incluindo n√≠veis com contagem = 0.
gss_cat %&amp;gt;% 
  count(race, .drop = FALSE)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 4 x 2
##   race               n
##   &amp;lt;fct&amp;gt;          &amp;lt;int&amp;gt;
## 1 Other           1959
## 2 Black           3129
## 3 White          16395
## 4 Not applicable     0
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;# Visualiza√ß√£o com ggplot
library(ggplot2)
gss_cat %&amp;gt;% 
  ggplot(aes(race)) + geom_bar()
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;https://laddem.github.io/courses/tidyverse/dia2_files/figure-html/unnamed-chunk-60-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;# Incluindo n√≠veis com contagem = 0.
gss_cat %&amp;gt;% 
  ggplot(aes(race)) + geom_bar() + scale_x_discrete(drop = FALSE)
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;https://laddem.github.io/courses/tidyverse/dia2_files/figure-html/unnamed-chunk-60-2.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;p&gt;Note o uso do argumento &lt;code&gt;drop&lt;/code&gt; nos dois casos, para indicar que casos com 0 observa√ß√µes n√£o devem ser removidos do resultado.&lt;/p&gt;
&lt;h3 id=&#34;modificando-a-ordem&#34;&gt;Modificando a ordem&lt;/h3&gt;
&lt;p&gt;A segunda tarefa comum quando trabalhamos com fatores √© modificar a ordem em que eles aparecem. N√£o √© tanto o caso quando trabalhamos com fatores ordenados, mas diversos tipos de vari√°veis categ√≥ricas n√£o possuem uma ordem l√≥gica pre-definida e, mesmo assim, nos interessa apresent√°-los de acordo com uma determinada hierarquia visual, seja porque eles s√£o os mais frequentes ou porque queremos destacar algum elemento em particular. &lt;code&gt;forcats&lt;/code&gt; implementa diversas estrat√©gias de reordenamento de fatores. Vamos v√™-las brevemente.&lt;/p&gt;
&lt;p&gt;Digamos que eu queira saber o tempo m√©dio de televis√£o assistida por membros das diversas religi√µes. Eu poderia produzir um sum√°rio e depois plotar isso num gr√°fico.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;relig_summary &amp;lt;- gss_cat %&amp;gt;%
  group_by(relig) %&amp;gt;%
  summarise(
    age = mean(age, na.rm = TRUE),
    tvhours = mean(tvhours, na.rm = TRUE),
    n = n()
  )

relig_summary %&amp;gt;% 
  ggplot(aes(tvhours, relig)) + geom_point()
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;https://laddem.github.io/courses/tidyverse/dia2_files/figure-html/unnamed-chunk-61-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;p&gt;O display est√° t√©cnicamente correto, mas a forma desorganizada dos n√≠veis no eixo Y dificulta a nossa capacidade de fazer compara√ß√µes. Talvez fosse mais interessante ordenar este resultado por ordem decrescente do n√∫mero de horas de tv. Mas, como fazer isso de forma direta, sem precisar realizar diversas computa√ß√µes?&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;# Direto no plot
relig_summary %&amp;gt;% 
  ggplot(aes(tvhours, fct_reorder(relig, tvhours))) + geom_point()
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;https://laddem.github.io/courses/tidyverse/dia2_files/figure-html/unnamed-chunk-62-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;# Antes de passar o data.frame para a plotagem
relig_summary %&amp;gt;% 
  mutate(relig = fct_reorder(relig, tvhours)) %&amp;gt;% 
  ggplot(aes(tvhours, relig)) + geom_point()
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;https://laddem.github.io/courses/tidyverse/dia2_files/figure-html/unnamed-chunk-62-2.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;p&gt;Note como posso aplicar a transforma√ß√£o diretamente na vari√°vel durante o processo de plotagem, ou antes, e uma invoca√ß√£o de &lt;code&gt;mutate&lt;/code&gt;. Na minha opini√£o, o segundo jeito √© o mais adequado, por duas raz√µes: √© mais f√°cil de digitar, inserir e retirar do c√≥digo e √© mais f√°cil para um leitor identificar que uma transforma√ß√£o foi feita na vari√°vel plotada.&lt;/p&gt;
&lt;p&gt;Outro exemplo: que tal exarminarmos a rela√ß√£o entre a idade e a renda declarada? Primeiro, √© preciso construir um sum√°rio, parecido com o primeiro:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;rincome_summary &amp;lt;- gss_cat %&amp;gt;%
  group_by(rincome) %&amp;gt;%
  summarise(
    age = mean(age, na.rm = TRUE),
    tvhours = mean(tvhours, na.rm = TRUE),
    n = n()
  )

rincome_summary %&amp;gt;% 
  mutate(rincome = fct_reorder(rincome, age)) %&amp;gt;% 
  ggplot(aes(age, rincome)) + geom_point()
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;https://laddem.github.io/courses/tidyverse/dia2_files/figure-html/unnamed-chunk-63-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;p&gt;Aqui, o reordenamento das vari√°veis de acordo com a idade n√£o faz muito sentido, porque os n√≠veis de renda tem uma ordem pr√≥pria. Nesse caso, n√£o √© recomendado utilizar &lt;code&gt;fct_reorder&lt;/code&gt;.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;rincome_summary %&amp;gt;% 
  ggplot(aes(age, rincome)) + geom_point()
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;https://laddem.github.io/courses/tidyverse/dia2_files/figure-html/unnamed-chunk-64-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;p&gt;S√≥ que ao plotar, notamos um problema: a categoria ‚ÄúNot applicable‚Äù ficou primeiro e isso desorganiza visualmente nosso gr√°fico. Sem problema! Utilizamos &lt;code&gt;fct_relevel&lt;/code&gt; para modificar a ordem de uma vari√°vel arbitrariamente. O padr√£o √© colocar pro come√ßo (Parecido com o comportamento de &lt;code&gt;stats::relevel&lt;/code&gt;), mas voc√™ pode especificar outra posi√ß√£o.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;rincome_summary %&amp;gt;% 
  mutate(rincome = fct_relevel(rincome, &amp;quot;Not applicable&amp;quot;)) %&amp;gt;% 
  ggplot(aes(age, rincome)) + geom_point()
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;https://laddem.github.io/courses/tidyverse/dia2_files/figure-html/unnamed-chunk-65-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;p&gt;Notem como nos exemplos acima, o uso do &lt;code&gt;%&amp;gt;%&lt;/code&gt; nos permite alterar partes do nosso c√≥digo de maneira interativa para chegar no resultado desejado.&lt;/p&gt;
&lt;p&gt;Outro tipo de mudan√ßa de ordem interessante ocorre quando temos uma terceira ‚Äúdimens√£o‚Äù no nosso gr√°fico. Em geral, utilizamos cores, formas ou linhas quebradas para diferenciar entre categorias e gostar√≠amos que a nossa legenda acompanhasse a tend√™ncia do gr√°fico. Compare:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;by_age &amp;lt;- gss_cat %&amp;gt;%
  filter(!is.na(age)) %&amp;gt;%
  count(age, marital) %&amp;gt;%
  group_by(age) %&amp;gt;%
  mutate(prop = n / sum(n))

# Sem altera√ß√£o na ordem
by_age %&amp;gt;% 
  ggplot(aes(age, prop, colour = marital)) +
  geom_line(na.rm = TRUE)
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;https://laddem.github.io/courses/tidyverse/dia2_files/figure-html/unnamed-chunk-66-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;# Com altera√ß√£o na ordem
ggplot(by_age, aes(age, prop, colour = fct_reorder2(marital, age, prop))) +
  geom_line() +
  labs(colour = &amp;quot;marital&amp;quot;)
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;https://laddem.github.io/courses/tidyverse/dia2_files/figure-html/unnamed-chunk-66-2.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;p&gt;No caso de &lt;code&gt;fct_reorder2&lt;/code&gt;, √© melhor fazer a altera√ß√£o de ordem dentro da fun√ß√£o gr√°fica, pois dentro uma invoca√ß√£o de &lt;code&gt;mutate&lt;/code&gt;, ela n√£o funcionou durante meus testes.&lt;/p&gt;
&lt;p&gt;Por √∫ltimo, podemos querer ordenar um gr√°fico de barras de acordo com a frequ√™ncia das categorias, o que podemos fazer com &lt;code&gt;fct_infreq&lt;/code&gt; e &lt;code&gt;fct_rev&lt;/code&gt; (opcional).&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;gss_cat %&amp;gt;%
  mutate(marital = marital %&amp;gt;% fct_infreq()) %&amp;gt;%
  ggplot(aes(marital)) +
    geom_bar()
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;https://laddem.github.io/courses/tidyverse/dia2_files/figure-html/unnamed-chunk-67-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;# OU
gss_cat %&amp;gt;%
  mutate(marital = marital %&amp;gt;% fct_infreq() %&amp;gt;% fct_rev()) %&amp;gt;%
  ggplot(aes(marital)) +
    geom_bar()
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;https://laddem.github.io/courses/tidyverse/dia2_files/figure-html/unnamed-chunk-67-2.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;p&gt;Notem o uso do pipe na hora de modificar a vari√°vel ‚Äúmarital.‚Äù&lt;/p&gt;
&lt;h3 id=&#34;modificando-os-n√≠veis&#34;&gt;Modificando os n√≠veis&lt;/h3&gt;
&lt;p&gt;O outro tipo de opera√ß√£o bastante comum √© a altera√ß√£o nos n√≠ves do fator. Em geral, queremos que os nossos n√≠veis sejam representativos das nossas categorias de an√°lise, sejam de f√°cil leitura e entendimento e contenham um n√∫mero significativo de observa√ß√µes. Por essa raz√£o, frequentemente precisamos alterar os r√≥tulos, agrupar categorias, etc.&lt;/p&gt;
&lt;p&gt;Vejamos o exemplo da vari√°vel &lt;code&gt;partyid&lt;/code&gt;, que registra a identifica√ß√£o do entrevistado com os partidos pol√≠ticos dos EUA.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;gss_cat %&amp;gt;% count(partyid)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 10 x 2
##    partyid                n
##    &amp;lt;fct&amp;gt;              &amp;lt;int&amp;gt;
##  1 No answer            154
##  2 Don&#39;t know             1
##  3 Other party          393
##  4 Strong republican   2314
##  5 Not str republican  3032
##  6 Ind,near rep        1791
##  7 Independent         4119
##  8 Ind,near dem        2499
##  9 Not str democrat    3690
## 10 Strong democrat     3490
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Vamos supor que, por qualquer motivo, essa forma de representa√ß√£o das categorias n√£o nos satisfaz. Vejamos algumas das ferramentas que podemos utilizar para modificar esse fator.&lt;/p&gt;
&lt;p&gt;Podemos, simplesmente, reescrever essas categorias de forma mais completa:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;gss_cat %&amp;gt;% 
  mutate(partyid = fct_recode(partyid,
    &amp;quot;Republicano, forte&amp;quot; = &amp;quot;Strong republican&amp;quot;,
    &amp;quot;Republicano, fraco&amp;quot; = &amp;quot;Not str republican&amp;quot;,
    &amp;quot;Independente, pr√≥x. repub.&amp;quot; = &amp;quot;Ind,near rep&amp;quot;,
    &amp;quot;Independente, pr√≥x. democ.&amp;quot; = &amp;quot;Ind,near dem&amp;quot;,
    &amp;quot;Independente&amp;quot; = &amp;quot;Independent&amp;quot;,
    &amp;quot;Democrata, forte&amp;quot; = &amp;quot;Strong democrat&amp;quot;,
    &amp;quot;Democrata, fraco&amp;quot; = &amp;quot;Not str democrat&amp;quot;,
    &amp;quot;Outro partido&amp;quot; = &amp;quot;Other party&amp;quot;,
    &amp;quot;N√£o sei&amp;quot; = &amp;quot;Don&#39;t know&amp;quot;,
    &amp;quot;Sem resposta&amp;quot; = &amp;quot;No answer&amp;quot;
  )) %&amp;gt;% 
  count(partyid)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 10 x 2
##    partyid                        n
##    &amp;lt;fct&amp;gt;                      &amp;lt;int&amp;gt;
##  1 Sem resposta                 154
##  2 N√£o sei                        1
##  3 Outro partido                393
##  4 Republicano, forte          2314
##  5 Republicano, fraco          3032
##  6 Independente, pr√≥x. repub.  1791
##  7 Independente                4119
##  8 Independente, pr√≥x. democ.  2499
##  9 Democrata, fraco            3690
## 10 Democrata, forte            3490
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;A fun√ß√£o utilizada √© &lt;code&gt;fct_recode&lt;/code&gt; e ela √© a mais gen√©rica e flex√≠vel de todas, por√©m, exige que cada n√≠vel seja modificado individualmente. Dentro dela, √© poss√≠vel agrupar v√°rios n√≠veis associando v√°rios n√≠veis antigos a um mesmo n√≠vel novo. Veja o exemplo:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;gss_cat %&amp;gt;% 
  mutate(partyid = fct_recode(partyid,
    &amp;quot;Republicano, forte&amp;quot; = &amp;quot;Strong republican&amp;quot;,
    &amp;quot;Republicano, fraco&amp;quot; = &amp;quot;Not str republican&amp;quot;,
    &amp;quot;Independente, pr√≥x. repub.&amp;quot; = &amp;quot;Ind,near rep&amp;quot;,
    &amp;quot;Independente, pr√≥x. democ.&amp;quot; = &amp;quot;Ind,near dem&amp;quot;,
    &amp;quot;Independente&amp;quot; = &amp;quot;Independent&amp;quot;,
    &amp;quot;Democrata, forte&amp;quot; = &amp;quot;Strong democrat&amp;quot;,
    &amp;quot;Democrata, fraco&amp;quot; = &amp;quot;Not str democrat&amp;quot;,
    # Note o nome
    &amp;quot;Outro&amp;quot; = &amp;quot;Other party&amp;quot;,
    &amp;quot;Outro&amp;quot; = &amp;quot;Don&#39;t know&amp;quot;,
    &amp;quot;Outro&amp;quot; = &amp;quot;No answer&amp;quot;
  )) %&amp;gt;% 
  count(partyid)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 8 x 2
##   partyid                        n
##   &amp;lt;fct&amp;gt;                      &amp;lt;int&amp;gt;
## 1 Outro                        548
## 2 Republicano, forte          2314
## 3 Republicano, fraco          3032
## 4 Independente, pr√≥x. repub.  1791
## 5 Independente                4119
## 6 Independente, pr√≥x. democ.  2499
## 7 Democrata, fraco            3690
## 8 Democrata, forte            3490
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Se voc√™ quiser recategorizar um fator que tem muitos n√≠veis para um menor, com poucos n√≠veis, utilize &lt;code&gt;fct_collapse&lt;/code&gt;:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;gss_cat %&amp;gt;%
  mutate(partyid = fct_collapse(partyid,
    Outro = c(&amp;quot;No answer&amp;quot;, &amp;quot;Don&#39;t know&amp;quot;, &amp;quot;Other party&amp;quot;),
    Republicano = c(&amp;quot;Strong republican&amp;quot;, &amp;quot;Not str republican&amp;quot;),
    Independente = c(&amp;quot;Ind,near rep&amp;quot;, &amp;quot;Independent&amp;quot;, &amp;quot;Ind,near dem&amp;quot;),
    Democrata = c(&amp;quot;Not str democrat&amp;quot;, &amp;quot;Strong democrat&amp;quot;)
  )) %&amp;gt;%
  count(partyid)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 4 x 2
##   partyid          n
##   &amp;lt;fct&amp;gt;        &amp;lt;int&amp;gt;
## 1 Outro          548
## 2 Republicano   5346
## 3 Independente  8409
## 4 Democrata     7180
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Repare que do lado esquerdo, nos valores novos, n√£o foi necess√°rio usar aspas. √â preciso cuidado com essa caracter√≠stica dos verbos do tidyverse. Ela se chama ‚Äútidy evaluation‚Äù e est√° um pouco fora do escopo do curso. Basicamente, se rolar d√∫vida ou der erros, se for usar acentos ou algum caractere diferente, use aspas.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;gss_cat %&amp;gt;%
  mutate(partyid = fct_collapse(partyid,
    &amp;quot;Outro&amp;quot; = c(&amp;quot;No answer&amp;quot;, &amp;quot;Don&#39;t know&amp;quot;, &amp;quot;Other party&amp;quot;),
    &amp;quot;Republicano&amp;quot; = c(&amp;quot;Strong republican&amp;quot;, &amp;quot;Not str republican&amp;quot;),
    &amp;quot;Independente&amp;quot; = c(&amp;quot;Ind,near rep&amp;quot;, &amp;quot;Independent&amp;quot;, &amp;quot;Ind,near dem&amp;quot;),
    &amp;quot;Democrata&amp;quot; = c(&amp;quot;Not str democrat&amp;quot;, &amp;quot;Strong democrat&amp;quot;)
  )) %&amp;gt;%
  count(partyid)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 4 x 2
##   partyid          n
##   &amp;lt;fct&amp;gt;        &amp;lt;int&amp;gt;
## 1 Outro          548
## 2 Republicano   5346
## 3 Independente  8409
## 4 Democrata     7180
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Outro tipo de mudan√ßa importante no n√∫mero de n√≠veis √© agrupar os n√≠veis menos frequentes, por exemplo, para produzir uma visualiza√ß√£o que d√™ maior destaque aos n√≠veis mais frequentes. Esse √© o trabalho de &lt;code&gt;fct_lump&lt;/code&gt;.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;gss_cat %&amp;gt;% 
  mutate(relig = fct_lump(relig, n = 5)) %&amp;gt;% 
  count(relig)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 6 x 2
##   relig          n
##   &amp;lt;fct&amp;gt;      &amp;lt;int&amp;gt;
## 1 Christian    689
## 2 None        3523
## 3 Jewish       388
## 4 Catholic    5124
## 5 Protestant 10846
## 6 Other        913
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Note que usando o argumento &lt;code&gt;n&lt;/code&gt; eu indico quantos n√≠veis eu quero. No caso, escolhi os 5 n√≠veis mais frequentes e todos os outros s√£o autom√°ticamente agrupados na categoria ‚ÄúOther.‚Äù Posso mudar esse nome tamb√©m:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;gss_cat %&amp;gt;% 
  mutate(relig = fct_lump(relig, n = 5, other_level = &amp;quot;Outros&amp;quot;)) %&amp;gt;% 
  count(relig)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 6 x 2
##   relig          n
##   &amp;lt;fct&amp;gt;      &amp;lt;int&amp;gt;
## 1 Christian    689
## 2 None        3523
## 3 Jewish       388
## 4 Catholic    5124
## 5 Protestant 10846
## 6 Outros       913
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;exerc√≠cios&#34;&gt;Exerc√≠cios&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;Encontre os v√¥os que:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Atrasaram mais de duas horas&lt;/li&gt;
&lt;li&gt;Com destino a Houston (&lt;code&gt;IAH&lt;/code&gt; ou &lt;code&gt;HOU&lt;/code&gt;)&lt;/li&gt;
&lt;li&gt;Operados pela United, American ou Delta&lt;/li&gt;
&lt;li&gt;Decolaram entre julho e setembro&lt;/li&gt;
&lt;li&gt;Chegaram com mais de duas horas de atraso, mas n√£o decolaram com atraso&lt;/li&gt;
&lt;li&gt;Atrasaram mais de uma hora para decolar, mas recuperaram mais de 30 minutos durante o voo&lt;/li&gt;
&lt;li&gt;Decolaram entre a meia-noite e 6 da manh√£ (inclusive)&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Reordene suas colunas para encontrar os voos mais r√°pidos (maior velocidade de voo).&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Teste v√°rias maneiras diferentes de selecionar as vari√°veis &lt;code&gt;dep_time&lt;/code&gt;, &lt;code&gt;dep_delay&lt;/code&gt;, &lt;code&gt;arr_time&lt;/code&gt; e &lt;code&gt;arr_delay&lt;/code&gt; usando as v√°rias helper functions de &lt;code&gt;select&lt;/code&gt;.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;As vari√°veis &lt;code&gt;dep_time&lt;/code&gt; e &lt;code&gt;sched_dep_time&lt;/code&gt; est√£o num formato incorreto (veja &lt;code&gt;?flights&lt;/code&gt;). Converta-as com &lt;code&gt;mutate&lt;/code&gt; para um valor em minutos passados desde a meia-noite. Dica: utilize &lt;code&gt;%/%&lt;/code&gt; e &lt;code&gt;%%&lt;/code&gt;.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;O que o c√≥digo abaixo est√° fazendo? Porque mesmo ap√≥s o c√≥digo abaixo continuam existindo diferen√ßas entre os valores das vari√°veis &lt;code&gt;air_time&lt;/code&gt; e &lt;code&gt;travel_time&lt;/code&gt;?&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;flights %&amp;gt;% 
  select(air_time, dep_time, arr_time, dep_delay, arr_delay) %&amp;gt;% 
  mutate(dep_hour = dep_time %/% 100,
         dep_min = dep_time %% 100,
         dep_time2 = dep_hour * 60 + dep_min,
         arr_hour = arr_time %/% 100,
         arr_min = arr_time %% 100,
         arr_time2 = arr_hour * 60 + arr_min,
         travel_time = arr_time2 - dep_time2) %&amp;gt;% 
  select(-dep_hour, -dep_min, -arr_hour, -arr_min)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 336,776 x 8
##    air_time dep_time arr_time dep_delay arr_delay dep_time2 arr_time2
##       &amp;lt;dbl&amp;gt;    &amp;lt;int&amp;gt;    &amp;lt;int&amp;gt;     &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;
##  1      227      517      830         2        11       317       510
##  2      227      533      850         4        20       333       530
##  3      160      542      923         2        33       342       563
##  4      183      544     1004        -1       -18       344       604
##  5      116      554      812        -6       -25       354       492
##  6      150      554      740        -4        12       354       460
##  7      158      555      913        -5        19       355       553
##  8       53      557      709        -3       -14       357       429
##  9      140      557      838        -3        -8       357       518
## 10      138      558      753        -2         8       358       473
## # ... with 336,766 more rows, and 1 more variable: travel_time &amp;lt;dbl&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;ol start=&#34;6&#34;&gt;
&lt;li&gt;Use o stringr para concatenar as seguintes strings em uma frase&lt;/li&gt;
&lt;/ol&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;x &amp;lt;- &amp;quot;.&amp;quot;
y &amp;lt;- &amp;quot;feliz&amp;quot;
w &amp;lt;- &amp;quot;acordei&amp;quot;
z &amp;lt;- &amp;quot;hoje&amp;quot;
&lt;/code&gt;&lt;/pre&gt;
&lt;ol start=&#34;7&#34;&gt;
&lt;li&gt;Corrija as inconsist√™ncias nas colunas pa√≠s, primeiro_nome, segundo_nome e crie uma nova coluna nomes contendo as duas anteriores. No final, ordene o banco em ordem alfab√©tica.&lt;/li&gt;
&lt;/ol&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;df &amp;lt;- 
  tibble::tribble(
    ~pais,    ~primeiro_nome, ~segundo_nome,
    # -------|----------------|-------------|
    &amp;quot;BRASIL&amp;quot;, &amp;quot;ISABELA&amp;quot;,       &amp;quot;MARTINS&amp;quot;,
    &amp;quot;Brasil&amp;quot;, &amp;quot;Eduardo&amp;quot;,       &amp;quot;cabellos&amp;quot;,
    &amp;quot;brasil&amp;quot;, &amp;quot;m√°rcia&amp;quot;,         &amp;quot;pinto&amp;quot;,
    &amp;quot;bRaSiL&amp;quot;, &amp;quot;rog√©rio&amp;quot;,        &amp;quot;Marinho&amp;quot;,
  )
&lt;/code&gt;&lt;/pre&gt;
&lt;ol start=&#34;8&#34;&gt;
&lt;li&gt;Transforme a string &lt;code&gt;c(&amp;quot;Seu nome&amp;quot;, &amp;quot;Seu sobrenome da m√£e&amp;quot;, &amp;quot;Seu sobrenome do pai&amp;quot;)&lt;/code&gt; na string &lt;code&gt;&amp;quot;SEU SOBRENOME DO PAI, sua inicial do nome. sua inicial da m√£e.&amp;quot;&lt;/code&gt;, como numa cita√ß√£o. Veja o exemplo abaixo:&lt;/li&gt;
&lt;/ol&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;# Transforme
c(&amp;quot;Vin√≠cius&amp;quot;, &amp;quot;de Souza&amp;quot;, &amp;quot;Maia&amp;quot;)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] &amp;quot;Vin√≠cius&amp;quot; &amp;quot;de Souza&amp;quot; &amp;quot;Maia&amp;quot;
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;# Resultado
&amp;quot;MAIA, V. S.&amp;quot;
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] &amp;quot;MAIA, V. S.&amp;quot;
&lt;/code&gt;&lt;/pre&gt;
&lt;ol start=&#34;9&#34;&gt;
&lt;li&gt;DESAFIO: Nos microdados da √°rea de sa√∫de, √© comum que a vari√°vel idade esteja registrada da seguinte forma: ‚Äú150,‚Äù ‚Äú219,‚Äù ‚Äú312,‚Äù ‚Äú471.‚Äù Esses c√≥digos indicam primeiro qual a unidade de medida da idade e segundo o valor desta unidade, 1 = horas, 2 = dias, 3 = meses, 4 = anos. Proponha um c√≥digo usando &lt;code&gt;stringr&lt;/code&gt; para transformar o vetor abaixo em um valor num√©rico.&lt;/li&gt;
&lt;/ol&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;# N√£o precisa se preocupar com essa parte
x &amp;lt;- as.character(round(c(
  runif(25, 100, 124),
  runif(25, 201, 230),
  runif(25, 301, 312),
  runif(25, 401, 499)
)))

# Como voc√™ transformaria esse vetor em n√∫mero?
x
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##   [1] &amp;quot;115&amp;quot; &amp;quot;113&amp;quot; &amp;quot;119&amp;quot; &amp;quot;121&amp;quot; &amp;quot;118&amp;quot; &amp;quot;116&amp;quot; &amp;quot;100&amp;quot; &amp;quot;108&amp;quot; &amp;quot;113&amp;quot; &amp;quot;119&amp;quot; &amp;quot;121&amp;quot; &amp;quot;103&amp;quot;
##  [13] &amp;quot;116&amp;quot; &amp;quot;111&amp;quot; &amp;quot;111&amp;quot; &amp;quot;115&amp;quot; &amp;quot;114&amp;quot; &amp;quot;102&amp;quot; &amp;quot;116&amp;quot; &amp;quot;103&amp;quot; &amp;quot;120&amp;quot; &amp;quot;115&amp;quot; &amp;quot;123&amp;quot; &amp;quot;103&amp;quot;
##  [25] &amp;quot;119&amp;quot; &amp;quot;230&amp;quot; &amp;quot;228&amp;quot; &amp;quot;225&amp;quot; &amp;quot;214&amp;quot; &amp;quot;225&amp;quot; &amp;quot;206&amp;quot; &amp;quot;207&amp;quot; &amp;quot;208&amp;quot; &amp;quot;202&amp;quot; &amp;quot;210&amp;quot; &amp;quot;229&amp;quot;
##  [37] &amp;quot;204&amp;quot; &amp;quot;207&amp;quot; &amp;quot;215&amp;quot; &amp;quot;218&amp;quot; &amp;quot;223&amp;quot; &amp;quot;221&amp;quot; &amp;quot;205&amp;quot; &amp;quot;214&amp;quot; &amp;quot;220&amp;quot; &amp;quot;227&amp;quot; &amp;quot;202&amp;quot; &amp;quot;224&amp;quot;
##  [49] &amp;quot;214&amp;quot; &amp;quot;201&amp;quot; &amp;quot;305&amp;quot; &amp;quot;310&amp;quot; &amp;quot;309&amp;quot; &amp;quot;310&amp;quot; &amp;quot;305&amp;quot; &amp;quot;305&amp;quot; &amp;quot;309&amp;quot; &amp;quot;303&amp;quot; &amp;quot;312&amp;quot; &amp;quot;310&amp;quot;
##  [61] &amp;quot;303&amp;quot; &amp;quot;302&amp;quot; &amp;quot;305&amp;quot; &amp;quot;303&amp;quot; &amp;quot;304&amp;quot; &amp;quot;306&amp;quot; &amp;quot;309&amp;quot; &amp;quot;304&amp;quot; &amp;quot;303&amp;quot; &amp;quot;309&amp;quot; &amp;quot;306&amp;quot; &amp;quot;311&amp;quot;
##  [73] &amp;quot;306&amp;quot; &amp;quot;307&amp;quot; &amp;quot;310&amp;quot; &amp;quot;417&amp;quot; &amp;quot;477&amp;quot; &amp;quot;470&amp;quot; &amp;quot;493&amp;quot; &amp;quot;414&amp;quot; &amp;quot;446&amp;quot; &amp;quot;402&amp;quot; &amp;quot;423&amp;quot; &amp;quot;476&amp;quot;
##  [85] &amp;quot;432&amp;quot; &amp;quot;490&amp;quot; &amp;quot;499&amp;quot; &amp;quot;429&amp;quot; &amp;quot;414&amp;quot; &amp;quot;455&amp;quot; &amp;quot;409&amp;quot; &amp;quot;462&amp;quot; &amp;quot;447&amp;quot; &amp;quot;483&amp;quot; &amp;quot;458&amp;quot; &amp;quot;471&amp;quot;
##  [97] &amp;quot;402&amp;quot; &amp;quot;423&amp;quot; &amp;quot;464&amp;quot; &amp;quot;483&amp;quot;
&lt;/code&gt;&lt;/pre&gt;
&lt;ol start=&#34;10&#34;&gt;
&lt;li&gt;
&lt;p&gt;Explore as contagens da vari√°vel &lt;code&gt;rincome&lt;/code&gt; em &lt;code&gt;gss_cat&lt;/code&gt;, ela ficaria bem representada num gr√°fico? De qual tipo?&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Qual a religi√£o mais comum em &lt;code&gt;gss_cat&lt;/code&gt;? Qual o partido (&lt;code&gt;partyid&lt;/code&gt;) mais popular?&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;A que religi√£o se refere a vari√°vel &lt;code&gt;denom&lt;/code&gt;? Voc√™ pode descobrir isso fazendo uma tabela de contagens?&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Como voc√™ poderia diminuir o n√∫mero de categorias da vari√°vel &lt;code&gt;rincome&lt;/code&gt; do banco &lt;code&gt;gss_cat&lt;/code&gt;?&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
</description>
    </item>
    
    <item>
      <title>ggplot2</title>
      <link>https://laddem.github.io/courses/tidyverse/dia3/</link>
      <pubDate>Sun, 23 May 2021 00:00:00 +0000</pubDate>
      <guid>https://laddem.github.io/courses/tidyverse/dia3/</guid>
      <description>&lt;h2 id=&#34;o-pacote-ggplot2-e-a-gram√°tica-dos-gr√°ficos&#34;&gt;O pacote ggplot2 e a &amp;ldquo;gram√°tica dos gr√°ficos&amp;rdquo;&lt;/h2&gt;
&lt;p&gt;Ainda me lembro da primeira vez que li o terceiro cap√≠tulo de &lt;a href=&#34;https://r4ds.had.co.nz/data-visualisation.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;R for Data Science&lt;/a&gt; em que o conceito de visualiza√ß√£o de dados √© apresentado junto com a ideia de &lt;code&gt;data.frame&lt;/code&gt; e o c√≥digo utilizado para gerar o gr√°fico. Acho que se o termo &lt;code&gt;sobrecarga infromacional&lt;/code&gt; n√£o existisse, eu teria inventado ele na hora.&lt;/p&gt;
&lt;p&gt;Anedotas a parte, n√£o √© culpa do autor. O livro pressup√µe um certo conhecimento pr√©vio que eu n√£o tinha quando o li pela primeira vez. Imagino que a maioria de voc√™s j√° viu gr√°ficos na vida e at√© construiu um ou dois deles usando esse ou outros softwares estat√≠sticos. O que talvez nem todos tenham claro na mente √© que os gr√°ficos s√£o uma &lt;strong&gt;codifica√ß√£o num sistema de coordenadas das informa√ß√µes presentes em um banco de dados atrav√©s de escalas&lt;/strong&gt;. Vamos destrinchar um pouco melhor isso:&lt;/p&gt;
&lt;p&gt;Suponha que voc√™ tenha o banco de dados &lt;code&gt;mpg&lt;/code&gt;, presente na biblioteca &lt;code&gt;ggplot2&lt;/code&gt;.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;library(ggplot2)
mpg
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 234 x 11
##    manufacturer model    displ  year   cyl trans   drv     cty   hwy fl    class
##    &amp;lt;chr&amp;gt;        &amp;lt;chr&amp;gt;    &amp;lt;dbl&amp;gt; &amp;lt;int&amp;gt; &amp;lt;int&amp;gt; &amp;lt;chr&amp;gt;   &amp;lt;chr&amp;gt; &amp;lt;int&amp;gt; &amp;lt;int&amp;gt; &amp;lt;chr&amp;gt; &amp;lt;chr&amp;gt;
##  1 audi         a4         1.8  1999     4 auto(l~ f        18    29 p     comp~
##  2 audi         a4         1.8  1999     4 manual~ f        21    29 p     comp~
##  3 audi         a4         2    2008     4 manual~ f        20    31 p     comp~
##  4 audi         a4         2    2008     4 auto(a~ f        21    30 p     comp~
##  5 audi         a4         2.8  1999     6 auto(l~ f        16    26 p     comp~
##  6 audi         a4         2.8  1999     6 manual~ f        18    26 p     comp~
##  7 audi         a4         3.1  2008     6 auto(a~ f        18    27 p     comp~
##  8 audi         a4 quat~   1.8  1999     4 manual~ 4        18    26 p     comp~
##  9 audi         a4 quat~   1.8  1999     4 auto(l~ 4        16    25 p     comp~
## 10 audi         a4 quat~   2    2008     4 manual~ 4        20    28 p     comp~
## # ... with 224 more rows
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;De posse desse banco, voc√™ gostaria de construir um gr√°fico relacionando a efici√™ncia do combust√≠vel de um carro (&lt;code&gt;hwy&lt;/code&gt;) com o seu peso (&lt;code&gt;displ&lt;/code&gt;). S√°bio e malandro no &lt;code&gt;ggplot2&lt;/code&gt;, voc√™ escreve o c√≥digo a seguir:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;ggplot(mpg, aes(displ,hwy, color = class)) +
  geom_point()
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;https://laddem.github.io/courses/tidyverse/dia3_files/figure-html/unnamed-chunk-2-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;p&gt;Mas fica a d√∫vida: que escolhas foram feitas no momento de traduzir a minha &lt;strong&gt;inten√ß√£o&lt;/strong&gt; de produzir um diagrama de dispers√£o (&lt;em&gt;scatterplot&lt;/em&gt;) do peso com o consumo de gasolina para a representa√ß√£o gr√°fica diante de n√≥s? Que unidades de medidas est√£o dispostas nos eixos X e Y? Qual o sistema de coordenadas no qual isto foi representado? Quem define os limites de in√≠cio e fim de cada eixo? Como cada ponto recebeu a sua cor? Essas perguntas podem parecer √≥bvias ou tontas, dependendo da perspectiva e da experi√™ncia do usu√°rio, mas elas s√£o centrais para entender como construir e modificar gr√°ficos no &lt;code&gt;ggplot2&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;O pacote √© inspirado pela &lt;a href=&#34;http://vita.had.co.nz/papers/layered-grammar.pdf&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Gram√°tica dos Gr√°ficos&lt;/a&gt;, e procura decompor o processo de produ√ß√£o de gr√°ficos em uma sequ√™ncia de camadas que v√£o se sobrepondo at√© chegar no objeto desejado.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;a camada dos &lt;strong&gt;dados&lt;/strong&gt; e do mapeamento &lt;strong&gt;est√©tico&lt;/strong&gt; (que vari√°veis v√£o em quais eixos/escalas)&lt;/li&gt;
&lt;li&gt;a camada dos objetos geom√©tricos (pontos, linhas, barras, etc.)&lt;/li&gt;
&lt;li&gt;a camada das escalas (natural? logar√≠tmica? escala de cores?)&lt;/li&gt;
&lt;li&gt;a camada das &lt;strong&gt;facetas&lt;/strong&gt; (mini gr√°ficos separados por alguma caracter√≠stica)&lt;/li&gt;
&lt;li&gt;a camada das transforma√ß√µes estat√≠sticas (distribui√ß√µes de probabilidade, contagens, propor√ß√µes, etc.)&lt;/li&gt;
&lt;li&gt;o sistema de coordenadas (cartesiano? polar?)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Obviamente, nem todo gr√°fico possui essa complexidade, e na verdade, a maioria dos gr√°ficos que fazemos se encaixa num pequeno subgrupo de todas essas especifica√ß√µes, ent√£o porque toda essa complexidade?&lt;/p&gt;
&lt;p&gt;Porque n√£o? Em primeiro lugar, se voc√™ est√° produzindo visualiza√ß√µes simples que cumprem seu prop√≥sito, voc√™ n√£o precisa se preocupar com quase nada disso, os &lt;strong&gt;padr√µes&lt;/strong&gt; do ggplot2, via de regra, se encaixam perfeitamente na maioria dos problemas e, em segundo lugar, se voc√™ sentir a necessidade de ir mais fundo e produzir visualiza√ß√µes mais complexas, as mesmas ferramentas que voc√™ j√° conhece est√£o a sua disposi√ß√£o.&lt;/p&gt;
&lt;h2 id=&#34;tr√™s-gr√°ficos-para-entender-a-mec√¢nica-do-ggplot2&#34;&gt;Tr√™s gr√°ficos para entender a mec√¢nica do ggplot2&lt;/h2&gt;
&lt;h3 id=&#34;scatterplots&#34;&gt;Scatterplots&lt;/h3&gt;
&lt;p&gt;Voltemos para o nosso gr√°fico original, vamos decomp√¥-lo em suas camadas como se estiv√©ssemos construindo ele passo-a-passo:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;# Primeiro, a camada dos dados e mapeamentos est√©ticos
ggplot(
  # Dados
  data = mpg,
  # Que vari√°vel vai em que eixo
  mapping = aes(x = displ, y = hwy)
)
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;https://laddem.github.io/courses/tidyverse/dia3_files/figure-html/unnamed-chunk-3-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;p&gt;Examinando a sa√≠da, vemos que ggplot desenhou um canvas com nossas vari√°veis, mas ainda nenhum objeto geom√©trico. Tudo bem, adicionamos (&lt;code&gt;+&lt;/code&gt;) uma camada de objetos geom√©tricos, no caso, pontos.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;# Objetos geom√©tricos come√ßam com &amp;quot;geom_&amp;quot;
ggplot(data = mpg, mapping = aes(x = displ, y = hwy)) + # adicionamos
  geom_point()
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;https://laddem.github.io/courses/tidyverse/dia3_files/figure-html/unnamed-chunk-4-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;p&gt;Agora, nosso gr√°fico j√° tem uma cara de diagrama de dispers√£o. Mas ainda n√£o tem as cores das classes de autom√≥vel. Tudo bem, voltamos para a primeira camada e informamos que queremos um terceiro mapeamento est√©tico.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;# A cor √© mapeada a vari√°vel class
ggplot(data = mpg, 
       mapping = aes(
         x = displ, y = hwy,
         color = class) # novo mapeamento est√©tico
       ) + # adicionamos
  geom_point()
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;https://laddem.github.io/courses/tidyverse/dia3_files/figure-html/unnamed-chunk-5-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;p&gt;Ok, chegamos no gr√°fico original. Mas como podem entender melhor as outras camadas? Vamos pensar, por exemplo, que talvez queiramos trabalhar a vari√°vel &lt;code&gt;hwy&lt;/code&gt; numa escala logar√≠tmica. Poder√≠amos transformar a vari√°vel original, claro, mas o &lt;code&gt;ggplot2&lt;/code&gt; nos permite especificar as transforma√ß√µes diretamente nas escalas do gr√°fico!&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;ggplot(data = mpg, mapping = aes(x = displ, y = hwy, color = class)) +
  geom_point() + # adicionando uma nova &amp;quot;camada&amp;quot;
  scale_y_continuous(trans = &amp;quot;log&amp;quot;)
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;https://laddem.github.io/courses/tidyverse/dia3_files/figure-html/unnamed-chunk-6-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;p&gt;Mas voc√™, leitor, n√£o ficou satisfeito. Voc√™ queria era transformar a vari√°vel &lt;code&gt;displ&lt;/code&gt; em ra√≠z quadrada. Tudo bem:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;ggplot(data = mpg, mapping = aes(x = displ, y = hwy, color = class)) +
  geom_point() +
  scale_x_continuous(trans = &amp;quot;sqrt&amp;quot;) # especificamos a transforma√ß√£o na escala de x
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;https://laddem.github.io/courses/tidyverse/dia3_files/figure-html/unnamed-chunk-7-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;p&gt;Outro leitor n√£o estava interessado nas escalas dos eixos x ou y, que s√£o cont√≠nuas nesse caso, mas sim na sele√ß√£o de cores utilizadas para representar a escala das cores. Por ser um leitor conhecedor das formas de defici√™ncia visual crom√°tica, ele optou pelas paletas de cores do &lt;code&gt;Colorbrewer&lt;/code&gt;:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;ggplot(data = mpg, mapping = aes(x = displ, y = hwy, color = class)) +
  geom_point() +
  scale_color_brewer(palette = &amp;quot;Set1&amp;quot;) # transforma√ß√£o da escala de cores
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;https://laddem.github.io/courses/tidyverse/dia3_files/figure-html/unnamed-chunk-8-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;p&gt;Um ge√≥grafo entrou na conversa e disse que o sistema cartesiano de coordenadas estava iludindo os leitores a pensar que a rela√ß√£o entre peso e consumo de combust√≠vel estava distorcida pelas diferen√ßas entre as unidades de medida das vari√°veis, produzida pelo sistema cartesiano de coordenadas, ent√£o ele sugeriu que us√°ssemos um sistema de coordenadas fixas:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;ggplot(data = mpg, mapping = aes(x = displ, y = hwy, color = class)) +
  geom_point() +
  scale_color_brewer(palette = &amp;quot;Set1&amp;quot;) +
  coord_fixed()
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;https://laddem.github.io/courses/tidyverse/dia3_files/figure-html/unnamed-chunk-9-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;p&gt;Ficou horr√≠vel, esse ge√≥grafo n√£o sabe nada. Como recompensa pela sua ignor√¢ncia, agora ele ocupa um cargo no primeiro escal√£o do Minist√©rio da Sa√∫de.&lt;/p&gt;
&lt;p&gt;Outro pesquisador estava interessado em visualizar as rela√ß√µes entre consumo, peso e classe, mas levando em considera√ß√£o o fabricante do ve√≠culo, ent√£o, ele sugeriu que constru√≠ssemos um gr√°fico para cada. Voc√™, que √© pregui√ßoso, usou a capacidade do &lt;code&gt;ggplot2&lt;/code&gt; de dividir gr√°ficos atrav√©s da introdu√ß√£o de uma camada de &lt;code&gt;facets&lt;/code&gt;.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;ggplot(data = mpg, mapping = aes(x = displ, y = hwy, color = class)) +
  geom_point() +
  scale_color_brewer(palette = &amp;quot;Set1&amp;quot;) + # adicionamos mais uma camada
  facet_wrap(~manufacturer)              # de facetas
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;https://laddem.github.io/courses/tidyverse/dia3_files/figure-html/unnamed-chunk-10-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;p&gt;Agora, muito satisfeitos com o resultado do nosso trabalho, resolvemos incluir o gr√°fico numa publica√ß√£o, mas do jeito que est√°, n√£o d√°. Ent√£o adicionamos mais algumas camadas para torn√°-lo apresent√°vel.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;ggplot(data = mpg, mapping = aes(x = displ, y = hwy, color = class)) +
  geom_point() +
  scale_color_brewer(palette = &amp;quot;Set1&amp;quot;) + 
  facet_wrap(~manufacturer) +
  # Colocamos os nomes nos eixos
  labs(title = &amp;quot;Rela√ß√£o entre peso e economia de combust√≠vel de autom√≥veis&amp;quot;,
       subtitle = &amp;quot;Separado por categoria e fabricante&amp;quot;,
       x = &amp;quot;Peso do ve√≠culo em toneladas&amp;quot;,
       y = &amp;quot;Consumo em milhas por gal√£o de 3,5l&amp;quot;,
       color = &amp;quot;Categoria&amp;quot;,
       caption = &amp;quot;Fonte: Ag√™ncia de Prote√ß√£o Ambiental Estadunidense.&amp;quot;) +
  # Escolhemos um tema bonito
  theme_light() +
  # Mudamos a posi√ß√£o da legenda, pra ficar mais jeitozinho
  theme(legend.position = &amp;quot;bottom&amp;quot;)
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;https://laddem.github.io/courses/tidyverse/dia3_files/figure-html/unnamed-chunk-11-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;p&gt;Pronto. Mam√£e vai ficar orgulhosa.&lt;/p&gt;
&lt;p&gt;Brincadeiras a parte, entendendo um pouco melhor a gram√°tica do gr√°fico, podemos construir nossas visualiza√ß√µes passo a passo, at√© chegar no resultado desejado.&lt;/p&gt;
&lt;h3 id=&#34;lineplots&#34;&gt;Lineplots&lt;/h3&gt;
&lt;p&gt;O segundo exemplo que quero mostrar pra voc√™s √© a constru√ß√£o de gr√°ficos com linhas. Eles s√£o interessantes porque d√£o bastante dor de cabe√ßa pra quem est√° come√ßando. Vamos continuar brincando com o &lt;code&gt;mpg&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Agora que eu fiz meu diagrama de dispers√£o, estou interessado em come√ßar um processo de modelagem, mas primeiro quero ter uma no√ß√£o visual da rela√ß√£o entre as vari√°veis.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;ggplot(mpg, aes(displ, hwy)) +
  geom_point() +
  geom_smooth()
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;https://laddem.github.io/courses/tidyverse/dia3_files/figure-html/unnamed-chunk-12-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;geom_smooth&lt;/code&gt; ajusta um modelo aos dados e desenha a linha com os valores preditos. Agora que temos dois objetos geom√©tricos, talvez seja interessante ver o que acontece se eu colocar as cores das classes.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;ggplot(mpg, aes(displ, hwy, color = class)) +
  geom_point() +
  geom_smooth(se = FALSE)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;https://laddem.github.io/courses/tidyverse/dia3_files/figure-html/unnamed-chunk-13-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;p&gt;Veja que ele fez o poss√≠vel para aplicar as escalas nos dois objetos geom√©tricos. Eu pedi para geom_smooth tirar os intervalos de confian√ßa para melhorar a visibilidade. Mas e seu eu quisesse ver a cor dos pontos, mas manter a linha de tend√™ncia geral? Voc√™ pode especificar mapeamentos est√©ticos gerais (na primeira camada) ou mapeamentos est√©ticos locais (dentro de cada camada geom√©trica).&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;ggplot(mpg, aes(displ, hwy)) + # mapeamentos gerais, se aplicam a todos os objetos
  geom_point(aes(color = class)) + # mapeamento local, s√≥ se aplica aqui
  geom_smooth(se = FALSE)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;https://laddem.github.io/courses/tidyverse/dia3_files/figure-html/unnamed-chunk-14-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;p&gt;Ok, mas e se eu quisesse um modelo linear ao inv√©s de um &amp;ldquo;Smoother de Loess&amp;rdquo;?&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;ggplot(mpg, aes(displ, hwy)) + 
  geom_point(aes(color = class)) +
  geom_smooth(method = lm)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## `geom_smooth()` using formula &#39;y ~ x&#39;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;https://laddem.github.io/courses/tidyverse/dia3_files/figure-html/unnamed-chunk-15-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;p&gt;N√£o vou entrar muito nos argumentos de cada objeto geom√©trico e fun√ß√£o, voc√™s podem aprender isso na pr√°tica olhando a documenta√ß√£o das fun√ß√µes que s√£o do interesse de voc√™s. &lt;code&gt;?geom_smooth&lt;/code&gt; para ver todas as possibilidades. Uma dica boa √© usar &lt;code&gt;geom_smooth&lt;/code&gt; para verificar intera√ß√µes entre vari√°veis num√©ricas e fatores.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;ggplot(mpg, aes(displ, hwy, color = factor(cyl))) + 
  geom_point() +
  geom_smooth(method = lm)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## `geom_smooth()` using formula &#39;y ~ x&#39;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;https://laddem.github.io/courses/tidyverse/dia3_files/figure-html/unnamed-chunk-16-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;p&gt;Ok, mas e se temos um gr√°fico de linhas mais tradicional, tipo uma s√©rie hist√≥rica?&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;economics
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 574 x 6
##    date         pce    pop psavert uempmed unemploy
##    &amp;lt;date&amp;gt;     &amp;lt;dbl&amp;gt;  &amp;lt;dbl&amp;gt;   &amp;lt;dbl&amp;gt;   &amp;lt;dbl&amp;gt;    &amp;lt;dbl&amp;gt;
##  1 1967-07-01  507. 198712    12.6     4.5     2944
##  2 1967-08-01  510. 198911    12.6     4.7     2945
##  3 1967-09-01  516. 199113    11.9     4.6     2958
##  4 1967-10-01  512. 199311    12.9     4.9     3143
##  5 1967-11-01  517. 199498    12.8     4.7     3066
##  6 1967-12-01  525. 199657    11.8     4.8     3018
##  7 1968-01-01  531. 199808    11.7     5.1     2878
##  8 1968-02-01  534. 199920    12.3     4.5     3001
##  9 1968-03-01  544. 200056    11.7     4.1     2877
## 10 1968-04-01  544  200208    12.3     4.6     2709
## # ... with 564 more rows
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Podemos criar um gr√°fico de linhas tendo como base a data (&lt;code&gt;date&lt;/code&gt;) e alguma das vari√°veis registradas, como a taxa de desemprego.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;ggplot(economics, aes(x = date, y = uempmed)) +
  geom_line()
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;https://laddem.github.io/courses/tidyverse/dia3_files/figure-html/unnamed-chunk-18-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;p&gt;Ou o consumo em bilh√µes de d√≥lares&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;ggplot(economics, aes(x = date, y = pce)) +
  geom_line()
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;https://laddem.github.io/courses/tidyverse/dia3_files/figure-html/unnamed-chunk-19-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;p&gt;Ou a popula√ß√£o&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;ggplot(economics, aes(x = date, y = pop)) +
  geom_line()
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;https://laddem.github.io/courses/tidyverse/dia3_files/figure-html/unnamed-chunk-20-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;p&gt;Ok, mas eu quero comparar visualmente o que ocorre com uma vari√°vel quando a outra muda. Podemos recorrer ao que aprendemos sobre mapeamentos est√©ticos globais e locais.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;ggplot(economics, aes(x = date)) +
  geom_line(aes(y = uempmed)) +
  geom_line(aes(y = pce)) +
  geom_line(aes(y = pop))
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;https://laddem.github.io/courses/tidyverse/dia3_files/figure-html/unnamed-chunk-21-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;p&gt;Ficou meio ruim, porque as vari√°vel tem grandezas distintas. Podemos tentar resolver esse problema aplicando transforma√ß√µes na vari√°vel idade, mas meio que pra qualquer lugar onde caminhos, batemos numa parede ou noutra. Esse tipo de solu√ß√£o √© muito frequente entre pessoas que vem do &lt;code&gt;base&lt;/code&gt; pro &lt;code&gt;ggplot2&lt;/code&gt;, porque no base estamos acostumado a ideia de adicionar mais objetos geom√©tricos ao nosso gr√°fico original adicionando invoca√ß√µes √† fun√ß√µes como &lt;code&gt;lines&lt;/code&gt; ou &lt;code&gt;text&lt;/code&gt;. Por√©m, a solu√ß√£o preferida no &lt;code&gt;tidyverse&lt;/code&gt; √© aplicar uma transforma√ß√£o no banco original de tal forma que as nossas vari√°veis num√©ricas caiam todas num par que especifica &lt;code&gt;o nome da vari√°vel | e o valor dela&lt;/code&gt;.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;library(tidyr)
economics %&amp;gt;% 
  pivot_longer(cols = -date,
               names_to = &amp;quot;variavel&amp;quot;,
               values_to = &amp;quot;valor&amp;quot;)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 2,870 x 3
##    date       variavel    valor
##    &amp;lt;date&amp;gt;     &amp;lt;chr&amp;gt;       &amp;lt;dbl&amp;gt;
##  1 1967-07-01 pce         507. 
##  2 1967-07-01 pop      198712  
##  3 1967-07-01 psavert      12.6
##  4 1967-07-01 uempmed       4.5
##  5 1967-07-01 unemploy   2944  
##  6 1967-08-01 pce         510. 
##  7 1967-08-01 pop      198911  
##  8 1967-08-01 psavert      12.6
##  9 1967-08-01 uempmed       4.7
## 10 1967-08-01 unemploy   2945  
## # ... with 2,860 more rows
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Talvez n√£o fique imediatamente claro para todos porque eu optei por esta solu√ß√£o, mas talvez essa pr√≥xima figura fale mais que mil palavras.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;economics %&amp;gt;% 
  pivot_longer(cols = -date,
               names_to = &amp;quot;variavel&amp;quot;,
               values_to = &amp;quot;valor&amp;quot;) %&amp;gt;% 
  ggplot(aes(date, valor)) +
  geom_line() +
  facet_wrap(~variavel, scales = &amp;quot;free_y&amp;quot;, ncol = 1)
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;https://laddem.github.io/courses/tidyverse/dia3_files/figure-html/unnamed-chunk-23-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;p&gt;A √™nfase em usar &lt;code&gt;tidy data&lt;/code&gt; no &lt;code&gt;tidyverse&lt;/code&gt; decorre do fato de que todos os pacotes s√£o programados para usar a forma de organiza√ß√£o do banco como uma alavanca para facilitar a an√°lise de dados. Vejam esta outra &lt;code&gt;pipeline&lt;/code&gt;.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;# Como vamos fazer algumas transforma√ß√µes nos dados, vamos carregar o dplyr aqui
library(dplyr)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## 
## Attaching package: &#39;dplyr&#39;
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## The following objects are masked from &#39;package:stats&#39;:
## 
##     filter, lag
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## The following objects are masked from &#39;package:base&#39;:
## 
##     intersect, setdiff, setequal, union
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;economics %&amp;gt;% 
  pivot_longer(cols = -date,
               names_to = &amp;quot;variavel&amp;quot;,
               values_to = &amp;quot;valor&amp;quot;) %&amp;gt;% 
  filter(variavel %in% c(&amp;quot;psavert&amp;quot;, &amp;quot;uempmed&amp;quot;)) %&amp;gt;% 
  ggplot(aes(date, valor, color = variavel, shape = variavel)) +
  geom_line()
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;https://laddem.github.io/courses/tidyverse/dia3_files/figure-html/unnamed-chunk-24-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;p&gt;E agora vejam um dos erros mais comuns de quem est√° come√ßando:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;economics %&amp;gt;% 
  pivot_longer(cols = -date,
               names_to = &amp;quot;variavel&amp;quot;,
               values_to = &amp;quot;valor&amp;quot;) %&amp;gt;% 
  filter(variavel %in% c(&amp;quot;psavert&amp;quot;, &amp;quot;uempmed&amp;quot;)) %&amp;gt;% 
  ggplot(aes(date, valor)) +
  geom_line()
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;https://laddem.github.io/courses/tidyverse/dia3_files/figure-html/unnamed-chunk-25-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;p&gt;Ao n√£o especificar uma separa√ß√£o entre grupos, o &lt;code&gt;ggplot2&lt;/code&gt; n√£o interpreta meus dados! Ele simplesmente conecta as observa√ß√µes mais ou menos na ordem em que elas aparecem no eixo x. Para resolver esse problema, precisamos especificar grupos! Seja indiretamente, atrav√©s de uma escala de cores, formas ou tipos de linha, seja diretamente atrav√©s da est√©tica &lt;code&gt;groups&lt;/code&gt;.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;economics %&amp;gt;% 
  pivot_longer(cols = -date,
               names_to = &amp;quot;variavel&amp;quot;,
               values_to = &amp;quot;valor&amp;quot;) %&amp;gt;% 
  filter(variavel %in% c(&amp;quot;psavert&amp;quot;, &amp;quot;uempmed&amp;quot;)) %&amp;gt;% 
  ggplot(aes(date, valor, group = variavel)) +
  geom_line()
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;https://laddem.github.io/courses/tidyverse/dia3_files/figure-html/unnamed-chunk-26-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;economics %&amp;gt;% 
  pivot_longer(cols = -date,
               names_to = &amp;quot;variavel&amp;quot;,
               values_to = &amp;quot;valor&amp;quot;) %&amp;gt;% 
  filter(variavel %in% c(&amp;quot;psavert&amp;quot;, &amp;quot;uempmed&amp;quot;)) %&amp;gt;% 
  ggplot(aes(date, valor, color = variavel, linetype = variavel)) +
  geom_line()
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;https://laddem.github.io/courses/tidyverse/dia3_files/figure-html/unnamed-chunk-27-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;p&gt;Legal n√©?&lt;/p&gt;
&lt;h3 id=&#34;barcharts&#34;&gt;Barcharts&lt;/h3&gt;
&lt;p&gt;Para terminar e ilustrar alguns exemplos de transforma√ß√£o estat√≠stica, vamos fazer alguns gr√°ficos de barras usando o &lt;code&gt;diamonds&lt;/code&gt;, um banco de dados para fazer a alegria das piores pessoas na hist√≥ria da humanidade.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;diamonds
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 53,940 x 10
##    carat cut       color clarity depth table price     x     y     z
##    &amp;lt;dbl&amp;gt; &amp;lt;ord&amp;gt;     &amp;lt;ord&amp;gt; &amp;lt;ord&amp;gt;   &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt; &amp;lt;int&amp;gt; &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt;
##  1  0.23 Ideal     E     SI2      61.5    55   326  3.95  3.98  2.43
##  2  0.21 Premium   E     SI1      59.8    61   326  3.89  3.84  2.31
##  3  0.23 Good      E     VS1      56.9    65   327  4.05  4.07  2.31
##  4  0.29 Premium   I     VS2      62.4    58   334  4.2   4.23  2.63
##  5  0.31 Good      J     SI2      63.3    58   335  4.34  4.35  2.75
##  6  0.24 Very Good J     VVS2     62.8    57   336  3.94  3.96  2.48
##  7  0.24 Very Good I     VVS1     62.3    57   336  3.95  3.98  2.47
##  8  0.26 Very Good H     SI1      61.9    55   337  4.07  4.11  2.53
##  9  0.22 Fair      E     VS2      65.1    61   337  3.87  3.78  2.49
## 10  0.23 Very Good H     VS1      59.4    61   338  4     4.05  2.39
## # ... with 53,930 more rows
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Que tal um gr√°fico b√°sico, do n√∫mero de diamantes de acordo com a qualidade de seu corte (&lt;code&gt;cut&lt;/code&gt;). Olhando a ajuda do &lt;code&gt;?geom_bar&lt;/code&gt; voc√™ vai na certeza de que voc√™ entendeu a aula e escreve o seguinte c√≥digo:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;ggplot(diamonds, aes(x = cut, color = cut)) +
  geom_bar()
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;https://laddem.github.io/courses/tidyverse/dia3_files/figure-html/unnamed-chunk-29-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;p&gt;E agora, voc√™ fica olhando pro seu computador com cara de tacho. O que aconteceu? Bom, no caso de &lt;code&gt;geoms&lt;/code&gt; com duas dimens√µes, podem existir casos em que voc√™ quer dar mapeamentos est√©ticos distintos para as bordas e para o conte√∫do deles. Por isso, existem as est√©ticas &lt;code&gt;color&lt;/code&gt; e &lt;code&gt;fill&lt;/code&gt;. Voc√™ pode pensar nelas como a casca do p√£o e o recheio.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;ggplot(diamonds, aes(x = cut, fill = cut)) +
  geom_bar()
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;https://laddem.github.io/courses/tidyverse/dia3_files/figure-html/unnamed-chunk-30-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;p&gt;Mas, voc√™ ainda n√£o est√° satisfeito. Pela sua ampla experi√™ncia com uma das ind√∫strias mais sangrentas e retr√≥gadas do planeta voc√™ entende que a qualidade do corte n√£o √© o suficiente para determinar o valor de um diamante, ent√£o voc√™ quer ver a distribui√ß√£o tamb√©m pelo n√≠vel de transpar√™ncia do diamante, codificado na vari√°vel &lt;code&gt;clarity&lt;/code&gt;.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;ggplot(diamonds, aes(x = cut, fill = clarity)) +
  geom_bar()
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;https://laddem.github.io/courses/tidyverse/dia3_files/figure-html/unnamed-chunk-31-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;p&gt;Esse √© um primeiro passo interessante, e se tivessemos apenas duas ou tr√™s categorias, a gente poderia parar por a√≠. Mas no geral, para facilitar compara√ß√µes, queremos poder controlar o posicionamento das barras. Isso √© poss√≠vel ajustando o argumento &lt;code&gt;position&lt;/code&gt; dos &lt;code&gt;geoms&lt;/code&gt; onde isso √© necess√°rio.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;# O padr√£o
ggplot(diamonds, aes(x = cut, fill = clarity)) +
  geom_bar(position = &amp;quot;stack&amp;quot;)
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;https://laddem.github.io/courses/tidyverse/dia3_files/figure-html/unnamed-chunk-32-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;# O certo
ggplot(diamonds, aes(x = cut, fill = clarity)) +
  geom_bar(position = &amp;quot;dodge&amp;quot;)
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;https://laddem.github.io/courses/tidyverse/dia3_files/figure-html/unnamed-chunk-32-2.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;# Empilhadas a 100%, para facilitar compara√ß√µes entre categorias
ggplot(diamonds, aes(x = cut, fill = clarity)) +
  geom_bar(position = &amp;quot;fill&amp;quot;)
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;https://laddem.github.io/courses/tidyverse/dia3_files/figure-html/unnamed-chunk-32-3.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;p&gt;Pode parecer jocoso, mas em 99% dos casos, o correto √© voc√™ usar barras lado-a-lado, assim voc√™ visualmente pode comparar as categorias simplesmente comparando a altura das barras. Da pr√≥xima vez que voc√™ pensar em construir um gr√°fico de pizza, desista e fa√ßa um gr√°fico de barras com &lt;code&gt;position = &amp;quot;dodge&amp;quot;&lt;/code&gt;. Seus leitores v√£o agradecer.&lt;/p&gt;
&lt;p&gt;Esse exemplo tamb√©m √© legal para gente olhar um pouco para a parte de transforma√ß√µes estat√≠sticas nas vari√°veis:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;diamonds2 &amp;lt;- diamonds %&amp;gt;% 
  count(cut) %&amp;gt;% 
  mutate(prop = n/sum(n))

diamonds2 %&amp;gt;% 
  ggplot() +
  geom_bar(aes(x = cut, y = prop), stat = &amp;quot;identity&amp;quot;)
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;https://laddem.github.io/courses/tidyverse/dia3_files/figure-html/unnamed-chunk-33-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;p&gt;Por padr√£o, &lt;code&gt;geom_bar&lt;/code&gt; j√° faz o primeiro passo e utiliza as contagens (&lt;code&gt;stat_count&lt;/code&gt;) para produzir o gr√°fico de barras, mas eu posso mudar esse comportamento atrav√©s do argumento &lt;code&gt;stat&lt;/code&gt;. Eu tamb√©m posso querer mostrar propr√ß√µes ao inv√©s de contagens de outra forma mais sucinta.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;ggplot(diamonds, aes(x = cut, 
                     # ao fazer isso, eu mudo o padr√£o de contagens para propor√ß√µes.
                     y = stat(prop), 
                     # preciso especificar o grupo, se n√£o todas as barras v√£o a 100%.
                     group = 1)) +
  geom_bar()
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;https://laddem.github.io/courses/tidyverse/dia3_files/figure-html/unnamed-chunk-34-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;p&gt;Voc√™ pode construir seus gr√°ficos a partir de transforma√ß√µes estat√≠sticas ao inv√©s de objetos geom√©tricos:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;ggplot(data = diamonds) + 
  stat_summary(
    mapping = aes(x = cut, y = depth),
    fun.min = min,
    fun.max = max,
    fun = median
  )
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;https://laddem.github.io/courses/tidyverse/dia3_files/figure-html/unnamed-chunk-35-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;p&gt;As transforma√ß√µes estat√≠sticas come√ßam sempre com &lt;code&gt;stat_&lt;/code&gt; e cada uma tem um objeto geom√©trico padr√£o, que voc√™ pode mudar com o argumento &lt;code&gt;geom&lt;/code&gt;.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;ggplot(data = diamonds) + 
  stat_summary(
    mapping = aes(x = cut, y = depth),
    fun.min = min,
    fun.max = max,
    # N√£o d√° pra mostrar a mediana com barras de erro, sorry
    #fun = median,
    geom = &amp;quot;errorbar&amp;quot;
  )
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;https://laddem.github.io/courses/tidyverse/dia3_files/figure-html/unnamed-chunk-36-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;p&gt;E era basicamente isso que eu tinha a dizer sobre como construir gr√°ficos no &lt;code&gt;ggplot2&lt;/code&gt;! Abaixo, uma se√ß√£o com alguns detalhes para quem tiver interesse nessa parte de embelezamento dos gr√°ficos.&lt;/p&gt;
&lt;h2 id=&#34;perfumaria&#34;&gt;Perfumaria&lt;/h2&gt;
&lt;p&gt;Essa se√ß√£o pretende introduzir um pouco uma parte de customiza√ß√£o dos gr√°ficos. Frequentemente, as publica√ß√µes de regras mais estritas sobre formatos, fontes, temas, etc. As op√ß√µes padr√£o do &lt;code&gt;ggplot2&lt;/code&gt; podem n√£o se acomodar, ent√£o, cabe a n√≥s ajeitar essa reta final.&lt;/p&gt;
&lt;h3 id=&#34;t√≠tulos-e-r√≥tulos&#34;&gt;T√≠tulos e r√≥tulos&lt;/h3&gt;
&lt;p&gt;A melhor maneira de ajustar t√≠tulos e r√≥tulos √© atrav√©s de &lt;code&gt;labs&lt;/code&gt;, porque voc√™ resolve tudo em uma s√≥ invoca√ß√£o. Mas tamb√©m h√° uma fun√ß√£o &lt;code&gt;ggtitle&lt;/code&gt;. Com ela, √© poss√≠vel setar apenas t√≠tulo e subt√≠tulo.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;ggplot(mpg, aes(displ, hwy, color = class)) +
  geom_point() +
  ggtitle(&amp;quot;T√≠tulo do gr√°fico&amp;quot;, &amp;quot;Subt√≠tulo do gr√°fico&amp;quot;)
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;https://laddem.github.io/courses/tidyverse/dia3_files/figure-html/unnamed-chunk-37-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;p&gt;A maioria das op√ß√µes de customiza√ß√£o mais fina est√° na camada &lt;code&gt;theme&lt;/code&gt;. Internamente, cada elemento do gr√°fico √© controlado por uma fun√ß√£o &lt;code&gt;element_&lt;/code&gt;, por exemplo, &lt;code&gt;element_text&lt;/code&gt; desenha textos e recebe argumentos relativos a isso, como fam√≠lia da fonte, tamanho, cor, etc.&lt;/p&gt;
&lt;p&gt;Ali, voc√™ tem um controle mais direto sobre a constru√ß√£o do gr√°fico. No que diz respeito aos r√≥tulos, podemos mudar a fonte do t√≠tulo.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;ggplot(mpg, aes(displ, hwy, color = class)) +
  geom_point() +
  ggtitle(&amp;quot;T√≠tulo do gr√°fico&amp;quot;, &amp;quot;Subt√≠tulo do gr√°fico&amp;quot;) +
  # Family √© meio complicado de mudar, mas voc√™ pode escolher serif, sans ou mono
  theme(plot.title = element_text(family = &amp;quot;serif&amp;quot;, face = &amp;quot;bold&amp;quot;, colour = &amp;quot;red&amp;quot;),
        plot.subtitle = element_text(family = &amp;quot;mono&amp;quot;, face = &amp;quot;italic&amp;quot;, color = &amp;quot;forestgreen&amp;quot;))
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;https://laddem.github.io/courses/tidyverse/dia3_files/figure-html/unnamed-chunk-38-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;p&gt;Usando uma s√≠ntaxe similar e os argumentos da fun√ß√£o &lt;code&gt;element_text&lt;/code&gt;, voc√™ pode mudar qual outro elemento textual do gr√°fico.&lt;/p&gt;
&lt;h3 id=&#34;eixos&#34;&gt;Eixos&lt;/h3&gt;
&lt;p&gt;Continuando o nosso frankenstein, podemos fazer altera√ß√µes nos eixos, como remover peda√ßos de um eixo, modificar sua forma, seu √¢ngulo e ajustar sua posi√ß√£o.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;ggplot(mpg, aes(displ, hwy, color = class)) +
  geom_point() +
  ggtitle(&amp;quot;T√≠tulo do gr√°fico&amp;quot;, &amp;quot;Subt√≠tulo do gr√°fico&amp;quot;) +
  # Family √© meio complicado de mudar, mas voc√™ pode escolher serif, sans ou mono
  theme(plot.title = element_text(family = &amp;quot;serif&amp;quot;, face = &amp;quot;bold&amp;quot;, colour = &amp;quot;red&amp;quot;),
        plot.subtitle = element_text(family = &amp;quot;mono&amp;quot;, face = &amp;quot;italic&amp;quot;, color = &amp;quot;forestgreen&amp;quot;),
        # voc√™ pode remover peda√ßos inteiros do gr√°fico com &amp;quot;element_blank()&amp;quot;
        axis.ticks.y = element_blank(),
        axis.text.y = element_blank(),
        axis.title.y = element_blank(),
        # voc√™ pode mudar a orienta√ß√£o, angulo, posi√ß√£o e at√© formato de elementos
        axis.title = element_text(angle = 90, hjust = 1),
        axis.text.x = element_text(angle = 45, vjust = 1),
        axis.ticks.x = element_line(
          colour = &amp;quot;royalblue3&amp;quot;,
          arrow = grid::arrow(angle = 45, length = unit(0.5, &amp;quot;cm&amp;quot;), ends = &amp;quot;first&amp;quot;, type = &amp;quot;closed&amp;quot;))
  )
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;https://laddem.github.io/courses/tidyverse/dia3_files/figure-html/unnamed-chunk-39-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;p&gt;Realmente, o c√©u √© o limite e voc√™ pode deixar o seu gr√°fico t√£o horr√≠vel quanto voc√™ quiser.&lt;/p&gt;
&lt;h3 id=&#34;legendas&#34;&gt;Legendas&lt;/h3&gt;
&lt;p&gt;Legendas no &lt;code&gt;ggplot2&lt;/code&gt; s√£o controladas em alguns lugares diferentes. Elas s√£o tratadas como guias (&lt;code&gt;guides&lt;/code&gt;) no sentido de que s√£o guias para o leitor. Vamos pegar outra vari√°vel de cores, para poder brincar com diferentes tipos de legenda.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;ggplot(mpg, aes(displ, hwy, color = cyl)) +
  geom_point()
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;https://laddem.github.io/courses/tidyverse/dia3_files/figure-html/unnamed-chunk-40-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;p&gt;Por padr√£o, ele entende cilindros como num√©rico e faz uma barra de cores cont√≠nua. Mas eu quero uma legenda!&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;# Jeito 1 - Simples e r√°pido
ggplot(mpg, aes(displ, hwy, color = cyl)) +
  geom_point() +
  guides(color = &amp;quot;legend&amp;quot;)
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;https://laddem.github.io/courses/tidyverse/dia3_files/figure-html/unnamed-chunk-41-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;# Jeito 2 - Posso mudar detalhes!
ggplot(mpg, aes(displ, hwy, color = cyl)) +
  geom_point() +
  guides(color = guide_legend(title = &amp;quot;Cilindrossss&amp;quot;,
                              title.position = &amp;quot;right&amp;quot;,
                              label.position = &amp;quot;bottom&amp;quot;,
                              direction = &amp;quot;horizontal&amp;quot;))
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;https://laddem.github.io/courses/tidyverse/dia3_files/figure-html/unnamed-chunk-41-2.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;# Jeito 3 - Mexendo diretamente nas escalas
ggplot(mpg, aes(displ, hwy, color = cyl)) +
  geom_point() +
  # Minha escala de cores preferida
  scale_color_viridis_c(guide = &amp;quot;legend&amp;quot;, option = &amp;quot;B&amp;quot;)
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;https://laddem.github.io/courses/tidyverse/dia3_files/figure-html/unnamed-chunk-41-3.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;# Jeito 3 - de novo, mas agora usando a especifica√ß√£o mais completa do guia
ggplot(mpg, aes(displ, hwy, color = cyl)) +
  geom_point() +
  # Minha escala de cores preferida
  scale_color_viridis_c(
    guide = guide_legend(title = &amp;quot;Cilindrossss&amp;quot;,
                         title.position = &amp;quot;right&amp;quot;,
                         label.position = &amp;quot;bottom&amp;quot;,
                         direction = &amp;quot;horizontal&amp;quot;), 
    option = &amp;quot;B&amp;quot;)
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;https://laddem.github.io/courses/tidyverse/dia3_files/figure-html/unnamed-chunk-41-4.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;p&gt;Em qualquer lugar onde voc√™ possa especificar &lt;code&gt;guides&lt;/code&gt;, voc√™ pode passar o valor &lt;code&gt;FALSE&lt;/code&gt; para remover a legenda.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;# Na camada &amp;quot;guides()&amp;quot;
ggplot(mpg, aes(displ, hwy, color = cyl, size = cyl)) +
  geom_point() +
  guides(color = FALSE)
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;https://laddem.github.io/courses/tidyverse/dia3_files/figure-html/unnamed-chunk-42-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;# Na pr√≥pria escala
ggplot(mpg, aes(displ, hwy, color = cyl, size = cyl)) +
  geom_point() +
  scale_size(guide = FALSE)
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;https://laddem.github.io/courses/tidyverse/dia3_files/figure-html/unnamed-chunk-42-2.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;# B√¥nus = no tema, mas a√≠ voc√™ remove todas
ggplot(mpg, aes(displ, hwy, color = cyl, size = cyl)) +
  geom_point() +
  theme(legend.position = &amp;quot;none&amp;quot;)
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;https://laddem.github.io/courses/tidyverse/dia3_files/figure-html/unnamed-chunk-42-3.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;h3 id=&#34;escalas&#34;&gt;Escalas&lt;/h3&gt;
&lt;p&gt;J√° dei uma palhinha de editar escalas, antes, ent√£o aqui vai um pouco mais de detalhe:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;ggplot(mpg, aes(displ, hwy, color = cyl, size = cyl)) +
  geom_point()
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;https://laddem.github.io/courses/tidyverse/dia3_files/figure-html/unnamed-chunk-43-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;# Mudar as cores manualmente
cores &amp;lt;- c(&amp;quot;red&amp;quot;, &amp;quot;green&amp;quot;, &amp;quot;blue&amp;quot;, &amp;quot;yellow&amp;quot;, &amp;quot;purple&amp;quot;, &amp;quot;tomato&amp;quot;, &amp;quot;wheat2&amp;quot;)

ggplot(mpg, aes(displ, hwy, color = class, size = cyl)) +
  geom_point() +
  scale_color_manual(values = cores)
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;https://laddem.github.io/courses/tidyverse/dia3_files/figure-html/unnamed-chunk-43-2.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;# Mudar os tamanhos
ggplot(mpg, aes(displ, hwy, color = class, size = cyl)) +
  geom_point() +
  scale_color_manual(values = cores) +
  # scale_radius para fazer proprcional ao raio
  scale_radius(range = c(3,6))
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;https://laddem.github.io/courses/tidyverse/dia3_files/figure-html/unnamed-chunk-43-3.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;ggplot(mpg, aes(displ, hwy, color = class, size = cyl)) +
  geom_point() +
  scale_color_manual(values = cores) +
  # scale_size para fazer proprcional a √°rea
  scale_size(range = c(2,4))
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;https://laddem.github.io/courses/tidyverse/dia3_files/figure-html/unnamed-chunk-43-4.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;p&gt;√â poss√≠vel aplicar transforma√ß√µes na vari√°vel diretamente na escala, mudar o n√∫mero de &lt;code&gt;breaks&lt;/code&gt; e especificar &lt;code&gt;labels&lt;/code&gt; e alterar os limites do gr√°fico manualmente.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;ggplot(mpg, aes(displ, hwy, color = class, size = cyl)) +
  geom_point() +
  scale_x_continuous(trans = &amp;quot;sqrt&amp;quot;, name = &amp;quot;Peso&amp;quot;) +
  scale_y_continuous(
    name   = &amp;quot;Consumo (rodovia)&amp;quot;,
    limits = c(0, 50),
    breaks = c(10, 20, 30, 40, 50), 
    labels = c(&amp;quot;fogo no clima&amp;quot;, &amp;quot;aquecimento global&amp;quot;, &amp;quot;caldeira planet√°ria&amp;quot;, &amp;quot;deixa pra pr√≥xima gera√ß√£o&amp;quot;, &amp;quot;desastre em c√¢mera lenta&amp;quot;))
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;https://laddem.github.io/courses/tidyverse/dia3_files/figure-html/unnamed-chunk-44-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;p&gt;Cada escala vai ter argumentos espec√≠ficos que fazem sentido em seu pr√≥prio contexto. Escalas cont√≠nuas tem argumentos para transforma√ß√£o estat√≠stica, escalas discretas n√£o aceitam argumentos cont√≠nuos e etc.&lt;/p&gt;
&lt;p&gt;Isto encerra nossa parte de &lt;code&gt;ggplot2&lt;/code&gt;, que tal uns exerc√≠cios pra esquentar?&lt;/p&gt;
&lt;h2 id=&#34;exerc√≠cios&#34;&gt;Exerc√≠cios&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;O que tem de errado no c√≥digo abaixo? Por que os pontos n√£o ficaram azuis?&lt;/li&gt;
&lt;/ol&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy, color = &amp;quot;blue&amp;quot;))
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;https://laddem.github.io/courses/tidyverse/dia3_files/figure-html/unnamed-chunk-45-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;ol start=&#34;2&#34;&gt;
&lt;li&gt;
&lt;p&gt;Utilizando o banco &lt;code&gt;mpg&lt;/code&gt;, fa√ßa o diagrama de dispers√£o de &lt;code&gt;displ&lt;/code&gt; por &lt;code&gt;hwy&lt;/code&gt; e mapeie a cor para &lt;code&gt;class&lt;/code&gt;, o tamanho para &lt;code&gt;cyl&lt;/code&gt; e a forma para &lt;code&gt;manufacturer&lt;/code&gt;. Como esses atributos est√©ticos se comportam diferente para vari√°veis categ√≥ricas vs cont√≠nuas?&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Utilizando o &lt;code&gt;diamonds&lt;/code&gt;, crie um diagrama de dispers√£o que relacione &lt;code&gt;carat&lt;/code&gt; com &lt;code&gt;price&lt;/code&gt;. Explore algumas outras vari√°veis utilizando escalas de cor para ver se voc√™ identifica algum padr√£o. Aplique transforma√ß√µes nas vari√°veis que voc√™ considerar justificadas.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Ainda continuando o exemplo anterior, aplique um &lt;code&gt;geom_smooth&lt;/code&gt; utilizando v√°rias op√ß√µes de &lt;code&gt;method&lt;/code&gt; para as vari√°veis originais ou transformadas.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;No nosso gr√°fico de barras usando &lt;code&gt;stat(prop)&lt;/code&gt; a gente precisou colocar &lt;code&gt;group = 1&lt;/code&gt;, porque? Qual √© a diferen√ßa entre esses dois c√≥digos?&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;ggplot(data = diamonds) + 
  geom_bar(mapping = aes(x = cut, y = after_stat(prop)))
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;https://laddem.github.io/courses/tidyverse/dia3_files/figure-html/unnamed-chunk-47-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;ggplot(data = diamonds) + 
  geom_bar(mapping = aes(x = cut, fill = color, y = after_stat(prop)))
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;https://laddem.github.io/courses/tidyverse/dia3_files/figure-html/unnamed-chunk-47-2.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;ol start=&#34;6&#34;&gt;
&lt;li&gt;&lt;code&gt;stat_smooth&lt;/code&gt; √© muito parecido com &lt;code&gt;geom_smooth&lt;/code&gt;, mas h√° uma diferen√ßa sutil. Compare os c√≥digos abaixo.&lt;/li&gt;
&lt;/ol&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;ggplot(mpg, aes(displ, hwy)) + 
  geom_point() +
  geom_smooth()
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;https://laddem.github.io/courses/tidyverse/dia3_files/figure-html/unnamed-chunk-48-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;ggplot(mpg, aes(displ, hwy)) + 
  geom_point() +
  stat_smooth(geom = &amp;quot;step&amp;quot;)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;https://laddem.github.io/courses/tidyverse/dia3_files/figure-html/unnamed-chunk-48-2.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;ggplot(mpg, aes(displ, hwy)) + 
  geom_point() +
  stat_smooth(geom = &amp;quot;linerange&amp;quot;)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;https://laddem.github.io/courses/tidyverse/dia3_files/figure-html/unnamed-chunk-48-3.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;ggplot(mpg, aes(displ, hwy)) + 
  geom_point() +
  stat_smooth(geom = &amp;quot;errorbar&amp;quot;)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;https://laddem.github.io/courses/tidyverse/dia3_files/figure-html/unnamed-chunk-48-4.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;ggplot(mpg, aes(displ, hwy)) + 
  geom_point() +
  stat_smooth(geom = &amp;quot;crossbar&amp;quot;)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;https://laddem.github.io/courses/tidyverse/dia3_files/figure-html/unnamed-chunk-48-5.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;ol start=&#34;7&#34;&gt;
&lt;li&gt;
&lt;p&gt;Usando o &lt;code&gt;mpg&lt;/code&gt; e &lt;code&gt;facet_grid&lt;/code&gt;, crie um scatterplot que contenha &lt;code&gt;displ&lt;/code&gt; no eixo x, &lt;code&gt;hwy&lt;/code&gt; no eixo y, &lt;code&gt;class&lt;/code&gt; na cor, &lt;code&gt;drv&lt;/code&gt; nas facetas-coluna e &lt;code&gt;cyl&lt;/code&gt; nas facetas linha.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Voc√™ acha que os dois gr√°ficos abaixo ficar√£o diferentes um do outro? Porque? Tente responder antes de rodar o c√≥digo.&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;ggplot(data = mpg, mapping = aes(x = displ, y = hwy)) + 
  geom_point() + 
  geom_smooth()
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;https://laddem.github.io/courses/tidyverse/dia3_files/figure-html/unnamed-chunk-50-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;ggplot() + 
  geom_point(data = mpg, mapping = aes(x = displ, y = hwy)) + 
  geom_smooth(data = mpg, mapping = aes(x = displ, y = hwy))
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;https://laddem.github.io/courses/tidyverse/dia3_files/figure-html/unnamed-chunk-50-2.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;ol start=&#34;9&#34;&gt;
&lt;li&gt;Tente recriar o seguinte gr√°fico&lt;/li&gt;
&lt;/ol&gt;
&lt;pre&gt;&lt;code&gt;## `geom_smooth()` using formula &#39;y ~ x&#39;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;https://laddem.github.io/courses/tidyverse/dia3_files/figure-html/unnamed-chunk-51-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;ol start=&#34;10&#34;&gt;
&lt;li&gt;Transforme o gr√°fico seguir em um gr√°fico de pizza usando &lt;code&gt;coord_polar&lt;/code&gt;.&lt;/li&gt;
&lt;/ol&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;ggplot(diamonds, aes(cut, fill = cut)) +
  geom_bar()
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;https://laddem.github.io/courses/tidyverse/dia3_files/figure-html/unnamed-chunk-52-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>purrr</title>
      <link>https://laddem.github.io/courses/tidyverse/dia4/</link>
      <pubDate>Sun, 23 May 2021 00:00:00 +0000</pubDate>
      <guid>https://laddem.github.io/courses/tidyverse/dia4/</guid>
      <description>&lt;p&gt;O autor dos pacotes do &lt;code&gt;tidyverse&lt;/code&gt; core √© completamente fascinado por gatos, por isso, tantas refer√™ncias ao bixo nos nomes dos pacotes. &amp;ldquo;Purr&amp;rdquo; (em ingl√™s) √© o som que os gatos fazem quando sentem prazer. Pra n√£o ficar uma coisa solta no come√ßo da aula, aqui uma foto de gatinho pra voc√™s:&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://laddem.github.io/courses/tidyverse/dia4_files/amy-cat.jpg&#34; alt=&#34;Amy, the cat&#34;&gt;&lt;/p&gt;
&lt;!-- Inciting incident --&gt;
&lt;p&gt;O assunto da aula de hoje √© talvez um pouco mais abstrato do que as aulas anteriores. Vamos falar bastante de fun√ß√µes, loops e programa√ß√£o funcional. S√£o termos que fazem parte do jarg√£o da computa√ß√£o, mas que mesmo usu√°rios veteranos do R como software estat√≠stico para an√°lise de dados podem ter pouca familiaridade. Ao inv√©s de come√ßar definindo o que vamos fazer, vou come√ßar definindo o que n√£o vamos.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;N√£o vamos revisar a fundo o assunto de itera√ß√µes. Os livros fazem um bom servi√ßo, √© um assunto espinhoso e n√£o basta compreender os conceitos, tem que botar a m√£o na massa pra ter um entendimento n√£o apenas da teoria, mas tamb√©m para conseguir resolver os muitos problemas que aparecem quando voc√™ est√° construindo itera√ß√µes com maior n√≠vel de complexidade.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;N√£o vamos cavar fundo em todos os aspectos da programa√ß√£o funcional ou de todas as fun√ß√µes do purrr. S√£o muitas e temos poucas horas.&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Agora o que SIM vamos fazer √© revisar muito brevemente a sintaxe de um for loop, ver em que situa√ß√µes a gente o utilizaria e como voc√™ pode substituir seus v√°rios for loops por fun√ß√µes no purrr, com exemplos de aplica√ß√£o quando poss√≠vel. Se der tempo, vamos entrar um pouco na ideia de utilizar programa√ß√£o funcional para resolver problemas mais gen√©ricos em que precisamos generalizar alguma tarefa.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;# Primeiro, nossos pacotes!
library(tidyverse) # o purrr j√° √© carregado automaticamente junto com os outros,
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## -- Attaching packages --------------------------------------- tidyverse 1.3.1 --
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## v ggplot2 3.3.3     v purrr   0.3.4
## v tibble  3.1.2     v dplyr   1.0.6
## v tidyr   1.1.3     v stringr 1.4.0
## v readr   1.4.0     v forcats 0.5.1
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## -- Conflicts ------------------------------------------ tidyverse_conflicts() --
## x dplyr::filter() masks stats::filter()
## x dplyr::lag()    masks stats::lag()
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;# Se quiser carregar apenas o purrr, descomente a linha abaixo
# library(purrr)
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;itera√ß√µes&#34;&gt;Itera√ß√µes&lt;/h2&gt;
&lt;p&gt;Do ponto de vista pr√°tico, uma itera√ß√£o √© uma repeti√ß√£o uma linha de c√≥digo de tal forma que apenas uma pequena parte previs√≠vel do c√≥digo muda entre uma repeti√ß√£o e outra. Por exemplo, digamos que voc√™ vai calcular uma soma de &lt;code&gt;x&lt;/code&gt;.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;x &amp;lt;- runif(100, 0, 1000)
x
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##   [1] 481.8565152 889.4467938 839.3919568 995.6545529 434.8893075 548.0684573
##   [7] 483.9695676 690.5513781 151.6914470 872.1020871   0.3946235 702.4974534
##  [13] 394.3226694 138.9176038 252.6494386 958.9286412 780.5854031 670.7747667
##  [19] 946.2900842 114.1950220 830.8356900 898.1239600 299.5932216 374.4803111
##  [25] 296.9716154 607.0112186 435.7656906 611.9967769  94.4200489 398.8551637
##  [31] 689.6964593 702.0807178 496.2329580 544.2922530 229.5011075 204.9134872
##  [37] 119.8225897 515.7763774 676.0634030 853.2036459 390.4024123 245.4408365
##  [43] 136.4117221  53.2958910 123.1613006 239.5618213 441.0227661 266.3004498
##  [49] 501.5086005 151.4288806 230.7690587 913.5274501 217.5684345 186.2564688
##  [55] 575.9362916 544.4018145 135.8508093  38.8186283 928.3766786 303.2186597
##  [61] 641.7115638 104.6880512 648.4473264 983.6191037 175.0366774  38.5587176
##  [67] 626.3049259 475.8893903 379.8211862 420.5922675 388.8584753 230.1794016
##  [73]  29.6346173 531.2614150 684.2571679  82.1317388  22.6144663 273.1581759
##  [79] 373.9245753 128.0558456 692.0181639 546.2022151 134.0667482 875.7218486
##  [85] 261.0591126 242.6213648 220.8787291 953.6133921 324.5823658 809.9891061
##  [91]  29.6787191 706.7882018 819.1550428 642.3830071 196.5823381 404.6445782
##  [97] 485.1826637 482.0555861 104.4058145 916.4104878
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Esque√ßa, por um instante, a fun√ß√£o &lt;code&gt;sum&lt;/code&gt;. O c√°lculo da soma se d√° pela soma de todos os elementos do vetor &lt;code&gt;x&lt;/code&gt;. Ent√£o, √© necess√°rio repetir a opera√ß√£o de soma atrav√©s da acumula√ß√£o dos valores. Veja que √© tudo totalmente previs√≠vel, cada nova repeti√ß√£o simplesmente adiciona mais um valor ao vetor original e esse valor pode ser encontrado na pr√≥xima posi√ß√£o de &lt;code&gt;x&lt;/code&gt;. Esse √© o t√≠pico caso de itera√ß√£o. No R, a melhor pr√°tica √© inicializar uma vari√°vel antes e salvar os resultados da itera√ß√£o nela.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;# Inicializa√ß√£o
result &amp;lt;- x[[1]]

# Sequ√™ncia
for (i in 2:length(x)) {
  # Corpo
  result &amp;lt;- result + x[[i]]
}

# Comparando os dois resultados
result
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] 44936.86
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;sum(x)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] 44936.86
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Outro exemplo de mesmo tipo √© repeti√ß√£o de uma mesma opera√ß√£o em v√°rios vetores/colunas/vari√°veis comuns. Por exemplo, se eu tenho um &lt;code&gt;data.frame&lt;/code&gt; com tr√™s colunas num√©ricas e eu gostaria de calcular a soma de cada uma.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;# Data.frame
df &amp;lt;- tibble(x = rnorm(100, 50, 25),
             y = rnorm(100, 100, 25),
             z = rnorm(100, 200, 25))

# Inicializa√ß√£o
result &amp;lt;- vector(mode = &amp;quot;double&amp;quot;, length = length(df))

# Sequ√™ncia
for (i in seq_along(df)) {
  result[[i]] &amp;lt;- sum(df[[i]])
}

# Resultado
result
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1]  4782.552 10009.401 20350.742
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Essa √© a minha revis√£o de 5 minutos de itera√ß√£o em R usando &lt;code&gt;for&lt;/code&gt; loops. Como j√° √© de costume, tem muito mais. Por exemplo, existe um outro tipo de iterador no R b√°sico chamado &lt;code&gt;while&lt;/code&gt;, que tem um funcionamento diferente do &lt;code&gt;for&lt;/code&gt;. Ao inv√©s de voc√™ ter um resultado de tamanho previs√≠vel, voc√™ pode ter um resultado de tamanho desconhecido. Vou deixar o &lt;code&gt;while&lt;/code&gt; para voc√™s pesquisarem porque o bom e velho &lt;code&gt;for&lt;/code&gt; costuma cobrir a maioria dos casos de uso do cientista de dados.&lt;/p&gt;
&lt;h2 id=&#34;programa√ß√£o-funcional&#34;&gt;Programa√ß√£o funcional&lt;/h2&gt;
&lt;p&gt;Beleza, agora que j√° dominamos (ou n√£o) o &lt;code&gt;for&lt;/code&gt; loop, encontramos v√°rias situa√ß√µes em que a gente gostaria de realizar a mesma opera√ß√£o v√°rias vezes, mas, o &lt;code&gt;for&lt;/code&gt; loop √© como uma feijoada: √© gostoso, mas √© pesado. &lt;code&gt;For&lt;/code&gt; loops em geral s√£o &amp;ldquo;verbosos&amp;rdquo;, voc√™ precisa escrever bastante para chegar em um determinado resultado e, depois de escrever alguns, voc√™ cansa de ter que repetir todos os peda√ßos dele. E se voc√™ pudesse &lt;strong&gt;abstrair&lt;/strong&gt; o loop para uma fun√ß√£o? A√≠ voc√™ n√£o precisaria escrever toda aquela parafernalha.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;soma &amp;lt;- function(x) {
  result &amp;lt;- 0
  for (i in 1:length(x)) {
    result &amp;lt;- result + x[[i]]
  }
  result
}

soma(x)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] 44936.86
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Ao fazer isso, eu ganho duas vantagens:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Manuten√ß√£o: sempre que eu precisar repetir a opera√ß√£o, eu consigo simplificar muito meu c√≥digo. N√£o preciso escrever um for loop para cada soma que eu precisar fazer. Se meus requerimentos mudarem no futuro, eu s√≥ preciso mudar um peda√ßo de c√≥digo.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Leitura: o humano que l√™ um &lt;code&gt;for&lt;/code&gt; loop vai precisar de um minuto para se familiarizar com a opera√ß√£o e entender o que est√° sendo iterado, calculado, etc. O humano que l√™ &amp;ldquo;soma&amp;rdquo; sabe que ocorrer√° uma soma. Voc√™ alinha a &lt;strong&gt;expectativa&lt;/strong&gt; com a &lt;strong&gt;execu√ß√£o&lt;/strong&gt;.&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Outro exemplo.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;soma_xyz &amp;lt;- function(x) {
  soma_xyz &amp;lt;- vector(mode = &amp;quot;double&amp;quot;, length = nrow(x))
  for (i in seq_along(df$soma_xyz)) {
    soma_xyz[[i]] &amp;lt;- x[[1]][[i]] + x[[2]][[i]] + x[[3]][i]
  }
  soma_xyz
}

df$soma_xyz2 &amp;lt;- soma_xyz(df)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## Warning: Unknown or uninitialised column: `soma_xyz`.
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;df
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 100 x 4
##        x     y     z soma_xyz2
##    &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;
##  1  91.3  90.4  195.         0
##  2  27.6  98.3  245.         0
##  3  37.5  46.6  195.         0
##  4  63.8  90.3  196.         0
##  5  62.6  94.4  247.         0
##  6  27.2 112.   209.         0
##  7  55.4  78.6  217.         0
##  8  50.3 113.   233.         0
##  9  34.3  74.5  235.         0
## 10  68.8  94.4  193.         0
## # ... with 90 more rows
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Outra vantagem de ter na m√£o uma fun√ß√£o, √© que eu posso me apropriar das ferramentas de programa√ß√£o funcional do R. S√£o as fun√ß√µes da fam√≠lia &lt;code&gt;apply&lt;/code&gt;, que recebem uma lista de objetos e aplicam uma fun√ß√£o em cada um. Basicamente, aquela &lt;strong&gt;abstra√ß√£o&lt;/strong&gt; do for loop que estavamos buscando.&lt;/p&gt;
&lt;p&gt;Vejam como eu posso recriar o exemplo das somas das colunas do &lt;code&gt;data.frame&lt;/code&gt; usando a fun√ß√£o soma.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;sapply(df, soma)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##         x         y         z soma_xyz2 
##  4782.552 10009.401 20350.742     0.000
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Eu sei, o exemplo √© muito simples pra ter uma aplica√ß√£o real. At√© porque j√° vimos como fazer esse tipo de opera√ß√£o com &lt;code&gt;summarize&lt;/code&gt; l√° atr√°s. Mas talvez, na hora que voc√™ estiver realizando alguma opera√ß√£o de repeti√ß√£o, voc√™ se lembre dessa possibilidade e ela lhe seja √∫til.&lt;/p&gt;
&lt;h3 id=&#34;o-pacote-purrr&#34;&gt;o pacote &lt;code&gt;purrr&lt;/code&gt;&lt;/h3&gt;
&lt;p&gt;At√© o momento, nos limitamos a utilizar fun√ß√µes presentes no &lt;code&gt;base&lt;/code&gt;, mas o verdadeiro intuito dessa aula √© introduzir as facilidade trazidas pelas fun√ß√µes do &lt;code&gt;tidyverse&lt;/code&gt;. No pacote &lt;code&gt;purrr&lt;/code&gt;, s√£o importadas fun√ß√µes com diversas funcionalidades que facilitam o trabalho com objetos mais complexos, como listas (pense sa√≠da de modelo), itera√ß√µes envolvendo mais de um argumento (pense escrever diversos objetos em diversos arquivos distintos) e assim sucessivamente. Abaixo, segue uma lista das fun√ß√µes do pacote com uma descri√ß√£o curta.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;a fam√≠lia &lt;code&gt;map_()&lt;/code&gt;: similar a fam√≠lia &lt;code&gt;apply&lt;/code&gt; do R base. Recebe uma lista de objetos de entrada e uma fun√ß√£o e devolve uma lista com os resultados.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;map2_()&lt;/code&gt;: mesma coisa, s√≥ que voc√™ pode passar duas listas de objetos e uma fun√ß√£o que requer dois argumentos vari√°veis. &lt;code&gt;pmap()&lt;/code&gt; √© a generaliza√ß√£o, em que voc√™ passa &lt;code&gt;p&lt;/code&gt; listas e uma fun√ß√£o que pede &lt;code&gt;p&lt;/code&gt; argumentos.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;imap()&lt;/code&gt;: aplica uma fun√ß√£o tanto ao vetor, como a seu nome/√≠ndice. √â meio louco, mas √© muito √∫til para alguns casos de uso.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;modify_()&lt;/code&gt;: permite aplicar altera√ß√µes no objeto estilo o que voc√™ faria com uma pipeline de &lt;code&gt;filter %&amp;gt;% mutate&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;safely()&lt;/code&gt;: e suas irm√£s &lt;code&gt;possibly()&lt;/code&gt; e &lt;code&gt;quietly()&lt;/code&gt; ajudam a obter resultados mesmo quando h√° ocorre um erro na itera√ß√£o.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;transpose()&lt;/code&gt;, &lt;code&gt;flatten_&lt;/code&gt;: manipulam e reformatam listas.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;invoke_map()&lt;/code&gt;: aplica uma lista de fun√ß√µes a uma (opcional) segunda lista de par√¢metros.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;reduce()&lt;/code&gt; e `accumulate()``: generalizam as opera√ß√µes de sumariza√ß√£o (pense soma acumulada, m√©dia, limite, fatorial)&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;pluck()&lt;/code&gt;: pesca elementos de uma lista com uma sintaxe linear e bonitinha.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;https://purrr.tidyverse.org/reference/index.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;E muito mais coisas&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;No interesse de ir direto ao ponto e n√£o tentar ser exaustivo, vamos ver algumas delas em mais detalhe.&lt;/p&gt;
&lt;h4 id=&#34;a-fun√ß√£o-map&#34;&gt;A fun√ß√£o &lt;code&gt;map&lt;/code&gt;&lt;/h4&gt;
&lt;p&gt;Essa fun√ß√£o √© praticamente uma c√≥pia de &lt;code&gt;lapply&lt;/code&gt;.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;df %&amp;gt;% lapply(sum)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## $x
## [1] 4782.552
## 
## $y
## [1] 10009.4
## 
## $z
## [1] 20350.74
## 
## $soma_xyz2
## [1] 0
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;df %&amp;gt;% map(sum)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## $x
## [1] 4782.552
## 
## $y
## [1] 10009.4
## 
## $z
## [1] 20350.74
## 
## $soma_xyz2
## [1] 0
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Embora existam pequenas diferen√ßas t√©cnicas entre elas, a principal vantagem de &lt;code&gt;map&lt;/code&gt; √© a possibilidade de criar fun√ß√µes an√¥nimas com uma s√≠ntaxe enxuta. Pense, por exemplo, em elevar ao quadrado.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;df %&amp;gt;% lapply(function(x) x ^ 2)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## $x
##   [1] 8.340665e+03 7.609719e+02 1.407304e+03 4.072748e+03 3.918333e+03
##   [6] 7.390810e+02 3.066834e+03 2.531999e+03 1.177876e+03 4.727122e+03
##  [11] 3.629937e+03 1.025907e+04 5.184645e+03 8.465455e+02 2.497259e+03
##  [16] 9.040971e+02 6.071589e+03 1.218469e+03 2.060830e+02 2.980012e+03
##  [21] 2.926861e+03 1.737000e+03 7.159171e+02 3.745861e+03 2.286992e+03
##  [26] 1.139618e+03 1.385856e+03 1.473180e+03 7.256814e+02 2.324368e+02
##  [31] 6.280350e+02 2.798749e+03 2.295509e+03 5.492001e+03 1.603682e+03
##  [36] 5.921566e+03 2.535633e+03 2.869353e+03 3.539944e+00 2.774229e+03
##  [41] 6.126133e+03 1.307888e+02 5.432382e+03 1.080891e+03 5.239030e+03
##  [46] 3.527635e+01 3.322854e+02 8.144258e+03 2.140008e+00 8.174575e-03
##  [51] 4.845700e+03 9.943035e+03 3.519638e+01 6.476945e+03 1.017417e+03
##  [56] 2.017825e+03 8.164210e+01 5.076489e+03 1.774837e+03 1.267500e+03
##  [61] 2.547740e+03 1.158167e+03 1.969161e+02 5.625541e+02 3.086190e+03
##  [66] 1.822884e+03 2.031231e+03 5.032518e+03 1.697567e+03 1.640038e+03
##  [71] 1.956268e+03 5.095183e+03 3.193288e+03 1.282227e+03 8.508813e+02
##  [76] 4.323554e+03 4.485009e+03 2.598271e+01 4.245055e+03 8.807886e+03
##  [81] 5.279595e+02 1.690810e+03 1.494979e+03 8.323780e+03 2.970652e+03
##  [86] 7.973331e+03 4.298083e+03 1.490143e+03 7.355707e+03 6.888136e+02
##  [91] 4.577101e+03 8.548181e+03 8.335626e+02 8.041585e+02 7.036801e+03
##  [96] 1.956278e+01 7.482131e+03 2.508999e+03 6.958052e+03 3.651068e+03
## 
## $y
##   [1]  8175.802  9655.427  2173.739  8162.567  8918.293 12647.369  6174.668
##   [8] 12853.036  5548.858  8907.042  3598.469 19733.664  9939.235 12768.554
##  [15] 14729.183  9798.012  6904.748  5388.004  3211.408 11746.864  4284.553
##  [22]  7587.151  3573.968 12485.685 12581.851  8549.839 13242.744  6221.696
##  [29] 23138.896 15254.354  5126.643  9314.245  7027.650  7238.021  9298.434
##  [36]  9590.037 16230.142 21024.441 10360.863 20232.282  5968.434 11773.480
##  [43]  9352.594  6487.212 14268.116 22835.777  6249.220 14092.213  7756.533
##  [50] 16457.960  6619.314  6553.217 19060.770  7766.440  8047.052  6098.922
##  [57] 10806.751 11915.118  9127.615  6985.857 11945.977  7995.177  6593.833
##  [64] 20428.728 16515.877 15453.485 16747.701  5506.670 29666.589 12339.310
##  [71]  8591.397  9430.074  8469.947 15936.118  6924.588 11339.666  7310.403
##  [78]  9806.804  4779.000 10068.194  2533.711  3112.751  5741.073 17578.210
##  [85]  3095.715 32905.527  4820.790  6854.842 17001.563  6286.864 15818.163
##  [92]  8620.866 10772.858 15410.029 11357.589 21756.877 11183.605  5818.452
##  [99] 17986.063  5486.993
## 
## $z
##   [1] 38166.20 59835.67 38148.02 38429.29 60772.90 43500.93 47008.10 54156.79
##   [9] 55144.65 37181.51 43479.82 34076.33 32159.97 43002.82 20928.52 44749.75
##  [17] 34836.89 61083.71 34735.53 29604.31 39366.31 46551.25 45708.43 42917.59
##  [25] 24308.75 31554.57 41343.99 48125.42 33339.10 31703.37 52953.02 40069.31
##  [33] 46482.75 40190.46 49221.78 36963.49 26005.78 44222.12 36592.87 48526.54
##  [41] 54375.20 46506.28 14958.35 36557.16 36944.87 58310.41 36741.60 41539.45
##  [49] 32371.12 41014.68 44839.06 35222.26 45268.79 29866.27 49296.33 42969.19
##  [57] 34748.62 39555.17 57497.89 48875.87 47479.51 24623.18 61368.62 45975.52
##  [65] 52805.84 54308.65 40488.29 30223.55 44914.23 44364.25 32447.04 23491.32
##  [73] 44225.58 41328.19 36727.72 55035.62 75682.59 44429.90 42944.31 47937.10
##  [81] 61786.95 50779.65 51986.37 37411.78 41597.63 36160.43 32692.37 45780.12
##  [89] 44958.06 31920.22 40491.99 40352.93 48159.41 38318.30 41328.63 30426.50
##  [97] 42943.59 33370.48 42763.44 32189.52
## 
## $soma_xyz2
##   [1] 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
##  [38] 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
##  [75] 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;df %&amp;gt;% map(~ .x ^ 2)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## $x
##   [1] 8.340665e+03 7.609719e+02 1.407304e+03 4.072748e+03 3.918333e+03
##   [6] 7.390810e+02 3.066834e+03 2.531999e+03 1.177876e+03 4.727122e+03
##  [11] 3.629937e+03 1.025907e+04 5.184645e+03 8.465455e+02 2.497259e+03
##  [16] 9.040971e+02 6.071589e+03 1.218469e+03 2.060830e+02 2.980012e+03
##  [21] 2.926861e+03 1.737000e+03 7.159171e+02 3.745861e+03 2.286992e+03
##  [26] 1.139618e+03 1.385856e+03 1.473180e+03 7.256814e+02 2.324368e+02
##  [31] 6.280350e+02 2.798749e+03 2.295509e+03 5.492001e+03 1.603682e+03
##  [36] 5.921566e+03 2.535633e+03 2.869353e+03 3.539944e+00 2.774229e+03
##  [41] 6.126133e+03 1.307888e+02 5.432382e+03 1.080891e+03 5.239030e+03
##  [46] 3.527635e+01 3.322854e+02 8.144258e+03 2.140008e+00 8.174575e-03
##  [51] 4.845700e+03 9.943035e+03 3.519638e+01 6.476945e+03 1.017417e+03
##  [56] 2.017825e+03 8.164210e+01 5.076489e+03 1.774837e+03 1.267500e+03
##  [61] 2.547740e+03 1.158167e+03 1.969161e+02 5.625541e+02 3.086190e+03
##  [66] 1.822884e+03 2.031231e+03 5.032518e+03 1.697567e+03 1.640038e+03
##  [71] 1.956268e+03 5.095183e+03 3.193288e+03 1.282227e+03 8.508813e+02
##  [76] 4.323554e+03 4.485009e+03 2.598271e+01 4.245055e+03 8.807886e+03
##  [81] 5.279595e+02 1.690810e+03 1.494979e+03 8.323780e+03 2.970652e+03
##  [86] 7.973331e+03 4.298083e+03 1.490143e+03 7.355707e+03 6.888136e+02
##  [91] 4.577101e+03 8.548181e+03 8.335626e+02 8.041585e+02 7.036801e+03
##  [96] 1.956278e+01 7.482131e+03 2.508999e+03 6.958052e+03 3.651068e+03
## 
## $y
##   [1]  8175.802  9655.427  2173.739  8162.567  8918.293 12647.369  6174.668
##   [8] 12853.036  5548.858  8907.042  3598.469 19733.664  9939.235 12768.554
##  [15] 14729.183  9798.012  6904.748  5388.004  3211.408 11746.864  4284.553
##  [22]  7587.151  3573.968 12485.685 12581.851  8549.839 13242.744  6221.696
##  [29] 23138.896 15254.354  5126.643  9314.245  7027.650  7238.021  9298.434
##  [36]  9590.037 16230.142 21024.441 10360.863 20232.282  5968.434 11773.480
##  [43]  9352.594  6487.212 14268.116 22835.777  6249.220 14092.213  7756.533
##  [50] 16457.960  6619.314  6553.217 19060.770  7766.440  8047.052  6098.922
##  [57] 10806.751 11915.118  9127.615  6985.857 11945.977  7995.177  6593.833
##  [64] 20428.728 16515.877 15453.485 16747.701  5506.670 29666.589 12339.310
##  [71]  8591.397  9430.074  8469.947 15936.118  6924.588 11339.666  7310.403
##  [78]  9806.804  4779.000 10068.194  2533.711  3112.751  5741.073 17578.210
##  [85]  3095.715 32905.527  4820.790  6854.842 17001.563  6286.864 15818.163
##  [92]  8620.866 10772.858 15410.029 11357.589 21756.877 11183.605  5818.452
##  [99] 17986.063  5486.993
## 
## $z
##   [1] 38166.20 59835.67 38148.02 38429.29 60772.90 43500.93 47008.10 54156.79
##   [9] 55144.65 37181.51 43479.82 34076.33 32159.97 43002.82 20928.52 44749.75
##  [17] 34836.89 61083.71 34735.53 29604.31 39366.31 46551.25 45708.43 42917.59
##  [25] 24308.75 31554.57 41343.99 48125.42 33339.10 31703.37 52953.02 40069.31
##  [33] 46482.75 40190.46 49221.78 36963.49 26005.78 44222.12 36592.87 48526.54
##  [41] 54375.20 46506.28 14958.35 36557.16 36944.87 58310.41 36741.60 41539.45
##  [49] 32371.12 41014.68 44839.06 35222.26 45268.79 29866.27 49296.33 42969.19
##  [57] 34748.62 39555.17 57497.89 48875.87 47479.51 24623.18 61368.62 45975.52
##  [65] 52805.84 54308.65 40488.29 30223.55 44914.23 44364.25 32447.04 23491.32
##  [73] 44225.58 41328.19 36727.72 55035.62 75682.59 44429.90 42944.31 47937.10
##  [81] 61786.95 50779.65 51986.37 37411.78 41597.63 36160.43 32692.37 45780.12
##  [89] 44958.06 31920.22 40491.99 40352.93 48159.41 38318.30 41328.63 30426.50
##  [97] 42943.59 33370.48 42763.44 32189.52
## 
## $soma_xyz2
##   [1] 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
##  [38] 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
##  [75] 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Atrav√©s do uso de f√≥rmulas &lt;code&gt;~&lt;/code&gt; √© poss√≠vel especificar fun√ß√µes an√¥nimas simples economizando caracteres e utilizando o autocompletar.&lt;/p&gt;
&lt;p&gt;Que tal esta pipeline?&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;library(nycflights13)

# M√©dias de todas as vari√°veis num√©ricas usando where()
flights %&amp;gt;% 
  select(where(is.numeric)) %&amp;gt;% 
  map(mean)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## $year
## [1] 2013
## 
## $month
## [1] 6.54851
## 
## $day
## [1] 15.71079
## 
## $dep_time
## [1] NA
## 
## $sched_dep_time
## [1] 1344.255
## 
## $dep_delay
## [1] NA
## 
## $arr_time
## [1] NA
## 
## $sched_arr_time
## [1] 1536.38
## 
## $arr_delay
## [1] NA
## 
## $flight
## [1] 1971.924
## 
## $air_time
## [1] NA
## 
## $distance
## [1] 1039.913
## 
## $hour
## [1] 13.18025
## 
## $minute
## [1] 26.2301
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Ou esta&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;# Propor√ß√£o de missings em todas as vari√°veis
flights %&amp;gt;% 
  map(is.na) %&amp;gt;% 
  map(mean)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## $year
## [1] 0
## 
## $month
## [1] 0
## 
## $day
## [1] 0
## 
## $dep_time
## [1] 0.02451184
## 
## $sched_dep_time
## [1] 0
## 
## $dep_delay
## [1] 0.02451184
## 
## $arr_time
## [1] 0.0258718
## 
## $sched_arr_time
## [1] 0
## 
## $arr_delay
## [1] 0.02800081
## 
## $carrier
## [1] 0
## 
## $flight
## [1] 0
## 
## $tailnum
## [1] 0.007458964
## 
## $origin
## [1] 0
## 
## $dest
## [1] 0
## 
## $air_time
## [1] 0.02800081
## 
## $distance
## [1] 0
## 
## $hour
## [1] 0
## 
## $minute
## [1] 0
## 
## $time_hour
## [1] 0
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;# Contagem de missings em todas as vari√°veis
flights %&amp;gt;% 
  map(is.na) %&amp;gt;% 
  map(sum)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## $year
## [1] 0
## 
## $month
## [1] 0
## 
## $day
## [1] 0
## 
## $dep_time
## [1] 8255
## 
## $sched_dep_time
## [1] 0
## 
## $dep_delay
## [1] 8255
## 
## $arr_time
## [1] 8713
## 
## $sched_arr_time
## [1] 0
## 
## $arr_delay
## [1] 9430
## 
## $carrier
## [1] 0
## 
## $flight
## [1] 0
## 
## $tailnum
## [1] 2512
## 
## $origin
## [1] 0
## 
## $dest
## [1] 0
## 
## $air_time
## [1] 9430
## 
## $distance
## [1] 0
## 
## $hour
## [1] 0
## 
## $minute
## [1] 0
## 
## $time_hour
## [1] 0
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;A outra grande vantagem do map √© ter acesso f√°cil ao controle do tipo de sa√≠da.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;# Vetor num√©rico
flights %&amp;gt;% 
  map(is.na) %&amp;gt;% 
  map_dbl(mean)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##           year          month            day       dep_time sched_dep_time 
##    0.000000000    0.000000000    0.000000000    0.024511842    0.000000000 
##      dep_delay       arr_time sched_arr_time      arr_delay        carrier 
##    0.024511842    0.025871796    0.000000000    0.028000808    0.000000000 
##         flight        tailnum         origin           dest       air_time 
##    0.000000000    0.007458964    0.000000000    0.000000000    0.028000808 
##       distance           hour         minute      time_hour 
##    0.000000000    0.000000000    0.000000000    0.000000000
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;# Vetor de caracteres
flights %&amp;gt;% 
  map(is.na) %&amp;gt;% 
  map_chr(mean)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##           year          month            day       dep_time sched_dep_time 
##     &amp;quot;0.000000&amp;quot;     &amp;quot;0.000000&amp;quot;     &amp;quot;0.000000&amp;quot;     &amp;quot;0.024512&amp;quot;     &amp;quot;0.000000&amp;quot; 
##      dep_delay       arr_time sched_arr_time      arr_delay        carrier 
##     &amp;quot;0.024512&amp;quot;     &amp;quot;0.025872&amp;quot;     &amp;quot;0.000000&amp;quot;     &amp;quot;0.028001&amp;quot;     &amp;quot;0.000000&amp;quot; 
##         flight        tailnum         origin           dest       air_time 
##     &amp;quot;0.000000&amp;quot;     &amp;quot;0.007459&amp;quot;     &amp;quot;0.000000&amp;quot;     &amp;quot;0.000000&amp;quot;     &amp;quot;0.028001&amp;quot; 
##       distance           hour         minute      time_hour 
##     &amp;quot;0.000000&amp;quot;     &amp;quot;0.000000&amp;quot;     &amp;quot;0.000000&amp;quot;     &amp;quot;0.000000&amp;quot;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Um exemplo um pouco mais elaborado: avalia√ß√£o inicial de vari√°veis em um modelo. Em geral, √© comum rodar um modelo para cada vari√°vel num√©rica para ver como elas se comportam.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;respvar &amp;lt;- &amp;quot;hwy&amp;quot;
predvars &amp;lt;- names(select(mpg, where(is.numeric), -hwy))

tibble(
  names = predvars,
  fit = map(names, ~lm(paste0(respvar, &amp;quot;~&amp;quot;, .x), data = mpg)),
  summary = map(fit, summary),
  r2 = map_dbl(summary, &amp;quot;r.squared&amp;quot;),
  FStat = map_df(summary, &amp;quot;fstatistic&amp;quot;),
  coefs = map_df(fit, coef),
)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 4 x 6
##   names fit    summary      r2 FStat$value $numdf $dendf coefs$`(Interce~ $displ
##   &amp;lt;chr&amp;gt; &amp;lt;list&amp;gt; &amp;lt;list&amp;gt;    &amp;lt;dbl&amp;gt;       &amp;lt;dbl&amp;gt;  &amp;lt;dbl&amp;gt;  &amp;lt;dbl&amp;gt;            &amp;lt;dbl&amp;gt;  &amp;lt;dbl&amp;gt;
## 1 displ &amp;lt;lm&amp;gt;   &amp;lt;smmry~ 5.87e-1   329.           1    232           35.7    -3.53
## 2 year  &amp;lt;lm&amp;gt;   &amp;lt;smmry~ 4.66e-6     0.00108      1    232           17.7    NA   
## 3 cyl   &amp;lt;lm&amp;gt;   &amp;lt;smmry~ 5.81e-1   321.           1    232           40.0    NA   
## 4 cty   &amp;lt;lm&amp;gt;   &amp;lt;smmry~ 9.14e-1  2459.           1    232            0.892  NA
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Ok, a sa√≠da n√£o est√° muito bonitinha! Mas com um pouco mais de trabalho, programadores melhores que eu fizeram isso:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;models &amp;lt;- 
  tibble(
    names = predvars,
    fit = map(names, ~lm(paste0(respvar, &amp;quot;~&amp;quot;, .x), data = mpg)),
    tidied = fit %&amp;gt;% map(broom::tidy),
    glanced = fit %&amp;gt;% map(broom::glance),
    augmented = fit %&amp;gt;% map(broom::augment)
  )

models
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 4 x 5
##   names fit    tidied           glanced           augmented         
##   &amp;lt;chr&amp;gt; &amp;lt;list&amp;gt; &amp;lt;list&amp;gt;           &amp;lt;list&amp;gt;            &amp;lt;list&amp;gt;            
## 1 displ &amp;lt;lm&amp;gt;   &amp;lt;tibble [2 x 5]&amp;gt; &amp;lt;tibble [1 x 12]&amp;gt; &amp;lt;tibble [234 x 8]&amp;gt;
## 2 year  &amp;lt;lm&amp;gt;   &amp;lt;tibble [2 x 5]&amp;gt; &amp;lt;tibble [1 x 12]&amp;gt; &amp;lt;tibble [234 x 8]&amp;gt;
## 3 cyl   &amp;lt;lm&amp;gt;   &amp;lt;tibble [2 x 5]&amp;gt; &amp;lt;tibble [1 x 12]&amp;gt; &amp;lt;tibble [234 x 8]&amp;gt;
## 4 cty   &amp;lt;lm&amp;gt;   &amp;lt;tibble [2 x 5]&amp;gt; &amp;lt;tibble [1 x 12]&amp;gt; &amp;lt;tibble [234 x 8]&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Grande coisa, Vin√≠cius, o output √© ileg√≠vel! Calma! Lembram da primeira aula em que eu comentei que havia mais fun√ß√µes no &lt;code&gt;tidyr&lt;/code&gt;?&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;# Coeficientes
models %&amp;gt;% 
  select(tidied) %&amp;gt;%
  tidyr::unnest(tidied) %&amp;gt;% 
  filter(term != &amp;quot;(Intercept)&amp;quot;)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 4 x 5
##   term  estimate std.error statistic   p.value
##   &amp;lt;chr&amp;gt;    &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;
## 1 displ -3.53       0.195   -18.2    2.04e- 46
## 2 year   0.00285    0.0867    0.0329 9.74e-  1
## 3 cyl   -2.82       0.157   -17.9    1.18e- 45
## 4 cty    1.34       0.0270   49.6    1.87e-125
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;# Estat√≠sticas do modelo
models %&amp;gt;% 
  select(names, glanced) %&amp;gt;% 
  unnest(glanced)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 4 x 13
##   names  r.squared adj.r.squared sigma  statistic   p.value    df logLik   AIC
##   &amp;lt;chr&amp;gt;      &amp;lt;dbl&amp;gt;         &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt;      &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt;  &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt;
## 1 displ 0.587            0.585    3.84  329.      2.04e- 46     1  -646. 1297.
## 2 year  0.00000466      -0.00431  5.97    0.00108 9.74e-  1     1  -749. 1504.
## 3 cyl   0.581            0.579    3.87  321.      1.18e- 45     1  -647. 1301.
## 4 cty   0.914            0.913    1.75 2459.      1.87e-125     1  -462.  931.
## # ... with 4 more variables: BIC &amp;lt;dbl&amp;gt;, deviance &amp;lt;dbl&amp;gt;, df.residual &amp;lt;int&amp;gt;,
## #   nobs &amp;lt;int&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;# Bancos &amp;quot;aumentados&amp;quot; com valores ajustados, res√≠duos, dist√¢ncias de cook, etc.
models %&amp;gt;% 
  filter(names == &amp;quot;displ&amp;quot;) %&amp;gt;% 
  select(names, augmented) %&amp;gt;% 
  unnest(augmented)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 234 x 9
##    names   hwy displ .fitted .resid    .hat .sigma    .cooksd .std.resid
##    &amp;lt;chr&amp;gt; &amp;lt;int&amp;gt; &amp;lt;dbl&amp;gt;   &amp;lt;dbl&amp;gt;  &amp;lt;dbl&amp;gt;   &amp;lt;dbl&amp;gt;  &amp;lt;dbl&amp;gt;      &amp;lt;dbl&amp;gt;      &amp;lt;dbl&amp;gt;
##  1 displ    29   1.8    29.3 -0.343 0.0115    3.84 0.0000468     -0.0898
##  2 displ    29   1.8    29.3 -0.343 0.0115    3.84 0.0000468     -0.0898
##  3 displ    31   2      28.6  2.36  0.00984   3.84 0.00191        0.619 
##  4 displ    30   2      28.6  1.36  0.00984   3.84 0.000634       0.357 
##  5 displ    26   2.8    25.8  0.188 0.00543   3.84 0.00000660     0.0491
##  6 displ    26   2.8    25.8  0.188 0.00543   3.84 0.00000660     0.0491
##  7 displ    27   3.1    24.8  2.25  0.00463   3.84 0.000802       0.587 
##  8 displ    26   1.8    29.3 -3.34  0.0115    3.84 0.00445       -0.876 
##  9 displ    25   1.8    29.3 -4.34  0.0115    3.83 0.00751       -1.14  
## 10 displ    28   2      28.6 -0.636 0.00984   3.84 0.000138      -0.167 
## # ... with 224 more rows
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Isso aqui √© s√≥ uma palhinha de modelagem com o &lt;code&gt;tidyverse&lt;/code&gt;, mas acho que √© uma demonstra√ß√£o muito convincente da aplicabilidade dos exemplos que vimos usando programa√ß√£o funcional.&lt;/p&gt;
&lt;p&gt;Outro exemplo mais simples com &lt;code&gt;map2&lt;/code&gt;: salvar v√°rios arquivos de uma vez s√≥.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;df1 &amp;lt;- tibble(x = rnorm(100), y = rnorm(100), z = rnorm(100))
df2 &amp;lt;- tibble(x = rnorm(100), y = rnorm(100), z = rnorm(100))
df3 &amp;lt;- tibble(x = rnorm(100), y = rnorm(100), z = rnorm(100))
df4 &amp;lt;- tibble(x = rnorm(100), y = rnorm(100), z = rnorm(100))

dfs &amp;lt;- list(df1, df2, df3, df4)
dfs
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [[1]]
## # A tibble: 100 x 3
##         x       y       z
##     &amp;lt;dbl&amp;gt;   &amp;lt;dbl&amp;gt;   &amp;lt;dbl&amp;gt;
##  1  0.841  2.68    0.0835
##  2  0.554 -0.131   0.526 
##  3 -0.171  0.614   0.898 
##  4  0.861  0.887   0.550 
##  5 -0.512  0.514  -0.191 
##  6  0.593 -0.498  -0.137 
##  7 -1.18  -0.298  -1.14  
##  8 -0.321  0.0182  0.693 
##  9 -0.993 -0.0592  0.507 
## 10 -1.20  -0.625  -0.678 
## # ... with 90 more rows
## 
## [[2]]
## # A tibble: 100 x 3
##         x       y       z
##     &amp;lt;dbl&amp;gt;   &amp;lt;dbl&amp;gt;   &amp;lt;dbl&amp;gt;
##  1  0.101  0.259   0.282 
##  2 -0.370 -0.223  -0.622 
##  3  1.66   0.0762  1.87  
##  4 -0.289  0.111  -2.20  
##  5  0.174 -0.695  -0.0989
##  6 -0.647 -0.709   1.53  
##  7  0.360 -0.966  -1.14  
##  8 -1.36   1.06    0.246 
##  9 -2.22  -1.33   -0.805 
## 10  0.881 -0.920   1.84  
## # ... with 90 more rows
## 
## [[3]]
## # A tibble: 100 x 3
##         x       y       z
##     &amp;lt;dbl&amp;gt;   &amp;lt;dbl&amp;gt;   &amp;lt;dbl&amp;gt;
##  1 -1.45  -2.37   -0.563 
##  2  0.161  0.473   0.0762
##  3  0.546 -0.764   1.05  
##  4  1.68   0.240   1.27  
##  5  1.19  -2.24   -0.211 
##  6 -1.76  -1.44    0.276 
##  7  0.823 -0.562   1.15  
##  8 -0.358  0.159   0.261 
##  9  0.325 -0.250  -0.650 
## 10  1.03  -0.0697  2.19  
## # ... with 90 more rows
## 
## [[4]]
## # A tibble: 100 x 3
##           x       y      z
##       &amp;lt;dbl&amp;gt;   &amp;lt;dbl&amp;gt;  &amp;lt;dbl&amp;gt;
##  1  0.551    1.12   -0.958
##  2  0.00661  1.04    1.38 
##  3  1.00    -1.78    0.405
##  4 -1.99     1.96    0.723
##  5  0.0453  -0.944   1.29 
##  6  1.97     1.16    1.12 
##  7 -0.151   -0.452  -0.134
##  8 -2.06    -0.115  -0.436
##  9  1.00     1.62   -1.11 
## 10 -0.546    0.0693 -0.955
## # ... with 90 more rows
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;paths &amp;lt;- sprintf(&amp;quot;arquivo%s.csv&amp;quot;, 1:4)
paths
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] &amp;quot;arquivo1.csv&amp;quot; &amp;quot;arquivo2.csv&amp;quot; &amp;quot;arquivo3.csv&amp;quot; &amp;quot;arquivo4.csv&amp;quot;
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;map2(dfs, paths, ~write_csv(x = .x, file = .y))
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [[1]]
## # A tibble: 100 x 3
##         x       y       z
##     &amp;lt;dbl&amp;gt;   &amp;lt;dbl&amp;gt;   &amp;lt;dbl&amp;gt;
##  1  0.841  2.68    0.0835
##  2  0.554 -0.131   0.526 
##  3 -0.171  0.614   0.898 
##  4  0.861  0.887   0.550 
##  5 -0.512  0.514  -0.191 
##  6  0.593 -0.498  -0.137 
##  7 -1.18  -0.298  -1.14  
##  8 -0.321  0.0182  0.693 
##  9 -0.993 -0.0592  0.507 
## 10 -1.20  -0.625  -0.678 
## # ... with 90 more rows
## 
## [[2]]
## # A tibble: 100 x 3
##         x       y       z
##     &amp;lt;dbl&amp;gt;   &amp;lt;dbl&amp;gt;   &amp;lt;dbl&amp;gt;
##  1  0.101  0.259   0.282 
##  2 -0.370 -0.223  -0.622 
##  3  1.66   0.0762  1.87  
##  4 -0.289  0.111  -2.20  
##  5  0.174 -0.695  -0.0989
##  6 -0.647 -0.709   1.53  
##  7  0.360 -0.966  -1.14  
##  8 -1.36   1.06    0.246 
##  9 -2.22  -1.33   -0.805 
## 10  0.881 -0.920   1.84  
## # ... with 90 more rows
## 
## [[3]]
## # A tibble: 100 x 3
##         x       y       z
##     &amp;lt;dbl&amp;gt;   &amp;lt;dbl&amp;gt;   &amp;lt;dbl&amp;gt;
##  1 -1.45  -2.37   -0.563 
##  2  0.161  0.473   0.0762
##  3  0.546 -0.764   1.05  
##  4  1.68   0.240   1.27  
##  5  1.19  -2.24   -0.211 
##  6 -1.76  -1.44    0.276 
##  7  0.823 -0.562   1.15  
##  8 -0.358  0.159   0.261 
##  9  0.325 -0.250  -0.650 
## 10  1.03  -0.0697  2.19  
## # ... with 90 more rows
## 
## [[4]]
## # A tibble: 100 x 3
##           x       y      z
##       &amp;lt;dbl&amp;gt;   &amp;lt;dbl&amp;gt;  &amp;lt;dbl&amp;gt;
##  1  0.551    1.12   -0.958
##  2  0.00661  1.04    1.38 
##  3  1.00    -1.78    0.405
##  4 -1.99     1.96    0.723
##  5  0.0453  -0.944   1.29 
##  6  1.97     1.16    1.12 
##  7 -0.151   -0.452  -0.134
##  8 -2.06    -0.115  -0.436
##  9  1.00     1.62   -1.11 
## 10 -0.546    0.0693 -0.955
## # ... with 90 more rows
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;E se eu quiser ler um banco de dados que est√° em v√°rios arquivos diferentes? Vamos usar os que acabamos de criar&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;# Bum! Uma linha
paths %&amp;gt;% map_dfr(read_csv, .id = &amp;quot;arquivo&amp;quot;)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## 
## -- Column specification --------------------------------------------------------
## cols(
##   x = col_double(),
##   y = col_double(),
##   z = col_double()
## )
## 
## 
## -- Column specification --------------------------------------------------------
## cols(
##   x = col_double(),
##   y = col_double(),
##   z = col_double()
## )
## 
## 
## -- Column specification --------------------------------------------------------
## cols(
##   x = col_double(),
##   y = col_double(),
##   z = col_double()
## )
## 
## 
## -- Column specification --------------------------------------------------------
## cols(
##   x = col_double(),
##   y = col_double(),
##   z = col_double()
## )
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 400 x 4
##    arquivo      x       y       z
##    &amp;lt;chr&amp;gt;    &amp;lt;dbl&amp;gt;   &amp;lt;dbl&amp;gt;   &amp;lt;dbl&amp;gt;
##  1 1        0.841  2.68    0.0835
##  2 1        0.554 -0.131   0.526 
##  3 1       -0.171  0.614   0.898 
##  4 1        0.861  0.887   0.550 
##  5 1       -0.512  0.514  -0.191 
##  6 1        0.593 -0.498  -0.137 
##  7 1       -1.18  -0.298  -1.14  
##  8 1       -0.321  0.0182  0.693 
##  9 1       -0.993 -0.0592  0.507 
## 10 1       -1.20  -0.625  -0.678 
## # ... with 390 more rows
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;As possibilidades s√£o in√∫meras. A regra √© a seguinte: viu uma tarefa que precisa ser repetida muitas vezes? Pense com carinho em usar uma fun√ß√£o vetorizada atrav√©s de &lt;code&gt;map_&lt;/code&gt;.&lt;/p&gt;
&lt;h4 id=&#34;predicados&#34;&gt;Predicados&lt;/h4&gt;
&lt;p&gt;O objetivo de um fun√ß√£o predicado √© selecionar elementos de uma lista com base em uma fun√ß√£o. Em geral, s√£o fun√ß√µes simples que retornam um valor &lt;code&gt;TRUE&lt;/code&gt; ou &lt;code&gt;FALSE&lt;/code&gt; com base em alguma caracter√≠stica do objeto, como o tipo.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;l &amp;lt;- list(c(&amp;quot;a&amp;quot;, &amp;quot;b&amp;quot;, &amp;quot;c&amp;quot;), c(1, 2, 3))
l %&amp;gt;% str()
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## List of 2
##  $ : chr [1:3] &amp;quot;a&amp;quot; &amp;quot;b&amp;quot; &amp;quot;c&amp;quot;
##  $ : num [1:3] 1 2 3
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;l %&amp;gt;% keep(is.numeric) %&amp;gt;% str()
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## List of 1
##  $ : num [1:3] 1 2 3
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;l %&amp;gt;% keep(is.character) %&amp;gt;% str()
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## List of 1
##  $ : chr [1:3] &amp;quot;a&amp;quot; &amp;quot;b&amp;quot; &amp;quot;c&amp;quot;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;O uso mais frequente que vejo de &lt;code&gt;keep&lt;/code&gt; e &lt;code&gt;discard&lt;/code&gt; √© como uma esp√©cie de atalho para &lt;code&gt;select&lt;/code&gt;. Como &lt;code&gt;data.frames&lt;/code&gt; s√£o secretamente listas, voc√™ pode rapidamente selecionar todas as vari√°veis do banco que tenham o mesmo tipo.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;flights %&amp;gt;% keep(is.numeric)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 336,776 x 14
##     year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
##    &amp;lt;int&amp;gt; &amp;lt;int&amp;gt; &amp;lt;int&amp;gt;    &amp;lt;int&amp;gt;          &amp;lt;int&amp;gt;     &amp;lt;dbl&amp;gt;    &amp;lt;int&amp;gt;          &amp;lt;int&amp;gt;
##  1  2013     1     1      517            515         2      830            819
##  2  2013     1     1      533            529         4      850            830
##  3  2013     1     1      542            540         2      923            850
##  4  2013     1     1      544            545        -1     1004           1022
##  5  2013     1     1      554            600        -6      812            837
##  6  2013     1     1      554            558        -4      740            728
##  7  2013     1     1      555            600        -5      913            854
##  8  2013     1     1      557            600        -3      709            723
##  9  2013     1     1      557            600        -3      838            846
## 10  2013     1     1      558            600        -2      753            745
## # ... with 336,766 more rows, and 6 more variables: arr_delay &amp;lt;dbl&amp;gt;,
## #   flight &amp;lt;int&amp;gt;, air_time &amp;lt;dbl&amp;gt;, distance &amp;lt;dbl&amp;gt;, hour &amp;lt;dbl&amp;gt;, minute &amp;lt;dbl&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;flights %&amp;gt;% discard(is.character)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 336,776 x 15
##     year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
##    &amp;lt;int&amp;gt; &amp;lt;int&amp;gt; &amp;lt;int&amp;gt;    &amp;lt;int&amp;gt;          &amp;lt;int&amp;gt;     &amp;lt;dbl&amp;gt;    &amp;lt;int&amp;gt;          &amp;lt;int&amp;gt;
##  1  2013     1     1      517            515         2      830            819
##  2  2013     1     1      533            529         4      850            830
##  3  2013     1     1      542            540         2      923            850
##  4  2013     1     1      544            545        -1     1004           1022
##  5  2013     1     1      554            600        -6      812            837
##  6  2013     1     1      554            558        -4      740            728
##  7  2013     1     1      555            600        -5      913            854
##  8  2013     1     1      557            600        -3      709            723
##  9  2013     1     1      557            600        -3      838            846
## 10  2013     1     1      558            600        -2      753            745
## # ... with 336,766 more rows, and 7 more variables: arr_delay &amp;lt;dbl&amp;gt;,
## #   flight &amp;lt;int&amp;gt;, air_time &amp;lt;dbl&amp;gt;, distance &amp;lt;dbl&amp;gt;, hour &amp;lt;dbl&amp;gt;, minute &amp;lt;dbl&amp;gt;,
## #   time_hour &amp;lt;dttm&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Como outros aspectos do &lt;code&gt;purrr&lt;/code&gt;, a grande vantagem aqui √© a generalidade. Essas fun√ß√µes funcionam em qualquer lista de objetos e n√£o apenas em &lt;code&gt;data.frames&lt;/code&gt;.&lt;/p&gt;
&lt;h4 id=&#34;lidando-com-a-presen√ßa-de-erros&#34;&gt;Lidando com a presen√ßa de erros&lt;/h4&gt;
&lt;p&gt;A pr√≥xima dica forte √© utilizar os adv√©rbios (chique) &lt;code&gt;safely()&lt;/code&gt; e companhia para lidar com erros.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;x &amp;lt;- list(a = c(1,2,3), b = c(&amp;quot;a&amp;quot;, &amp;quot;b&amp;quot;, &amp;quot;c&amp;quot;), c = c(99, 88, 77))

x %&amp;gt;% map(sum)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## Error in .Primitive(&amp;quot;sum&amp;quot;)(..., na.rm = na.rm): &#39;type&#39; inv√°lido (character) do argumento
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;N√£o conseguimos nada! A mensagem de erro nem nos informa onde o problema ocorreu. E agora?&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;x %&amp;gt;% map(safely(sum)) %&amp;gt;% str()
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## List of 3
##  $ a:List of 2
##   ..$ result: num 6
##   ..$ error : NULL
##  $ b:List of 2
##   ..$ result: NULL
##   ..$ error :List of 2
##   .. ..$ message: chr &amp;quot;&#39;type&#39; inv√°lido (character) do argumento&amp;quot;
##   .. ..$ call   : language .Primitive(&amp;quot;sum&amp;quot;)(..., na.rm = na.rm)
##   .. ..- attr(*, &amp;quot;class&amp;quot;)= chr [1:3] &amp;quot;simpleError&amp;quot; &amp;quot;error&amp;quot; &amp;quot;condition&amp;quot;
##  $ c:List of 2
##   ..$ result: num 264
##   ..$ error : NULL
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;x %&amp;gt;% map(possibly(sum, otherwise = NA_real_)) %&amp;gt;% str()
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## List of 3
##  $ a: num 6
##  $ b: num NA
##  $ c: num 264
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Essas fun√ß√µes permitem alterar a sa√≠da de uma fun√ß√£o quando ocorrer um erro. &lt;code&gt;quietly&lt;/code&gt; √© parecido, mas ela captura mais a sa√≠da do R, o texto em si.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;x &amp;lt;- list(1, -1)
x %&amp;gt;% map(quietly(log)) %&amp;gt;% str()
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## List of 2
##  $ :List of 4
##   ..$ result  : num 0
##   ..$ output  : chr &amp;quot;&amp;quot;
##   ..$ warnings: chr(0) 
##   ..$ messages: chr(0) 
##  $ :List of 4
##   ..$ result  : num NaN
##   ..$ output  : chr &amp;quot;&amp;quot;
##   ..$ warnings: chr &amp;quot;NaNs produzidos&amp;quot;
##   ..$ messages: chr(0)
&lt;/code&gt;&lt;/pre&gt;
&lt;h4 id=&#34;chamando-listas-de-fun√ß√µes&#34;&gt;Chamando listas de fun√ß√µes&lt;/h4&gt;
&lt;p&gt;Vamos supor que voc√™ tem um vetor de n√∫meros e voc√™ quer aplicar um monte de fun√ß√µes diferentes nele, mas voc√™ n√£o quer ter que ficar copiando e colando tudo.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;numeros &amp;lt;- rnorm(25, 50, 10)
numeros
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##  [1] 43.17877 48.76450 51.29309 40.21730 50.91338 49.95989 54.53964 44.23765
##  [9] 56.14614 37.00182 55.60017 44.17833 33.21468 54.57325 60.78264 39.49895
## [17] 40.34316 24.39014 68.37701 53.10101 62.45857 73.02202 49.60368 48.17334
## [25] 57.83333
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Nessas situa√ß√µes, voc√™ gostaria de chamar v√°rias fun√ß√µes no mesmo objeto ou grupo de objetos, mas voc√™ n√£o sabe bem como fazer isso&amp;hellip; Ent√£o, &lt;code&gt;invoke_map&lt;/code&gt; vem ao resgate.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;funcs &amp;lt;- list(&amp;quot;mean&amp;quot;, &amp;quot;sd&amp;quot;, &amp;quot;IQR&amp;quot;, &amp;quot;sum&amp;quot;, &amp;quot;length&amp;quot;, &amp;quot;range&amp;quot;, &amp;quot;min&amp;quot;, &amp;quot;max&amp;quot;)
args &amp;lt;- list(list(na.rm = T, trim = 0.05),
             list(na.rm=T), 
             list(type = 2),
             list(na.rm = T), 
             list(),
             list(na.rm = T), 
             list(na.rm = T), 
             list(na.rm = T))
funcs %&amp;gt;% str()
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## List of 8
##  $ : chr &amp;quot;mean&amp;quot;
##  $ : chr &amp;quot;sd&amp;quot;
##  $ : chr &amp;quot;IQR&amp;quot;
##  $ : chr &amp;quot;sum&amp;quot;
##  $ : chr &amp;quot;length&amp;quot;
##  $ : chr &amp;quot;range&amp;quot;
##  $ : chr &amp;quot;min&amp;quot;
##  $ : chr &amp;quot;max&amp;quot;
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;args %&amp;gt;% str()
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## List of 8
##  $ :List of 2
##   ..$ na.rm: logi TRUE
##   ..$ trim : num 0.05
##  $ :List of 1
##   ..$ na.rm: logi TRUE
##  $ :List of 1
##   ..$ type: num 2
##  $ :List of 1
##   ..$ na.rm: logi TRUE
##  $ : list()
##  $ :List of 1
##   ..$ na.rm: logi TRUE
##  $ :List of 1
##   ..$ na.rm: logi TRUE
##  $ :List of 1
##   ..$ na.rm: logi TRUE
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;invoke_map(funcs, args, x = numeros) %&amp;gt;% glimpse()
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## List of 8
##  $ : num 49.7
##  $ : num 10.9
##  $ : num 12.4
##  $ : num 1241
##  $ : int 25
##  $ : num [1:2] 24.4 73
##  $ : num 24.4
##  $ : num 73
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Fica mais bonito se voc√™ nomear os argumentos, ai o output fica melhorzinho.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;names(funcs) &amp;lt;- unlist(funcs)

invoke_map(funcs, args, x = numeros) %&amp;gt;% glimpse()
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## List of 8
##  $ mean  : num 49.7
##  $ sd    : num 10.9
##  $ IQR   : num 12.4
##  $ sum   : num 1241
##  $ length: int 25
##  $ range : num [1:2] 24.4 73
##  $ min   : num 24.4
##  $ max   : num 73
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Claro que esse exemplo aqui talvez n√£o seja √∫til para voc√™s, mas espero que quando voc√™s encontrarem uma situa√ß√£o em que voc√™ gostaria de aplicar uma bateria de fun√ß√µes no mesmo objeto ou grupo de objetos, voc√™s se lembrem dessa possibilidade.&lt;/p&gt;
&lt;h4 id=&#34;reduce-e-accumulate&#34;&gt;&lt;code&gt;reduce&lt;/code&gt; e &lt;code&gt;accumulate&lt;/code&gt;&lt;/h4&gt;
&lt;p&gt;Essas duas fun√ß√µes s√£o desenhadas para fazer aplica√ß√µes recursivas de fun√ß√µes que recebem dois argumentos (operadores matem√°ticos, &lt;code&gt;_join&lt;/code&gt;s, etc. Recursividade em linhas gerais, √© voc√™ repetir uma opera√ß√£o com o resultado da repeti√ß√£o anterior. Pense em somas ou produtos acumulados, em que o pr√≥ximo valor √© determinado pela aplica√ß√£o de uma regra sobre o anterior.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;accumulate(1:10, `+`)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##  [1]  1  3  6 10 15 21 28 36 45 55
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;accumulate(1:10, `*`)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##  [1]       1       2       6      24     120     720    5040   40320  362880
## [10] 3628800
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;A principal diferen√ßa entre &lt;code&gt;accumulate&lt;/code&gt; e &lt;code&gt;reduce&lt;/code&gt; √© que a primeira guarda os resultados intermedi√°rios, enquanto a segunda retorna apenas o √∫ltimo.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;reduce(1:10, `+`)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] 55
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;reduce(1:10, `*`)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] 3628800
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Uma aplica√ß√£o bastante pr√°tica dessas fun√ß√µes √© a produ√ß√£o de um √∫nico banco de dados a partir de v√°rios arquivos separados.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;# Lembra dos nossos arquivos l√° em cima?
paths
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] &amp;quot;arquivo1.csv&amp;quot; &amp;quot;arquivo2.csv&amp;quot; &amp;quot;arquivo3.csv&amp;quot; &amp;quot;arquivo4.csv&amp;quot;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Vamos fingir que n√£o temos acesso a &lt;code&gt;map_dfr&lt;/code&gt; e precisamos importar esses objetos e todos comp√µem um √∫nico banco. Imaginaem que tratam-se de dados por ano.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;dfs &amp;lt;- map(paths, read_csv)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## 
## -- Column specification --------------------------------------------------------
## cols(
##   x = col_double(),
##   y = col_double(),
##   z = col_double()
## )
## 
## 
## -- Column specification --------------------------------------------------------
## cols(
##   x = col_double(),
##   y = col_double(),
##   z = col_double()
## )
## 
## 
## -- Column specification --------------------------------------------------------
## cols(
##   x = col_double(),
##   y = col_double(),
##   z = col_double()
## )
## 
## 
## -- Column specification --------------------------------------------------------
## cols(
##   x = col_double(),
##   y = col_double(),
##   z = col_double()
## )
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;glimpse(dfs)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## List of 4
##  $ : spec_tbl_df [100 x 3] (S3: spec_tbl_df/tbl_df/tbl/data.frame)
##   ..$ x: num [1:100] 0.841 0.554 -0.171 0.861 -0.512 ...
##   ..$ y: num [1:100] 2.679 -0.131 0.614 0.887 0.514 ...
##   ..$ z: num [1:100] 0.0835 0.5261 0.8976 0.5499 -0.1911 ...
##   ..- attr(*, &amp;quot;spec&amp;quot;)=
##   .. .. cols(
##   .. ..   x = col_double(),
##   .. ..   y = col_double(),
##   .. ..   z = col_double()
##   .. .. )
##  $ : spec_tbl_df [100 x 3] (S3: spec_tbl_df/tbl_df/tbl/data.frame)
##   ..$ x: num [1:100] 0.101 -0.37 1.658 -0.289 0.174 ...
##   ..$ y: num [1:100] 0.2594 -0.2229 0.0762 0.1111 -0.6952 ...
##   ..$ z: num [1:100] 0.2824 -0.6223 1.8727 -2.201 -0.0989 ...
##   ..- attr(*, &amp;quot;spec&amp;quot;)=
##   .. .. cols(
##   .. ..   x = col_double(),
##   .. ..   y = col_double(),
##   .. ..   z = col_double()
##   .. .. )
##  $ : spec_tbl_df [100 x 3] (S3: spec_tbl_df/tbl_df/tbl/data.frame)
##   ..$ x: num [1:100] -1.453 0.161 0.546 1.678 1.188 ...
##   ..$ y: num [1:100] -2.369 0.473 -0.764 0.24 -2.241 ...
##   ..$ z: num [1:100] -0.5626 0.0762 1.0544 1.2732 -0.2112 ...
##   ..- attr(*, &amp;quot;spec&amp;quot;)=
##   .. .. cols(
##   .. ..   x = col_double(),
##   .. ..   y = col_double(),
##   .. ..   z = col_double()
##   .. .. )
##  $ : spec_tbl_df [100 x 3] (S3: spec_tbl_df/tbl_df/tbl/data.frame)
##   ..$ x: num [1:100] 0.55069 0.00661 1.00478 -1.99002 0.04531 ...
##   ..$ y: num [1:100] 1.12 1.044 -1.779 1.963 -0.944 ...
##   ..$ z: num [1:100] -0.958 1.379 0.405 0.723 1.286 ...
##   ..- attr(*, &amp;quot;spec&amp;quot;)=
##   .. .. cols(
##   .. ..   x = col_double(),
##   .. ..   y = col_double(),
##   .. ..   z = col_double()
##   .. .. )
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;new_df &amp;lt;- reduce(dfs, bind_rows)
new_df
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 400 x 3
##         x       y       z
##     &amp;lt;dbl&amp;gt;   &amp;lt;dbl&amp;gt;   &amp;lt;dbl&amp;gt;
##  1  0.841  2.68    0.0835
##  2  0.554 -0.131   0.526 
##  3 -0.171  0.614   0.898 
##  4  0.861  0.887   0.550 
##  5 -0.512  0.514  -0.191 
##  6  0.593 -0.498  -0.137 
##  7 -1.18  -0.298  -1.14  
##  8 -0.321  0.0182  0.693 
##  9 -0.993 -0.0592  0.507 
## 10 -1.20  -0.625  -0.678 
## # ... with 390 more rows
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;O resultado √© o mesmo observado em &lt;code&gt;map_dfr&lt;/code&gt;, mas essa abordagem √© &lt;strong&gt;gen√©rica&lt;/strong&gt;, ou seja, ela se aplica para qualquer grupo de objetos e para qualquer fun√ß√£o que recebe dois argumentos e precisa ser repetida de maneira &lt;strong&gt;recursiva&lt;/strong&gt;.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;# Apaga os arquivos pra eles n√£o ficarem ai gastando mem√≥ria a toa
file.remove(paths)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] TRUE TRUE TRUE TRUE
&lt;/code&gt;&lt;/pre&gt;
&lt;h4 id=&#34;pluck&#34;&gt;&lt;code&gt;pluck&lt;/code&gt;&lt;/h4&gt;
&lt;p&gt;Esta fun√ß√£o √© um atalho para as tesouras duplas do r &lt;code&gt;[[&lt;/code&gt;. Seu objeto √© facilitar a &lt;strong&gt;leitura&lt;/strong&gt; de c√≥digos que pescam elementos profundos de uma lista aninhada.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;l &amp;lt;- list(
  list(-1, x = 1, y = c(2), z = &amp;quot;a&amp;quot;),
  list(-2, x = 4, y = c(5, 6), z = &amp;quot;b&amp;quot;),
  list(-3, x = 8, y = c(9, 10, 11))
)

glimpse(l)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## List of 3
##  $ :List of 4
##   ..$  : num -1
##   ..$ x: num 1
##   ..$ y: num 2
##   ..$ z: chr &amp;quot;a&amp;quot;
##  $ :List of 4
##   ..$  : num -2
##   ..$ x: num 4
##   ..$ y: num [1:2] 5 6
##   ..$ z: chr &amp;quot;b&amp;quot;
##  $ :List of 3
##   ..$  : num -3
##   ..$ x: num 8
##   ..$ y: num [1:3] 9 10 11
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Se voc√™ chamar &lt;code&gt;map_&lt;/code&gt; nessa lista, voc√™ pode extrair os elementos delas pelo nome.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;map_dbl(l, &amp;quot;x&amp;quot;)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] 1 4 8
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;map(l, &amp;quot;y&amp;quot;)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [[1]]
## [1] 2
## 
## [[2]]
## [1] 5 6
## 
## [[3]]
## [1]  9 10 11
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;map(l, &amp;quot;z&amp;quot;)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [[1]]
## [1] &amp;quot;a&amp;quot;
## 
## [[2]]
## [1] &amp;quot;b&amp;quot;
## 
## [[3]]
## NULL
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Ou pela posi√ß√£o na lista&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;map_dbl(l, 1)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] -1 -2 -3
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;map_dbl(l, 2)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] 1 4 8
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;map(l, 3)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [[1]]
## [1] 2
## 
## [[2]]
## [1] 5 6
## 
## [[3]]
## [1]  9 10 11
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Ou os dois&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;map_dbl(l, list(&amp;quot;x&amp;quot;, 1))
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] 1 4 8
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;map(l, list(&amp;quot;z&amp;quot;, 1))
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [[1]]
## [1] &amp;quot;a&amp;quot;
## 
## [[2]]
## [1] &amp;quot;b&amp;quot;
## 
## [[3]]
## NULL
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;map(l, list(&amp;quot;y&amp;quot;, 3))
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [[1]]
## NULL
## 
## [[2]]
## NULL
## 
## [[3]]
## [1] 11
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Se um componente n√£o existir, voc√™ recebe um erro&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;map_chr(l, &amp;quot;z&amp;quot;)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## Error: Result 3 must be a single string, not NULL of length 0
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Mas voc√™ pode resolver isso passando um valor padr√£o&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;map_chr(l, &amp;quot;z&amp;quot;, .default = NA_character_)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] &amp;quot;a&amp;quot; &amp;quot;b&amp;quot; NA
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Tudo isso funciona com base na fun√ß√£o &lt;code&gt;pluck&lt;/code&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;pluck(l, 1)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [[1]]
## [1] -1
## 
## $x
## [1] 1
## 
## $y
## [1] 2
## 
## $z
## [1] &amp;quot;a&amp;quot;
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;pluck(l, 1, 2)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] 1
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;pluck(l, 2, 3)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] 5 6
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;pluck(l, 1, &amp;quot;x&amp;quot;)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] 1
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;pluck(l, 2, &amp;quot;z&amp;quot;)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] &amp;quot;b&amp;quot;
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;pluck(l, 3, &amp;quot;y&amp;quot;)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1]  9 10 11
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;exerc√≠cios&#34;&gt;Exerc√≠cios&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;Utilize uma das fun√ß√µes &lt;code&gt;map_&lt;/code&gt; para:&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Calcular a m√©dia de cada coluna em &lt;code&gt;mtcars&lt;/code&gt;.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Determinar o tipo de cada coluna em &lt;code&gt;flights&lt;/code&gt;.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Computar o n√∫mero de valores √∫nicos em cada coluna de &lt;code&gt;iris&lt;/code&gt;.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Gere 10 distribui√ß√µes aleat√≥rias (&lt;code&gt;rnorm&lt;/code&gt;) com m√©dias -10, 0, 10 e 100.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Como voc√™ pode criar um vetor indicando se cada coluna em um &lt;code&gt;data.frame&lt;/code&gt; √© um fator?&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Usando as fun√ß√µes predicado &lt;code&gt;keep&lt;/code&gt; e &lt;code&gt;discard&lt;/code&gt;:&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Selecione todas as colunas caractere no banco &lt;code&gt;flights&lt;/code&gt;.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Descarte os caracteres em &lt;code&gt;mpg&lt;/code&gt;.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Selecione os fatores ordenados em &lt;code&gt;diamonds&lt;/code&gt;.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Descarte as vari√°veis n√£o-num√©ricas em &lt;code&gt;iris&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Imagine que voc√™ tem um diret√≥rio cheio de arquivos &lt;code&gt;.csv&lt;/code&gt; que correspondem a um √∫nico banco de dados. Voc√™ tem os caminhos de todos eles num vetor com a forma &lt;code&gt;c(arquivo_1.csv, ..., arquivo_n.csv)&lt;/code&gt;. Como voc√™ importaria esses arquivos? Tente fazer duas solu√ß√µes diferentes.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Escreva um c√≥digo sucinto que implemente v√°rios modelos lineares especificados por voc√™. Salve os resultados numa &lt;code&gt;tibble&lt;/code&gt; com colunas-lista. Depois, extraia os resultados com &lt;code&gt;unnest()&lt;/code&gt;. Use o exemplo como guia.&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;mtcars
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##                      mpg cyl  disp  hp drat    wt  qsec vs am gear carb
## Mazda RX4           21.0   6 160.0 110 3.90 2.620 16.46  0  1    4    4
## Mazda RX4 Wag       21.0   6 160.0 110 3.90 2.875 17.02  0  1    4    4
## Datsun 710          22.8   4 108.0  93 3.85 2.320 18.61  1  1    4    1
## Hornet 4 Drive      21.4   6 258.0 110 3.08 3.215 19.44  1  0    3    1
## Hornet Sportabout   18.7   8 360.0 175 3.15 3.440 17.02  0  0    3    2
## Valiant             18.1   6 225.0 105 2.76 3.460 20.22  1  0    3    1
## Duster 360          14.3   8 360.0 245 3.21 3.570 15.84  0  0    3    4
## Merc 240D           24.4   4 146.7  62 3.69 3.190 20.00  1  0    4    2
## Merc 230            22.8   4 140.8  95 3.92 3.150 22.90  1  0    4    2
## Merc 280            19.2   6 167.6 123 3.92 3.440 18.30  1  0    4    4
## Merc 280C           17.8   6 167.6 123 3.92 3.440 18.90  1  0    4    4
## Merc 450SE          16.4   8 275.8 180 3.07 4.070 17.40  0  0    3    3
## Merc 450SL          17.3   8 275.8 180 3.07 3.730 17.60  0  0    3    3
## Merc 450SLC         15.2   8 275.8 180 3.07 3.780 18.00  0  0    3    3
## Cadillac Fleetwood  10.4   8 472.0 205 2.93 5.250 17.98  0  0    3    4
## Lincoln Continental 10.4   8 460.0 215 3.00 5.424 17.82  0  0    3    4
## Chrysler Imperial   14.7   8 440.0 230 3.23 5.345 17.42  0  0    3    4
## Fiat 128            32.4   4  78.7  66 4.08 2.200 19.47  1  1    4    1
## Honda Civic         30.4   4  75.7  52 4.93 1.615 18.52  1  1    4    2
## Toyota Corolla      33.9   4  71.1  65 4.22 1.835 19.90  1  1    4    1
## Toyota Corona       21.5   4 120.1  97 3.70 2.465 20.01  1  0    3    1
## Dodge Challenger    15.5   8 318.0 150 2.76 3.520 16.87  0  0    3    2
## AMC Javelin         15.2   8 304.0 150 3.15 3.435 17.30  0  0    3    2
## Camaro Z28          13.3   8 350.0 245 3.73 3.840 15.41  0  0    3    4
## Pontiac Firebird    19.2   8 400.0 175 3.08 3.845 17.05  0  0    3    2
## Fiat X1-9           27.3   4  79.0  66 4.08 1.935 18.90  1  1    4    1
## Porsche 914-2       26.0   4 120.3  91 4.43 2.140 16.70  0  1    5    2
## Lotus Europa        30.4   4  95.1 113 3.77 1.513 16.90  1  1    5    2
## Ford Pantera L      15.8   8 351.0 264 4.22 3.170 14.50  0  1    5    4
## Ferrari Dino        19.7   6 145.0 175 3.62 2.770 15.50  0  1    5    6
## Maserati Bora       15.0   8 301.0 335 3.54 3.570 14.60  0  1    5    8
## Volvo 142E          21.4   4 121.0 109 4.11 2.780 18.60  1  1    4    2
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;modelos &amp;lt;- c(&amp;quot;mpg ~ wt&amp;quot;,
             &amp;quot;mpg ~ wt + cyl&amp;quot;,
             &amp;quot;mpg ~ wt + cyl + drat&amp;quot;,
             &amp;quot;mpg ~ wt + cyl + drat + am&amp;quot;)
&lt;/code&gt;&lt;/pre&gt;
</description>
    </item>
    
    <item>
      <title>Solu√ß√µes</title>
      <link>https://laddem.github.io/courses/tidyverse/solucoes/</link>
      <pubDate>Tue, 25 May 2021 00:00:00 +0000</pubDate>
      <guid>https://laddem.github.io/courses/tidyverse/solucoes/</guid>
      <description>&lt;h2 id=&#34;solu√ß√µes-dos-exerc√≠cios&#34;&gt;Solu√ß√µes dos exerc√≠cios&lt;/h2&gt;
&lt;h3 id=&#34;readr-tibble-tidyr&#34;&gt;&lt;code&gt;readr&lt;/code&gt;, &lt;code&gt;tibble&lt;/code&gt;, &lt;code&gt;tidyr&lt;/code&gt;&lt;/h3&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;# N√£o esque√ßa dos pacotes!
library(tidyverse)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## -- Attaching packages --------------------------------------- tidyverse 1.3.1 --
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## v ggplot2 3.3.3     v purrr   0.3.4
## v tibble  3.1.2     v dplyr   1.0.6
## v tidyr   1.1.3     v stringr 1.4.0
## v readr   1.4.0     v forcats 0.5.1
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## -- Conflicts ------------------------------------------ tidyverse_conflicts() --
## x dplyr::filter() masks stats::filter()
## x dplyr::lag()    masks stats::lag()
&lt;/code&gt;&lt;/pre&gt;
&lt;ol&gt;
&lt;li&gt;Como voc√™ importaria o banco &amp;ldquo;epa78.csv&amp;rdquo;&lt;/li&gt;
&lt;/ol&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;file &amp;lt;- readr_example(&amp;quot;epa78.txt&amp;quot;)
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Primeiro, √© bom verificar como est√£o dispostas as informa√ß√µes no arquivo texto&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;read_lines(file, n_max = 10)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##  [1] &amp;quot;ALFA ROMEO                                                                     ALFA ROMEO           78010003&amp;quot;
##  [2] &amp;quot;ALFETTA                              03  81  8    74  7   89  9                ALFETTA              78010053&amp;quot;
##  [3] &amp;quot;SPIDER 2000                          01                                        SPIDER 2000          78010103&amp;quot;
##  [4] &amp;quot;AMC                                                                            AMC                  78020002&amp;quot;
##  [5] &amp;quot;GREMLIN                              03  79  9                    79  9        GREMLIN              78020053&amp;quot;
##  [6] &amp;quot;PACER                                04  89 11                    89 11        PACER                78020103&amp;quot;
##  [7] &amp;quot;PACER WAGON                          07  90 26    91 26                        PACER WAGON          78020153&amp;quot;
##  [8] &amp;quot;CONCORD                              04  88 12    90 11   90 11   83 16        CONCORD              78020203&amp;quot;
##  [9] &amp;quot;CONCORD WAGON                        07  91 30            91 30                CONCORD WAGON        78020253&amp;quot;
## [10] &amp;quot;MATADOR COUPE                        05  97 14    97 14                        MATADOR COUPE        78020303&amp;quot;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Ao identificar que se trata de um arquivo colunado, mas que as colunas s√£o separadas por espa√ßos, escolho o read_fwf com o fwf_empty.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;dic &amp;lt;- fwf_empty(file)

df &amp;lt;- read_fwf(file, col_positions = dic)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## 
## -- Column specification --------------------------------------------------------
## cols(
##   X1 = col_character(),
##   X2 = col_character(),
##   X3 = col_double(),
##   X4 = col_double(),
##   X5 = col_double(),
##   X6 = col_double(),
##   X7 = col_double(),
##   X8 = col_double(),
##   X9 = col_double(),
##   X10 = col_double(),
##   X11 = col_character(),
##   X12 = col_double()
## )
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;df
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 20 x 12
##    X1       X2       X3    X4    X5    X6    X7    X8    X9   X10 X11        X12
##    &amp;lt;chr&amp;gt;    &amp;lt;chr&amp;gt; &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt; &amp;lt;chr&amp;gt;    &amp;lt;dbl&amp;gt;
##  1 ALFA RO~ &amp;lt;NA&amp;gt;     NA    NA    NA    NA    NA    NA    NA    NA ALFA R~ 7.80e7
##  2 ALFETTA  03       81     8    74     7    89     9    NA    NA ALFETTA 7.80e7
##  3 SPIDER ~ 01       NA    NA    NA    NA    NA    NA    NA    NA SPIDER~ 7.80e7
##  4 AMC      &amp;lt;NA&amp;gt;     NA    NA    NA    NA    NA    NA    NA    NA AMC     7.80e7
##  5 GREMLIN  03       79     9    NA    NA    NA    NA    79     9 GREMLIN 7.80e7
##  6 PACER    04       89    11    NA    NA    NA    NA    89    11 PACER   7.80e7
##  7 PACER W~ 07       90    26    91    26    NA    NA    NA    NA PACER ~ 7.80e7
##  8 CONCORD  04       88    12    90    11    90    11    83    16 CONCORD 7.80e7
##  9 CONCORD~ 07       91    30    NA    NA    91    30    NA    NA CONCOR~ 7.80e7
## 10 MATADOR~ 05       97    14    97    14    NA    NA    NA    NA MATADO~ 7.80e7
## 11 MATADOR~ 06      110    20    NA    NA   110    20    NA    NA MATADO~ 7.80e7
## 12 MATADOR~ 09      112    50    NA    NA   112    50    NA    NA MATADO~ 7.80e7
## 13 ASTON M~ &amp;lt;NA&amp;gt;     NA    NA    NA    NA    NA    NA    NA    NA ASTON ~ 7.80e7
## 14 ASTON M~ &amp;lt;NA&amp;gt;     NA    NA    NA    NA    NA    NA    NA    NA ASTON ~ 7.80e7
## 15 AUDI     &amp;lt;NA&amp;gt;     NA    NA    NA    NA    NA    NA    NA    NA AUDI    7.81e7
## 16 FOX      03       84    11    84    11    84    11    NA    NA FOX     7.81e7
## 17 FOX WAG~ 07       83    40    NA    NA    83    40    NA    NA FOX WA~ 7.81e7
## 18 5000     04       90    15    NA    NA    90    15    NA    NA 5000    7.81e7
## 19 AVANTI   &amp;lt;NA&amp;gt;     NA    NA    NA    NA    NA    NA    NA    NA AVANTI  7.81e7
## 20 AVANTI ~ 02       75     8    75     8    NA    NA    NA    NA AVANTI~ 7.81e7
&lt;/code&gt;&lt;/pre&gt;
&lt;ol start=&#34;2&#34;&gt;
&lt;li&gt;Importe o banco &amp;ldquo;challenge.csv&amp;rdquo; e resolva os problemas com o tipo da coluna.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Ao verificar as primeiras 10 linhas do banco, podemos notar algo estranho&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;file &amp;lt;- readr_example(&amp;quot;challenge.csv&amp;quot;)

read_lines(file, n_max = 10)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##  [1] &amp;quot;x,y&amp;quot;     &amp;quot;404,NA&amp;quot;  &amp;quot;4172,NA&amp;quot; &amp;quot;3004,NA&amp;quot; &amp;quot;787,NA&amp;quot;  &amp;quot;37,NA&amp;quot;   &amp;quot;2332,NA&amp;quot;
##  [8] &amp;quot;2489,NA&amp;quot; &amp;quot;1449,NA&amp;quot; &amp;quot;3665,NA&amp;quot;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Parece ser um arquivo csv comum, com duas colunas, mas uma delas parece ter apenas NAs. Se a gente proceder com a importa√ß√£o padr√£o, chegaremos em&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;df &amp;lt;- read_csv(file)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## 
## -- Column specification --------------------------------------------------------
## cols(
##   x = col_double(),
##   y = col_logical()
## )
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## Warning: 1000 parsing failures.
##  row col           expected     actual                                                                     file
## 1001   y 1/0/T/F/TRUE/FALSE 2015-01-16 &#39;C:/Users/vinic/Documents/R/win-library/4.1/readr/extdata/challenge.csv&#39;
## 1002   y 1/0/T/F/TRUE/FALSE 2018-05-18 &#39;C:/Users/vinic/Documents/R/win-library/4.1/readr/extdata/challenge.csv&#39;
## 1003   y 1/0/T/F/TRUE/FALSE 2015-09-05 &#39;C:/Users/vinic/Documents/R/win-library/4.1/readr/extdata/challenge.csv&#39;
## 1004   y 1/0/T/F/TRUE/FALSE 2012-11-28 &#39;C:/Users/vinic/Documents/R/win-library/4.1/readr/extdata/challenge.csv&#39;
## 1005   y 1/0/T/F/TRUE/FALSE 2020-01-13 &#39;C:/Users/vinic/Documents/R/win-library/4.1/readr/extdata/challenge.csv&#39;
## .... ... .................. .......... ........................................................................
## See problems(...) for more details.
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;df
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 2,000 x 2
##        x y    
##    &amp;lt;dbl&amp;gt; &amp;lt;lgl&amp;gt;
##  1   404 NA   
##  2  4172 NA   
##  3  3004 NA   
##  4   787 NA   
##  5    37 NA   
##  6  2332 NA   
##  7  2489 NA   
##  8  1449 NA   
##  9  3665 NA   
## 10  3863 NA   
## # ... with 1,990 more rows
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;No console de voc√™s, deve aparecer que foram importadas as colunas x como double e y como logical. Mas uma chuva de &amp;ldquo;parsing failures&amp;rdquo;, indicando que expected = 1/0/T/F/TRUE/FALSE, actual = 2015-01-16.&lt;/p&gt;
&lt;p&gt;Na verdade, ao tentar adivinhar o tipo de colunas, o readr l√™ as primeiras 1000 observa√ß√µes em busca de um padr√£o. Voc√™ pode resolver esse problema:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;# 1. Aumentando o n√∫mero de observa√ß√µes utilizadas para adivinhar as colunas
df &amp;lt;- read_csv(file, guess_max = 1001)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## 
## -- Column specification --------------------------------------------------------
## cols(
##   x = col_double(),
##   y = col_date(format = &amp;quot;&amp;quot;)
## )
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;# A espec√≠fica√ß√£o da coluna Y agora √© &amp;lt;date&amp;gt;
df
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 2,000 x 2
##        x y         
##    &amp;lt;dbl&amp;gt; &amp;lt;date&amp;gt;    
##  1   404 NA        
##  2  4172 NA        
##  3  3004 NA        
##  4   787 NA        
##  5    37 NA        
##  6  2332 NA        
##  7  2489 NA        
##  8  1449 NA        
##  9  3665 NA        
## 10  3863 NA        
## # ... with 1,990 more rows
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;# 2. escolhendo diretamente o tipo de coluna antes da importa√ß√£o
tipos &amp;lt;- cols(
  y = col_date()
)

df &amp;lt;- read_csv(file, col_types = tipos)

# Mesmo resultado
df
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 2,000 x 2
##        x y         
##    &amp;lt;dbl&amp;gt; &amp;lt;date&amp;gt;    
##  1   404 NA        
##  2  4172 NA        
##  3  3004 NA        
##  4   787 NA        
##  5    37 NA        
##  6  2332 NA        
##  7  2489 NA        
##  8  1449 NA        
##  9  3665 NA        
## 10  3863 NA        
## # ... with 1,990 more rows
&lt;/code&gt;&lt;/pre&gt;
&lt;ol start=&#34;3&#34;&gt;
&lt;li&gt;Com o banco sala_aula dado a seguir, transforme-o para que ele contenha as vari√°veis nome, avalia√ß√£o e nota.&lt;/li&gt;
&lt;/ol&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;sala_aula &amp;lt;- tribble(
 ~name,    ~teste1,  ~teste2,  ~prova1,
 &amp;quot;Billy&amp;quot;,  &amp;quot;&amp;lt;NA&amp;gt;&amp;quot;,   &amp;quot;D&amp;quot;   ,   &amp;quot;C&amp;quot;,
 &amp;quot;Suzy&amp;quot;,   &amp;quot;F&amp;quot;,      &amp;quot;&amp;lt;NA&amp;gt;&amp;quot;,   &amp;quot;&amp;lt;NA&amp;gt;&amp;quot;,
 &amp;quot;Lionel&amp;quot;, &amp;quot;B&amp;quot;,      &amp;quot;C&amp;quot;   ,   &amp;quot;B&amp;quot;,
 &amp;quot;Jenny&amp;quot;,  &amp;quot;A&amp;quot;,      &amp;quot;A&amp;quot;   ,   &amp;quot;B&amp;quot;
)
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;√â sempre bom come√ßar planejando o banco que queremos construir. Queremos um banco que tenha 3 vari√°veis: o nome, o tipo de prova aplicada e a nota de cada aluno. Para isso, precisamos colocar os nomes das colunas teste1, teste2 e prova1 numa vari√°vel e os valores das c√©lulas em outra. Vamos chamar essas colunas de &amp;ldquo;avalia√ß√£o&amp;rdquo; e &amp;ldquo;nota&amp;rdquo;, elas formam um par.&lt;/p&gt;
&lt;p&gt;Agora vamos chamar &lt;code&gt;pivot_wider&lt;/code&gt; e especificar esses argumentos.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;sala_aula %&amp;gt;% pivot_longer(
  # Primeiro, identificamos as colunas que ser√£o modificadas
  cols = c(teste1, teste2, prova1),
  # Agora, indicamos os nomes das colunas que receber√£o
  # os nomes das colunas transformadas
  names_to = &amp;quot;avaliacao&amp;quot;,
  # os valores das c√©lulas
  values_to = &amp;quot;nota&amp;quot;
)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 12 x 3
##    name   avaliacao nota 
##    &amp;lt;chr&amp;gt;  &amp;lt;chr&amp;gt;     &amp;lt;chr&amp;gt;
##  1 Billy  teste1    &amp;lt;NA&amp;gt; 
##  2 Billy  teste2    D    
##  3 Billy  prova1    C    
##  4 Suzy   teste1    F    
##  5 Suzy   teste2    &amp;lt;NA&amp;gt; 
##  6 Suzy   prova1    &amp;lt;NA&amp;gt; 
##  7 Lionel teste1    B    
##  8 Lionel teste2    C    
##  9 Lionel prova1    B    
## 10 Jenny  teste1    A    
## 11 Jenny  teste2    A    
## 12 Jenny  prova1    B
&lt;/code&gt;&lt;/pre&gt;
&lt;ol start=&#34;4&#34;&gt;
&lt;li&gt;Transforme o banco &lt;code&gt;relig_income&lt;/code&gt; para que ele contenha as colunas religi√£o, renda e frequ√™ncia.&lt;/li&gt;
&lt;/ol&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;relig_income
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 18 x 11
##    religion `&amp;lt;$10k` `$10-20k` `$20-30k` `$30-40k` `$40-50k` `$50-75k` `$75-100k`
##    &amp;lt;chr&amp;gt;      &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;      &amp;lt;dbl&amp;gt;
##  1 Agnostic      27        34        60        81        76       137        122
##  2 Atheist       12        27        37        52        35        70         73
##  3 Buddhist      27        21        30        34        33        58         62
##  4 Catholic     418       617       732       670       638      1116        949
##  5 Don‚Äôt k~      15        14        15        11        10        35         21
##  6 Evangel~     575       869      1064       982       881      1486        949
##  7 Hindu          1         9         7         9        11        34         47
##  8 Histori~     228       244       236       238       197       223        131
##  9 Jehovah~      20        27        24        24        21        30         15
## 10 Jewish        19        19        25        25        30        95         69
## 11 Mainlin~     289       495       619       655       651      1107        939
## 12 Mormon        29        40        48        51        56       112         85
## 13 Muslim         6         7         9        10         9        23         16
## 14 Orthodox      13        17        23        32        32        47         38
## 15 Other C~       9         7        11        13        13        14         18
## 16 Other F~      20        33        40        46        49        63         46
## 17 Other W~       5         2         3         4         2         7          3
## 18 Unaffil~     217       299       374       365       341       528        407
## # ... with 3 more variables: $100-150k &amp;lt;dbl&amp;gt;, &amp;gt;150k &amp;lt;dbl&amp;gt;,
## #   Don&#39;t know/refused &amp;lt;dbl&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;O banco relig_income parece ter uma organiza√ß√£o em que temos 2 vari√°veis, mas uma delas est√° numa coluna &amp;ldquo;religion&amp;rdquo; e a outra est√° em 10 colunas, &amp;ldquo;income&amp;rdquo;. Queremos um banco que tenha 3 colunas: a religi√£o, o n√≠vel de renda, e o n√∫mero de pessoas em cada combina√ß√£o das duas primeiras.&lt;/p&gt;
&lt;p&gt;Como no exer√≠cio anterior, vamos chamar pivot_longer e especificar&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;relig_income %&amp;gt;% pivot_longer(
  
  # As colunas a serem modificadas, notem o uso de &#39;:&#39; para selecionar v√°rias
  # colunas em sequ√™ncia
  cols = `&amp;lt;$10k`:`Don&#39;t know/refused`,
  
  # Vari√°vel recebe os nomes da antiga coluna
  names_to = &amp;quot;nivel_renda&amp;quot;,
  
  # Vari√°vel recebe os valores das c√©lulas
  values_to = &amp;quot;contagem&amp;quot;
  
)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 180 x 3
##    religion nivel_renda        contagem
##    &amp;lt;chr&amp;gt;    &amp;lt;chr&amp;gt;                 &amp;lt;dbl&amp;gt;
##  1 Agnostic &amp;lt;$10k                    27
##  2 Agnostic $10-20k                  34
##  3 Agnostic $20-30k                  60
##  4 Agnostic $30-40k                  81
##  5 Agnostic $40-50k                  76
##  6 Agnostic $50-75k                 137
##  7 Agnostic $75-100k                122
##  8 Agnostic $100-150k               109
##  9 Agnostic &amp;gt;150k                    84
## 10 Agnostic Don&#39;t know/refused       96
## # ... with 170 more rows
&lt;/code&gt;&lt;/pre&gt;
&lt;ol start=&#34;5&#34;&gt;
&lt;li&gt;Transforme o banco &lt;code&gt;billboard&lt;/code&gt; para que ele contenha apenas uma coluna &amp;ldquo;semana&amp;rdquo; e uma coluna com a posi√ß√£o da m√∫sica no ranking.&lt;/li&gt;
&lt;/ol&gt;
&lt;blockquote&gt;
&lt;p&gt;Dica, voc√™ pode selecionar v√°rias colunas usando o atalho wk1:wk76&lt;/p&gt;
&lt;/blockquote&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;billboard
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 317 x 79
##    artist   track   date.entered   wk1   wk2   wk3   wk4   wk5   wk6   wk7   wk8
##    &amp;lt;chr&amp;gt;    &amp;lt;chr&amp;gt;   &amp;lt;date&amp;gt;       &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt;
##  1 2 Pac    Baby D~ 2000-02-26      87    82    72    77    87    94    99    NA
##  2 2Ge+her  The Ha~ 2000-09-02      91    87    92    NA    NA    NA    NA    NA
##  3 3 Doors~ Krypto~ 2000-04-08      81    70    68    67    66    57    54    53
##  4 3 Doors~ Loser   2000-10-21      76    76    72    69    67    65    55    59
##  5 504 Boyz Wobble~ 2000-04-15      57    34    25    17    17    31    36    49
##  6 98^0     Give M~ 2000-08-19      51    39    34    26    26    19     2     2
##  7 A*Teens  Dancin~ 2000-07-08      97    97    96    95   100    NA    NA    NA
##  8 Aaliyah  I Don&#39;~ 2000-01-29      84    62    51    41    38    35    35    38
##  9 Aaliyah  Try Ag~ 2000-03-18      59    53    38    28    21    18    16    14
## 10 Adams, ~ Open M~ 2000-08-26      76    76    74    69    68    67    61    58
## # ... with 307 more rows, and 68 more variables: wk9 &amp;lt;dbl&amp;gt;, wk10 &amp;lt;dbl&amp;gt;,
## #   wk11 &amp;lt;dbl&amp;gt;, wk12 &amp;lt;dbl&amp;gt;, wk13 &amp;lt;dbl&amp;gt;, wk14 &amp;lt;dbl&amp;gt;, wk15 &amp;lt;dbl&amp;gt;, wk16 &amp;lt;dbl&amp;gt;,
## #   wk17 &amp;lt;dbl&amp;gt;, wk18 &amp;lt;dbl&amp;gt;, wk19 &amp;lt;dbl&amp;gt;, wk20 &amp;lt;dbl&amp;gt;, wk21 &amp;lt;dbl&amp;gt;, wk22 &amp;lt;dbl&amp;gt;,
## #   wk23 &amp;lt;dbl&amp;gt;, wk24 &amp;lt;dbl&amp;gt;, wk25 &amp;lt;dbl&amp;gt;, wk26 &amp;lt;dbl&amp;gt;, wk27 &amp;lt;dbl&amp;gt;, wk28 &amp;lt;dbl&amp;gt;,
## #   wk29 &amp;lt;dbl&amp;gt;, wk30 &amp;lt;dbl&amp;gt;, wk31 &amp;lt;dbl&amp;gt;, wk32 &amp;lt;dbl&amp;gt;, wk33 &amp;lt;dbl&amp;gt;, wk34 &amp;lt;dbl&amp;gt;,
## #   wk35 &amp;lt;dbl&amp;gt;, wk36 &amp;lt;dbl&amp;gt;, wk37 &amp;lt;dbl&amp;gt;, wk38 &amp;lt;dbl&amp;gt;, wk39 &amp;lt;dbl&amp;gt;, wk40 &amp;lt;dbl&amp;gt;,
## #   wk41 &amp;lt;dbl&amp;gt;, wk42 &amp;lt;dbl&amp;gt;, wk43 &amp;lt;dbl&amp;gt;, wk44 &amp;lt;dbl&amp;gt;, wk45 &amp;lt;dbl&amp;gt;, wk46 &amp;lt;dbl&amp;gt;,
## #   wk47 &amp;lt;dbl&amp;gt;, wk48 &amp;lt;dbl&amp;gt;, wk49 &amp;lt;dbl&amp;gt;, wk50 &amp;lt;dbl&amp;gt;, wk51 &amp;lt;dbl&amp;gt;, wk52 &amp;lt;dbl&amp;gt;,
## #   wk53 &amp;lt;dbl&amp;gt;, wk54 &amp;lt;dbl&amp;gt;, wk55 &amp;lt;dbl&amp;gt;, wk56 &amp;lt;dbl&amp;gt;, wk57 &amp;lt;dbl&amp;gt;, wk58 &amp;lt;dbl&amp;gt;,
## #   wk59 &amp;lt;dbl&amp;gt;, wk60 &amp;lt;dbl&amp;gt;, wk61 &amp;lt;dbl&amp;gt;, wk62 &amp;lt;dbl&amp;gt;, wk63 &amp;lt;dbl&amp;gt;, wk64 &amp;lt;dbl&amp;gt;,
## #   wk65 &amp;lt;dbl&amp;gt;, wk66 &amp;lt;lgl&amp;gt;, wk67 &amp;lt;lgl&amp;gt;, wk68 &amp;lt;lgl&amp;gt;, wk69 &amp;lt;lgl&amp;gt;, wk70 &amp;lt;lgl&amp;gt;,
## #   wk71 &amp;lt;lgl&amp;gt;, wk72 &amp;lt;lgl&amp;gt;, wk73 &amp;lt;lgl&amp;gt;, wk74 &amp;lt;lgl&amp;gt;, wk75 &amp;lt;lgl&amp;gt;, wk76 &amp;lt;lgl&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Da mesma forma como fizemos nos anteriores, queremos transformar as v√°rias wk1:wk76 em um par de colunas, uma que me diga a semana e a outra que me diga em que posi√ß√£o no ranking a m√∫sica estava.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;billboard %&amp;gt;% pivot_longer(
  # Colunas que ser√£o transformadas
  cols = wk1:wk76,
  # Nome da vari√°vel que receber√° os nomes das colunas
  names_to = &amp;quot;semana&amp;quot;,
  # Nome da vari√°vel que receber√° os valores das c√©lulas
  values_to = &amp;quot;posicao_rank&amp;quot;,
  # Nesse caso, uso o argumento opcional para eliminar os NAs
  values_drop_na = TRUE
  # Experimente mudar este argumento para FALSE e veja o resultado
  # Quando uma m√∫sica n√£o est√° mais nas paradas, ela recebe NA. Acho
  # justificado excluir os NAs nesse caso.
)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 5,307 x 5
##    artist  track                   date.entered semana posicao_rank
##    &amp;lt;chr&amp;gt;   &amp;lt;chr&amp;gt;                   &amp;lt;date&amp;gt;       &amp;lt;chr&amp;gt;         &amp;lt;dbl&amp;gt;
##  1 2 Pac   Baby Don&#39;t Cry (Keep... 2000-02-26   wk1              87
##  2 2 Pac   Baby Don&#39;t Cry (Keep... 2000-02-26   wk2              82
##  3 2 Pac   Baby Don&#39;t Cry (Keep... 2000-02-26   wk3              72
##  4 2 Pac   Baby Don&#39;t Cry (Keep... 2000-02-26   wk4              77
##  5 2 Pac   Baby Don&#39;t Cry (Keep... 2000-02-26   wk5              87
##  6 2 Pac   Baby Don&#39;t Cry (Keep... 2000-02-26   wk6              94
##  7 2 Pac   Baby Don&#39;t Cry (Keep... 2000-02-26   wk7              99
##  8 2Ge+her The Hardest Part Of ... 2000-09-02   wk1              91
##  9 2Ge+her The Hardest Part Of ... 2000-09-02   wk2              87
## 10 2Ge+her The Hardest Part Of ... 2000-09-02   wk3              92
## # ... with 5,297 more rows
&lt;/code&gt;&lt;/pre&gt;
&lt;ol start=&#34;6&#34;&gt;
&lt;li&gt;Experimente fazer o caminho inverso dos exerc√≠cios 3 a 5, devolvendo os datasets ao seu formato original. O que voc√™ observou?&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Vou come√ßar enxugando os c√≥digos anteriores para criar os resultados que produzimos e salv√°-los em objetos.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;sala_aula_long &amp;lt;- 
  sala_aula %&amp;gt;% pivot_longer(
    cols = c(teste1, teste2, prova1),
    names_to = &amp;quot;avaliacao&amp;quot;,
    values_to = &amp;quot;nota&amp;quot;
  )

relig_income_long &amp;lt;- 
  relig_income %&amp;gt;% pivot_longer(
    cols = `&amp;lt;$10k`:`Don&#39;t know/refused`,
    names_to = &amp;quot;nivel_renda&amp;quot;,
    values_to = &amp;quot;contagem&amp;quot;
  )

billboard_long &amp;lt;- 
  billboard %&amp;gt;% pivot_longer(
    cols = wk1:wk76,
    names_to = &amp;quot;semana&amp;quot;,
    values_to = &amp;quot;posicao_rank&amp;quot;,
    values_drop_na = TRUE
  )

sala_aula_long
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 12 x 3
##    name   avaliacao nota 
##    &amp;lt;chr&amp;gt;  &amp;lt;chr&amp;gt;     &amp;lt;chr&amp;gt;
##  1 Billy  teste1    &amp;lt;NA&amp;gt; 
##  2 Billy  teste2    D    
##  3 Billy  prova1    C    
##  4 Suzy   teste1    F    
##  5 Suzy   teste2    &amp;lt;NA&amp;gt; 
##  6 Suzy   prova1    &amp;lt;NA&amp;gt; 
##  7 Lionel teste1    B    
##  8 Lionel teste2    C    
##  9 Lionel prova1    B    
## 10 Jenny  teste1    A    
## 11 Jenny  teste2    A    
## 12 Jenny  prova1    B
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;relig_income_long
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 180 x 3
##    religion nivel_renda        contagem
##    &amp;lt;chr&amp;gt;    &amp;lt;chr&amp;gt;                 &amp;lt;dbl&amp;gt;
##  1 Agnostic &amp;lt;$10k                    27
##  2 Agnostic $10-20k                  34
##  3 Agnostic $20-30k                  60
##  4 Agnostic $30-40k                  81
##  5 Agnostic $40-50k                  76
##  6 Agnostic $50-75k                 137
##  7 Agnostic $75-100k                122
##  8 Agnostic $100-150k               109
##  9 Agnostic &amp;gt;150k                    84
## 10 Agnostic Don&#39;t know/refused       96
## # ... with 170 more rows
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;billboard_long
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 5,307 x 5
##    artist  track                   date.entered semana posicao_rank
##    &amp;lt;chr&amp;gt;   &amp;lt;chr&amp;gt;                   &amp;lt;date&amp;gt;       &amp;lt;chr&amp;gt;         &amp;lt;dbl&amp;gt;
##  1 2 Pac   Baby Don&#39;t Cry (Keep... 2000-02-26   wk1              87
##  2 2 Pac   Baby Don&#39;t Cry (Keep... 2000-02-26   wk2              82
##  3 2 Pac   Baby Don&#39;t Cry (Keep... 2000-02-26   wk3              72
##  4 2 Pac   Baby Don&#39;t Cry (Keep... 2000-02-26   wk4              77
##  5 2 Pac   Baby Don&#39;t Cry (Keep... 2000-02-26   wk5              87
##  6 2 Pac   Baby Don&#39;t Cry (Keep... 2000-02-26   wk6              94
##  7 2 Pac   Baby Don&#39;t Cry (Keep... 2000-02-26   wk7              99
##  8 2Ge+her The Hardest Part Of ... 2000-09-02   wk1              91
##  9 2Ge+her The Hardest Part Of ... 2000-09-02   wk2              87
## 10 2Ge+her The Hardest Part Of ... 2000-09-02   wk3              92
## # ... with 5,297 more rows
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;O caminho inverso desses bancos de dados, √© utilizar &lt;code&gt;pivot_wider&lt;/code&gt;. Aqui, vamos escolher um par de colunas que cont√©m:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;O nome das colunas que queremos criar&lt;/li&gt;
&lt;li&gt;O valor que queremos passar para as c√©lulas dessas novas colunas&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Vamos ver exemplos comentados como no anterior&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;sala_aula_long %&amp;gt;% pivot_wider(
  
  # Aqui, identificamos colunas que N√ÉO SER√ÉO MODIFICADAS
  # √â o contr√°rio de pivot_longer. Por padr√£o, s√£o todas as que n√£o s√£o
  # mencionadas na transforma√ß√£o, mas para deixar bem claro, 
  # vou deixar expl√≠cito.
  id_cols = name,
  
  # Vari√°vel com os nomes para as novas colunas
  names_from = avaliacao,
  
  # Vari√°vel com os valores para as c√©lulas
  values_from = nota
)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 4 x 4
##   name   teste1 teste2 prova1
##   &amp;lt;chr&amp;gt;  &amp;lt;chr&amp;gt;  &amp;lt;chr&amp;gt;  &amp;lt;chr&amp;gt; 
## 1 Billy  &amp;lt;NA&amp;gt;   D      C     
## 2 Suzy   F      &amp;lt;NA&amp;gt;   &amp;lt;NA&amp;gt;  
## 3 Lionel B      C      B     
## 4 Jenny  A      A      B
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;relig_income_long %&amp;gt;% pivot_wider(
  # Colunas n√£o modificadas
  id_cols = religion,
  
  # Vari√°vel com os nomes para as novas colunas
  names_from = nivel_renda,
  
  # Vari√°vel com os valores para as c√©lulas
  values_from = contagem
)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 18 x 11
##    religion `&amp;lt;$10k` `$10-20k` `$20-30k` `$30-40k` `$40-50k` `$50-75k` `$75-100k`
##    &amp;lt;chr&amp;gt;      &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;      &amp;lt;dbl&amp;gt;
##  1 Agnostic      27        34        60        81        76       137        122
##  2 Atheist       12        27        37        52        35        70         73
##  3 Buddhist      27        21        30        34        33        58         62
##  4 Catholic     418       617       732       670       638      1116        949
##  5 Don‚Äôt k~      15        14        15        11        10        35         21
##  6 Evangel~     575       869      1064       982       881      1486        949
##  7 Hindu          1         9         7         9        11        34         47
##  8 Histori~     228       244       236       238       197       223        131
##  9 Jehovah~      20        27        24        24        21        30         15
## 10 Jewish        19        19        25        25        30        95         69
## 11 Mainlin~     289       495       619       655       651      1107        939
## 12 Mormon        29        40        48        51        56       112         85
## 13 Muslim         6         7         9        10         9        23         16
## 14 Orthodox      13        17        23        32        32        47         38
## 15 Other C~       9         7        11        13        13        14         18
## 16 Other F~      20        33        40        46        49        63         46
## 17 Other W~       5         2         3         4         2         7          3
## 18 Unaffil~     217       299       374       365       341       528        407
## # ... with 3 more variables: $100-150k &amp;lt;dbl&amp;gt;, &amp;gt;150k &amp;lt;dbl&amp;gt;,
## #   Don&#39;t know/refused &amp;lt;dbl&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;billboard_long %&amp;gt;% pivot_wider(
  # Colunas n√£o modificadas
  id_cols = c(artist, track, date.entered),
  
  # Vari√°vel com os nomes para as novas colunas
  names_from = semana,
  
  # Vari√°vel com os valores para as c√©lulas
  values_from = posicao_rank
)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 317 x 68
##    artist   track   date.entered   wk1   wk2   wk3   wk4   wk5   wk6   wk7   wk8
##    &amp;lt;chr&amp;gt;    &amp;lt;chr&amp;gt;   &amp;lt;date&amp;gt;       &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt;
##  1 2 Pac    Baby D~ 2000-02-26      87    82    72    77    87    94    99    NA
##  2 2Ge+her  The Ha~ 2000-09-02      91    87    92    NA    NA    NA    NA    NA
##  3 3 Doors~ Krypto~ 2000-04-08      81    70    68    67    66    57    54    53
##  4 3 Doors~ Loser   2000-10-21      76    76    72    69    67    65    55    59
##  5 504 Boyz Wobble~ 2000-04-15      57    34    25    17    17    31    36    49
##  6 98^0     Give M~ 2000-08-19      51    39    34    26    26    19     2     2
##  7 A*Teens  Dancin~ 2000-07-08      97    97    96    95   100    NA    NA    NA
##  8 Aaliyah  I Don&#39;~ 2000-01-29      84    62    51    41    38    35    35    38
##  9 Aaliyah  Try Ag~ 2000-03-18      59    53    38    28    21    18    16    14
## 10 Adams, ~ Open M~ 2000-08-26      76    76    74    69    68    67    61    58
## # ... with 307 more rows, and 57 more variables: wk9 &amp;lt;dbl&amp;gt;, wk10 &amp;lt;dbl&amp;gt;,
## #   wk11 &amp;lt;dbl&amp;gt;, wk12 &amp;lt;dbl&amp;gt;, wk13 &amp;lt;dbl&amp;gt;, wk14 &amp;lt;dbl&amp;gt;, wk15 &amp;lt;dbl&amp;gt;, wk16 &amp;lt;dbl&amp;gt;,
## #   wk17 &amp;lt;dbl&amp;gt;, wk18 &amp;lt;dbl&amp;gt;, wk19 &amp;lt;dbl&amp;gt;, wk20 &amp;lt;dbl&amp;gt;, wk21 &amp;lt;dbl&amp;gt;, wk22 &amp;lt;dbl&amp;gt;,
## #   wk23 &amp;lt;dbl&amp;gt;, wk24 &amp;lt;dbl&amp;gt;, wk25 &amp;lt;dbl&amp;gt;, wk26 &amp;lt;dbl&amp;gt;, wk27 &amp;lt;dbl&amp;gt;, wk28 &amp;lt;dbl&amp;gt;,
## #   wk29 &amp;lt;dbl&amp;gt;, wk30 &amp;lt;dbl&amp;gt;, wk31 &amp;lt;dbl&amp;gt;, wk32 &amp;lt;dbl&amp;gt;, wk33 &amp;lt;dbl&amp;gt;, wk34 &amp;lt;dbl&amp;gt;,
## #   wk35 &amp;lt;dbl&amp;gt;, wk36 &amp;lt;dbl&amp;gt;, wk37 &amp;lt;dbl&amp;gt;, wk38 &amp;lt;dbl&amp;gt;, wk39 &amp;lt;dbl&amp;gt;, wk40 &amp;lt;dbl&amp;gt;,
## #   wk41 &amp;lt;dbl&amp;gt;, wk42 &amp;lt;dbl&amp;gt;, wk43 &amp;lt;dbl&amp;gt;, wk44 &amp;lt;dbl&amp;gt;, wk45 &amp;lt;dbl&amp;gt;, wk46 &amp;lt;dbl&amp;gt;,
## #   wk47 &amp;lt;dbl&amp;gt;, wk48 &amp;lt;dbl&amp;gt;, wk49 &amp;lt;dbl&amp;gt;, wk50 &amp;lt;dbl&amp;gt;, wk51 &amp;lt;dbl&amp;gt;, wk52 &amp;lt;dbl&amp;gt;,
## #   wk53 &amp;lt;dbl&amp;gt;, wk54 &amp;lt;dbl&amp;gt;, wk55 &amp;lt;dbl&amp;gt;, wk56 &amp;lt;dbl&amp;gt;, wk57 &amp;lt;dbl&amp;gt;, wk58 &amp;lt;dbl&amp;gt;,
## #   wk59 &amp;lt;dbl&amp;gt;, wk60 &amp;lt;dbl&amp;gt;, wk61 &amp;lt;dbl&amp;gt;, wk62 &amp;lt;dbl&amp;gt;, wk63 &amp;lt;dbl&amp;gt;, wk64 &amp;lt;dbl&amp;gt;,
## #   wk65 &amp;lt;dbl&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Tanto &lt;code&gt;pivot_longer&lt;/code&gt; quanto &lt;code&gt;pivot_wider&lt;/code&gt; tem mais argumentos para lidar com situa√ß√µes complexas, como quando voc√™ precisa aplicar transforma√ß√µes em vari√°veis antes de reformatar o banco ou precisa utilizar m√∫ltiplas colunas, mas eu deixo isso para voc√™s descobrirem por conta pr√≥pria quando estiverem confort√°veis com a sintaxe b√°sica.&lt;/p&gt;
&lt;ol start=&#34;7&#34;&gt;
&lt;li&gt;O que os argumentos &lt;code&gt;extra&lt;/code&gt; e &lt;code&gt;fill&lt;/code&gt; em separate fazem? Utilize o exemplo a seguir como guia.&lt;/li&gt;
&lt;/ol&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;tibble(x = c(&amp;quot;a,b,c&amp;quot;, &amp;quot;d,e,f,g&amp;quot;, &amp;quot;h,i,j&amp;quot;)) %&amp;gt;% 
  separate(x, c(&amp;quot;um&amp;quot;, &amp;quot;dois&amp;quot;, &amp;quot;tres&amp;quot;))
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## Warning: Expected 3 pieces. Additional pieces discarded in 1 rows [2].
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 3 x 3
##   um    dois  tres 
##   &amp;lt;chr&amp;gt; &amp;lt;chr&amp;gt; &amp;lt;chr&amp;gt;
## 1 a     b     c    
## 2 d     e     f    
## 3 h     i     j
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;tibble(x = c(&amp;quot;a,b,c&amp;quot;, &amp;quot;d,e&amp;quot;, &amp;quot;f,g,i&amp;quot;)) %&amp;gt;% 
  separate(x, c(&amp;quot;um&amp;quot;, &amp;quot;dois&amp;quot;, &amp;quot;tres&amp;quot;))
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## Warning: Expected 3 pieces. Missing pieces filled with `NA` in 1 rows [2].
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 3 x 3
##   um    dois  tres 
##   &amp;lt;chr&amp;gt; &amp;lt;chr&amp;gt; &amp;lt;chr&amp;gt;
## 1 a     b     c    
## 2 d     e     &amp;lt;NA&amp;gt; 
## 3 f     g     i
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Por padr√£o, &lt;code&gt;separate&lt;/code&gt; espera que todas as colunas sendo separadas tenham o mesmo comprimento. Por exemplo, no primeiro caso, indicamos que vamos criar tr√™s novas colunas, chamadas de &amp;ldquo;um&amp;rdquo;, &amp;ldquo;dois&amp;rdquo; e &amp;ldquo;tres&amp;rdquo;. Mas os vetores tem tamanhos diferentes. Um deles tem 4 letras ao inv√©s de 3. No segundo exemplo, um deles tem duas letras ao inv√©s de tr√™s. Esse tipo de situa√ß√£o √© bastante comum quando lidamos com erros de digita√ß√£o. Ent√£o, o que fazer com o elemento que est√° sobrando ou faltando?&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;# Sobrando
tibble(x = c(&amp;quot;a,b,c&amp;quot;, &amp;quot;d,e,f,g&amp;quot;, &amp;quot;h,i,j&amp;quot;)) %&amp;gt;% 
  separate(x, c(&amp;quot;um&amp;quot;, &amp;quot;dois&amp;quot;, &amp;quot;tres&amp;quot;), extra = &amp;quot;warn&amp;quot;) # avise que ocorreu (padr√£o)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## Warning: Expected 3 pieces. Additional pieces discarded in 1 rows [2].
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 3 x 3
##   um    dois  tres 
##   &amp;lt;chr&amp;gt; &amp;lt;chr&amp;gt; &amp;lt;chr&amp;gt;
## 1 a     b     c    
## 2 d     e     f    
## 3 h     i     j
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;tibble(x = c(&amp;quot;a,b,c&amp;quot;, &amp;quot;d,e,f,g&amp;quot;, &amp;quot;h,i,j&amp;quot;)) %&amp;gt;% 
  separate(x, c(&amp;quot;um&amp;quot;, &amp;quot;dois&amp;quot;, &amp;quot;tres&amp;quot;), extra = &amp;quot;drop&amp;quot;) # descarte o que sobrou
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 3 x 3
##   um    dois  tres 
##   &amp;lt;chr&amp;gt; &amp;lt;chr&amp;gt; &amp;lt;chr&amp;gt;
## 1 a     b     c    
## 2 d     e     f    
## 3 h     i     j
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;tibble(x = c(&amp;quot;a,b,c&amp;quot;, &amp;quot;d,e,f,g&amp;quot;, &amp;quot;h,i,j&amp;quot;)) %&amp;gt;% 
  separate(x, c(&amp;quot;um&amp;quot;, &amp;quot;dois&amp;quot;, &amp;quot;tres&amp;quot;), extra = &amp;quot;merge&amp;quot;) # junte com o √∫ltimo
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 3 x 3
##   um    dois  tres 
##   &amp;lt;chr&amp;gt; &amp;lt;chr&amp;gt; &amp;lt;chr&amp;gt;
## 1 a     b     c    
## 2 d     e     f,g  
## 3 h     i     j
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;# Note especialmente no √∫ltimo caso o que ocorreu com as colunas.

# Faltando
tibble(x = c(&amp;quot;a,b,c&amp;quot;, &amp;quot;d,e&amp;quot;, &amp;quot;f,g,i&amp;quot;)) %&amp;gt;% 
  separate(x, c(&amp;quot;um&amp;quot;, &amp;quot;dois&amp;quot;, &amp;quot;tres&amp;quot;), fill = &amp;quot;warn&amp;quot;) # avise e preencha a direita
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## Warning: Expected 3 pieces. Missing pieces filled with `NA` in 1 rows [2].
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 3 x 3
##   um    dois  tres 
##   &amp;lt;chr&amp;gt; &amp;lt;chr&amp;gt; &amp;lt;chr&amp;gt;
## 1 a     b     c    
## 2 d     e     &amp;lt;NA&amp;gt; 
## 3 f     g     i
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;tibble(x = c(&amp;quot;a,b,c&amp;quot;, &amp;quot;d,e&amp;quot;, &amp;quot;f,g,i&amp;quot;)) %&amp;gt;% 
  separate(x, c(&amp;quot;um&amp;quot;, &amp;quot;dois&amp;quot;, &amp;quot;tres&amp;quot;), fill = &amp;quot;left&amp;quot;) # preencha a esquerda
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 3 x 3
##   um    dois  tres 
##   &amp;lt;chr&amp;gt; &amp;lt;chr&amp;gt; &amp;lt;chr&amp;gt;
## 1 a     b     c    
## 2 &amp;lt;NA&amp;gt;  d     e    
## 3 f     g     i
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;tibble(x = c(&amp;quot;a,b,c&amp;quot;, &amp;quot;d,e&amp;quot;, &amp;quot;f,g,i&amp;quot;)) %&amp;gt;% 
  separate(x, c(&amp;quot;um&amp;quot;, &amp;quot;dois&amp;quot;, &amp;quot;tres&amp;quot;), fill = &amp;quot;right&amp;quot;) # preencha a direta
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 3 x 3
##   um    dois  tres 
##   &amp;lt;chr&amp;gt; &amp;lt;chr&amp;gt; &amp;lt;chr&amp;gt;
## 1 a     b     c    
## 2 d     e     &amp;lt;NA&amp;gt; 
## 3 f     g     i
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;# Note na sua sa√≠da do R como ficou a tibble e onde foram colocados NAs
# em cada caso
&lt;/code&gt;&lt;/pre&gt;
&lt;ol start=&#34;8&#34;&gt;
&lt;li&gt;Tanto &lt;code&gt;unite&lt;/code&gt; como &lt;code&gt;separate&lt;/code&gt; possuem um argumento &lt;code&gt;remove&lt;/code&gt;. Pra que ele serve e quando voc√™ o utilizaria no valor &lt;code&gt;FALSE&lt;/code&gt;?&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Acho que a melhor forma de compreender isso √© utilizar um banco de dados. Vamos pegar aquele da popula√ß√£o retirado da Wikip√©dia.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;populacao &amp;lt;- tribble(
  ~Rank, ~Country, ~Population,	~&#39;% of world&#39;, ~Day, ~Month, ~Year, ~Source,
  1L,         &amp;quot;China&amp;quot;,    1411778724, &amp;quot;17.9%&amp;quot;,  &amp;quot;1&amp;quot;, &amp;quot;Nov&amp;quot;, &amp;quot;2020&amp;quot;,       &amp;quot;Seventh Census on 2020&amp;quot;,
  2L,         &amp;quot;India&amp;quot;,    1377123716, &amp;quot;17.5%&amp;quot;, &amp;quot;19&amp;quot;, &amp;quot;May&amp;quot;, &amp;quot;2021&amp;quot;, &amp;quot;National population clock[3]&amp;quot;,
  3L, &amp;quot;United States&amp;quot;,     331695937, &amp;quot;4.22%&amp;quot;, &amp;quot;19&amp;quot;, &amp;quot;May&amp;quot;, &amp;quot;2021&amp;quot;, &amp;quot;National population clock[4]&amp;quot;,
  4L,     &amp;quot;Indonesia&amp;quot;,     271350000, &amp;quot;3.45%&amp;quot;, &amp;quot;31&amp;quot;, &amp;quot;Dec&amp;quot;, &amp;quot;2020&amp;quot;,  &amp;quot;National annual estimate[5]&amp;quot;,
  5L,      &amp;quot;Pakistan&amp;quot;,     225200000, &amp;quot;2.86%&amp;quot;,  &amp;quot;1&amp;quot;, &amp;quot;Jul&amp;quot;, &amp;quot;2021&amp;quot;,             &amp;quot;UN projection[2]&amp;quot;,
  6L,        &amp;quot;Brazil&amp;quot;,     213154869, &amp;quot;2.71%&amp;quot;, &amp;quot;19&amp;quot;, &amp;quot;May&amp;quot;, &amp;quot;2021&amp;quot;, &amp;quot;National population clock[6]&amp;quot;,
  7L,       &amp;quot;Nigeria&amp;quot;,     211401000, &amp;quot;2.69%&amp;quot;,  &amp;quot;1&amp;quot;, &amp;quot;Jul&amp;quot;, &amp;quot;2021&amp;quot;,             &amp;quot;UN projection[2]&amp;quot;,
  8L,    &amp;quot;Bangladesh&amp;quot;,     170689832, &amp;quot;2.17%&amp;quot;, &amp;quot;19&amp;quot;, &amp;quot;May&amp;quot;, &amp;quot;2021&amp;quot;, &amp;quot;National population clock[7]&amp;quot;,
  9L,        &amp;quot;Russia&amp;quot;,     146171015, &amp;quot;1.86%&amp;quot;,  &amp;quot;1&amp;quot;, &amp;quot;Jan&amp;quot;, &amp;quot;2021&amp;quot;,  &amp;quot;National annual estimate[8]&amp;quot;,
  10L,       &amp;quot;Mexico&amp;quot;,     126014024, &amp;quot;1.60%&amp;quot;,  &amp;quot;2&amp;quot;, &amp;quot;Mar&amp;quot;, &amp;quot;2020&amp;quot;,        &amp;quot;2020 census result[9]&amp;quot;
)
populacao
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 10 x 8
##     Rank Country     Population `% of world` Day   Month Year  Source           
##    &amp;lt;int&amp;gt; &amp;lt;chr&amp;gt;            &amp;lt;dbl&amp;gt; &amp;lt;chr&amp;gt;        &amp;lt;chr&amp;gt; &amp;lt;chr&amp;gt; &amp;lt;chr&amp;gt; &amp;lt;chr&amp;gt;            
##  1     1 China       1411778724 17.9%        1     Nov   2020  Seventh Census o~
##  2     2 India       1377123716 17.5%        19    May   2021  National populat~
##  3     3 United Sta~  331695937 4.22%        19    May   2021  National populat~
##  4     4 Indonesia    271350000 3.45%        31    Dec   2020  National annual ~
##  5     5 Pakistan     225200000 2.86%        1     Jul   2021  UN projection[2] 
##  6     6 Brazil       213154869 2.71%        19    May   2021  National populat~
##  7     7 Nigeria      211401000 2.69%        1     Jul   2021  UN projection[2] 
##  8     8 Bangladesh   170689832 2.17%        19    May   2021  National populat~
##  9     9 Russia       146171015 1.86%        1     Jan   2021  National annual ~
## 10    10 Mexico       126014024 1.60%        2     Mar   2020  2020 census resu~
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Vamos ver dois exemplos, um com &lt;code&gt;unite&lt;/code&gt; e outro com &lt;code&gt;separate&lt;/code&gt; para exemplificar o que &lt;code&gt;remove&lt;/code&gt; faz.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;# Unir as colunas Day, Month, Year, remove = TRUE
populacao %&amp;gt;% unite(Data, Day, Month, Year, remove = TRUE) # padr√£o
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 10 x 6
##     Rank Country      Population `% of world` Data       Source                 
##    &amp;lt;int&amp;gt; &amp;lt;chr&amp;gt;             &amp;lt;dbl&amp;gt; &amp;lt;chr&amp;gt;        &amp;lt;chr&amp;gt;      &amp;lt;chr&amp;gt;                  
##  1     1 China        1411778724 17.9%        1_Nov_2020 Seventh Census on 2020 
##  2     2 India        1377123716 17.5%        19_May_20~ National population cl~
##  3     3 United Stat~  331695937 4.22%        19_May_20~ National population cl~
##  4     4 Indonesia     271350000 3.45%        31_Dec_20~ National annual estima~
##  5     5 Pakistan      225200000 2.86%        1_Jul_2021 UN projection[2]       
##  6     6 Brazil        213154869 2.71%        19_May_20~ National population cl~
##  7     7 Nigeria       211401000 2.69%        1_Jul_2021 UN projection[2]       
##  8     8 Bangladesh    170689832 2.17%        19_May_20~ National population cl~
##  9     9 Russia        146171015 1.86%        1_Jan_2021 National annual estima~
## 10    10 Mexico        126014024 1.60%        2_Mar_2020 2020 census result[9]
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;# Unir as colunas Day, Month, Year, remove = FALSE
populacao %&amp;gt;% unite(Data, Day, Month, Year, remove = FALSE)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 10 x 9
##     Rank Country   Population `% of world` Data    Day   Month Year  Source     
##    &amp;lt;int&amp;gt; &amp;lt;chr&amp;gt;          &amp;lt;dbl&amp;gt; &amp;lt;chr&amp;gt;        &amp;lt;chr&amp;gt;   &amp;lt;chr&amp;gt; &amp;lt;chr&amp;gt; &amp;lt;chr&amp;gt; &amp;lt;chr&amp;gt;      
##  1     1 China     1411778724 17.9%        1_Nov_~ 1     Nov   2020  Seventh Ce~
##  2     2 India     1377123716 17.5%        19_May~ 19    May   2021  National p~
##  3     3 United S~  331695937 4.22%        19_May~ 19    May   2021  National p~
##  4     4 Indonesia  271350000 3.45%        31_Dec~ 31    Dec   2020  National a~
##  5     5 Pakistan   225200000 2.86%        1_Jul_~ 1     Jul   2021  UN project~
##  6     6 Brazil     213154869 2.71%        19_May~ 19    May   2021  National p~
##  7     7 Nigeria    211401000 2.69%        1_Jul_~ 1     Jul   2021  UN project~
##  8     8 Banglade~  170689832 2.17%        19_May~ 19    May   2021  National p~
##  9     9 Russia     146171015 1.86%        1_Jan_~ 1     Jan   2021  National a~
## 10    10 Mexico     126014024 1.60%        2_Mar_~ 2     Mar   2020  2020 censu~
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;# Vejam o que aconteceu com as colunas nos dois bancos.
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Agora com &lt;code&gt;separate&lt;/code&gt;: Separar a coluna &lt;code&gt;year&lt;/code&gt; em s√©culo e ano, apenas como exemplo&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;# remove = TRUE, padr√£o
populacao %&amp;gt;% separate(Year, c(&amp;quot;seculo&amp;quot;, &amp;quot;ano&amp;quot;), sep = 2, remove = TRUE)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 10 x 9
##     Rank Country   Population `% of world` Day   Month seculo ano   Source      
##    &amp;lt;int&amp;gt; &amp;lt;chr&amp;gt;          &amp;lt;dbl&amp;gt; &amp;lt;chr&amp;gt;        &amp;lt;chr&amp;gt; &amp;lt;chr&amp;gt; &amp;lt;chr&amp;gt;  &amp;lt;chr&amp;gt; &amp;lt;chr&amp;gt;       
##  1     1 China     1411778724 17.9%        1     Nov   20     20    Seventh Cen~
##  2     2 India     1377123716 17.5%        19    May   20     21    National po~
##  3     3 United S~  331695937 4.22%        19    May   20     21    National po~
##  4     4 Indonesia  271350000 3.45%        31    Dec   20     20    National an~
##  5     5 Pakistan   225200000 2.86%        1     Jul   20     21    UN projecti~
##  6     6 Brazil     213154869 2.71%        19    May   20     21    National po~
##  7     7 Nigeria    211401000 2.69%        1     Jul   20     21    UN projecti~
##  8     8 Banglade~  170689832 2.17%        19    May   20     21    National po~
##  9     9 Russia     146171015 1.86%        1     Jan   20     21    National an~
## 10    10 Mexico     126014024 1.60%        2     Mar   20     20    2020 census~
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;# remove = FALSE
populacao %&amp;gt;% separate(Year, c(&amp;quot;seculo&amp;quot;, &amp;quot;ano&amp;quot;), sep = 2, remove = FALSE)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 10 x 10
##     Rank Country  Population `% of world` Day   Month Year  seculo ano   Source 
##    &amp;lt;int&amp;gt; &amp;lt;chr&amp;gt;         &amp;lt;dbl&amp;gt; &amp;lt;chr&amp;gt;        &amp;lt;chr&amp;gt; &amp;lt;chr&amp;gt; &amp;lt;chr&amp;gt; &amp;lt;chr&amp;gt;  &amp;lt;chr&amp;gt; &amp;lt;chr&amp;gt;  
##  1     1 China    1411778724 17.9%        1     Nov   2020  20     20    Sevent~
##  2     2 India    1377123716 17.5%        19    May   2021  20     21    Nation~
##  3     3 United ~  331695937 4.22%        19    May   2021  20     21    Nation~
##  4     4 Indones~  271350000 3.45%        31    Dec   2020  20     20    Nation~
##  5     5 Pakistan  225200000 2.86%        1     Jul   2021  20     21    UN pro~
##  6     6 Brazil    213154869 2.71%        19    May   2021  20     21    Nation~
##  7     7 Nigeria   211401000 2.69%        1     Jul   2021  20     21    UN pro~
##  8     8 Banglad~  170689832 2.17%        19    May   2021  20     21    Nation~
##  9     9 Russia    146171015 1.86%        1     Jan   2021  20     21    Nation~
## 10    10 Mexico    126014024 1.60%        2     Mar   2020  20     20    2020 c~
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;# Vejam o que aconteceu com as colunas nos dois bancos.
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Eu gosto de utilizar esse argumento quando eu tenho d√∫vida sobre o resultado e quero fazer inspe√ß√£o visual para detectar eventuais problemas na separa√ß√£o ou jun√ß√£o. Uma vez que estou satisfeito com o resultado, em geral eu uso o &lt;code&gt;remove=TRUE&lt;/code&gt;. Voc√™s tem que decidir se precisam manter as colunas originais ou se a coluna transformada √© o suficiente.&lt;/p&gt;
&lt;ol start=&#34;9&#34;&gt;
&lt;li&gt;Compare o argumento &lt;code&gt;values_fill&lt;/code&gt; em &lt;code&gt;pivot_wider&lt;/code&gt; e &lt;code&gt;fill&lt;/code&gt; em &lt;code&gt;complete&lt;/code&gt;. Qual √© a diferen√ßa?&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;A resposta curta √© simples: em &lt;code&gt;pivot_wider&lt;/code&gt;, podemos ter aqueles missings &amp;ldquo;impl√≠citos&amp;rdquo; que n√£o apareciam no nosso banco longo e, durante a transforma√ß√£o, eles viram &lt;code&gt;NA&lt;/code&gt;s nas colunas. √ì argumento &lt;code&gt;values_fill&lt;/code&gt; indica um valor para ser preenchido no lugar de &lt;code&gt;NA&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Em &lt;code&gt;complete&lt;/code&gt;, temos uma situa√ß√£o similar. O que fazer quando for encontrada uma combina√ß√£o de valores no banco longo que √© um &amp;ldquo;missing impl√≠cito&amp;rdquo;? Voc√™ pode especificar um valor padr√£o para preench√™-lo.&lt;/p&gt;
&lt;p&gt;S√£o fun√ß√µes similares, mas uma funciona sem reformatar o banco e a outra durante o processo de reformata√ß√£o. Veja um exemplo abaixo com aquela &lt;code&gt;tibble&lt;/code&gt; das a√ß√µes.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;acoes &amp;lt;- tibble(
  ano   = c(2015, 2015, 2015, 2015, 2016, 2016, 2016),
  qdr   = c(   1,    2,    3,    4,    2,    3,    4),
  lucro = c(1.88, 0.59, 0.35,   NA, 0.92, 0.17, 2.66)
)

acoes
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 7 x 3
##     ano   qdr lucro
##   &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt;
## 1  2015     1  1.88
## 2  2015     2  0.59
## 3  2015     3  0.35
## 4  2015     4 NA   
## 5  2016     2  0.92
## 6  2016     3  0.17
## 7  2016     4  2.66
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;# Vamos supor que o NA impl√≠cito significa que a empresa teve 
# lucro = 0 naquele quadrimestre.

# pivot_wider, values_fill
acoes %&amp;gt;% pivot_wider(
  id_cols = ano,
  names_from = qdr,
  values_from = lucro,
  values_fill = 0
)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 2 x 5
##     ano   `1`   `2`   `3`   `4`
##   &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt;
## 1  2015  1.88  0.59  0.35 NA   
## 2  2016  0     0.92  0.17  2.66
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;# complete, fill
acoes %&amp;gt;% complete(ano, qdr, fill = list(lucro = 0))
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 8 x 3
##     ano   qdr lucro
##   &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt;
## 1  2015     1  1.88
## 2  2015     2  0.59
## 3  2015     3  0.35
## 4  2015     4  0   
## 5  2016     1  0   
## 6  2016     2  0.92
## 7  2016     3  0.17
## 8  2016     4  2.66
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Note o resultado. E note tamb√©m que &lt;code&gt;values_fill&lt;/code&gt; em &lt;code&gt;pivot_wider&lt;/code&gt; √© um pouco mais criterioso na hora de fazer as transforma√ß√µes.&lt;/p&gt;
&lt;h3 id=&#34;stringr-forcats-e-dplyr&#34;&gt;&lt;code&gt;stringr&lt;/code&gt;, &lt;code&gt;forcats&lt;/code&gt; e &lt;code&gt;dplyr&lt;/code&gt;&lt;/h3&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;library(nycflights13)
&lt;/code&gt;&lt;/pre&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;Encontre os v√¥os que:&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Atrasaram mais de duas horas&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;flights %&amp;gt;% filter(dep_delay &amp;gt; 120)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 9,723 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
##    &amp;lt;int&amp;gt; &amp;lt;int&amp;gt; &amp;lt;int&amp;gt;    &amp;lt;int&amp;gt;          &amp;lt;int&amp;gt;     &amp;lt;dbl&amp;gt;    &amp;lt;int&amp;gt;          &amp;lt;int&amp;gt;
##  1  2013     1     1      848           1835       853     1001           1950
##  2  2013     1     1      957            733       144     1056            853
##  3  2013     1     1     1114            900       134     1447           1222
##  4  2013     1     1     1540           1338       122     2020           1825
##  5  2013     1     1     1815           1325       290     2120           1542
##  6  2013     1     1     1842           1422       260     1958           1535
##  7  2013     1     1     1856           1645       131     2212           2005
##  8  2013     1     1     1934           1725       129     2126           1855
##  9  2013     1     1     1938           1703       155     2109           1823
## 10  2013     1     1     1942           1705       157     2124           1830
## # ... with 9,713 more rows, and 11 more variables: arr_delay &amp;lt;dbl&amp;gt;,
## #   carrier &amp;lt;chr&amp;gt;, flight &amp;lt;int&amp;gt;, tailnum &amp;lt;chr&amp;gt;, origin &amp;lt;chr&amp;gt;, dest &amp;lt;chr&amp;gt;,
## #   air_time &amp;lt;dbl&amp;gt;, distance &amp;lt;dbl&amp;gt;, hour &amp;lt;dbl&amp;gt;, minute &amp;lt;dbl&amp;gt;, time_hour &amp;lt;dttm&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;ol start=&#34;2&#34;&gt;
&lt;li&gt;Com destino a Houston (&lt;code&gt;IAH&lt;/code&gt; ou &lt;code&gt;HOU&lt;/code&gt;)&lt;/li&gt;
&lt;/ol&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;flights %&amp;gt;% filter(dest %in% c(&amp;quot;IAH&amp;quot;, &amp;quot;HOU&amp;quot;))
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 9,313 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
##    &amp;lt;int&amp;gt; &amp;lt;int&amp;gt; &amp;lt;int&amp;gt;    &amp;lt;int&amp;gt;          &amp;lt;int&amp;gt;     &amp;lt;dbl&amp;gt;    &amp;lt;int&amp;gt;          &amp;lt;int&amp;gt;
##  1  2013     1     1      517            515         2      830            819
##  2  2013     1     1      533            529         4      850            830
##  3  2013     1     1      623            627        -4      933            932
##  4  2013     1     1      728            732        -4     1041           1038
##  5  2013     1     1      739            739         0     1104           1038
##  6  2013     1     1      908            908         0     1228           1219
##  7  2013     1     1     1028           1026         2     1350           1339
##  8  2013     1     1     1044           1045        -1     1352           1351
##  9  2013     1     1     1114            900       134     1447           1222
## 10  2013     1     1     1205           1200         5     1503           1505
## # ... with 9,303 more rows, and 11 more variables: arr_delay &amp;lt;dbl&amp;gt;,
## #   carrier &amp;lt;chr&amp;gt;, flight &amp;lt;int&amp;gt;, tailnum &amp;lt;chr&amp;gt;, origin &amp;lt;chr&amp;gt;, dest &amp;lt;chr&amp;gt;,
## #   air_time &amp;lt;dbl&amp;gt;, distance &amp;lt;dbl&amp;gt;, hour &amp;lt;dbl&amp;gt;, minute &amp;lt;dbl&amp;gt;, time_hour &amp;lt;dttm&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;ol start=&#34;3&#34;&gt;
&lt;li&gt;Operados pela United, American ou Delta&lt;/li&gt;
&lt;/ol&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;unique(flights$carrier)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##  [1] &amp;quot;UA&amp;quot; &amp;quot;AA&amp;quot; &amp;quot;B6&amp;quot; &amp;quot;DL&amp;quot; &amp;quot;EV&amp;quot; &amp;quot;MQ&amp;quot; &amp;quot;US&amp;quot; &amp;quot;WN&amp;quot; &amp;quot;VX&amp;quot; &amp;quot;FL&amp;quot; &amp;quot;AS&amp;quot; &amp;quot;9E&amp;quot; &amp;quot;F9&amp;quot; &amp;quot;HA&amp;quot; &amp;quot;YV&amp;quot;
## [16] &amp;quot;OO&amp;quot;
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;flights %&amp;gt;% filter(carrier %in% c(&amp;quot;UA&amp;quot;, &amp;quot;AA&amp;quot;, &amp;quot;DL&amp;quot;))
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 139,504 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
##    &amp;lt;int&amp;gt; &amp;lt;int&amp;gt; &amp;lt;int&amp;gt;    &amp;lt;int&amp;gt;          &amp;lt;int&amp;gt;     &amp;lt;dbl&amp;gt;    &amp;lt;int&amp;gt;          &amp;lt;int&amp;gt;
##  1  2013     1     1      517            515         2      830            819
##  2  2013     1     1      533            529         4      850            830
##  3  2013     1     1      542            540         2      923            850
##  4  2013     1     1      554            600        -6      812            837
##  5  2013     1     1      554            558        -4      740            728
##  6  2013     1     1      558            600        -2      753            745
##  7  2013     1     1      558            600        -2      924            917
##  8  2013     1     1      558            600        -2      923            937
##  9  2013     1     1      559            600        -1      941            910
## 10  2013     1     1      559            600        -1      854            902
## # ... with 139,494 more rows, and 11 more variables: arr_delay &amp;lt;dbl&amp;gt;,
## #   carrier &amp;lt;chr&amp;gt;, flight &amp;lt;int&amp;gt;, tailnum &amp;lt;chr&amp;gt;, origin &amp;lt;chr&amp;gt;, dest &amp;lt;chr&amp;gt;,
## #   air_time &amp;lt;dbl&amp;gt;, distance &amp;lt;dbl&amp;gt;, hour &amp;lt;dbl&amp;gt;, minute &amp;lt;dbl&amp;gt;, time_hour &amp;lt;dttm&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;ol start=&#34;4&#34;&gt;
&lt;li&gt;Decolaram entre julho e setembro&lt;/li&gt;
&lt;/ol&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;flights %&amp;gt;% filter(between(month, 7, 9))
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 86,326 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
##    &amp;lt;int&amp;gt; &amp;lt;int&amp;gt; &amp;lt;int&amp;gt;    &amp;lt;int&amp;gt;          &amp;lt;int&amp;gt;     &amp;lt;dbl&amp;gt;    &amp;lt;int&amp;gt;          &amp;lt;int&amp;gt;
##  1  2013     7     1        1           2029       212      236           2359
##  2  2013     7     1        2           2359         3      344            344
##  3  2013     7     1       29           2245       104      151              1
##  4  2013     7     1       43           2130       193      322             14
##  5  2013     7     1       44           2150       174      300            100
##  6  2013     7     1       46           2051       235      304           2358
##  7  2013     7     1       48           2001       287      308           2305
##  8  2013     7     1       58           2155       183      335             43
##  9  2013     7     1      100           2146       194      327             30
## 10  2013     7     1      100           2245       135      337            135
## # ... with 86,316 more rows, and 11 more variables: arr_delay &amp;lt;dbl&amp;gt;,
## #   carrier &amp;lt;chr&amp;gt;, flight &amp;lt;int&amp;gt;, tailnum &amp;lt;chr&amp;gt;, origin &amp;lt;chr&amp;gt;, dest &amp;lt;chr&amp;gt;,
## #   air_time &amp;lt;dbl&amp;gt;, distance &amp;lt;dbl&amp;gt;, hour &amp;lt;dbl&amp;gt;, minute &amp;lt;dbl&amp;gt;, time_hour &amp;lt;dttm&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;ol start=&#34;5&#34;&gt;
&lt;li&gt;Chegaram com mais de duas horas de atraso, mas n√£o decolaram com atraso&lt;/li&gt;
&lt;/ol&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;flights %&amp;gt;% filter(arr_delay &amp;gt; 120, dep_delay &amp;lt;= 0)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 29 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
##    &amp;lt;int&amp;gt; &amp;lt;int&amp;gt; &amp;lt;int&amp;gt;    &amp;lt;int&amp;gt;          &amp;lt;int&amp;gt;     &amp;lt;dbl&amp;gt;    &amp;lt;int&amp;gt;          &amp;lt;int&amp;gt;
##  1  2013     1    27     1419           1420        -1     1754           1550
##  2  2013    10     7     1350           1350         0     1736           1526
##  3  2013    10     7     1357           1359        -2     1858           1654
##  4  2013    10    16      657            700        -3     1258           1056
##  5  2013    11     1      658            700        -2     1329           1015
##  6  2013     3    18     1844           1847        -3       39           2219
##  7  2013     4    17     1635           1640        -5     2049           1845
##  8  2013     4    18      558            600        -2     1149            850
##  9  2013     4    18      655            700        -5     1213            950
## 10  2013     5    22     1827           1830        -3     2217           2010
## # ... with 19 more rows, and 11 more variables: arr_delay &amp;lt;dbl&amp;gt;, carrier &amp;lt;chr&amp;gt;,
## #   flight &amp;lt;int&amp;gt;, tailnum &amp;lt;chr&amp;gt;, origin &amp;lt;chr&amp;gt;, dest &amp;lt;chr&amp;gt;, air_time &amp;lt;dbl&amp;gt;,
## #   distance &amp;lt;dbl&amp;gt;, hour &amp;lt;dbl&amp;gt;, minute &amp;lt;dbl&amp;gt;, time_hour &amp;lt;dttm&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;ol start=&#34;6&#34;&gt;
&lt;li&gt;Atrasaram mais de uma hora para decolar, mas recuperaram mais de 30 minutos durante o voo&lt;/li&gt;
&lt;/ol&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;flights %&amp;gt;% filter(dep_delay &amp;gt; 60, dep_delay - arr_delay &amp;gt;= 30)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 2,046 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
##    &amp;lt;int&amp;gt; &amp;lt;int&amp;gt; &amp;lt;int&amp;gt;    &amp;lt;int&amp;gt;          &amp;lt;int&amp;gt;     &amp;lt;dbl&amp;gt;    &amp;lt;int&amp;gt;          &amp;lt;int&amp;gt;
##  1  2013     1     1     1716           1545        91     2140           2039
##  2  2013     1     1     2205           1720       285       46           2040
##  3  2013     1     1     2326           2130       116      131             18
##  4  2013     1     3     1503           1221       162     1803           1555
##  5  2013     1     3     1821           1530       171     2131           1910
##  6  2013     1     3     1839           1700        99     2056           1950
##  7  2013     1     3     1850           1745        65     2148           2120
##  8  2013     1     3     1923           1815        68     2036           1958
##  9  2013     1     3     1941           1759       102     2246           2139
## 10  2013     1     3     1950           1845        65     2228           2227
## # ... with 2,036 more rows, and 11 more variables: arr_delay &amp;lt;dbl&amp;gt;,
## #   carrier &amp;lt;chr&amp;gt;, flight &amp;lt;int&amp;gt;, tailnum &amp;lt;chr&amp;gt;, origin &amp;lt;chr&amp;gt;, dest &amp;lt;chr&amp;gt;,
## #   air_time &amp;lt;dbl&amp;gt;, distance &amp;lt;dbl&amp;gt;, hour &amp;lt;dbl&amp;gt;, minute &amp;lt;dbl&amp;gt;, time_hour &amp;lt;dttm&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;ol start=&#34;7&#34;&gt;
&lt;li&gt;Decolaram entre a meia-noite e 6 da manh√£ (inclusive)&lt;/li&gt;
&lt;/ol&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;flights %&amp;gt;% filter(between(hour, 0, 5) | (hour == 6 &amp;amp; minute == 0))
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 8,970 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
##    &amp;lt;int&amp;gt; &amp;lt;int&amp;gt; &amp;lt;int&amp;gt;    &amp;lt;int&amp;gt;          &amp;lt;int&amp;gt;     &amp;lt;dbl&amp;gt;    &amp;lt;int&amp;gt;          &amp;lt;int&amp;gt;
##  1  2013     1     1      517            515         2      830            819
##  2  2013     1     1      533            529         4      850            830
##  3  2013     1     1      542            540         2      923            850
##  4  2013     1     1      544            545        -1     1004           1022
##  5  2013     1     1      554            600        -6      812            837
##  6  2013     1     1      554            558        -4      740            728
##  7  2013     1     1      555            600        -5      913            854
##  8  2013     1     1      557            600        -3      709            723
##  9  2013     1     1      557            600        -3      838            846
## 10  2013     1     1      558            600        -2      753            745
## # ... with 8,960 more rows, and 11 more variables: arr_delay &amp;lt;dbl&amp;gt;,
## #   carrier &amp;lt;chr&amp;gt;, flight &amp;lt;int&amp;gt;, tailnum &amp;lt;chr&amp;gt;, origin &amp;lt;chr&amp;gt;, dest &amp;lt;chr&amp;gt;,
## #   air_time &amp;lt;dbl&amp;gt;, distance &amp;lt;dbl&amp;gt;, hour &amp;lt;dbl&amp;gt;, minute &amp;lt;dbl&amp;gt;, time_hour &amp;lt;dttm&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;ol start=&#34;2&#34;&gt;
&lt;li&gt;Reordene suas colunas para encontrar os voos mais r√°pidos (maior velocidade de voo).&lt;/li&gt;
&lt;/ol&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;flights %&amp;gt;% 
  select(air_time, distance) %&amp;gt;% 
  mutate(speed = distance/air_time) %&amp;gt;% 
  arrange(desc(speed))
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 336,776 x 3
##    air_time distance speed
##       &amp;lt;dbl&amp;gt;    &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt;
##  1       65      762 11.7 
##  2       93     1008 10.8 
##  3       55      594 10.8 
##  4       70      748 10.7 
##  5      105     1035  9.86
##  6      170     1598  9.4 
##  7      172     1598  9.29
##  8      175     1623  9.27
##  9      173     1598  9.24
## 10      173     1598  9.24
## # ... with 336,766 more rows
&lt;/code&gt;&lt;/pre&gt;
&lt;ol start=&#34;3&#34;&gt;
&lt;li&gt;Teste v√°rias maneiras diferentes de selecionar as vari√°veis &lt;code&gt;dep_time&lt;/code&gt;, &lt;code&gt;dep_delay&lt;/code&gt;, &lt;code&gt;arr_time&lt;/code&gt; e &lt;code&gt;arr_delay&lt;/code&gt; usando as v√°rias helper functions de &lt;code&gt;select&lt;/code&gt;.&lt;/li&gt;
&lt;/ol&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;flights %&amp;gt;% select(dep_time, dep_delay, arr_time, arr_delay)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 336,776 x 4
##    dep_time dep_delay arr_time arr_delay
##       &amp;lt;int&amp;gt;     &amp;lt;dbl&amp;gt;    &amp;lt;int&amp;gt;     &amp;lt;dbl&amp;gt;
##  1      517         2      830        11
##  2      533         4      850        20
##  3      542         2      923        33
##  4      544        -1     1004       -18
##  5      554        -6      812       -25
##  6      554        -4      740        12
##  7      555        -5      913        19
##  8      557        -3      709       -14
##  9      557        -3      838        -8
## 10      558        -2      753         8
## # ... with 336,766 more rows
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;flights %&amp;gt;% select(starts_with(&amp;quot;dep&amp;quot;), starts_with(&amp;quot;arr&amp;quot;))
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 336,776 x 4
##    dep_time dep_delay arr_time arr_delay
##       &amp;lt;int&amp;gt;     &amp;lt;dbl&amp;gt;    &amp;lt;int&amp;gt;     &amp;lt;dbl&amp;gt;
##  1      517         2      830        11
##  2      533         4      850        20
##  3      542         2      923        33
##  4      544        -1     1004       -18
##  5      554        -6      812       -25
##  6      554        -4      740        12
##  7      555        -5      913        19
##  8      557        -3      709       -14
##  9      557        -3      838        -8
## 10      558        -2      753         8
## # ... with 336,766 more rows
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;flights %&amp;gt;% select(starts_with(c(&amp;quot;dep&amp;quot;, &amp;quot;arr&amp;quot;)))
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 336,776 x 4
##    dep_time dep_delay arr_time arr_delay
##       &amp;lt;int&amp;gt;     &amp;lt;dbl&amp;gt;    &amp;lt;int&amp;gt;     &amp;lt;dbl&amp;gt;
##  1      517         2      830        11
##  2      533         4      850        20
##  3      542         2      923        33
##  4      544        -1     1004       -18
##  5      554        -6      812       -25
##  6      554        -4      740        12
##  7      555        -5      913        19
##  8      557        -3      709       -14
##  9      557        -3      838        -8
## 10      558        -2      753         8
## # ... with 336,766 more rows
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;flights %&amp;gt;% select(matches(&amp;quot;^arr|^dep&amp;quot;))
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 336,776 x 4
##    dep_time dep_delay arr_time arr_delay
##       &amp;lt;int&amp;gt;     &amp;lt;dbl&amp;gt;    &amp;lt;int&amp;gt;     &amp;lt;dbl&amp;gt;
##  1      517         2      830        11
##  2      533         4      850        20
##  3      542         2      923        33
##  4      544        -1     1004       -18
##  5      554        -6      812       -25
##  6      554        -4      740        12
##  7      555        -5      913        19
##  8      557        -3      709       -14
##  9      557        -3      838        -8
## 10      558        -2      753         8
## # ... with 336,766 more rows
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;flights %&amp;gt;% select(!starts_with(c(&amp;quot;sched&amp;quot;, &amp;quot;car&amp;quot;)) &amp;amp; contains(c(&amp;quot;dep&amp;quot;, &amp;quot;arr&amp;quot;)))
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 336,776 x 4
##    dep_time dep_delay arr_time arr_delay
##       &amp;lt;int&amp;gt;     &amp;lt;dbl&amp;gt;    &amp;lt;int&amp;gt;     &amp;lt;dbl&amp;gt;
##  1      517         2      830        11
##  2      533         4      850        20
##  3      542         2      923        33
##  4      544        -1     1004       -18
##  5      554        -6      812       -25
##  6      554        -4      740        12
##  7      555        -5      913        19
##  8      557        -3      709       -14
##  9      557        -3      838        -8
## 10      558        -2      753         8
## # ... with 336,766 more rows
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;flights %&amp;gt;% select(ends_with(c(&amp;quot;time&amp;quot;, &amp;quot;delay&amp;quot;)) &amp;amp; !starts_with(c(&amp;quot;sched&amp;quot;, &amp;quot;air&amp;quot;)))
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 336,776 x 4
##    dep_time arr_time dep_delay arr_delay
##       &amp;lt;int&amp;gt;    &amp;lt;int&amp;gt;     &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;
##  1      517      830         2        11
##  2      533      850         4        20
##  3      542      923         2        33
##  4      544     1004        -1       -18
##  5      554      812        -6       -25
##  6      554      740        -4        12
##  7      555      913        -5        19
##  8      557      709        -3       -14
##  9      557      838        -3        -8
## 10      558      753        -2         8
## # ... with 336,766 more rows
&lt;/code&gt;&lt;/pre&gt;
&lt;ol start=&#34;4&#34;&gt;
&lt;li&gt;As vari√°veis &lt;code&gt;dep_time&lt;/code&gt; e &lt;code&gt;sched_dep_time&lt;/code&gt; est√£o num formato incorreto (veja &lt;code&gt;?flights&lt;/code&gt;). Converta-as com &lt;code&gt;mutate&lt;/code&gt; para um valor em minutos passados desde a meia-noite. Dica: utilize &lt;code&gt;%/%&lt;/code&gt; e &lt;code&gt;%%&lt;/code&gt;.&lt;/li&gt;
&lt;/ol&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;flights %&amp;gt;% mutate(
  dep_hour         = dep_time %/% 100,
  dep_minute       = dep_time %% 100,
  sched_dep_hour   = sched_dep_time %/% 100,
  sched_arr_minute = sched_arr_time %% 100
)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 336,776 x 23
##     year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
##    &amp;lt;int&amp;gt; &amp;lt;int&amp;gt; &amp;lt;int&amp;gt;    &amp;lt;int&amp;gt;          &amp;lt;int&amp;gt;     &amp;lt;dbl&amp;gt;    &amp;lt;int&amp;gt;          &amp;lt;int&amp;gt;
##  1  2013     1     1      517            515         2      830            819
##  2  2013     1     1      533            529         4      850            830
##  3  2013     1     1      542            540         2      923            850
##  4  2013     1     1      544            545        -1     1004           1022
##  5  2013     1     1      554            600        -6      812            837
##  6  2013     1     1      554            558        -4      740            728
##  7  2013     1     1      555            600        -5      913            854
##  8  2013     1     1      557            600        -3      709            723
##  9  2013     1     1      557            600        -3      838            846
## 10  2013     1     1      558            600        -2      753            745
## # ... with 336,766 more rows, and 15 more variables: arr_delay &amp;lt;dbl&amp;gt;,
## #   carrier &amp;lt;chr&amp;gt;, flight &amp;lt;int&amp;gt;, tailnum &amp;lt;chr&amp;gt;, origin &amp;lt;chr&amp;gt;, dest &amp;lt;chr&amp;gt;,
## #   air_time &amp;lt;dbl&amp;gt;, distance &amp;lt;dbl&amp;gt;, hour &amp;lt;dbl&amp;gt;, minute &amp;lt;dbl&amp;gt;, time_hour &amp;lt;dttm&amp;gt;,
## #   dep_hour &amp;lt;dbl&amp;gt;, dep_minute &amp;lt;dbl&amp;gt;, sched_dep_hour &amp;lt;dbl&amp;gt;,
## #   sched_arr_minute &amp;lt;dbl&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;# H√° uma outra solu√ß√£o com separate!
flights %&amp;gt;% 
  separate(
    col = dep_time,
    into = c(&amp;quot;dep_hour&amp;quot;, &amp;quot;dep_minute&amp;quot;),
    sep = 1,
    # Esse argumento √© importante! Teste com FALSE para ver a diferen√ßa
    convert = TRUE) %&amp;gt;% 
  separate(
    col = sched_dep_time,
    into = c(&amp;quot;sched_dep_hour&amp;quot;, &amp;quot;sched_dep_minute&amp;quot;),
    sep = 1,
    convert = TRUE)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 336,776 x 21
##     year month   day dep_hour dep_minute sched_dep_hour sched_dep_minute
##    &amp;lt;int&amp;gt; &amp;lt;int&amp;gt; &amp;lt;int&amp;gt;    &amp;lt;int&amp;gt;      &amp;lt;int&amp;gt;          &amp;lt;int&amp;gt;            &amp;lt;int&amp;gt;
##  1  2013     1     1        5         17              5               15
##  2  2013     1     1        5         33              5               29
##  3  2013     1     1        5         42              5               40
##  4  2013     1     1        5         44              5               45
##  5  2013     1     1        5         54              6                0
##  6  2013     1     1        5         54              5               58
##  7  2013     1     1        5         55              6                0
##  8  2013     1     1        5         57              6                0
##  9  2013     1     1        5         57              6                0
## 10  2013     1     1        5         58              6                0
## # ... with 336,766 more rows, and 14 more variables: dep_delay &amp;lt;dbl&amp;gt;,
## #   arr_time &amp;lt;int&amp;gt;, sched_arr_time &amp;lt;int&amp;gt;, arr_delay &amp;lt;dbl&amp;gt;, carrier &amp;lt;chr&amp;gt;,
## #   flight &amp;lt;int&amp;gt;, tailnum &amp;lt;chr&amp;gt;, origin &amp;lt;chr&amp;gt;, dest &amp;lt;chr&amp;gt;, air_time &amp;lt;dbl&amp;gt;,
## #   distance &amp;lt;dbl&amp;gt;, hour &amp;lt;dbl&amp;gt;, minute &amp;lt;dbl&amp;gt;, time_hour &amp;lt;dttm&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Existe uma outra solu√ß√£o poss√≠vel para essa quest√£o usando manipula√ß√£o de strings, com &lt;code&gt;str_sub&lt;/code&gt; tamb√©m. Fica como desafio!&lt;/p&gt;
&lt;p&gt;Pensando na legibilidade do c√≥digo e na flexibilidade da abordagem, qual das duas solu√ß√µes acima voc√™ implementaria? &lt;code&gt;mutate&lt;/code&gt; ou duas &lt;code&gt;separate&lt;/code&gt;? Reflita.&lt;/p&gt;
&lt;ol start=&#34;5&#34;&gt;
&lt;li&gt;O que o c√≥digo abaixo est√° fazendo? Porque mesmo ap√≥s o c√≥digo abaixo continuam existindo diferen√ßas entre os valores das vari√°veis &lt;code&gt;air_time&lt;/code&gt; e &lt;code&gt;travel_time&lt;/code&gt;?&lt;/li&gt;
&lt;/ol&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;flights %&amp;gt;% 
  select(air_time, dep_time, arr_time, dep_delay, arr_delay) %&amp;gt;% 
  mutate(dep_hour = dep_time %/% 100,
         dep_min = dep_time %% 100,
         dep_time2 = dep_hour * 60 + dep_min,
         arr_hour = arr_time %/% 100,
         arr_min = arr_time %% 100,
         arr_time2 = arr_hour * 60 + arr_min,
         travel_time = arr_time2 - dep_time2) %&amp;gt;% 
  select(-dep_hour, -dep_min, -arr_hour, -arr_min)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 336,776 x 8
##    air_time dep_time arr_time dep_delay arr_delay dep_time2 arr_time2
##       &amp;lt;dbl&amp;gt;    &amp;lt;int&amp;gt;    &amp;lt;int&amp;gt;     &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;
##  1      227      517      830         2        11       317       510
##  2      227      533      850         4        20       333       530
##  3      160      542      923         2        33       342       563
##  4      183      544     1004        -1       -18       344       604
##  5      116      554      812        -6       -25       354       492
##  6      150      554      740        -4        12       354       460
##  7      158      555      913        -5        19       355       553
##  8       53      557      709        -3       -14       357       429
##  9      140      557      838        -3        -8       357       518
## 10      138      558      753        -2         8       358       473
## # ... with 336,766 more rows, and 1 more variable: travel_time &amp;lt;dbl&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Essa tem uma resposta mais qualitativa. A primeira parte √© parecida com a quest√£o anterior, mas estamos manualmente tentando calcular os tempos de viagem. Acontece que os valores n√£o batem com os tempos de v√¥o identificados no banco. Isso se deve a pelo menos tr√™s quest√µes distintas.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Uma delas diz respeito ao registro dos tempos, a defini√ß√£o de &lt;code&gt;air_time&lt;/code&gt; pode n√£o estar considerando tempos em que o avi√£o est√° manobrando ou em solo ou mesmo podem existir erros de preenchimento.&lt;/li&gt;
&lt;li&gt;A segunda diz respeito ao fuso hor√°rio distinto entre aeroportos de sa√≠da e chegada, que complica o c√°lculo dos tempos reais, ent√£o nosso c√°lculo est√° muito cru para identificar isso.&lt;/li&gt;
&lt;li&gt;A √∫ltima quest√£o s√£o os v√¥os longos, que come√ßam em um dia e terminam no dia seguinte, que podem prejudicar nosso m√©todo de c√°lculo. Para corrigir alguns desses problemas, voc√™ precisaria escrever um c√≥digo que minimamente levasse essas quest√µes em considera√ß√£o. Como esse n√£o √© o objetivo do curso, eu deixo para quem quiser tentar. &lt;a href=&#34;https://jrnold.github.io/r4ds-exercise-solutions/transform.html#exercise-5.5.2&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;H√° uma solu√ß√£o postada aqui&lt;/a&gt;.&lt;/li&gt;
&lt;/ul&gt;
&lt;ol start=&#34;6&#34;&gt;
&lt;li&gt;Use o stringr para concatenar as seguintes strings em uma frase&lt;/li&gt;
&lt;/ol&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;x &amp;lt;- &amp;quot;.&amp;quot;
y &amp;lt;- &amp;quot;feliz&amp;quot;
w &amp;lt;- &amp;quot;acordei&amp;quot;
z &amp;lt;- &amp;quot;hoje&amp;quot;

str_c(z, w, y, sep = &amp;quot; &amp;quot;) %&amp;gt;% 
  str_c(x, sep = &amp;quot;&amp;quot;) %&amp;gt;% 
  str_to_sentence()
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] &amp;quot;Hoje acordei feliz.&amp;quot;
&lt;/code&gt;&lt;/pre&gt;
&lt;ol start=&#34;7&#34;&gt;
&lt;li&gt;Corrija as inconsist√™ncias nas colunas pa√≠s, primeiro_nome, segundo_nome e crie uma nova coluna nomes contendo as duas anteriores. No final, ordene o banco em ordem alfab√©tica.&lt;/li&gt;
&lt;/ol&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;df &amp;lt;- 
  tibble::tribble(
    ~pais,    ~primeiro_nome, ~segundo_nome,
    # -------|----------------|-------------|
    &amp;quot;BRASIL&amp;quot;, &amp;quot;ISABELA&amp;quot;,       &amp;quot;MARTINS&amp;quot;,
    &amp;quot;Brasil&amp;quot;, &amp;quot;Eduardo&amp;quot;,       &amp;quot;cabellos&amp;quot;,
    &amp;quot;brasil&amp;quot;, &amp;quot;m√°rcia&amp;quot;,         &amp;quot;pinto&amp;quot;,
    &amp;quot;bRaSiL&amp;quot;, &amp;quot;rog√©rio&amp;quot;,        &amp;quot;Marinho&amp;quot;,
  )

# Sem dplyr
df$pais &amp;lt;- str_to_title(df$pais)
df$primeiro_nome &amp;lt;-  str_to_title(df$primeiro_nome)
df$segundo_nome &amp;lt;- str_to_title(df$segundo_nome)

df &amp;lt;- df %&amp;gt;% tidyr::unite(nomes, primeiro_nome, segundo_nome, sep = &amp;quot; &amp;quot;)
df[ str_order(df$nomes), ]
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 4 x 2
##   pais   nomes           
##   &amp;lt;chr&amp;gt;  &amp;lt;chr&amp;gt;           
## 1 Brasil Eduardo Cabellos
## 2 Brasil Isabela Martins 
## 3 Brasil M√°rcia Pinto    
## 4 Brasil Rog√©rio Marinho
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;# Com dplyr
df &amp;lt;- 
  tibble::tribble(
    ~pais,    ~primeiro_nome, ~segundo_nome,
    # -------|----------------|-------------|
    &amp;quot;BRASIL&amp;quot;, &amp;quot;ISABELA&amp;quot;,       &amp;quot;MARTINS&amp;quot;,
    &amp;quot;Brasil&amp;quot;, &amp;quot;Eduardo&amp;quot;,       &amp;quot;cabellos&amp;quot;,
    &amp;quot;brasil&amp;quot;, &amp;quot;m√°rcia&amp;quot;,         &amp;quot;pinto&amp;quot;,
    &amp;quot;bRaSiL&amp;quot;, &amp;quot;rog√©rio&amp;quot;,        &amp;quot;Marinho&amp;quot;,
  )

df %&amp;gt;% 
  mutate(pais = str_to_title(pais),
         primeiro_nome = str_to_title(primeiro_nome),
         segundo_nome = str_to_title(segundo_nome)) %&amp;gt;% 
  unite(nomes, primeiro_nome, segundo_nome, sep = &amp;quot; &amp;quot;) %&amp;gt;% 
  arrange(str_order(nomes))
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 4 x 2
##   pais   nomes           
##   &amp;lt;chr&amp;gt;  &amp;lt;chr&amp;gt;           
## 1 Brasil Eduardo Cabellos
## 2 Brasil Isabela Martins 
## 3 Brasil M√°rcia Pinto    
## 4 Brasil Rog√©rio Marinho
&lt;/code&gt;&lt;/pre&gt;
&lt;ol start=&#34;8&#34;&gt;
&lt;li&gt;Transforme a string &lt;code&gt;c(&amp;quot;Seu nome&amp;quot;, &amp;quot;Seu sobrenome da m√£e&amp;quot;, &amp;quot;Seu sobrenome do pai&amp;quot;)&lt;/code&gt; na string &lt;code&gt;&amp;quot;SEU SOBRENOME DO PAI, sua inicial do nome. sua inicial da m√£e.&amp;quot;&lt;/code&gt;, como numa cita√ß√£o. Veja o exemplo abaixo:&lt;/li&gt;
&lt;/ol&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;# Transforme
c(&amp;quot;Vin√≠cius&amp;quot;, &amp;quot;de Souza&amp;quot;, &amp;quot;Maia&amp;quot;)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] &amp;quot;Vin√≠cius&amp;quot; &amp;quot;de Souza&amp;quot; &amp;quot;Maia&amp;quot;
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;# Resultado
&amp;quot;MAIA, V. S.&amp;quot;
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] &amp;quot;MAIA, V. S.&amp;quot;
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;x &amp;lt;- c(&amp;quot;Vin√≠cius&amp;quot;, &amp;quot;de Souza&amp;quot;, &amp;quot;Maia&amp;quot;)
x[1] &amp;lt;- str_sub(x[1], 1, 1) %&amp;gt;% str_c(&amp;quot;.&amp;quot;)
x[2] &amp;lt;- str_sub(x[2], 4, 4) %&amp;gt;% str_c(&amp;quot;.&amp;quot;)
x[3] &amp;lt;- str_to_upper(x[3])
str_c(c(x[3], x[1], x[2]), collapse = &amp;quot; &amp;quot;)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] &amp;quot;MAIA V. S.&amp;quot;
&lt;/code&gt;&lt;/pre&gt;
&lt;ol start=&#34;9&#34;&gt;
&lt;li&gt;DESAFIO: Nos microdados da √°rea de sa√∫de, √© comum que a vari√°vel idade esteja registrada da seguinte forma: &amp;ldquo;150&amp;rdquo;, &amp;ldquo;219&amp;rdquo;, &amp;ldquo;312&amp;rdquo;, &amp;ldquo;471&amp;rdquo;. Esses c√≥digos indicam primeiro qual a unidade de medida da idade e segundo o valor desta unidade, 1 = horas, 2 = dias, 3 = meses, 4 = anos. Proponha um c√≥digo usando &lt;code&gt;stringr&lt;/code&gt; para transformar o vetor abaixo em um valor num√©rico.&lt;/li&gt;
&lt;/ol&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;# N√£o precisa se preocupar com essa parte
x &amp;lt;- as.character(round(c(
  runif(25, 100, 124),
  runif(25, 201, 230),
  runif(25, 301, 312),
  runif(25, 401, 499)
)))

# Como voc√™ transformaria esse vetor em n√∫mero?
x
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##   [1] &amp;quot;107&amp;quot; &amp;quot;107&amp;quot; &amp;quot;104&amp;quot; &amp;quot;115&amp;quot; &amp;quot;109&amp;quot; &amp;quot;112&amp;quot; &amp;quot;105&amp;quot; &amp;quot;101&amp;quot; &amp;quot;101&amp;quot; &amp;quot;113&amp;quot; &amp;quot;118&amp;quot; &amp;quot;110&amp;quot;
##  [13] &amp;quot;122&amp;quot; &amp;quot;112&amp;quot; &amp;quot;113&amp;quot; &amp;quot;113&amp;quot; &amp;quot;114&amp;quot; &amp;quot;118&amp;quot; &amp;quot;115&amp;quot; &amp;quot;100&amp;quot; &amp;quot;112&amp;quot; &amp;quot;123&amp;quot; &amp;quot;102&amp;quot; &amp;quot;104&amp;quot;
##  [25] &amp;quot;115&amp;quot; &amp;quot;219&amp;quot; &amp;quot;229&amp;quot; &amp;quot;212&amp;quot; &amp;quot;210&amp;quot; &amp;quot;221&amp;quot; &amp;quot;204&amp;quot; &amp;quot;221&amp;quot; &amp;quot;209&amp;quot; &amp;quot;227&amp;quot; &amp;quot;216&amp;quot; &amp;quot;202&amp;quot;
##  [37] &amp;quot;215&amp;quot; &amp;quot;218&amp;quot; &amp;quot;203&amp;quot; &amp;quot;208&amp;quot; &amp;quot;223&amp;quot; &amp;quot;227&amp;quot; &amp;quot;215&amp;quot; &amp;quot;203&amp;quot; &amp;quot;227&amp;quot; &amp;quot;203&amp;quot; &amp;quot;201&amp;quot; &amp;quot;228&amp;quot;
##  [49] &amp;quot;211&amp;quot; &amp;quot;212&amp;quot; &amp;quot;309&amp;quot; &amp;quot;309&amp;quot; &amp;quot;310&amp;quot; &amp;quot;309&amp;quot; &amp;quot;303&amp;quot; &amp;quot;302&amp;quot; &amp;quot;308&amp;quot; &amp;quot;303&amp;quot; &amp;quot;310&amp;quot; &amp;quot;304&amp;quot;
##  [61] &amp;quot;306&amp;quot; &amp;quot;303&amp;quot; &amp;quot;302&amp;quot; &amp;quot;308&amp;quot; &amp;quot;304&amp;quot; &amp;quot;303&amp;quot; &amp;quot;304&amp;quot; &amp;quot;303&amp;quot; &amp;quot;303&amp;quot; &amp;quot;301&amp;quot; &amp;quot;311&amp;quot; &amp;quot;302&amp;quot;
##  [73] &amp;quot;303&amp;quot; &amp;quot;311&amp;quot; &amp;quot;310&amp;quot; &amp;quot;434&amp;quot; &amp;quot;460&amp;quot; &amp;quot;469&amp;quot; &amp;quot;439&amp;quot; &amp;quot;413&amp;quot; &amp;quot;436&amp;quot; &amp;quot;479&amp;quot; &amp;quot;440&amp;quot; &amp;quot;441&amp;quot;
##  [85] &amp;quot;455&amp;quot; &amp;quot;484&amp;quot; &amp;quot;491&amp;quot; &amp;quot;436&amp;quot; &amp;quot;468&amp;quot; &amp;quot;420&amp;quot; &amp;quot;472&amp;quot; &amp;quot;474&amp;quot; &amp;quot;496&amp;quot; &amp;quot;407&amp;quot; &amp;quot;449&amp;quot; &amp;quot;405&amp;quot;
##  [97] &amp;quot;470&amp;quot; &amp;quot;469&amp;quot; &amp;quot;442&amp;quot; &amp;quot;473&amp;quot;
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;# Esse exerc√≠cio √© um pouco mais dif√≠cil mesmo!
x %&amp;gt;% str_extract(&amp;quot;\\d&amp;quot;)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##   [1] &amp;quot;1&amp;quot; &amp;quot;1&amp;quot; &amp;quot;1&amp;quot; &amp;quot;1&amp;quot; &amp;quot;1&amp;quot; &amp;quot;1&amp;quot; &amp;quot;1&amp;quot; &amp;quot;1&amp;quot; &amp;quot;1&amp;quot; &amp;quot;1&amp;quot; &amp;quot;1&amp;quot; &amp;quot;1&amp;quot; &amp;quot;1&amp;quot; &amp;quot;1&amp;quot; &amp;quot;1&amp;quot; &amp;quot;1&amp;quot; &amp;quot;1&amp;quot; &amp;quot;1&amp;quot;
##  [19] &amp;quot;1&amp;quot; &amp;quot;1&amp;quot; &amp;quot;1&amp;quot; &amp;quot;1&amp;quot; &amp;quot;1&amp;quot; &amp;quot;1&amp;quot; &amp;quot;1&amp;quot; &amp;quot;2&amp;quot; &amp;quot;2&amp;quot; &amp;quot;2&amp;quot; &amp;quot;2&amp;quot; &amp;quot;2&amp;quot; &amp;quot;2&amp;quot; &amp;quot;2&amp;quot; &amp;quot;2&amp;quot; &amp;quot;2&amp;quot; &amp;quot;2&amp;quot; &amp;quot;2&amp;quot;
##  [37] &amp;quot;2&amp;quot; &amp;quot;2&amp;quot; &amp;quot;2&amp;quot; &amp;quot;2&amp;quot; &amp;quot;2&amp;quot; &amp;quot;2&amp;quot; &amp;quot;2&amp;quot; &amp;quot;2&amp;quot; &amp;quot;2&amp;quot; &amp;quot;2&amp;quot; &amp;quot;2&amp;quot; &amp;quot;2&amp;quot; &amp;quot;2&amp;quot; &amp;quot;2&amp;quot; &amp;quot;3&amp;quot; &amp;quot;3&amp;quot; &amp;quot;3&amp;quot; &amp;quot;3&amp;quot;
##  [55] &amp;quot;3&amp;quot; &amp;quot;3&amp;quot; &amp;quot;3&amp;quot; &amp;quot;3&amp;quot; &amp;quot;3&amp;quot; &amp;quot;3&amp;quot; &amp;quot;3&amp;quot; &amp;quot;3&amp;quot; &amp;quot;3&amp;quot; &amp;quot;3&amp;quot; &amp;quot;3&amp;quot; &amp;quot;3&amp;quot; &amp;quot;3&amp;quot; &amp;quot;3&amp;quot; &amp;quot;3&amp;quot; &amp;quot;3&amp;quot; &amp;quot;3&amp;quot; &amp;quot;3&amp;quot;
##  [73] &amp;quot;3&amp;quot; &amp;quot;3&amp;quot; &amp;quot;3&amp;quot; &amp;quot;4&amp;quot; &amp;quot;4&amp;quot; &amp;quot;4&amp;quot; &amp;quot;4&amp;quot; &amp;quot;4&amp;quot; &amp;quot;4&amp;quot; &amp;quot;4&amp;quot; &amp;quot;4&amp;quot; &amp;quot;4&amp;quot; &amp;quot;4&amp;quot; &amp;quot;4&amp;quot; &amp;quot;4&amp;quot; &amp;quot;4&amp;quot; &amp;quot;4&amp;quot; &amp;quot;4&amp;quot;
##  [91] &amp;quot;4&amp;quot; &amp;quot;4&amp;quot; &amp;quot;4&amp;quot; &amp;quot;4&amp;quot; &amp;quot;4&amp;quot; &amp;quot;4&amp;quot; &amp;quot;4&amp;quot; &amp;quot;4&amp;quot; &amp;quot;4&amp;quot; &amp;quot;4&amp;quot;
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;tibble(
  tipo_idade = str_sub(x, 1, 1),
  idade = str_sub(x, 2, 3),
  idade_anos =
    if_else(
      str_detect(tipo_idade, &amp;quot;1&amp;quot;),
      as.numeric(idade) / (24 * 30 * 12),
      if_else(
        str_detect(tipo_idade, &amp;quot;2&amp;quot;),
        as.numeric(idade) / (30 * 12),
        if_else(
          str_detect(tipo_idade, &amp;quot;3&amp;quot;),
          as.numeric(idade) / 12,
          as.numeric(idade)
        )
      )
    )
) %&amp;gt;% 
  print(n = Inf)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 100 x 3
##     tipo_idade idade idade_anos
##     &amp;lt;chr&amp;gt;      &amp;lt;chr&amp;gt;      &amp;lt;dbl&amp;gt;
##   1 1          07      0.000810
##   2 1          07      0.000810
##   3 1          04      0.000463
##   4 1          15      0.00174 
##   5 1          09      0.00104 
##   6 1          12      0.00139 
##   7 1          05      0.000579
##   8 1          01      0.000116
##   9 1          01      0.000116
##  10 1          13      0.00150 
##  11 1          18      0.00208 
##  12 1          10      0.00116 
##  13 1          22      0.00255 
##  14 1          12      0.00139 
##  15 1          13      0.00150 
##  16 1          13      0.00150 
##  17 1          14      0.00162 
##  18 1          18      0.00208 
##  19 1          15      0.00174 
##  20 1          00      0       
##  21 1          12      0.00139 
##  22 1          23      0.00266 
##  23 1          02      0.000231
##  24 1          04      0.000463
##  25 1          15      0.00174 
##  26 2          19      0.0528  
##  27 2          29      0.0806  
##  28 2          12      0.0333  
##  29 2          10      0.0278  
##  30 2          21      0.0583  
##  31 2          04      0.0111  
##  32 2          21      0.0583  
##  33 2          09      0.025   
##  34 2          27      0.075   
##  35 2          16      0.0444  
##  36 2          02      0.00556 
##  37 2          15      0.0417  
##  38 2          18      0.05    
##  39 2          03      0.00833 
##  40 2          08      0.0222  
##  41 2          23      0.0639  
##  42 2          27      0.075   
##  43 2          15      0.0417  
##  44 2          03      0.00833 
##  45 2          27      0.075   
##  46 2          03      0.00833 
##  47 2          01      0.00278 
##  48 2          28      0.0778  
##  49 2          11      0.0306  
##  50 2          12      0.0333  
##  51 3          09      0.75    
##  52 3          09      0.75    
##  53 3          10      0.833   
##  54 3          09      0.75    
##  55 3          03      0.25    
##  56 3          02      0.167   
##  57 3          08      0.667   
##  58 3          03      0.25    
##  59 3          10      0.833   
##  60 3          04      0.333   
##  61 3          06      0.5     
##  62 3          03      0.25    
##  63 3          02      0.167   
##  64 3          08      0.667   
##  65 3          04      0.333   
##  66 3          03      0.25    
##  67 3          04      0.333   
##  68 3          03      0.25    
##  69 3          03      0.25    
##  70 3          01      0.0833  
##  71 3          11      0.917   
##  72 3          02      0.167   
##  73 3          03      0.25    
##  74 3          11      0.917   
##  75 3          10      0.833   
##  76 4          34     34       
##  77 4          60     60       
##  78 4          69     69       
##  79 4          39     39       
##  80 4          13     13       
##  81 4          36     36       
##  82 4          79     79       
##  83 4          40     40       
##  84 4          41     41       
##  85 4          55     55       
##  86 4          84     84       
##  87 4          91     91       
##  88 4          36     36       
##  89 4          68     68       
##  90 4          20     20       
##  91 4          72     72       
##  92 4          74     74       
##  93 4          96     96       
##  94 4          07      7       
##  95 4          49     49       
##  96 4          05      5       
##  97 4          70     70       
##  98 4          69     69       
##  99 4          42     42       
## 100 4          73     73
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Ao inv√©s de utilizar essas chamadas recursivas de &lt;code&gt;if_else&lt;/code&gt;, que s√£o muito ruins de ler, como voc√™ poderia reescrever a condi√ß√£o usando &lt;code&gt;case_when&lt;/code&gt;?&lt;/p&gt;
&lt;ol start=&#34;10&#34;&gt;
&lt;li&gt;Explore as contagens da vari√°vel &lt;code&gt;rincome&lt;/code&gt; em &lt;code&gt;gss_cat&lt;/code&gt;, ela ficaria bem representada num gr√°fico? De qual tipo?&lt;/li&gt;
&lt;/ol&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;gss_cat %&amp;gt;% count(rincome)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 16 x 2
##    rincome            n
##    &amp;lt;fct&amp;gt;          &amp;lt;int&amp;gt;
##  1 No answer        183
##  2 Don&#39;t know       267
##  3 Refused          975
##  4 $25000 or more  7363
##  5 $20000 - 24999  1283
##  6 $15000 - 19999  1048
##  7 $10000 - 14999  1168
##  8 $8000 to 9999    340
##  9 $7000 to 7999    188
## 10 $6000 to 6999    215
## 11 $5000 to 5999    227
## 12 $4000 to 4999    226
## 13 $3000 to 3999    276
## 14 $1000 to 2999    395
## 15 Lt $1000         286
## 16 Not applicable  7043
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Em geral, contagens de vari√°veis ficam bem em gr√°ficos de barras ou visualiza√ß√µes equivalentes, em que √© poss√≠vel comparar visualmente as contagens das diversas categorias. Mais sobre isso na aula do &lt;code&gt;ggplot2&lt;/code&gt;.&lt;/p&gt;
&lt;ol start=&#34;11&#34;&gt;
&lt;li&gt;Qual a religi√£o mais comum em &lt;code&gt;gss_cat&lt;/code&gt;? Qual o partido (&lt;code&gt;partyid&lt;/code&gt;) mais popular?&lt;/li&gt;
&lt;/ol&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;# Religi√£o
gss_cat %&amp;gt;% count(relig) %&amp;gt;% arrange(desc(n))
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 15 x 2
##    relig                       n
##    &amp;lt;fct&amp;gt;                   &amp;lt;int&amp;gt;
##  1 Protestant              10846
##  2 Catholic                 5124
##  3 None                     3523
##  4 Christian                 689
##  5 Jewish                    388
##  6 Other                     224
##  7 Buddhism                  147
##  8 Inter-nondenominational   109
##  9 Moslem/islam              104
## 10 Orthodox-christian         95
## 11 No answer                  93
## 12 Hinduism                   71
## 13 Other eastern              32
## 14 Native american            23
## 15 Don&#39;t know                 15
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;# Partido
gss_cat %&amp;gt;% count(partyid) %&amp;gt;% arrange(desc(n))
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 10 x 2
##    partyid                n
##    &amp;lt;fct&amp;gt;              &amp;lt;int&amp;gt;
##  1 Independent         4119
##  2 Not str democrat    3690
##  3 Strong democrat     3490
##  4 Not str republican  3032
##  5 Ind,near dem        2499
##  6 Strong republican   2314
##  7 Ind,near rep        1791
##  8 Other party          393
##  9 No answer            154
## 10 Don&#39;t know             1
&lt;/code&gt;&lt;/pre&gt;
&lt;ol start=&#34;12&#34;&gt;
&lt;li&gt;A que religi√£o se refere a vari√°vel &lt;code&gt;denom&lt;/code&gt;? Voc√™ pode descobrir isso fazendo uma tabela de contagens?&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Voc√™ pode chamar count com v√°rias vari√°veis para fazer uma tabula√ß√£o cruzada.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;gss_cat %&amp;gt;% count(relig, denom) %&amp;gt;% print(n = Inf)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 47 x 3
##    relig                   denom                    n
##    &amp;lt;fct&amp;gt;                   &amp;lt;fct&amp;gt;                &amp;lt;int&amp;gt;
##  1 No answer               No answer               93
##  2 Don&#39;t know              Not applicable          15
##  3 Inter-nondenominational Not applicable         109
##  4 Native american         Not applicable          23
##  5 Christian               No answer                2
##  6 Christian               Don&#39;t know              11
##  7 Christian               No denomination        452
##  8 Christian               Not applicable         224
##  9 Orthodox-christian      Not applicable          95
## 10 Moslem/islam            Not applicable         104
## 11 Other eastern           Not applicable          32
## 12 Hinduism                Not applicable          71
## 13 Buddhism                Not applicable         147
## 14 Other                   No denomination          7
## 15 Other                   Not applicable         217
## 16 None                    Not applicable        3523
## 17 Jewish                  Not applicable         388
## 18 Catholic                Not applicable        5124
## 19 Protestant              No answer               22
## 20 Protestant              Don&#39;t know              41
## 21 Protestant              No denomination       1224
## 22 Protestant              Other                 2534
## 23 Protestant              Episcopal              397
## 24 Protestant              Presbyterian-dk wh     244
## 25 Protestant              Presbyterian, merged    67
## 26 Protestant              Other presbyterian      47
## 27 Protestant              United pres ch in us   110
## 28 Protestant              Presbyterian c in us   104
## 29 Protestant              Lutheran-dk which      267
## 30 Protestant              Evangelical luth       122
## 31 Protestant              Other lutheran          30
## 32 Protestant              Wi evan luth synod      71
## 33 Protestant              Lutheran-mo synod      212
## 34 Protestant              Luth ch in america      71
## 35 Protestant              Am lutheran            146
## 36 Protestant              Methodist-dk which     239
## 37 Protestant              Other methodist         33
## 38 Protestant              United methodist      1067
## 39 Protestant              Afr meth ep zion        32
## 40 Protestant              Afr meth episcopal      77
## 41 Protestant              Baptist-dk which      1457
## 42 Protestant              Other baptists         213
## 43 Protestant              Southern baptist      1536
## 44 Protestant              Nat bapt conv usa       40
## 45 Protestant              Nat bapt conv of am     76
## 46 Protestant              Am bapt ch in usa      130
## 47 Protestant              Am baptist asso        237
&lt;/code&gt;&lt;/pre&gt;
&lt;ol start=&#34;13&#34;&gt;
&lt;li&gt;Como voc√™ poderia diminuir o n√∫mero de categorias da vari√°vel &lt;code&gt;rincome&lt;/code&gt; do banco &lt;code&gt;gss_cat&lt;/code&gt;?&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;A melhor fun√ß√£o para redu√ß√£o de fatores √© &lt;code&gt;fct_collapse&lt;/code&gt;. Veja como ficam a coluna original e a transformada.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;gss_cat2 &amp;lt;- 
  gss_cat %&amp;gt;% 
  # Aqui vou salvar em &amp;quot;rincome2&amp;quot; para a gente poder ver as duas
  mutate(rincome2 = fct_collapse(
    rincome,
    &amp;quot;Non-response&amp;quot; = c(&amp;quot;No answer&amp;quot;, &amp;quot;Don&#39;t know&amp;quot;, &amp;quot;Refused&amp;quot;, &amp;quot;Not applicable&amp;quot;),
    &amp;quot;At√© 5k&amp;quot;       = c(&amp;quot;$4000 to 4999&amp;quot;, &amp;quot;$3000 to 3999&amp;quot;, &amp;quot;$1000 to 2999&amp;quot;, &amp;quot;Lt $1000&amp;quot;),
    &amp;quot;5k-10k&amp;quot;       = c( &amp;quot;$8000 to 9999&amp;quot;, &amp;quot;$7000 to 7999&amp;quot;, &amp;quot;$6000 to 6999&amp;quot;, &amp;quot;$5000 to 5999&amp;quot;),
    &amp;quot;10k-20k&amp;quot;      = c(&amp;quot;$15000 - 19999&amp;quot;, &amp;quot;$10000 - 14999&amp;quot;),
    &amp;quot;20k+&amp;quot;         = c(&amp;quot;$25000 or more&amp;quot;, &amp;quot;$20000 - 24999&amp;quot;))) %&amp;gt;% 
  select(rincome, rincome2)

# E veja as contagens
gss_cat2 %&amp;gt;% count(rincome)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 16 x 2
##    rincome            n
##    &amp;lt;fct&amp;gt;          &amp;lt;int&amp;gt;
##  1 No answer        183
##  2 Don&#39;t know       267
##  3 Refused          975
##  4 $25000 or more  7363
##  5 $20000 - 24999  1283
##  6 $15000 - 19999  1048
##  7 $10000 - 14999  1168
##  8 $8000 to 9999    340
##  9 $7000 to 7999    188
## 10 $6000 to 6999    215
## 11 $5000 to 5999    227
## 12 $4000 to 4999    226
## 13 $3000 to 3999    276
## 14 $1000 to 2999    395
## 15 Lt $1000         286
## 16 Not applicable  7043
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;gss_cat2 %&amp;gt;% count(rincome2)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 5 x 2
##   rincome2         n
##   &amp;lt;fct&amp;gt;        &amp;lt;int&amp;gt;
## 1 Non-response  8468
## 2 20k+          8646
## 3 10k-20k       2216
## 4 5k-10k         970
## 5 At√© 5k        1183
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;ggplot2&#34;&gt;&lt;code&gt;ggplot2&lt;/code&gt;&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;O que tem de errado no c√≥digo abaixo? Por que os pontos n√£o ficaram azuis?&lt;/li&gt;
&lt;/ol&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy, color = &amp;quot;blue&amp;quot;))
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;https://laddem.github.io/courses/tidyverse/solucoes_files/figure-html/unnamed-chunk-42-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;p&gt;Os pontos n√£o ficam azuis porque voc√™ n√£o est√° especificando cores! Dentro da fun√ß√£o &lt;code&gt;aes()&lt;/code&gt; voc√™ est√° especificando vari√°veis para serem mapeadas a uma escala de cores. Portanto, o &lt;code&gt;ggplot&lt;/code&gt; interpreta &amp;ldquo;blue&amp;rdquo; como uma vari√°vel sem nome que tem o valor &amp;ldquo;blue&amp;rdquo; e mapeia ela para a escala de cores padr√£o, que √© vermelha. Se voc√™ quer controlar apenas a &amp;ldquo;apar√™ncia&amp;rdquo; dos pontos e n√£o est√° preocupada em mapear nenhuma vari√°vel, voc√™ pode passar essa est√©tica fora da fun√ß√£o &lt;code&gt;aes()&lt;/code&gt;.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;ggplot(data = mpg) + 
  geom_point(
    mapping = aes(x = displ, y = hwy), # aqui acabam os mapeamentos est√©ticos
    color = &amp;quot;blue&amp;quot;, # altera√ß√£o apenas na apar√™ncia do geom
    size = 2, # altera√ß√£o apenas na apar√™ncia do geom
    shape = 6 # altera√ß√£o apenas na apar√™ncia do geom
    ) 
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;https://laddem.github.io/courses/tidyverse/solucoes_files/figure-html/unnamed-chunk-43-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;ol start=&#34;2&#34;&gt;
&lt;li&gt;Utilizando o banco &lt;code&gt;mpg&lt;/code&gt;, fa√ßa o diagrama de dispers√£o de &lt;code&gt;displ&lt;/code&gt; por &lt;code&gt;hwy&lt;/code&gt; e mapeie a cor para &lt;code&gt;class&lt;/code&gt;, o tamanho para &lt;code&gt;cyl&lt;/code&gt; e a forma para &lt;code&gt;manufacturer&lt;/code&gt;. Como esses atributos est√©ticos se comportam diferente para vari√°veis categ√≥ricas vs cont√≠nuas?&lt;/li&gt;
&lt;/ol&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;ggplot(mpg, aes(
  displ, 
  hwy, 
  color = class, 
  size = cyl,
  shape = manufacturer)) +
  geom_point()
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## Warning: The shape palette can deal with a maximum of 6 discrete values because
## more than 6 becomes difficult to discriminate; you have 15. Consider
## specifying shapes manually if you must have them.
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## Warning: Removed 112 rows containing missing values (geom_point).
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;https://laddem.github.io/courses/tidyverse/solucoes_files/figure-html/unnamed-chunk-44-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;p&gt;Ao cumprir as instru√ß√µes como dadas, logo de cara voc√™ recebe um aviso do &lt;code&gt;ggplot2&lt;/code&gt;. A paleta de &amp;ldquo;shapes&amp;rdquo; s√≥ recebe por padr√£o 6 shapes diferentes, porque de acordo com o autor, mais de 6 torna dif√≠cil de distinguir. Mas eu sou teimoso.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;ggplot(mpg, aes(
  displ, 
  hwy, 
  color = class, 
  size = cyl,
  shape = manufacturer)) +
  geom_point() +
  scale_shape_manual(values = 1:15, guide = &amp;quot;legend&amp;quot;)
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;https://laddem.github.io/courses/tidyverse/solucoes_files/figure-html/unnamed-chunk-45-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;p&gt;Esse gr√°fico √© mais um exemplo para voc√™s verem como diferentes escalas se comportam. A vari√°vel &lt;code&gt;cyl&lt;/code&gt; √© num√©rica e ordenada, ent√£o faz sentido coloc√°-la num mapeamento como &lt;code&gt;size&lt;/code&gt;, j√° que visualmente √© poss√≠vel indicar que a grandeza aumenta com o tamanho. Classe √© uma vari√°vel categ√≥rica, ent√£o ela fica melhor em mapeamentos que ressaltam diferen√ßas entre as categorias, como &lt;code&gt;colors&lt;/code&gt; ou &lt;code&gt;shapes&lt;/code&gt;. O pacote tamb√©m imp√µe algumas restri√ß√µes sobre o que √© poss√≠vel mapear. Por exemplo, ele retorna erro se voc√™ tenta mapear uma vari√°vel discreta para uma escala cont√≠nua.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;ggplot(mpg, aes(displ, hwy, color = class)) +
  geom_point() +
  scale_color_continuous()
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## Error: Discrete value supplied to continuous scale
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;https://laddem.github.io/courses/tidyverse/solucoes_files/figure-html/unnamed-chunk-46-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;p&gt;Experimentem tentar mapear diferentes vari√°veis no banco &lt;code&gt;mpg&lt;/code&gt; para as diferentes escalas e vejam os resultados. Em alguns casos, √© poss√≠vel, mas o gr√°fico √© pouco informativo, em outros, voc√™ ver√° mensagens de erro.&lt;/p&gt;
&lt;ol start=&#34;3&#34;&gt;
&lt;li&gt;Utilizando o &lt;code&gt;diamonds&lt;/code&gt;, crie um diagrama de dispers√£o que relacione &lt;code&gt;carat&lt;/code&gt; com &lt;code&gt;price&lt;/code&gt;. Explore algumas outras vari√°veis utilizando escalas de cor para ver se voc√™ identifica algum padr√£o. Aplique transforma√ß√µes nas vari√°veis que voc√™ considerar justificadas.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Esse exerc√≠cio n√£o tem uma resposta correta. O objetivo era que voc√™s explorassem as transforma√ß√µes estat√≠sticas e as escalas de cores diferentes presentes no &lt;code&gt;ggplot&lt;/code&gt;, atrav√©s do argumento &lt;code&gt;trans&lt;/code&gt;, ou mesmo fazer outras transforma√ß√µes que interessassem voc√™s nas vari√°veis. Abaixo um exemplo de transforma√ß√£o de Yeo-Johnson, um tipo de transforma√ß√£o BoxCox que aceita valores negativos e uma das escalas de cor do pacote &lt;code&gt;viridis&lt;/code&gt;.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;ggplot(diamonds, aes(carat, price, color = clarity)) +
  geom_point() +
  scale_x_continuous(trans = scales::yj_trans(p = 2)) +
  scale_color_viridis_d(option = &amp;quot;magma&amp;quot;)
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;https://laddem.github.io/courses/tidyverse/solucoes_files/figure-html/unnamed-chunk-47-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;ol start=&#34;4&#34;&gt;
&lt;li&gt;Ainda continuando o exemplo anterior, aplique um &lt;code&gt;geom_smooth&lt;/code&gt; utilizando v√°rias op√ß√µes de &lt;code&gt;method&lt;/code&gt; para as vari√°veis originais ou transformadas.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Segundo a mesma l√≥gica, o objetivo era explorar as op√ß√µes de visualiza√ß√£o de modelos simples atrav√©s do argumento &lt;code&gt;method&lt;/code&gt;. Abaixo um exemplo de &lt;code&gt;gam&lt;/code&gt;. Uma mudan√ßa que fiz foi usar a vari√°vel &lt;code&gt;cut&lt;/code&gt; ao inv√©s de &lt;code&gt;clarity&lt;/code&gt;, porque o gr√°fico n√£o-transformado de &lt;code&gt;clarity&lt;/code&gt; estava muito polu√≠do.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;ggplot(diamonds, aes(carat, price, color = cut)) +
  geom_point(alpha = 0.1) + # pontos transl√∫cidos para reduzir a polui√ß√£o
  geom_smooth(method = &amp;quot;gam&amp;quot;, se = FALSE) +
  scale_color_viridis_d(option = &amp;quot;plasma&amp;quot;)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## `geom_smooth()` using formula &#39;y ~ s(x, bs = &amp;quot;cs&amp;quot;)&#39;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;https://laddem.github.io/courses/tidyverse/solucoes_files/figure-html/unnamed-chunk-48-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;ol start=&#34;5&#34;&gt;
&lt;li&gt;No nosso gr√°fico de barras usando &lt;code&gt;stat(prop)&lt;/code&gt; a gente precisou colocar &lt;code&gt;group = 1&lt;/code&gt;, porque? Qual √© a diferen√ßa entre esses dois c√≥digos?&lt;/li&gt;
&lt;/ol&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;ggplot(data = diamonds) + 
  geom_bar(mapping = aes(x = cut, y = after_stat(prop)))
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;https://laddem.github.io/courses/tidyverse/solucoes_files/figure-html/unnamed-chunk-49-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;ggplot(data = diamonds) + 
  geom_bar(mapping = aes(x = cut, fill = color, y = after_stat(prop)))
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;https://laddem.github.io/courses/tidyverse/solucoes_files/figure-html/unnamed-chunk-49-2.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;p&gt;Acabei explicando isso na aula, devido a uma pergunta, mas para quem perdeu, trata-se do comportamento padr√£o quando h√° propor√ß√µes: cada barra ter√° sua pr√≥pria propor√ß√£o e todas somar√£o a 100%. O uso de &lt;code&gt;group = 1&lt;/code&gt; indica √† fun√ß√£o que as propor√ß√µes que somam a 100% s√£o o total dos n√≠veis do fator e n√£o cada n√≠vel individualmente.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;ggplot(data = diamonds) + 
  geom_bar(mapping = aes(x = cut, y = after_stat(prop), group = 1))
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;https://laddem.github.io/courses/tidyverse/solucoes_files/figure-html/unnamed-chunk-50-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;# No caso em que h√° um &amp;quot;fill&amp;quot;, precisamos normalizar as alturas das barras
ggplot(data = diamonds) +
  geom_bar(mapping = aes(
    x = cut,
    y = stat(prop),
    fill = clarity
  ))
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;https://laddem.github.io/courses/tidyverse/solucoes_files/figure-html/unnamed-chunk-50-2.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;ggplot(data = diamonds) +
  geom_bar(mapping = aes(
    x = cut,
    y = stat(count)/sum(stat(count)),
    fill = clarity
  ))
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;https://laddem.github.io/courses/tidyverse/solucoes_files/figure-html/unnamed-chunk-50-3.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;ol start=&#34;6&#34;&gt;
&lt;li&gt;&lt;code&gt;stat_smooth&lt;/code&gt; √© muito parecido com &lt;code&gt;geom_smooth&lt;/code&gt;, mas h√° uma diferen√ßa sutil. Compare os c√≥digos abaixo.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;code&gt;geom_smooth&lt;/code&gt; chama &lt;code&gt;stat_smooth&lt;/code&gt; quando voc√™ utiliza a fun√ß√£o para calcular as &amp;ldquo;m√©dias condicionais&amp;rdquo; que correspondem a linha de tend√™ncia desenhada no gr√°fico. √â assim com todos os &lt;code&gt;geom&lt;/code&gt;s no pacote. H√° uma conex√£o entre o objeto geom√©trico e uma transforma√ß√£o estat√≠stica. Mesmo que seja a transforma√ß√£o &lt;code&gt;_identity&lt;/code&gt;, que mant√©m a vari√°vel exatamente como ela estava no dado. A grande vantagem de construir um gr√°fico com &lt;code&gt;stat_smooth&lt;/code&gt; ao inv√©s de &lt;code&gt;geom_smooth&lt;/code&gt; √© que voc√™ pode especificar outro objeto geom√©trico que n√£o seja o padr√£o (&lt;code&gt;geom_line&lt;/code&gt; + &lt;code&gt;geom_ribbon&lt;/code&gt;). √â isso que os gr√°ficos abaixo demonstram.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;ggplot(mpg, aes(displ, hwy)) + 
  geom_point() +
  geom_smooth()
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;https://laddem.github.io/courses/tidyverse/solucoes_files/figure-html/unnamed-chunk-51-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;ggplot(mpg, aes(displ, hwy)) + 
  geom_point() +
  stat_smooth(geom = &amp;quot;step&amp;quot;)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;https://laddem.github.io/courses/tidyverse/solucoes_files/figure-html/unnamed-chunk-51-2.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;ggplot(mpg, aes(displ, hwy)) + 
  geom_point() +
  stat_smooth(geom = &amp;quot;linerange&amp;quot;)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;https://laddem.github.io/courses/tidyverse/solucoes_files/figure-html/unnamed-chunk-51-3.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;ggplot(mpg, aes(displ, hwy)) + 
  geom_point() +
  stat_smooth(geom = &amp;quot;errorbar&amp;quot;)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;https://laddem.github.io/courses/tidyverse/solucoes_files/figure-html/unnamed-chunk-51-4.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;ggplot(mpg, aes(displ, hwy)) + 
  geom_point() +
  stat_smooth(geom = &amp;quot;crossbar&amp;quot;)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;https://laddem.github.io/courses/tidyverse/solucoes_files/figure-html/unnamed-chunk-51-5.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;ol start=&#34;7&#34;&gt;
&lt;li&gt;Usando o &lt;code&gt;mpg&lt;/code&gt; e &lt;code&gt;facet_grid&lt;/code&gt;, crie um scatterplot que contenha &lt;code&gt;displ&lt;/code&gt; no eixo x, &lt;code&gt;hwy&lt;/code&gt; no eixo y, &lt;code&gt;class&lt;/code&gt; na cor, &lt;code&gt;drv&lt;/code&gt; nas facetas-coluna e &lt;code&gt;cyl&lt;/code&gt; nas facetas linha.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Esse aqui √© para demonstrar o uso de &lt;code&gt;facet_grid&lt;/code&gt;, que permite especificar fatores de classifica√ß√£o diferentes nas linhas e colunas, diferente de &lt;code&gt;facet_wrap&lt;/code&gt; mostrado na aula, que s√≥ permite especificar uma dimens√£o.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;ggplot(mpg, aes(x = displ, y = hwy, color = class)) +
  geom_point() +
  facet_grid(cyl ~ drv)
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;https://laddem.github.io/courses/tidyverse/solucoes_files/figure-html/unnamed-chunk-52-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;ol start=&#34;8&#34;&gt;
&lt;li&gt;Voc√™ acha que os dois gr√°ficos abaixo ficar√£o diferentes um do outro? Porque? Tente responder antes de rodar o c√≥digo.&lt;/li&gt;
&lt;/ol&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;ggplot(data = mpg, mapping = aes(x = displ, y = hwy)) + 
  geom_point() + 
  geom_smooth()
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;https://laddem.github.io/courses/tidyverse/solucoes_files/figure-html/unnamed-chunk-53-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;ggplot() + 
  geom_point(data = mpg, mapping = aes(x = displ, y = hwy)) + 
  geom_smooth(data = mpg, mapping = aes(x = displ, y = hwy))
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;https://laddem.github.io/courses/tidyverse/solucoes_files/figure-html/unnamed-chunk-53-2.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;p&gt;Mesmo antes de rodar o c√≥digo, o observador astuto notar√° que os mapeamentos locais no segundo gr√°fico s√£o id√™nticos entre si e aos mapeamentos globais, ent√£o os dois gr√°ficos s√£o iguais.&lt;/p&gt;
&lt;ol start=&#34;9&#34;&gt;
&lt;li&gt;Tente recriar o seguinte gr√°fico&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;O objetivo dessa era fazer voc√™s fu√ßarem um pouco na ajuda para tentar recriar o mais fielmente poss√≠vel o gr√°fico final. N√£o precisava ter acertado, o objetivo era chegar o mais pr√≥ximo poss√≠vel.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;ggplot(mpg, aes(displ, hwy, color = drv)) +
  geom_point() +
  geom_smooth(method = lm, se = FALSE) +
  labs(x = &amp;quot;Rodovia&amp;quot;, y = &amp;quot;Toneladas&amp;quot;, color = &amp;quot;Tra√ß√£o&amp;quot;) +
  scale_color_brewer(palette = &amp;quot;Set1&amp;quot;)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## `geom_smooth()` using formula &#39;y ~ x&#39;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;https://laddem.github.io/courses/tidyverse/solucoes_files/figure-html/unnamed-chunk-54-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;ol start=&#34;10&#34;&gt;
&lt;li&gt;Transforme o gr√°fico seguir em um gr√°fico de pizza usando &lt;code&gt;coord_polar&lt;/code&gt;.&lt;/li&gt;
&lt;/ol&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;ggplot(diamonds, aes(cut, fill = cut)) +
  geom_bar()
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;https://laddem.github.io/courses/tidyverse/solucoes_files/figure-html/unnamed-chunk-55-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;p&gt;Depois de simplesmente especificar &lt;code&gt;coord_polar&lt;/code&gt;, em geral o gr√°fico fica meio estranho, n√£o tem aquela cara bonita de pizza. √â preciso corrigir os seguintes problemas:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;A largura das barras deve ser igual a propor√ß√£o das contagens, mas a altura deve ser igual a 1! Portanto, eu inverto as coisas e passo as contagens/propor√ß√µes para &amp;ldquo;x&amp;rdquo; e &amp;ldquo;y&amp;rdquo; fica com o valor fixo = 1.&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;&lt;code class=&#34;language-r&#34;&gt;ggplot(diamonds, 
       aes(
         # calculando as propor√ß√µes do total,
         # tamb√©m funciona com o padr√£o stat(count)
         x = stat(count)/sum(stat(count)),
         y = 1, # altura igual a 1
         fill = cut)) + # cores
  geom_bar() +
  coord_polar() + # coordenadas polares
  # opcional: remover aspectos do tema para um visual mais clean
  theme_void()
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;https://laddem.github.io/courses/tidyverse/solucoes_files/figure-html/unnamed-chunk-56-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;p&gt;Como desafio, tentem adicionar elementos textuais das propor√ß√µes no gr√°fico. O problema a ser resolvido √© como posicionar o texto num sistema de coordenadas polares. Boa sorte!&lt;/p&gt;
&lt;p&gt;Gr√°ficos de pizza s√£o pol√™micos na an√°lise de dados porque nossos olhos n√£o captam bem diferen√ßas entre formatos curvos e complexos, ent√£o a compara√ß√£o entre as categorias fica prejudicada se houverem mais de 2 ou 3. Eu sempre dou prefer√™ncia para barras. H√° um tipo de gr√°fico de pizza melhorzinho chamado &amp;ldquo;donut plot&amp;rdquo;, em que o meio do c√≠rculo √© oco, mas eu ainda prefiro as barras.&lt;/p&gt;
</description>
    </item>
    
  </channel>
</rss>

<!DOCTYPE html><html lang="en-us" >

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  
  
  
    <meta name="generator" content="Wowchemy 5.1.0 for Hugo" />
  

  

  
  
  
  
  
    
    
    
  
  

  <meta name="author" content="LADDEM" />

  
  
  
    
  
  <meta name="description" content="O pacote ggplot2 e a &ldquo;gramática dos gráficos&rdquo; Ainda me lembro da primeira vez que li o terceiro capítulo de R for Data Science em que o conceito de visualização de dados é apresentado junto com a ideia de data." />

  
  <link rel="alternate" hreflang="en-us" href="https://laddem.github.io/courses/tidyverse/dia3/" />

  







  




  
  
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  

  
  
  
    <meta name="theme-color" content="rgb(251, 191, 183)" />
  

  
  

  
  
  
  
    
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css" integrity="sha256-FMvZuGapsJLjouA6k7Eo2lusoAX9i0ShlWFG6qt7SLc=" crossorigin="anonymous">

    
    

    
    
    
      
    
    
      
      
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/styles/foundation.min.css" crossorigin="anonymous" title="hl-light" media="print" onload="this.media='all'">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/styles/foundation.min.css" crossorigin="anonymous" title="hl-dark" media="print" onload="this.media='all'" disabled>
      
    

    
    
    
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/leaflet.min.css" integrity="sha512-1xoFisiGdy9nvho8EgXuXvnpR5GAMSjFwp40gSRE3NwdUdIMIKuPa7bqoUhLD0O/5tPNhteAsE5XyyMi5reQVA==" crossorigin="anonymous" media="print" onload="this.media='all'">
    

    

    
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      
        
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
  

  
  
  
    
      
      <link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=Cutive+Mono&family=Lora:wght@400;700&family=Roboto:wght@400;700&display=swap&display=swap">
      <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Cutive+Mono&family=Lora:wght@400;700&family=Roboto:wght@400;700&display=swap&display=swap" media="print" onload="this.media='all'">
    
  

  
  
  
  
  
  <link rel="stylesheet" href="/css/wowchemy.46f8102c91669d08bf92f59f6531234a.css" />

  



  

  

  




  
  
  

  

  
    <link rel="manifest" href="/index.webmanifest" />
  

  <link rel="icon" type="image/png" href="/media/icon_hua2ec155b4296a9c9791d015323e16eb5_11927_32x32_fill_lanczos_center_2.png" />
  <link rel="apple-touch-icon" type="image/png" href="/media/icon_hua2ec155b4296a9c9791d015323e16eb5_11927_180x180_fill_lanczos_center_2.png" />

  <link rel="canonical" href="https://laddem.github.io/courses/tidyverse/dia3/" />

  
  
  
  
  
  
  
  
    
    
  
  
  <meta property="twitter:card" content="summary" />
  
  <meta property="og:site_name" content="LADDEM" />
  <meta property="og:url" content="https://laddem.github.io/courses/tidyverse/dia3/" />
  <meta property="og:title" content="ggplot2 | LADDEM" />
  <meta property="og:description" content="O pacote ggplot2 e a &ldquo;gramática dos gráficos&rdquo; Ainda me lembro da primeira vez que li o terceiro capítulo de R for Data Science em que o conceito de visualização de dados é apresentado junto com a ideia de data." /><meta property="og:image" content="https://laddem.github.io/media/logo_hu21999b1509efcb95cf9a1f4a62aafaa3_109704_300x300_fit_lanczos_2.png" />
    <meta property="twitter:image" content="https://laddem.github.io/media/logo_hu21999b1509efcb95cf9a1f4a62aafaa3_109704_300x300_fit_lanczos_2.png" /><meta property="og:locale" content="en-us" />
  
    
      <meta
        property="article:published_time"
        content="2021-05-23T00:00:00&#43;00:00"
      />
    
    <meta property="article:modified_time" content="2021-05-23T00:00:00&#43;00:00">
  

  



  

  

  





  <title>ggplot2 | LADDEM</title>
</head>


<body id="top" data-spy="scroll" data-offset="70" data-target="#TableOfContents" class="page-wrapper   " data-wc-page-id="b9e37b7e1055bb09bf3bd731ebee0b86" >

  
  
  
  
  
  
  
  
  <script src="/js/wowchemy-init.min.f16be01fc8fb2b5885dd67ce942d1185.js"></script>

  


<aside class="search-modal" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between mb-3">
        <div class="col-6">
          <h1>Search</h1>
        </div>
        <div class="col-6 col-search-close">
          <a class="js-search" href="#" aria-label="Close"><i class="fas fa-times-circle text-muted" aria-hidden="true"></i></a>
        </div>
      </div>

      <div id="search-box">
        
        <input name="q" id="search-query" placeholder="Search..." autocapitalize="off"
        autocomplete="off" autocorrect="off" spellcheck="false" type="search" class="form-control"
        aria-label="Search...">
        
      </div>

      
      

      

    </section>
    <section class="section-search-results">

      <div id="search-hits">
        
      </div>

    </section>
  </div>
</aside>



  <div class="page-header">
    











  


<nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id="navbar-main">
  <div class="container-xl">

    
    <div class="d-none d-lg-inline-flex">
      <a class="navbar-brand" href="/"><img src="/media/logo_hu21999b1509efcb95cf9a1f4a62aafaa3_109704_0x70_resize_lanczos_2.png" alt="LADDEM"></a>
    </div>
    

    
    <button type="button" class="navbar-toggler" data-toggle="collapse"
            data-target="#navbar-content" aria-controls="navbar-content" aria-expanded="false" aria-label="Toggle navigation">
    <span><i class="fas fa-bars"></i></span>
    </button>
    

    
    <div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none">
      <a class="navbar-brand" href="/"><img src="/media/logo_hu21999b1509efcb95cf9a1f4a62aafaa3_109704_0x70_resize_lanczos_2.png" alt="LADDEM"></a>
    </div>
    

    
    
    <div class="navbar-collapse main-menu-item collapse justify-content-start" id="navbar-content">

      
      <ul class="navbar-nav d-md-inline-flex">
        

        

        
        
        
          
        

        

        
        
        
        

        
          
            
            
          
          
            
            
            
              
            
            
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#about"><span>Sobre</span></a>
        </li>

        
        

        

        
        
        
          
        

        

        
        
        
        

        
          
            
            
          
          
        

        <li class="nav-item">
          <a class="nav-link  active" href="/courses/"><span>Cursos</span></a>
        </li>

        
        

        

        
        
        
          
        

        

        
        
        
        

        
          
            
            
          
          
            
            
            
              
            
            
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#contact"><span>Contato</span></a>
        </li>

        
        

      

        
      </ul>
    </div>

    <ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2">

      
      

      
      
      <li class="nav-item">
        <a class="nav-link js-search" href="#" aria-label="Search"><i class="fas fa-search" aria-hidden="true"></i></a>
      </li>
      

      
      
      <li class="nav-item dropdown theme-dropdown">
        <a href="#" class="nav-link" data-toggle="dropdown" aria-haspopup="true" aria-label="Display preferences">
          <i class="fas fa-moon" aria-hidden="true"></i>
        </a>
        <div class="dropdown-menu">
          <a href="#" class="dropdown-item js-set-theme-light">
            <span>Light</span>
          </a>
          <a href="#" class="dropdown-item js-set-theme-dark">
            <span>Dark</span>
          </a>
          <a href="#" class="dropdown-item js-set-theme-auto">
            <span>Automatic</span>
          </a>
        </div>
      </li>
      

      
      

    </ul>

  </div>
</nav>


  </div>

  <div class="page-body">
    





<div class="container-fluid docs">
  <div class="row flex-xl-nowrap">
    <div class="col-12 col-md-3 col-xl-2 docs-sidebar">
      <form class="docs-search d-flex align-items-center">
  <button class="btn docs-toggle d-md-none p-0 mr-md-3 w-100" type="button" data-toggle="collapse" data-target="#docs-nav" aria-controls="docs-nav" aria-expanded="false" aria-label="Toggle section navigation">
    <div class="d-flex">
      <span class="d-md-none pl-1 flex-grow-1 text-left overflow-hidden">
        
          Tidyverse
        
      </span>
      <span><i class="fas fa-chevron-down"></i></span>
    </div>
  </button>

  
  <button class="form-control sidebar-search js-search d-none d-md-flex">
    <i class="fas fa-search pr-2"></i>
    <span class="sidebar-search-text">Search...</span>
    <span class="sidebar-search-shortcut">/</span>
  </button>
  
</form>

<nav class="collapse docs-links" id="docs-nav">
  
  
  
  
  
  

  
  
    

    
      

      <ul class="nav docs-sidenav">
        <li><a href="/courses/"><i class="fas fa-arrow-left pr-1"></i>Cursos</a></li>
      </ul>

      
      
        
          
        
      


  
    
    
    
    
      
    
    

    
      <div class="docs-toc-item">
        <a class="docs-toc-link " href="/courses/tidyverse/">Tidyverse</a>
    
      
        <ul class="nav docs-sidenav">
      


  <li class=""><a href="/courses/tidyverse/dia1/">readr, tibble e tidyr</a></li>



  <li class=""><a href="/courses/tidyverse/dia2/">stringr, forcats e dplyr</a></li>



  <li class="active"><a href="/courses/tidyverse/dia3/">ggplot2</a></li>

      
        </ul>
      
    

    
      </div>
    

    
  
</nav>

    </div>

    
    
    <div class="d-none d-xl-block col-xl-2 docs-toc">
      

      <ul class="nav toc-top">
        <li><a href="#" id="back_to_top" class="docs-toc-title">Contents</a></li>
      </ul>

      <nav id="TableOfContents">
  <ul>
    <li><a href="#o-pacote-ggplot2-e-a-gramática-dos-gráficos">O pacote ggplot2 e a &ldquo;gramática dos gráficos&rdquo;</a></li>
    <li><a href="#três-gráficos-para-entender-a-mecânica-do-ggplot2">Três gráficos para entender a mecânica do ggplot2</a>
      <ul>
        <li><a href="#scatterplots">Scatterplots</a></li>
        <li><a href="#lineplots">Lineplots</a></li>
        <li><a href="#barcharts">Barcharts</a></li>
      </ul>
    </li>
    <li><a href="#perfumaria">Perfumaria</a>
      <ul>
        <li><a href="#títulos-e-rótulos">Títulos e rótulos</a></li>
        <li><a href="#eixos">Eixos</a></li>
        <li><a href="#legendas">Legendas</a></li>
        <li><a href="#escalas">Escalas</a></li>
      </ul>
    </li>
    <li><a href="#exercícios">Exercícios</a></li>
  </ul>
</nav>

      
    </div>
    

    <main class="col-12 col-md-9 col-xl-8 py-md-3 pl-md-5 docs-content" role="main">

      <article class="article">

        <div class="docs-article-container">
          
            
  <nav class="d-none d-md-flex" aria-label="breadcrumb">
    <ol class="breadcrumb">
      
  
  
  

  <li class="breadcrumb-item">
    <a href="/">
      
        Home
      
    </a>
  </li>


  <li class="breadcrumb-item">
    <a href="/courses/">
      
        Cursos
      
    </a>
  </li>


  <li class="breadcrumb-item">
    <a href="/courses/tidyverse/">
      
        Tidyverse
      
    </a>
  </li>


      <li class="breadcrumb-item active" aria-current="page">
        ggplot2
      </li>
    </ol>
  </nav>


          

          <h1>ggplot2</h1>

          <div class="article-style">
            <h2 id="o-pacote-ggplot2-e-a-gramática-dos-gráficos">O pacote ggplot2 e a &ldquo;gramática dos gráficos&rdquo;</h2>
<p>Ainda me lembro da primeira vez que li o terceiro capítulo de <a href="https://r4ds.had.co.nz/data-visualisation.html" target="_blank" rel="noopener">R for Data Science</a> em que o conceito de visualização de dados é apresentado junto com a ideia de <code>data.frame</code> e o código utilizado para gerar o gráfico. Acho que se o termo <code>sobrecarga infromacional</code> não existisse, eu teria inventado ele na hora.</p>
<p>Anedotas a parte, não é culpa do autor. O livro pressupõe um certo conhecimento prévio que eu não tinha quando o li pela primeira vez. Imagino que a maioria de vocês já viu gráficos na vida e até construiu um ou dois deles usando esse ou outros softwares estatísticos. O que talvez nem todos tenham claro na mente é que os gráficos são uma <strong>codificação num sistema de coordenadas das informações presentes em um banco de dados através de escalas</strong>. Vamos destrinchar um pouco melhor isso:</p>
<p>Suponha que você tenha o banco de dados <code>mpg</code>, presente na biblioteca <code>ggplot2</code>.</p>
<pre><code class="language-r">library(ggplot2)
mpg
</code></pre>
<pre><code>## # A tibble: 234 x 11
##    manufacturer model    displ  year   cyl trans   drv     cty   hwy fl    class
##    &lt;chr&gt;        &lt;chr&gt;    &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt;   &lt;chr&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt;
##  1 audi         a4         1.8  1999     4 auto(l~ f        18    29 p     comp~
##  2 audi         a4         1.8  1999     4 manual~ f        21    29 p     comp~
##  3 audi         a4         2    2008     4 manual~ f        20    31 p     comp~
##  4 audi         a4         2    2008     4 auto(a~ f        21    30 p     comp~
##  5 audi         a4         2.8  1999     6 auto(l~ f        16    26 p     comp~
##  6 audi         a4         2.8  1999     6 manual~ f        18    26 p     comp~
##  7 audi         a4         3.1  2008     6 auto(a~ f        18    27 p     comp~
##  8 audi         a4 quat~   1.8  1999     4 manual~ 4        18    26 p     comp~
##  9 audi         a4 quat~   1.8  1999     4 auto(l~ 4        16    25 p     comp~
## 10 audi         a4 quat~   2    2008     4 manual~ 4        20    28 p     comp~
## # ... with 224 more rows
</code></pre>
<p>De posse desse banco, você gostaria de construir um gráfico relacionando a eficiência do combustível de um carro (<code>hwy</code>) com o seu peso (<code>displ</code>). Sábio e malandro no <code>ggplot2</code>, você escreve o código a seguir:</p>
<pre><code class="language-r">ggplot(mpg, aes(displ,hwy, color = class)) +
  geom_point()
</code></pre>
<p><img src="/courses/tidyverse/dia3_files/figure-html/unnamed-chunk-2-1.png" width="672" /></p>
<p>Mas fica a dúvida: que escolhas foram feitas no momento de traduzir a minha <strong>intenção</strong> de produzir um diagrama de dispersão (<em>scatterplot</em>) do peso com o consumo de gasolina para a representação gráfica diante de nós? Que unidades de medidas estão dispostas nos eixos X e Y? Qual o sistema de coordenadas no qual isto foi representado? Quem define os limites de início e fim de cada eixo? Como cada ponto recebeu a sua cor? Essas perguntas podem parecer óbvias ou tontas, dependendo da perspectiva e da experiência do usuário, mas elas são centrais para entender como construir e modificar gráficos no <code>ggplot2</code>.</p>
<p>O pacote é inspirado pela <a href="http://vita.had.co.nz/papers/layered-grammar.pdf" target="_blank" rel="noopener">Gramática dos Gráficos</a>, e procura decompor o processo de produção de gráficos em uma sequência de camadas que vão se sobrepondo até chegar no objeto desejado.</p>
<ul>
<li>a camada dos <strong>dados</strong> e do mapeamento <strong>estético</strong> (que variáveis vão em quais eixos/escalas)</li>
<li>a camada dos objetos geométricos (pontos, linhas, barras, etc.)</li>
<li>a camada das escalas (natural? logarítmica? escala de cores?)</li>
<li>a camada das <strong>facetas</strong> (mini gráficos separados por alguma característica)</li>
<li>a camada das transformações estatísticas (distribuições de probabilidade, contagens, proporções, etc.)</li>
<li>o sistema de coordenadas (cartesiano? polar?)</li>
</ul>
<p>Obviamente, nem todo gráfico possui essa complexidade, e na verdade, a maioria dos gráficos que fazemos se encaixa num pequeno subgrupo de todas essas especificações, então porque toda essa complexidade?</p>
<p>Porque não? Em primeiro lugar, se você está produzindo visualizações simples que cumprem seu propósito, você não precisa se preocupar com quase nada disso, os <strong>padrões</strong> do ggplot2, via de regra, se encaixam perfeitamente na maioria dos problemas e, em segundo lugar, se você sentir a necessidade de ir mais fundo e produzir visualizações mais complexas, as mesmas ferramentas que você já conhece estão a sua disposição.</p>
<h2 id="três-gráficos-para-entender-a-mecânica-do-ggplot2">Três gráficos para entender a mecânica do ggplot2</h2>
<h3 id="scatterplots">Scatterplots</h3>
<p>Voltemos para o nosso gráfico original, vamos decompô-lo em suas camadas como se estivéssemos construindo ele passo-a-passo:</p>
<pre><code class="language-r"># Primeiro, a camada dos dados e mapeamentos estéticos
ggplot(
  # Dados
  data = mpg,
  # Que variável vai em que eixo
  mapping = aes(x = displ, y = hwy)
)
</code></pre>
<p><img src="/courses/tidyverse/dia3_files/figure-html/unnamed-chunk-3-1.png" width="672" /></p>
<p>Examinando a saída, vemos que ggplot desenhou um canvas com nossas variáveis, mas ainda nenhum objeto geométrico. Tudo bem, adicionamos (<code>+</code>) uma camada de objetos geométricos, no caso, pontos.</p>
<pre><code class="language-r"># Objetos geométricos começam com &quot;geom_&quot;
ggplot(data = mpg, mapping = aes(x = displ, y = hwy)) + # adicionamos
  geom_point()
</code></pre>
<p><img src="/courses/tidyverse/dia3_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
<p>Agora, nosso gráfico já tem uma cara de diagrama de dispersão. Mas ainda não tem as cores das classes de automóvel. Tudo bem, voltamos para a primeira camada e informamos que queremos um terceiro mapeamento estético.</p>
<pre><code class="language-r"># A cor é mapeada a variável class
ggplot(data = mpg, 
       mapping = aes(
         x = displ, y = hwy,
         color = class) # novo mapeamento estético
       ) + # adicionamos
  geom_point()
</code></pre>
<p><img src="/courses/tidyverse/dia3_files/figure-html/unnamed-chunk-5-1.png" width="672" /></p>
<p>Ok, chegamos no gráfico original. Mas como podem entender melhor as outras camadas? Vamos pensar, por exemplo, que talvez queiramos trabalhar a variável <code>hwy</code> numa escala logarítmica. Poderíamos transformar a variável original, claro, mas o <code>ggplot2</code> nos permite especificar as transformações diretamente nas escalas do gráfico!</p>
<pre><code class="language-r">ggplot(data = mpg, mapping = aes(x = displ, y = hwy, color = class)) +
  geom_point() + # adicionando uma nova &quot;camada&quot;
  scale_y_continuous(trans = &quot;log&quot;)
</code></pre>
<p><img src="/courses/tidyverse/dia3_files/figure-html/unnamed-chunk-6-1.png" width="672" /></p>
<p>Mas você, leitor, não ficou satisfeito. Você queria era transformar a variável <code>displ</code> em raíz quadrada. Tudo bem:</p>
<pre><code class="language-r">ggplot(data = mpg, mapping = aes(x = displ, y = hwy, color = class)) +
  geom_point() +
  scale_x_continuous(trans = &quot;sqrt&quot;) # especificamos a transformação na escala de x
</code></pre>
<p><img src="/courses/tidyverse/dia3_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
<p>Outro leitor não estava interessado nas escalas dos eixos x ou y, que são contínuas nesse caso, mas sim na seleção de cores utilizadas para representar a escala das cores. Por ser um leitor conhecedor das formas de deficiência visual cromática, ele optou pelas paletas de cores do <code>Colorbrewer</code>:</p>
<pre><code class="language-r">ggplot(data = mpg, mapping = aes(x = displ, y = hwy, color = class)) +
  geom_point() +
  scale_color_brewer(palette = &quot;Set1&quot;) # transformação da escala de cores
</code></pre>
<p><img src="/courses/tidyverse/dia3_files/figure-html/unnamed-chunk-8-1.png" width="672" /></p>
<p>Um geógrafo entrou na conversa e disse que o sistema cartesiano de coordenadas estava iludindo os leitores a pensar que a relação entre peso e consumo de combustível estava distorcida pelas diferenças entre as unidades de medida das variáveis, produzida pelo sistema cartesiano de coordenadas, então ele sugeriu que usássemos um sistema de coordenadas fixas:</p>
<pre><code class="language-r">ggplot(data = mpg, mapping = aes(x = displ, y = hwy, color = class)) +
  geom_point() +
  scale_color_brewer(palette = &quot;Set1&quot;) +
  coord_fixed()
</code></pre>
<p><img src="/courses/tidyverse/dia3_files/figure-html/unnamed-chunk-9-1.png" width="672" /></p>
<p>Ficou horrível, esse geógrafo não sabe nada. Como recompensa pela sua ignorância, agora ele ocupa um cargo no primeiro escalão do Ministério da Saúde.</p>
<p>Outro pesquisador estava interessado em visualizar as relações entre consumo, peso e classe, mas levando em consideração o fabricante do veículo, então, ele sugeriu que construíssemos um gráfico para cada. Você, que é preguiçoso, usou a capacidade do <code>ggplot2</code> de dividir gráficos através da introdução de uma camada de <code>facets</code>.</p>
<pre><code class="language-r">ggplot(data = mpg, mapping = aes(x = displ, y = hwy, color = class)) +
  geom_point() +
  scale_color_brewer(palette = &quot;Set1&quot;) + # adicionamos mais uma camada
  facet_wrap(~manufacturer)              # de facetas
</code></pre>
<p><img src="/courses/tidyverse/dia3_files/figure-html/unnamed-chunk-10-1.png" width="672" /></p>
<p>Agora, muito satisfeitos com o resultado do nosso trabalho, resolvemos incluir o gráfico numa publicação, mas do jeito que está, não dá. Então adicionamos mais algumas camadas para torná-lo apresentável.</p>
<pre><code class="language-r">ggplot(data = mpg, mapping = aes(x = displ, y = hwy, color = class)) +
  geom_point() +
  scale_color_brewer(palette = &quot;Set1&quot;) + 
  facet_wrap(~manufacturer) +
  # Colocamos os nomes nos eixos
  labs(title = &quot;Relação entre peso e economia de combustível de automóveis&quot;,
       subtitle = &quot;Separado por categoria e fabricante&quot;,
       x = &quot;Peso do veículo em toneladas&quot;,
       y = &quot;Consumo em milhas por galão de 3,5l&quot;,
       color = &quot;Categoria&quot;,
       caption = &quot;Fonte: Agência de Proteção Ambiental Estadunidense.&quot;) +
  # Escolhemos um tema bonito
  theme_light() +
  # Mudamos a posição da legenda, pra ficar mais jeitozinho
  theme(legend.position = &quot;bottom&quot;)
</code></pre>
<p><img src="/courses/tidyverse/dia3_files/figure-html/unnamed-chunk-11-1.png" width="672" /></p>
<p>Pronto. Mamãe vai ficar orgulhosa.</p>
<p>Brincadeiras a parte, entendendo um pouco melhor a gramática do gráfico, podemos construir nossas visualizações passo a passo, até chegar no resultado desejado.</p>
<h3 id="lineplots">Lineplots</h3>
<p>O segundo exemplo que quero mostrar pra vocês é a construção de gráficos com linhas. Eles são interessantes porque dão bastante dor de cabeça pra quem está começando. Vamos continuar brincando com o <code>mpg</code>.</p>
<p>Agora que eu fiz meu diagrama de dispersão, estou interessado em começar um processo de modelagem, mas primeiro quero ter uma noção visual da relação entre as variáveis.</p>
<pre><code class="language-r">ggplot(mpg, aes(displ, hwy)) +
  geom_point() +
  geom_smooth()
</code></pre>
<pre><code>## `geom_smooth()` using method = 'loess' and formula 'y ~ x'
</code></pre>
<p><img src="/courses/tidyverse/dia3_files/figure-html/unnamed-chunk-12-1.png" width="672" /></p>
<p><code>geom_smooth</code> ajusta um modelo aos dados e desenha a linha com os valores preditos. Agora que temos dois objetos geométricos, talvez seja interessante ver o que acontece se eu colocar as cores das classes.</p>
<pre><code class="language-r">ggplot(mpg, aes(displ, hwy, color = class)) +
  geom_point() +
  geom_smooth(se = FALSE)
</code></pre>
<pre><code>## `geom_smooth()` using method = 'loess' and formula 'y ~ x'
</code></pre>
<p><img src="/courses/tidyverse/dia3_files/figure-html/unnamed-chunk-13-1.png" width="672" /></p>
<p>Veja que ele fez o possível para aplicar as escalas nos dois objetos geométricos. Eu pedi para geom_smooth tirar os intervalos de confiança para melhorar a visibilidade. Mas e seu eu quisesse ver a cor dos pontos, mas manter a linha de tendência geral? Você pode especificar mapeamentos estéticos gerais (na primeira camada) ou mapeamentos estéticos locais (dentro de cada camada geométrica).</p>
<pre><code class="language-r">ggplot(mpg, aes(displ, hwy)) + # mapeamentos gerais, se aplicam a todos os objetos
  geom_point(aes(color = class)) + # mapeamento local, só se aplica aqui
  geom_smooth(se = FALSE)
</code></pre>
<pre><code>## `geom_smooth()` using method = 'loess' and formula 'y ~ x'
</code></pre>
<p><img src="/courses/tidyverse/dia3_files/figure-html/unnamed-chunk-14-1.png" width="672" /></p>
<p>Ok, mas e se eu quisesse um modelo linear ao invés de um &ldquo;Smoother de Loess&rdquo;?</p>
<pre><code class="language-r">ggplot(mpg, aes(displ, hwy)) + 
  geom_point(aes(color = class)) +
  geom_smooth(method = lm)
</code></pre>
<pre><code>## `geom_smooth()` using formula 'y ~ x'
</code></pre>
<p><img src="/courses/tidyverse/dia3_files/figure-html/unnamed-chunk-15-1.png" width="672" /></p>
<p>Não vou entrar muito nos argumentos de cada objeto geométrico e função, vocês podem aprender isso na prática olhando a documentação das funções que são do interesse de vocês. <code>?geom_smooth</code> para ver todas as possibilidades. Uma dica boa é usar <code>geom_smooth</code> para verificar interações entre variáveis numéricas e fatores.</p>
<pre><code class="language-r">ggplot(mpg, aes(displ, hwy, color = factor(cyl))) + 
  geom_point() +
  geom_smooth(method = lm)
</code></pre>
<pre><code>## `geom_smooth()` using formula 'y ~ x'
</code></pre>
<p><img src="/courses/tidyverse/dia3_files/figure-html/unnamed-chunk-16-1.png" width="672" /></p>
<p>Ok, mas e se temos um gráfico de linhas mais tradicional, tipo uma série histórica?</p>
<pre><code class="language-r">economics
</code></pre>
<pre><code>## # A tibble: 574 x 6
##    date         pce    pop psavert uempmed unemploy
##    &lt;date&gt;     &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;
##  1 1967-07-01  507. 198712    12.6     4.5     2944
##  2 1967-08-01  510. 198911    12.6     4.7     2945
##  3 1967-09-01  516. 199113    11.9     4.6     2958
##  4 1967-10-01  512. 199311    12.9     4.9     3143
##  5 1967-11-01  517. 199498    12.8     4.7     3066
##  6 1967-12-01  525. 199657    11.8     4.8     3018
##  7 1968-01-01  531. 199808    11.7     5.1     2878
##  8 1968-02-01  534. 199920    12.3     4.5     3001
##  9 1968-03-01  544. 200056    11.7     4.1     2877
## 10 1968-04-01  544  200208    12.3     4.6     2709
## # ... with 564 more rows
</code></pre>
<p>Podemos criar um gráfico de linhas tendo como base a data (<code>date</code>) e alguma das variáveis registradas, como a taxa de desemprego.</p>
<pre><code class="language-r">ggplot(economics, aes(x = date, y = uempmed)) +
  geom_line()
</code></pre>
<p><img src="/courses/tidyverse/dia3_files/figure-html/unnamed-chunk-18-1.png" width="672" /></p>
<p>Ou o consumo em bilhões de dólares</p>
<pre><code class="language-r">ggplot(economics, aes(x = date, y = pce)) +
  geom_line()
</code></pre>
<p><img src="/courses/tidyverse/dia3_files/figure-html/unnamed-chunk-19-1.png" width="672" /></p>
<p>Ou a população</p>
<pre><code class="language-r">ggplot(economics, aes(x = date, y = pop)) +
  geom_line()
</code></pre>
<p><img src="/courses/tidyverse/dia3_files/figure-html/unnamed-chunk-20-1.png" width="672" /></p>
<p>Ok, mas eu quero comparar visualmente o que ocorre com uma variável quando a outra muda. Podemos recorrer ao que aprendemos sobre mapeamentos estéticos globais e locais.</p>
<pre><code class="language-r">ggplot(economics, aes(x = date)) +
  geom_line(aes(y = uempmed)) +
  geom_line(aes(y = pce)) +
  geom_line(aes(y = pop))
</code></pre>
<p><img src="/courses/tidyverse/dia3_files/figure-html/unnamed-chunk-21-1.png" width="672" /></p>
<p>Ficou meio ruim, porque as variável tem grandezas distintas. Podemos tentar resolver esse problema aplicando transformações na variável idade, mas meio que pra qualquer lugar onde caminhos, batemos numa parede ou noutra. Esse tipo de solução é muito frequente entre pessoas que vem do <code>base</code> pro <code>ggplot2</code>, porque no base estamos acostumado a ideia de adicionar mais objetos geométricos ao nosso gráfico original adicionando invocações à funções como <code>lines</code> ou <code>text</code>. Porém, a solução preferida no <code>tidyverse</code> é aplicar uma transformação no banco original de tal forma que as nossas variáveis numéricas caiam todas num par que especifica <code>o nome da variável | e o valor dela</code>.</p>
<pre><code class="language-r">library(tidyr)
economics %&gt;% 
  pivot_longer(cols = -date,
               names_to = &quot;variavel&quot;,
               values_to = &quot;valor&quot;)
</code></pre>
<pre><code>## # A tibble: 2,870 x 3
##    date       variavel    valor
##    &lt;date&gt;     &lt;chr&gt;       &lt;dbl&gt;
##  1 1967-07-01 pce         507. 
##  2 1967-07-01 pop      198712  
##  3 1967-07-01 psavert      12.6
##  4 1967-07-01 uempmed       4.5
##  5 1967-07-01 unemploy   2944  
##  6 1967-08-01 pce         510. 
##  7 1967-08-01 pop      198911  
##  8 1967-08-01 psavert      12.6
##  9 1967-08-01 uempmed       4.7
## 10 1967-08-01 unemploy   2945  
## # ... with 2,860 more rows
</code></pre>
<p>Talvez não fique imediatamente claro para todos porque eu optei por esta solução, mas talvez essa próxima figura fale mais que mil palavras.</p>
<pre><code class="language-r">economics %&gt;% 
  pivot_longer(cols = -date,
               names_to = &quot;variavel&quot;,
               values_to = &quot;valor&quot;) %&gt;% 
  ggplot(aes(date, valor)) +
  geom_line() +
  facet_wrap(~variavel, scales = &quot;free_y&quot;, ncol = 1)
</code></pre>
<p><img src="/courses/tidyverse/dia3_files/figure-html/unnamed-chunk-23-1.png" width="672" /></p>
<p>A ênfase em usar <code>tidy data</code> no <code>tidyverse</code> decorre do fato de que todos os pacotes são programados para usar a forma de organização do banco como uma alavanca para facilitar a análise de dados. Vejam esta outra <code>pipeline</code>.</p>
<pre><code class="language-r"># Como vamos fazer algumas transformações nos dados, vamos carregar o dplyr aqui
library(dplyr)
</code></pre>
<pre><code>## 
## Attaching package: 'dplyr'
</code></pre>
<pre><code>## The following objects are masked from 'package:stats':
## 
##     filter, lag
</code></pre>
<pre><code>## The following objects are masked from 'package:base':
## 
##     intersect, setdiff, setequal, union
</code></pre>
<pre><code class="language-r">economics %&gt;% 
  pivot_longer(cols = -date,
               names_to = &quot;variavel&quot;,
               values_to = &quot;valor&quot;) %&gt;% 
  filter(variavel %in% c(&quot;psavert&quot;, &quot;uempmed&quot;)) %&gt;% 
  ggplot(aes(date, valor, color = variavel, shape = variavel)) +
  geom_line()
</code></pre>
<p><img src="/courses/tidyverse/dia3_files/figure-html/unnamed-chunk-24-1.png" width="672" /></p>
<p>E agora vejam um dos erros mais comuns de quem está começando:</p>
<pre><code class="language-r">economics %&gt;% 
  pivot_longer(cols = -date,
               names_to = &quot;variavel&quot;,
               values_to = &quot;valor&quot;) %&gt;% 
  filter(variavel %in% c(&quot;psavert&quot;, &quot;uempmed&quot;)) %&gt;% 
  ggplot(aes(date, valor)) +
  geom_line()
</code></pre>
<p><img src="/courses/tidyverse/dia3_files/figure-html/unnamed-chunk-25-1.png" width="672" /></p>
<p>Ao não especificar uma separação entre grupos, o <code>ggplot2</code> não interpreta meus dados! Ele simplesmente conecta as observações mais ou menos na ordem em que elas aparecem no eixo x. Para resolver esse problema, precisamos especificar grupos! Seja indiretamente, através de uma escala de cores, formas ou tipos de linha, seja diretamente através da estética <code>groups</code>.</p>
<pre><code class="language-r">economics %&gt;% 
  pivot_longer(cols = -date,
               names_to = &quot;variavel&quot;,
               values_to = &quot;valor&quot;) %&gt;% 
  filter(variavel %in% c(&quot;psavert&quot;, &quot;uempmed&quot;)) %&gt;% 
  ggplot(aes(date, valor, group = variavel)) +
  geom_line()
</code></pre>
<p><img src="/courses/tidyverse/dia3_files/figure-html/unnamed-chunk-26-1.png" width="672" /></p>
<pre><code class="language-r">economics %&gt;% 
  pivot_longer(cols = -date,
               names_to = &quot;variavel&quot;,
               values_to = &quot;valor&quot;) %&gt;% 
  filter(variavel %in% c(&quot;psavert&quot;, &quot;uempmed&quot;)) %&gt;% 
  ggplot(aes(date, valor, color = variavel, linetype = variavel)) +
  geom_line()
</code></pre>
<p><img src="/courses/tidyverse/dia3_files/figure-html/unnamed-chunk-27-1.png" width="672" /></p>
<p>Legal né?</p>
<h3 id="barcharts">Barcharts</h3>
<p>Para terminar e ilustrar alguns exemplos de transformação estatística, vamos fazer alguns gráficos de barras usando o <code>diamonds</code>, um banco de dados para fazer a alegria das piores pessoas na história da humanidade.</p>
<pre><code class="language-r">diamonds
</code></pre>
<pre><code>## # A tibble: 53,940 x 10
##    carat cut       color clarity depth table price     x     y     z
##    &lt;dbl&gt; &lt;ord&gt;     &lt;ord&gt; &lt;ord&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1  0.23 Ideal     E     SI2      61.5    55   326  3.95  3.98  2.43
##  2  0.21 Premium   E     SI1      59.8    61   326  3.89  3.84  2.31
##  3  0.23 Good      E     VS1      56.9    65   327  4.05  4.07  2.31
##  4  0.29 Premium   I     VS2      62.4    58   334  4.2   4.23  2.63
##  5  0.31 Good      J     SI2      63.3    58   335  4.34  4.35  2.75
##  6  0.24 Very Good J     VVS2     62.8    57   336  3.94  3.96  2.48
##  7  0.24 Very Good I     VVS1     62.3    57   336  3.95  3.98  2.47
##  8  0.26 Very Good H     SI1      61.9    55   337  4.07  4.11  2.53
##  9  0.22 Fair      E     VS2      65.1    61   337  3.87  3.78  2.49
## 10  0.23 Very Good H     VS1      59.4    61   338  4     4.05  2.39
## # ... with 53,930 more rows
</code></pre>
<p>Que tal um gráfico básico, do número de diamantes de acordo com a qualidade de seu corte (<code>cut</code>). Olhando a ajuda do <code>?geom_bar</code> você vai na certeza de que você entendeu a aula e escreve o seguinte código:</p>
<pre><code class="language-r">ggplot(diamonds, aes(x = cut, color = cut)) +
  geom_bar()
</code></pre>
<p><img src="/courses/tidyverse/dia3_files/figure-html/unnamed-chunk-29-1.png" width="672" /></p>
<p>E agora, você fica olhando pro seu computador com cara de tacho. O que aconteceu? Bom, no caso de <code>geoms</code> com duas dimensões, podem existir casos em que você quer dar mapeamentos estéticos distintos para as bordas e para o conteúdo deles. Por isso, existem as estéticas <code>color</code> e <code>fill</code>. Você pode pensar nelas como a casca do pão e o recheio.</p>
<pre><code class="language-r">ggplot(diamonds, aes(x = cut, fill = cut)) +
  geom_bar()
</code></pre>
<p><img src="/courses/tidyverse/dia3_files/figure-html/unnamed-chunk-30-1.png" width="672" /></p>
<p>Mas, você ainda não está satisfeito. Pela sua ampla experiência com uma das indústrias mais sangrentas e retrógadas do planeta você entende que a qualidade do corte não é o suficiente para determinar o valor de um diamante, então você quer ver a distribuição também pelo nível de transparência do diamante, codificado na variável <code>clarity</code>.</p>
<pre><code class="language-r">ggplot(diamonds, aes(x = cut, fill = clarity)) +
  geom_bar()
</code></pre>
<p><img src="/courses/tidyverse/dia3_files/figure-html/unnamed-chunk-31-1.png" width="672" /></p>
<p>Esse é um primeiro passo interessante, e se tivessemos apenas duas ou três categorias, a gente poderia parar por aí. Mas no geral, para facilitar comparações, queremos poder controlar o posicionamento das barras. Isso é possível ajustando o argumento <code>position</code> dos <code>geoms</code> onde isso é necessário.</p>
<pre><code class="language-r"># O padrão
ggplot(diamonds, aes(x = cut, fill = clarity)) +
  geom_bar(position = &quot;stack&quot;)
</code></pre>
<p><img src="/courses/tidyverse/dia3_files/figure-html/unnamed-chunk-32-1.png" width="672" /></p>
<pre><code class="language-r"># O certo
ggplot(diamonds, aes(x = cut, fill = clarity)) +
  geom_bar(position = &quot;dodge&quot;)
</code></pre>
<p><img src="/courses/tidyverse/dia3_files/figure-html/unnamed-chunk-32-2.png" width="672" /></p>
<pre><code class="language-r"># Empilhadas a 100%, para facilitar comparações entre categorias
ggplot(diamonds, aes(x = cut, fill = clarity)) +
  geom_bar(position = &quot;fill&quot;)
</code></pre>
<p><img src="/courses/tidyverse/dia3_files/figure-html/unnamed-chunk-32-3.png" width="672" /></p>
<p>Pode parecer jocoso, mas em 99% dos casos, o correto é você usar barras lado-a-lado, assim você visualmente pode comparar as categorias simplesmente comparando a altura das barras. Da próxima vez que você pensar em construir um gráfico de pizza, desista e faça um gráfico de barras com <code>position = &quot;dodge&quot;</code>. Seus leitores vão agradecer.</p>
<p>Esse exemplo também é legal para gente olhar um pouco para a parte de transformações estatísticas nas variáveis:</p>
<pre><code class="language-r">diamonds2 &lt;- diamonds %&gt;% 
  count(cut) %&gt;% 
  mutate(prop = n/sum(n))

diamonds2 %&gt;% 
  ggplot() +
  geom_bar(aes(x = cut, y = prop), stat = &quot;identity&quot;)
</code></pre>
<p><img src="/courses/tidyverse/dia3_files/figure-html/unnamed-chunk-33-1.png" width="672" /></p>
<p>Por padrão, <code>geom_bar</code> já faz o primeiro passo e utiliza as contagens (<code>stat_count</code>) para produzir o gráfico de barras, mas eu posso mudar esse comportamento através do argumento <code>stat</code>. Eu também posso querer mostrar proprções ao invés de contagens de outra forma mais sucinta.</p>
<pre><code class="language-r">ggplot(diamonds, aes(x = cut, 
                     # ao fazer isso, eu mudo o padrão de contagens para proporções.
                     y = stat(prop), 
                     # preciso especificar o grupo, se não todas as barras vão a 100%.
                     group = 1)) +
  geom_bar()
</code></pre>
<p><img src="/courses/tidyverse/dia3_files/figure-html/unnamed-chunk-34-1.png" width="672" /></p>
<p>Você pode construir seus gráficos a partir de transformações estatísticas ao invés de objetos geométricos:</p>
<pre><code class="language-r">ggplot(data = diamonds) + 
  stat_summary(
    mapping = aes(x = cut, y = depth),
    fun.min = min,
    fun.max = max,
    fun = median
  )
</code></pre>
<p><img src="/courses/tidyverse/dia3_files/figure-html/unnamed-chunk-35-1.png" width="672" /></p>
<p>As transformações estatísticas começam sempre com <code>stat_</code> e cada uma tem um objeto geométrico padrão, que você pode mudar com o argumento <code>geom</code>.</p>
<pre><code class="language-r">ggplot(data = diamonds) + 
  stat_summary(
    mapping = aes(x = cut, y = depth),
    fun.min = min,
    fun.max = max,
    # Não dá pra mostrar a mediana com barras de erro, sorry
    #fun = median,
    geom = &quot;errorbar&quot;
  )
</code></pre>
<p><img src="/courses/tidyverse/dia3_files/figure-html/unnamed-chunk-36-1.png" width="672" /></p>
<p>E era basicamente isso que eu tinha a dizer sobre como construir gráficos no <code>ggplot2</code>! Abaixo, uma seção com alguns detalhes para quem tiver interesse nessa parte de embelezamento dos gráficos.</p>
<h2 id="perfumaria">Perfumaria</h2>
<p>Essa seção pretende introduzir um pouco uma parte de customização dos gráficos. Frequentemente, as publicações de regras mais estritas sobre formatos, fontes, temas, etc. As opções padrão do <code>ggplot2</code> podem não se acomodar, então, cabe a nós ajeitar essa reta final.</p>
<h3 id="títulos-e-rótulos">Títulos e rótulos</h3>
<p>A melhor maneira de ajustar títulos e rótulos é através de <code>labs</code>, porque você resolve tudo em uma só invocação. Mas também há uma função <code>ggtitle</code>. Com ela, é possível setar apenas título e subtítulo.</p>
<pre><code class="language-r">ggplot(mpg, aes(displ, hwy, color = class)) +
  geom_point() +
  ggtitle(&quot;Título do gráfico&quot;, &quot;Subtítulo do gráfico&quot;)
</code></pre>
<p><img src="/courses/tidyverse/dia3_files/figure-html/unnamed-chunk-37-1.png" width="672" /></p>
<p>A maioria das opções de customização mais fina está na camada <code>theme</code>. Internamente, cada elemento do gráfico é controlado por uma função <code>element_</code>, por exemplo, <code>element_text</code> desenha textos e recebe argumentos relativos a isso, como família da fonte, tamanho, cor, etc.</p>
<p>Ali, você tem um controle mais direto sobre a construção do gráfico. No que diz respeito aos rótulos, podemos mudar a fonte do título.</p>
<pre><code class="language-r">ggplot(mpg, aes(displ, hwy, color = class)) +
  geom_point() +
  ggtitle(&quot;Título do gráfico&quot;, &quot;Subtítulo do gráfico&quot;) +
  # Family é meio complicado de mudar, mas você pode escolher serif, sans ou mono
  theme(plot.title = element_text(family = &quot;serif&quot;, face = &quot;bold&quot;, colour = &quot;red&quot;),
        plot.subtitle = element_text(family = &quot;mono&quot;, face = &quot;italic&quot;, color = &quot;forestgreen&quot;))
</code></pre>
<p><img src="/courses/tidyverse/dia3_files/figure-html/unnamed-chunk-38-1.png" width="672" /></p>
<p>Usando uma síntaxe similar e os argumentos da função <code>element_text</code>, você pode mudar qual outro elemento textual do gráfico.</p>
<h3 id="eixos">Eixos</h3>
<p>Continuando o nosso frankenstein, podemos fazer alterações nos eixos, como remover pedaços de um eixo, modificar sua forma, seu ângulo e ajustar sua posição.</p>
<pre><code class="language-r">ggplot(mpg, aes(displ, hwy, color = class)) +
  geom_point() +
  ggtitle(&quot;Título do gráfico&quot;, &quot;Subtítulo do gráfico&quot;) +
  # Family é meio complicado de mudar, mas você pode escolher serif, sans ou mono
  theme(plot.title = element_text(family = &quot;serif&quot;, face = &quot;bold&quot;, colour = &quot;red&quot;),
        plot.subtitle = element_text(family = &quot;mono&quot;, face = &quot;italic&quot;, color = &quot;forestgreen&quot;),
        # você pode remover pedaços inteiros do gráfico com &quot;element_blank()&quot;
        axis.ticks.y = element_blank(),
        axis.text.y = element_blank(),
        axis.title.y = element_blank(),
        # você pode mudar a orientação, angulo, posição e até formato de elementos
        axis.title = element_text(angle = 90, hjust = 1),
        axis.text.x = element_text(angle = 45, vjust = 1),
        axis.ticks.x = element_line(
          colour = &quot;royalblue3&quot;,
          arrow = grid::arrow(angle = 45, length = unit(0.5, &quot;cm&quot;), ends = &quot;first&quot;, type = &quot;closed&quot;))
  )
</code></pre>
<p><img src="/courses/tidyverse/dia3_files/figure-html/unnamed-chunk-39-1.png" width="672" /></p>
<p>Realmente, o céu é o limite e você pode deixar o seu gráfico tão horrível quanto você quiser.</p>
<h3 id="legendas">Legendas</h3>
<p>Legendas no <code>ggplot2</code> são controladas em alguns lugares diferentes. Elas são tratadas como guias (<code>guides</code>) no sentido de que são guias para o leitor. Vamos pegar outra variável de cores, para poder brincar com diferentes tipos de legenda.</p>
<pre><code class="language-r">ggplot(mpg, aes(displ, hwy, color = cyl)) +
  geom_point()
</code></pre>
<p><img src="/courses/tidyverse/dia3_files/figure-html/unnamed-chunk-40-1.png" width="672" /></p>
<p>Por padrão, ele entende cilindros como numérico e faz uma barra de cores contínua. Mas eu quero uma legenda!</p>
<pre><code class="language-r"># Jeito 1 - Simples e rápido
ggplot(mpg, aes(displ, hwy, color = cyl)) +
  geom_point() +
  guides(color = &quot;legend&quot;)
</code></pre>
<p><img src="/courses/tidyverse/dia3_files/figure-html/unnamed-chunk-41-1.png" width="672" /></p>
<pre><code class="language-r"># Jeito 2 - Posso mudar detalhes!
ggplot(mpg, aes(displ, hwy, color = cyl)) +
  geom_point() +
  guides(color = guide_legend(title = &quot;Cilindrossss&quot;,
                              title.position = &quot;right&quot;,
                              label.position = &quot;bottom&quot;,
                              direction = &quot;horizontal&quot;))
</code></pre>
<p><img src="/courses/tidyverse/dia3_files/figure-html/unnamed-chunk-41-2.png" width="672" /></p>
<pre><code class="language-r"># Jeito 3 - Mexendo diretamente nas escalas
ggplot(mpg, aes(displ, hwy, color = cyl)) +
  geom_point() +
  # Minha escala de cores preferida
  scale_color_viridis_c(guide = &quot;legend&quot;, option = &quot;B&quot;)
</code></pre>
<p><img src="/courses/tidyverse/dia3_files/figure-html/unnamed-chunk-41-3.png" width="672" /></p>
<pre><code class="language-r"># Jeito 3 - de novo, mas agora usando a especificação mais completa do guia
ggplot(mpg, aes(displ, hwy, color = cyl)) +
  geom_point() +
  # Minha escala de cores preferida
  scale_color_viridis_c(
    guide = guide_legend(title = &quot;Cilindrossss&quot;,
                         title.position = &quot;right&quot;,
                         label.position = &quot;bottom&quot;,
                         direction = &quot;horizontal&quot;), 
    option = &quot;B&quot;)
</code></pre>
<p><img src="/courses/tidyverse/dia3_files/figure-html/unnamed-chunk-41-4.png" width="672" /></p>
<p>Em qualquer lugar onde você possa especificar <code>guides</code>, você pode passar o valor <code>FALSE</code> para remover a legenda.</p>
<pre><code class="language-r"># Na camada &quot;guides()&quot;
ggplot(mpg, aes(displ, hwy, color = cyl, size = cyl)) +
  geom_point() +
  guides(color = FALSE)
</code></pre>
<p><img src="/courses/tidyverse/dia3_files/figure-html/unnamed-chunk-42-1.png" width="672" /></p>
<pre><code class="language-r"># Na própria escala
ggplot(mpg, aes(displ, hwy, color = cyl, size = cyl)) +
  geom_point() +
  scale_size(guide = FALSE)
</code></pre>
<p><img src="/courses/tidyverse/dia3_files/figure-html/unnamed-chunk-42-2.png" width="672" /></p>
<pre><code class="language-r"># Bônus = no tema, mas aí você remove todas
ggplot(mpg, aes(displ, hwy, color = cyl, size = cyl)) +
  geom_point() +
  theme(legend.position = &quot;none&quot;)
</code></pre>
<p><img src="/courses/tidyverse/dia3_files/figure-html/unnamed-chunk-42-3.png" width="672" /></p>
<h3 id="escalas">Escalas</h3>
<p>Já dei uma palhinha de editar escalas, antes, então aqui vai um pouco mais de detalhe:</p>
<pre><code class="language-r">ggplot(mpg, aes(displ, hwy, color = cyl, size = cyl)) +
  geom_point()
</code></pre>
<p><img src="/courses/tidyverse/dia3_files/figure-html/unnamed-chunk-43-1.png" width="672" /></p>
<pre><code class="language-r"># Mudar as cores manualmente
cores &lt;- c(&quot;red&quot;, &quot;green&quot;, &quot;blue&quot;, &quot;yellow&quot;, &quot;purple&quot;, &quot;tomato&quot;, &quot;wheat2&quot;)

ggplot(mpg, aes(displ, hwy, color = class, size = cyl)) +
  geom_point() +
  scale_color_manual(values = cores)
</code></pre>
<p><img src="/courses/tidyverse/dia3_files/figure-html/unnamed-chunk-43-2.png" width="672" /></p>
<pre><code class="language-r"># Mudar os tamanhos
ggplot(mpg, aes(displ, hwy, color = class, size = cyl)) +
  geom_point() +
  scale_color_manual(values = cores) +
  # scale_radius para fazer proprcional ao raio
  scale_radius(range = c(3,6))
</code></pre>
<p><img src="/courses/tidyverse/dia3_files/figure-html/unnamed-chunk-43-3.png" width="672" /></p>
<pre><code class="language-r">ggplot(mpg, aes(displ, hwy, color = class, size = cyl)) +
  geom_point() +
  scale_color_manual(values = cores) +
  # scale_size para fazer proprcional a área
  scale_size(range = c(2,4))
</code></pre>
<p><img src="/courses/tidyverse/dia3_files/figure-html/unnamed-chunk-43-4.png" width="672" /></p>
<p>É possível aplicar transformações na variável diretamente na escala, mudar o número de <code>breaks</code> e especificar <code>labels</code> e alterar os limites do gráfico manualmente.</p>
<pre><code class="language-r">ggplot(mpg, aes(displ, hwy, color = class, size = cyl)) +
  geom_point() +
  scale_x_continuous(trans = &quot;sqrt&quot;, name = &quot;Peso&quot;) +
  scale_y_continuous(
    name   = &quot;Consumo (rodovia)&quot;,
    limits = c(0, 50),
    breaks = c(10, 20, 30, 40, 50), 
    labels = c(&quot;fogo no clima&quot;, &quot;aquecimento global&quot;, &quot;caldeira planetária&quot;, &quot;deixa pra próxima geração&quot;, &quot;desastre em câmera lenta&quot;))
</code></pre>
<p><img src="/courses/tidyverse/dia3_files/figure-html/unnamed-chunk-44-1.png" width="672" /></p>
<p>Cada escala vai ter argumentos específicos que fazem sentido em seu próprio contexto. Escalas contínuas tem argumentos para transformação estatística, escalas discretas não aceitam argumentos contínuos e etc.</p>
<p>Isto encerra nossa parte de <code>ggplot2</code>, que tal uns exercícios pra esquentar?</p>
<h2 id="exercícios">Exercícios</h2>
<ol>
<li>O que tem de errado no código abaixo? Por que os pontos não ficaram azuis?</li>
</ol>
<pre><code class="language-r">ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy, color = &quot;blue&quot;))
</code></pre>
<p><img src="/courses/tidyverse/dia3_files/figure-html/unnamed-chunk-45-1.png" width="672" /></p>
<ol start="2">
<li>
<p>Utilizando o banco <code>mpg</code>, faça o diagrama de dispersão de <code>displ</code> por <code>hwy</code> e mapeie a cor para <code>class</code>, o tamanho para <code>cyl</code> e a forma para <code>manufacturer</code>. Como esses atributos estéticos se comportam diferente para variáveis categóricas vs contínuas?</p>
</li>
<li>
<p>Utilizando o <code>diamonds</code>, crie um diagrama de dispersão que relacione <code>carat</code> com <code>price</code>. Explore algumas outras variáveis utilizando escalas de cor para ver se você identifica algum padrão. Aplique transformações nas variáveis que você considerar justificadas.</p>
</li>
<li>
<p>Ainda continuando o exemplo anterior, aplique um <code>geom_smooth</code> utilizando várias opções de <code>method</code> para as variáveis originais ou transformadas.</p>
</li>
<li>
<p>No nosso gráfico de barras usando <code>stat(prop)</code> a gente precisou colocar <code>group = 1</code>, porque? Qual é a diferença entre esses dois códigos?</p>
</li>
</ol>
<pre><code class="language-r">ggplot(data = diamonds) + 
  geom_bar(mapping = aes(x = cut, y = after_stat(prop)))
</code></pre>
<p><img src="/courses/tidyverse/dia3_files/figure-html/unnamed-chunk-47-1.png" width="672" /></p>
<pre><code class="language-r">ggplot(data = diamonds) + 
  geom_bar(mapping = aes(x = cut, fill = color, y = after_stat(prop)))
</code></pre>
<p><img src="/courses/tidyverse/dia3_files/figure-html/unnamed-chunk-47-2.png" width="672" /></p>
<ol start="6">
<li><code>stat_smooth</code> é muito parecido com <code>geom_smooth</code>, mas há uma diferença sutil. Compare os códigos abaixo.</li>
</ol>
<pre><code class="language-r">ggplot(mpg, aes(displ, hwy)) + 
  geom_point() +
  geom_smooth()
</code></pre>
<pre><code>## `geom_smooth()` using method = 'loess' and formula 'y ~ x'
</code></pre>
<p><img src="/courses/tidyverse/dia3_files/figure-html/unnamed-chunk-48-1.png" width="672" /></p>
<pre><code class="language-r">ggplot(mpg, aes(displ, hwy)) + 
  geom_point() +
  stat_smooth(geom = &quot;step&quot;)
</code></pre>
<pre><code>## `geom_smooth()` using method = 'loess' and formula 'y ~ x'
</code></pre>
<p><img src="/courses/tidyverse/dia3_files/figure-html/unnamed-chunk-48-2.png" width="672" /></p>
<pre><code class="language-r">ggplot(mpg, aes(displ, hwy)) + 
  geom_point() +
  stat_smooth(geom = &quot;linerange&quot;)
</code></pre>
<pre><code>## `geom_smooth()` using method = 'loess' and formula 'y ~ x'
</code></pre>
<p><img src="/courses/tidyverse/dia3_files/figure-html/unnamed-chunk-48-3.png" width="672" /></p>
<pre><code class="language-r">ggplot(mpg, aes(displ, hwy)) + 
  geom_point() +
  stat_smooth(geom = &quot;errorbar&quot;)
</code></pre>
<pre><code>## `geom_smooth()` using method = 'loess' and formula 'y ~ x'
</code></pre>
<p><img src="/courses/tidyverse/dia3_files/figure-html/unnamed-chunk-48-4.png" width="672" /></p>
<pre><code class="language-r">ggplot(mpg, aes(displ, hwy)) + 
  geom_point() +
  stat_smooth(geom = &quot;crossbar&quot;)
</code></pre>
<pre><code>## `geom_smooth()` using method = 'loess' and formula 'y ~ x'
</code></pre>
<p><img src="/courses/tidyverse/dia3_files/figure-html/unnamed-chunk-48-5.png" width="672" /></p>
<ol start="7">
<li>
<p>Usando o <code>mpg</code> e <code>facet_grid</code>, crie um scatterplot que contenha <code>displ</code> no eixo x, <code>hwy</code> no eixo y, <code>class</code> na cor, <code>drv</code> nas facetas-coluna e <code>cyl</code> nas facetas linha.</p>
</li>
<li>
<p>Você acha que os dois gráficos abaixo ficarão diferentes um do outro? Porque? Tente responder antes de rodar o código.</p>
</li>
</ol>
<pre><code class="language-r">ggplot(data = mpg, mapping = aes(x = displ, y = hwy)) + 
  geom_point() + 
  geom_smooth()
</code></pre>
<pre><code>## `geom_smooth()` using method = 'loess' and formula 'y ~ x'
</code></pre>
<p><img src="/courses/tidyverse/dia3_files/figure-html/unnamed-chunk-50-1.png" width="672" /></p>
<pre><code class="language-r">ggplot() + 
  geom_point(data = mpg, mapping = aes(x = displ, y = hwy)) + 
  geom_smooth(data = mpg, mapping = aes(x = displ, y = hwy))
</code></pre>
<pre><code>## `geom_smooth()` using method = 'loess' and formula 'y ~ x'
</code></pre>
<p><img src="/courses/tidyverse/dia3_files/figure-html/unnamed-chunk-50-2.png" width="672" /></p>
<ol start="9">
<li>Tente recriar o seguinte gráfico</li>
</ol>
<pre><code>## `geom_smooth()` using formula 'y ~ x'
</code></pre>
<p><img src="/courses/tidyverse/dia3_files/figure-html/unnamed-chunk-51-1.png" width="672" /></p>
<ol start="10">
<li>Transforme o gráfico seguir em um gráfico de pizza usando <code>coord_polar</code>.</li>
</ol>
<pre><code class="language-r">ggplot(diamonds, aes(cut, fill = cut)) +
  geom_bar()
</code></pre>
<p><img src="/courses/tidyverse/dia3_files/figure-html/unnamed-chunk-52-1.png" width="672" /></p>

          </div>

          



          
          
          <div class="article-widget">
            
<div class="post-nav">
  
  
  
  <div class="post-nav-item">
    <div class="meta-nav">Previous</div>
    <a href="/courses/tidyverse/dia2/" rel="next">stringr, forcats e dplyr</a>
  </div>
  
  
</div>

          </div>
          
        </div>

        <div class="body-footer">
          <p>Last updated on 23 May 2021</p>

          





          




          


  
  



        </div>

      </article>

      <footer class="site-footer">

  

  

  
  <p class="powered-by">
    © 2021 LADDEM
  </p>
  

  
  






  <p class="powered-by">
    
    
    
      
      
      
      
      
      
      Published with <a href="https://wowchemy.com/?utm_campaign=poweredby" target="_blank" rel="noopener">Wowchemy</a> — the free, <a href="https://github.com/wowchemy/wowchemy-hugo-modules" target="_blank" rel="noopener">open source</a> website builder that empowers creators.
    
  </p>
</footer>


    </main>
  </div>
</div>

  </div>

  <div class="page-footer">
    
    
  </div>

  
<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Cite</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <pre><code class="tex hljs"></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-outline-primary my-1 js-copy-cite" href="#" target="_blank">
          <i class="fas fa-copy"></i> Copy
        </a>
        <a class="btn btn-outline-primary my-1 js-download-cite" href="#" target="_blank">
          <i class="fas fa-download"></i> Download
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>

      

    
    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/instant.page/5.1.0/instantpage.min.js" integrity="sha512-1+qUtKoh9XZW7j+6LhRMAyOrgSQKenQ4mluTR+cvxXjP1Z54RxZuzstR/H9kgPXQsVB8IW7DMDFUJpzLjvhGSQ==" crossorigin="anonymous"></script>

      
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.4/imagesloaded.pkgd.min.js" integrity="sha256-lqvxZrPLtfffUl2G/e7szqSvPBILGbwmsGE1MKlOi0Q=" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.6/isotope.pkgd.min.js" integrity="sha256-CBrpuqrMhXwcLLUd5tvQ4euBHCdh7wGlDfNz8vbu/iI=" crossorigin="anonymous"></script>
      

      
      

      

      
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/highlight.min.js" integrity="sha512-TDKKr+IvoqZnPzc3l35hdjpHD0m+b2EC2SrLEgKDRWpxf2rFCxemkgvJ5kfU48ip+Y+m2XVKyOCD85ybtlZDmw==" crossorigin="anonymous"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/languages/r.min.js"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/languages/python.min.js"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/languages/latex.min.js"></script>
        
      

    

    
    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/leaflet.min.js" integrity="sha512-SeiQaaDh73yrb56sTW/RgVdi/mMqNeM2oBwubFHagc5BkixSpP1fvqF47mKzPGWYSSy4RwbBunrJBQ4Co8fRWA==" crossorigin="anonymous"></script>
    

    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.2.2/anchor.min.js" integrity="sha512-I7w3ZdSFzw5j3jU3ZkNikBNeIrl3i+hEuEdwNmqUJvwNcaBUNcijnP2gd9DtGlgVYDplfjGoD8vTNsID+lCjqg==" crossorigin="anonymous"></script>
    <script>
      anchors.add();
    </script>
    

    
    
    
      
      <script id="search-hit-fuse-template" type="text/x-template">
        <div class="search-hit" id="summary-{{key}}">
          <div class="search-hit-content">
            <div class="search-hit-name">
              <a href="{{relpermalink}}">{{title}}</a>
              <div class="article-metadata search-hit-type">{{type}}</div>
              <p class="search-hit-description">{{snippet}}</p>
            </div>
          </div>
        </div>
      </script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.2.1/fuse.min.js" integrity="sha256-VzgmKYmhsGNNN4Ph1kMW+BjoYJM2jV5i4IlFoeZA9XI=" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script>
      
    

    
    

    
    
    
    

    
    <script src="/js/bootstrap.bundle.min.8b7df62fd2da18ce73e29c13cc0a6198.js"></script>

    
    
      
      
      
      
      
      
      
    

    
    
    
    
    
    
    
    
      
      
    
    
    <script src="/en/js/wowchemy.min.71e713848164e269bc250f377042949d.js"></script>

    
  <script async defer src="https://buttons.github.io/buttons.js"></script>




</body>
</html>
